(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["fdfa1aa0e118170244e2663bb81af06f"],{qgfM:function(e,t,n){"use strict";n("pNMO");n("ma9I");n("TeQF");n("fbCW");n("yXV3");n("2B1R");n("ToJy");n("5DmW");n("FZtP");var r=i(n("j6G6"));function i(e){return e&&e.__esModule?e:{default:e}}function s(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};var i=Object.keys(n);if(typeof Object.getOwnPropertySymbols==="function"){i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))}i.forEach(function(e){o(t,e,n[e])})}return t}function o(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}var l=n("e2gc");var a=n("q1z7");var _=n("F/us");var c=function e(t){if(!t){return t}var n="abstain";if(t.upVoted){n="up"}else if(t.downVoted){n="down"}t.voteType=n;if(t.date){t.date=new Date(t.date)}t.author={kaid:t.authorKaid,nickname:t.authorNickname,avatarSrc:t.authorAvatarSrc};delete t.authorKaid;delete t.authorNickname;delete t.authorAvatarSrc;if(t.showLowQualityNotice){t.lowQualityNotice={authorKaid:t.author.kaid,translatedFeedbackEditTip:t.translatedFeedbackEditTip,translatedFeedbackType:"post",lowQualityScore:t.lowQualityScore};delete t.showLowQualityNotice;delete t.translatedFeedbackEditTip;delete t.lowQualityScore}t.shownLowQualityNotice=t.shownLowQualityNotice||false;delete t.upVoted;delete t.downVoted;delete t.isQuestion;delete t.isAnswer;delete t.isComment;delete t.isReply;delete t.isScratchpad;delete t.isClarification;delete t.numberOfFlags;return t};var u=a.Model.extend({idAttribute:"key",parse:c,defaults:{shownLowQualityNotice:false},urlRoutes:{createUpdate:function e(){var t="/api/internal/discussions/".concat(this.getFocusKind(),"/")+"".concat(this.getFocusId(),"/").concat(this.get("type"));if(this.isNew()){return"".concat(t,"?casing=camel")}else{return"".concat(t,"/").concat(this.id,"?casing=camel")}},destroy:function e(){return"/api/internal/feedback/".concat(this.get("key"),"?casing=camel")}},toggleVote:function e(t,n){var i=this;var r=this.get("voteType");var s=this.get("sumVotesIncremented");var o={down:-1,abstain:0,up:1};var a=t;var c=o[t];if(t===r){a="abstain";c*=-1}var u=s+c;this.set({voteType:a,sumVotesIncremented:u});l.post("/api/internal/discussions/voteentity",{entity_key:this.id,vote_type:o[t]}).done(function(e){if(e&&e.error){i.set({voteType:r,sumVotesIncremented:s});n(e.error)}}).fail(function(){i.set({voteType:r,sumVotesIncremented:s});n("Log in first to vote")})},save:function e(t,n){this.unset("lowQualityNotice");n=n?_(n).clone():{};_(n).extend({url:this.urlRoutes.createUpdate.apply(this),parse:true});return a.Model.prototype.save.call(this,t,n)},destroy:function e(t){t=t?_(t).clone():{};_(t).extend({url:this.urlRoutes.destroy.apply(this),parse:true});if(this.get("inQueue")||this.userIsAuthor()){return a.Model.prototype.destroy.call(this,t)}else{this.sync("delete",this,t);this.set("deleted",true)}},undelete:function e(){var t=this;l.ajax({type:"PUT",url:"/api/internal/feedback/".concat(this.id,"/undelete?casing=camel"),contentType:"application/json"}).then(function(){t.set("deleted",false)})},convertTo:function e(t){var n=this;l.ajax({type:"PUT",url:"/api/internal/feedback/".concat(this.id,"/changetype?casing=camel"),contentType:"application/json",data:JSON.stringify({type:t}),dataType:"json"}).then(function(){n.set({flags:[],flaggedBy:[]})})},flag:function e(t,n){var i=this;var r={flag:t,justification:n,entity_key:this.id};l.ajax({type:"POST",url:"/api/internal/discussions/flagentity",dataType:"json",data:r}).then(function(){i.set("flaggedByUser",true)})},clearFlags:function e(){l.ajax({type:"PUT",url:"/api/internal/feedback/".concat(this.id,"/clearflags?casing=camel"),dataType:"json"})},markDuplicate:function e(){this.set("duplicateNotice",true)},unMarkDuplicate:function e(){this.unset("duplicateNotice")},userIsAuthor:function e(){var t=r.default.getUserProfile();var n=this.get("author");return t&&n&&t.get("kaid")===n.kaid},getFocusKind:function e(){return this.get("focusKind")||this.get("focus")&&this.get("focus").kind},getFocusId:function e(){return this.get("focusId")||this.get("focus")&&this.get("focus").id},getTextContent:function e(){return this.get("content")||this.get("text")||""},getThumbnailUrl:function e(){if(this.getFocusKind()==="scratchpad"){return"".concat(this.get("focus").relativeUrl,"/latest.png")}return null},getFocusUrlWithExpandKey:function e(){return"".concat(this.get("focus").relativeUrl,"?qa_expand_key=").concat(this.id)},canHaveVotes:function e(){return this.get("type")!=="reply"&&this.get("type")!=="projecteval"&&this.get("type")!=="projectevalanswer"},canHaveReplies:function e(){return this.get("type")==="clarification"||this.get("type")==="projecthelp"||this.get("type")==="answer"},canHaveAnswers:function e(){return this.get("type")==="question"||this.isProjectFeedbackRequest()||this.isProjectEval()},isProjectFeedbackRequest:function e(){return this.get("type")==="projecthelp"||this.get("type")==="projectcritique"},isProjectHelp:function e(){return this.get("type")==="projecthelp"},isProjectEval:function e(){return this.get("type")==="projecteval"},isAnswer:function e(){return this.get("type")==="answer"},isProjectEvalAnswer:function e(){return this.get("type")==="projectevalanswer"},isEditable:function e(){return this.get("type")!=="scratchpad"&&this.get("type")!=="reply"&&this.get("type")!=="projecteval"&&this.get("type")!=="projectevalanswer"},isFlaggable:function e(){return!this.isProjectEval()&&!this.get("hideFlagControls")},hasAnswers:function e(){return this.get("answers")&&this.get("answers").some(function(e){return!e.deleted})},isPassingEvalAnswer:function e(){return this.get("sumVotesIncremented")>1}});var f=a.Collection.extend({model:u,initialize:function e(t,n){this.type=n.type;this.complete=true;this.focusKind=n.focusKind;this.focusId=n.focusId;this.topic=n.topic;this.maxAnswers=n.maxAnswers;this.minAnswers=n.minAnswers;this.shuffle=n.shuffle;this.sortOrder=n.sortOrder;this.autoRefresh=n.autoRefresh;this.fetchCount=n.fetchCount},fetch:function e(t){var n=this;var i=function e(){n.fetchedInitial=true;n.trigger("change");return t&&t.success&&t.success.apply(t,arguments)};return a.Collection.prototype.fetch.call(this,s({},t,{success:i}))},parse:function e(t){var n=this;var i=[];if(t.feedback){i=t.feedback;_(i).each(function(e){e.focus=e.focus||t.focus});this.cursor=t.cursor;this.complete=t.complete;this.authorCoachedByUser=t.authorCoachedByUser}else{i=t;_(i).each(function(e){e.focus={kind:n.focusKind,id:n.focusId}})}return i},findDuplicate:function e(t){var n=t.getTextContent().toLowerCase();return this.find(function(e){var t=e.getTextContent().toLowerCase();return t.indexOf(n)>-1})},removeDuplicateNotice:function e(){this.each(function(e){e.unMarkDuplicate()})},url:function e(){var t="/api/internal/";var n={casing:"camel",limit:this.fetchCount||10};if(this.focusId){t+="discussions/".concat(this.focusKind,"/").concat(this.focusId,"/").concat(this.type)}else{t+=this.type;n["topic"]=this.topic}if(this.cursor){n["cursor"]=this.cursor}if(this.maxAnswers!=null){n["max_answers"]=this.maxAnswers}if(this.minAnswers!=null){n["min_answers"]=this.minAnswers}if(this.sortOrder){n["sort"]=this.sortOrder}if(this.shuffle){n["shuffle"]=1}return t+"?"+l.param(n)},isAllProjectHelpAnswered:function e(){return this.every(function(e){return!e.isProjectHelp()||e.hasAnswers()})},hasEvalRequests:function e(){return this.some(function(e){return e.isProjectEval()})},hasEvaluatedEvalRequests:function e(){return this.some(function(e){return e.isProjectEval()&&e.hasAnswers()})},hasPassingEvalRequests:function e(){return this.some(function(e){return e.isProjectEval()&&e.get("answers")&&e.get("answers").some(function(e){return!e.deleted&&e.sumVotesIncremented>1})})},hasPendingEvalRequests:function e(){return this.some(function(e){return e.isProjectEval()&&!e.hasAnswers()})},hasHelpRequests:function e(){return this.some(function(e){return e.isProjectHelp()})},getOpenEvalRequest:function e(){return this.find(function(e){return e.isProjectEval()&&!e.hasAnswers()})},getEvalAnswer:function e(){var t;this.some(function(e){if(e.isProjectEval()){t=_(e.get("answers")).find(function(e){return!e.deleted})}return!!t});return t&&new y(t)},getPassingEvalAnswer:function e(){var t;this.some(function(e){if(e.isProjectEval()){t=_(e.get("answers")).find(function(e){return!e.deleted&&e.sumVotesIncremented>1})}return!!t});return t&&new y(t)},getBestEvalAnswer:function e(){var t=this.getPassingEvalAnswer();if(!t){t=this.getEvalAnswer()}return t},getNextEvalUrl:function e(){var t="/computing/computer-programming";this.each(function(e){t=e.get("focus").subjectUrl});var n="".concat(t,"/projectfeedback/next-eval");var i=r.default.getUserProfile();if(i&&i.get("isModerator")){n+="?any_difficulty=1"}return n},isComplete:function e(){return _.isUndefined(this.complete)?true:this.complete}},{fromItemAnswers:function e(n){var t=[];if(n.get("answers")){t=n.get("answers").map(function(e){var t=c(e);t.focus=n.get("focus");return t})}return new w(t,{focusKind:n.get("focus").kind,focusId:n.get("focus").id,type:"answer"})}});var d=a.Model.extend({idAttribute:"key"},{forVideoModel:function e(t){return new d({urlRoot:d.urlForVideoModel(t),text:"",open_timestamp:50,close_timestamp:70})},urlForVideoModel:function e(t){return"/api/internal/clarifications_for/"+t.get("translatedYoutubeId")},userIsOmnipotent:function e(){var t=r.default.getUserProfile();return t&&t.get("canCreateOfficialClarifications")}});var h=a.Collection.extend({model:d,url:function e(){return d.urlForVideoModel(this.videoModel)},initialize:function e(t,n){this.videoModel=n.videoModel},comparator:"open_timestamp"});var p=u.extend({urlRoutes:{createUpdate:function e(){return"/api/internal/discussions/"+this.get("focusKind")+"/"+this.get("focusId")+"/clarifications?casing=camel"},destroy:function e(){return"/api/internal/feedback/"+this.get("key")+"?casing=camel"}}},{forVideoModel:function e(t){return new p({focusKind:"youtubevideo",focusId:t.get("translatedYoutubeId"),content:""},{parse:true})},forArticleId:function e(t){return new p({focusKind:"article",focusId:t,content:""},{parse:true})}});var g=f.extend({model:p,url:function e(){if(this.articleId){return g.urlForArticleId(this.articleId)}else{return g.urlForYoutubeId(this.videoModel.get("translatedYoutubeId"))}},initialize:function e(t,n){this.videoModel=n.videoModel;this.articleId=n.articleId},parse:function e(t){var n=t.feedback;_(n).each(function(e){e.focus=t.focus});return n}},{urlForYoutubeId:function e(t){return"/api/internal/discussions/youtubevideo/"+t+"/clarifications?casing=camel"},urlForArticleId:function e(t){return"/api/internal/discussions/article/"+t+"/clarifications?casing=camel"}});var v=u.extend({save:function e(t,n){this.set({text:this.get("content"),content:undefined});return u.prototype.save.call(this,t,n)},urlRoutes:{createUpdate:function e(){return"/api/internal/discussions/"+this.get("parentKey")+"/replies?casing=camel"},destroy:function e(){return"/api/internal/feedback/"+this.get("key")+"?casing=camel&lang=en"}}});var y=u.extend({answerType:"answers",save:function e(t,n){this.set({text:this.get("content"),content:undefined});return u.prototype.save.call(this,t,n)},urlRoutes:{createUpdate:function e(){var t="/api/internal/questions/"+"".concat(this.get("questionKey"),"/").concat(this.answerType);if(this.isNew()){return t+"?casing=camel"}else{return"".concat(t,"/").concat(this.get("key"),"?casing=camel")}},destroy:function e(){return"/api/internal/feedback/"+"".concat(this.get("key"),"?casing=camel&lang=en")}}});var m=y.extend({answerType:"projectevalanswers"});var w=f.extend({model:y,comparator:function e(t,n){var i=t.get("date"),r=n.get("date");return i<r?-1:i>r?1:0}});var b=f.extend({model:v,initialize:function e(t,n){this.parent=n.parent},url:function e(){return"/api/internal/discussions/"+"".concat(this.parent.id,"/replies?casing=camel")}},{fromItem:function e(t){return new b([],{parent:t})}});e.exports={sanify:c,DiscussionItemModel:u,DiscussionItemCollection:f,OfficialClarificationModel:d,OfficialClarificationCollection:h,ReplyModel:v,AnswerModel:y,ProjectEvalAnswerModel:m,ReplyCollection:b,AnswerCollection:w,SuggestedClarificationModel:p,SuggestedClarificationCollection:g}}}]);
//# sourceMappingURL=../../sourcemaps/en/fdfa1aa0e118170244e2663bb81af06f.a6777a4e3b31b384dcee.js.map