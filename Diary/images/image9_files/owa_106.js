self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.InlineImages.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[252],{11841:function(e,t,i){"use strict";i.r(t);var n=i(7),s=i(0),o=i(9968),a=i(4),r=i(2),l=i(70),d=i(20),h=i(1445),m=i(67),c=i(1823),g=i(3795),p="data-imgsize",u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s.__extends(t,e),t.prototype.render=function(){return r.createElement(h.a,{shouldFocusOnMount:!0,directionalHint:m.DirectionalHint.bottomRightEdge,target:this.props.anchorPoint,onDismiss:this.onDismissContextMenu,items:this.createContextMenuItems()})},t.prototype.createContextMenuItems=function(){var e=this,t=this.props.imageElement.getAttribute(p);t||(t="bestfit");var i={items:[{name:Object(a.a)(o.d),key:"bestfit",onClick:function(){e.onSetSizeBestFit()},isChecked:"bestfit"==t,canCheck:!0},{name:Object(a.a)(o.g),key:"small",onClick:function(){e.onSetSizeSmall()},isChecked:"small"==t,canCheck:!0},{name:Object(a.a)(o.e),key:"medium",onClick:function(){e.onSetSizeMedium()},isChecked:"medium"==t,canCheck:!0},{name:Object(a.a)(o.f),key:"original",onClick:function(){e.onSetSizeOriginal()},isChecked:"original"==t,canCheck:!0}]};return[{name:Object(a.a)(o.b),key:"resize",subMenuProps:i},{name:Object(a.a)(o.c),key:"remove",onClick:function(){e.onRemoveImage()}},{name:Object(a.a)(o.a),key:"addAltText",onClick:function(){g.f.import().then(function(t){e.props.imageElement&&t(e.props.imageElement,function(t){e.props.imageElement.alt=t})})}}]},t.prototype.onDismissContextMenu=function(e){y(),this.props.afterDismissContextMenu()},t.prototype.onSetSizeSmall=function(){this.removeImageWidthHeightAttributes(),this.props.imageElement.style.width=this.props.imageElement.naturalWidth/4+"px",this.props.imageElement.style.height="",this.props.imageElement.style.maxWidth="",this.props.imageElement.setAttribute(p,"small"),this.onImageChanged()},t.prototype.onSetSizeMedium=function(){this.removeImageWidthHeightAttributes(),this.props.imageElement.style.width=this.props.imageElement.naturalWidth/2+"px",this.props.imageElement.style.maxWidth="",this.props.imageElement.style.height="",this.props.imageElement.setAttribute(p,"medium"),this.onImageChanged()},t.prototype.onSetSizeBestFit=function(){this.removeImageWidthHeightAttributes(),this.props.imageElement.style.width="",this.props.imageElement.style.height="",this.props.imageElement.style.maxWidth="100%",this.props.imageElement.setAttribute(p,"bestfit"),this.onImageChanged()},t.prototype.onSetSizeOriginal=function(){this.removeImageWidthHeightAttributes(),this.props.imageElement.style.width=this.props.imageElement.naturalWidth+"px",this.props.imageElement.style.height="",this.props.imageElement.style.maxWidth="",this.props.imageElement.setAttribute(p,"original"),this.onImageChanged()},t.prototype.removeImageWidthHeightAttributes=function(){this.props.imageElement.removeAttribute("width"),this.props.imageElement.removeAttribute("height")},t.prototype.onRemoveImage=function(){this.props.imageElement.parentNode.removeChild(this.props.imageElement),this.onImageChanged()},t.prototype.onImageChanged=function(){this.props.onImageChanged&&this.props.onImageChanged()},s.__decorate([c.a],t.prototype,"createContextMenuItems",null),s.__decorate([c.a],t.prototype,"onDismissContextMenu",null),t=s.__decorate([d.observer],t)}(r.Component),I=null;function y(){I&&(l.unmountComponentAtNode(I),I.parentNode.removeChild(I),I=null)}var f,v=i(109),S=i(12),C=function(){function e(){var e=this;this.onMouseDownOnResizeHandle=function(t){e.imageSizeAtDragStart={width:e.selectedImage.width,height:e.selectedImage.height},e.dragHandlePositionAtDragStart={left:t.pageX,top:t.pageY},e.divBeingDragged=t.target,e.selectedImage.setAttribute(p,"custom")},this.onMouseMove=function(t){null!=e.divBeingDragged&&(e.selectedImage.style.maxWidth="",e.updateImageWidthAndHeightDuringDrag(t),e.updateSelectionBorderAndResizeHandlePositions(e.getElementPosition(e.selectedImage)))},this.onMouseUp=function(t){null!=e.divBeingDragged&&(e.divBeingDragged=null,e.onImageChanged&&e.onImageChanged())},this.onScroll=function(){null!=e.selectedImage&&e.updateSelectionBorderAndResizeHandlePositions(e.getElementPosition(e.selectedImage))}}return e.prototype.dispose=function(){var e=this;this.selectedImageBorder&&(this.selectedImageBorder.parentElement&&this.selectedImageBorder.parentElement.removeChild(this.selectedImageBorder),this.selectedImageBorder=null),this.resizeHandles&&(this.resizeHandles.forEach(function(t,i){t.removeEventListener("mousedown",e.onMouseDownOnResizeHandle),t.parentElement.removeChild(t),t=null}),this.resizeHandles=null),this.unbindEvents(),this.selectedImage=null,this.imageSizeAtDragStart=null,this.dragHandlePositionAtDragStart=null,this.divBeingDragged=null,this.composeBodyWrapper=null,this.scrollContainer=null},e.prototype.deselectImage=function(e){this.divBeingDragged||(this.selectedImage=null,this.selectedImageBorder&&(this.selectedImageBorder.style.display="none"),this.resizeHandles&&this.resizeHandles.forEach(function(e,t){e.style.display="none"})),e.imageSelected=null!=this.selectedImage,e.imageSelected||(this.onImageChanged=null)},e.prototype.selectImage=function(e,t,i,n,s){this.onImageChanged=s;var o=this.selectedImage==e;this.selectedImage&&this.deselectImage(n),o||(this.selectedImage=e,this.setComposeBodyWrapperDiv(i),this.setScrollContainer(t),e.parentElement&&"a"===e.parentElement.tagName.toLowerCase()||this.addSelectionBorderAndResizeHandles()),n.imageSelected=null!=this.selectedImage},e.prototype.deleteImage=function(e){var t=this.selectedImage;this.deselectImage(e),t&&t.parentNode&&t.parentNode.removeChild(t)},e.prototype.getSelectedImage=function(){return this.selectedImage},e.prototype.setComposeBodyWrapperDiv=function(e){this.composeBodyWrapper=e},e.prototype.setScrollContainer=function(e){this.scrollContainer!=e&&(this.scrollContainer&&this.unbindEvents(),this.scrollContainer=e,this.scrollContainer&&this.bindEvents())},e.prototype.addSelectionBorderAndResizeHandles=function(){this.selectedImageBorder||this.createSelectedImageBorder(),this.resizeHandles||this.createResizeHandles(),this.updateSelectionBorderAndResizeHandlePositions(this.getElementPosition(this.selectedImage)),this.resizeHandles.forEach(function(e,t){e.style.display="block"}),this.selectedImageBorder.style.display="block"},e.prototype.updateSelectionBorderAndResizeHandlePositions=function(e){this.resizeHandles&&this.selectedImageBorder?(this.resizeHandles[0].style.left=e.left-3+"px",this.resizeHandles[0].style.top=e.top-3+"px",this.resizeHandles[1].style.left=e.left+this.selectedImage.clientWidth-3+"px",this.resizeHandles[1].style.top=e.top-3+"px",this.resizeHandles[2].style.left=e.left+this.selectedImage.clientWidth-3+"px",this.resizeHandles[2].style.top=e.top+this.selectedImage.clientHeight-3+"px",this.resizeHandles[3].style.left=e.left-3+"px",this.resizeHandles[3].style.top=e.top+this.selectedImage.clientHeight-3+"px",this.selectedImageBorder.style.left=e.left+"px",this.selectedImageBorder.style.top=e.top+"px",this.selectedImageBorder.style.width=this.selectedImage.width-1+"px",this.selectedImageBorder.style.height=this.selectedImage.height-1+"px"):S.c.info("updateSelectionBorderAndResizeHandlePositions: failed to execute method")},e.prototype.createSelectedImageBorder=function(){this.selectedImageBorder=document.createElement("div"),this.selectedImageBorder.id="selectedImageBorder",this.selectedImageBorder.style.display="none",this.selectedImageBorder.style.borderWidth="1px",this.selectedImageBorder.style.borderStyle="solid",this.selectedImageBorder.style.borderColor=Object(v.g)().themePrimary,this.selectedImageBorder.style.position="absolute",this.selectedImageBorder.style.pointerEvents="none",this.composeBodyWrapper.appendChild(this.selectedImageBorder)},e.prototype.createResizeHandles=function(){this.resizeHandles=[];for(var e=["nw","ne","se","sw"],t=0;t<4;t++){var i=document.createElement("div");i.setAttribute("data-position",e[t]),i.style.display="none",i.style.width="6px",i.style.height="6px",i.style.position="absolute",i.style.backgroundColor=Object(v.g)().themePrimary,i.style.cursor=e[t]+"-resize",i.addEventListener("mousedown",this.onMouseDownOnResizeHandle),this.composeBodyWrapper.appendChild(i),this.resizeHandles.push(i)}},e.prototype.bindEvents=function(){document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),this.scrollContainer.addEventListener("scroll",this.onScroll)},e.prototype.unbindEvents=function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),this.scrollContainer&&this.scrollContainer.removeEventListener("scroll",this.onScroll)},e.prototype.updateImageWidthAndHeightDuringDrag=function(e){var t;switch(this.divBeingDragged.getAttribute("data-position")){case"nw":t={x:-1,y:-1};break;case"ne":t={x:1,y:-1};break;case"se":t={x:1,y:1};break;case"sw":t={x:-1,y:1};break;default:t={x:1,y:1}}var i=e.pageX-this.dragHandlePositionAtDragStart.left,n=e.pageY-this.dragHandlePositionAtDragStart.top,s=i*t.x+n*t.y,o=(this.imageSizeAtDragStart.width+s)/this.imageSizeAtDragStart.width,a=Math.min(50,this.selectedImage.naturalWidth),r=Math.min(50,this.selectedImage.naturalHeight);(this.imageSizeAtDragStart.width*o<a||this.imageSizeAtDragStart.height*o<r)&&(o=Math.max(a/this.imageSizeAtDragStart.width,r/this.imageSizeAtDragStart.height)),this.selectedImage.style.width=this.imageSizeAtDragStart.width*o+"px",this.selectedImage.style.height=this.imageSizeAtDragStart.height*o+"px"},e.prototype.getElementPosition=function(e){if(!this.selectedImageBorder)throw new Error("getElementPosition called without defined selectedImageBorder");var t=e.getBoundingClientRect(),i=this.selectedImageBorder.parentElement.getBoundingClientRect();return{top:t.top-i.top,left:t.left-i.left}},e}();function E(e){f&&f.deselectImage(e)}function b(){var e=null;return f&&(e=f.getSelectedImage()),e}var z=Object(n.action)("showInlineImageContextMenu")(function(e,t,i,n,s,o){E(i),function(e,t,i,n,s){I&&y(),(I=document.createElement("div")).id="inlineImageContentMenu",(s||document.body).appendChild(I),l.render(r.createElement(u,{anchorPoint:t,imageElement:e,afterDismissContextMenu:i,onImageChanged:n}),I)}(e,t,n,s,o)}),B=function(){function e(e){var t=this;this.scrollAdapter=e,this.onImageChanged=function(){t.editor&&t.editor.addUndoSnapshot()},this.onContextMenu=function(e){e.stopPropagation(),e.preventDefault(),z(e.target,{x:e.clientX,y:e.clientY},t.imageSelectionState,function(){t.editor&&t.editor.focus()},t.onImageChanged,t.contextMenuParentDiv)},this.boundInlineImages=[],this.imageSelectionInitialized=!1,this.imageSelectionState={imageSelected:!1}}return e.prototype.getName=function(){return"InlineImageResize"},e.prototype.initialize=function(e){this.editor=e,this.editor.getDocument().execCommand("enableObjectResizing",!1,"false")},e.prototype.dispose=function(){this.editor=null,this.cleanupBoundInlineImages(),this.composeBodyWrapper=null,this.imageSelectionInitialized&&(f&&(f.dispose(),f=null),this.imageSelectionInitialized=!1)},e.prototype.onPluginEvent=function(e){if(5===e.eventType){var t=e.rawEvent.target;null!==t&&"IMG"==t.nodeName?(this.bindEventsForNewInlineImage(t),n=t,s=this.scrollAdapter.getScrollContainer(),o=this.composeBodyWrapper,a=this.imageSelectionState,r=this.onImageChanged,f||(f=new C),f.selectImage(n,s,o,a,r)):this.deselectImageIfNecessary()}else if(0===e.eventType){var i=e.rawEvent;46===i.which||8===i.which?this.removeSelectedImage()&&(e.rawEvent.stopPropagation(),e.rawEvent.preventDefault()):this.deselectImageIfNecessary()}var n,s,o,a,r},e.prototype.setComposeBodyWrapperDiv=function(e){this.composeBodyWrapper=e},e.prototype.setContextMenuParentDiv=function(e){this.contextMenuParentDiv=e},e.prototype.bindEventsForNewInlineImage=function(e){this.boundInlineImages.includes(e)||(this.boundInlineImages.push(e),e.addEventListener("contextmenu",this.onContextMenu)),this.imageSelectionInitialized=!0},e.prototype.cleanupBoundInlineImages=function(){var e=this;this.boundInlineImages.forEach(function(t){t.removeEventListener("contextmenu",e.onContextMenu)}),this.boundInlineImages=null},e.prototype.deselectImageIfNecessary=function(){this.imageSelectionInitialized&&this.imageSelectionState.imageSelected&&E(this.imageSelectionState)},e.prototype.removeSelectedImage=function(){return!(!this.imageSelectionInitialized||!this.imageSelectionState.imageSelected)&&(e=this.imageSelectionState,f&&f.deleteImage(e),!0);var e},e}();i.d(t,"InlineImageResizePlugin",function(){return B}),i.d(t,"getSelectedImage",function(){return b})},1823:function(e,t,i){"use strict";function n(e,t,i){var n=i.value,s=!1;return{configurable:!0,get:function(){if(s||n&&this===n.prototype||this.hasOwnProperty(t))return n;var e=n&&n.bind(this);return s=!0,Object.defineProperty(this,t,{configurable:!0,writable:!0,enumerable:!0,value:e}),s=!1,e},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,enumerable:!0,value:e})}}}i.d(t,"a",function(){return n})},9968:function(e){e.exports={d:"qea",g:"rea",e:"sea",f:"tea",b:"uea",c:"vea",a:"wea"}}},0,[4,8,10,11,242,38,189]]);
//# sourceMappingURL=owa.InlineImages.js.map
self.scriptsLoaded['owa.InlineImages.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.InlineImages.js'] = (new Date()).getTime();