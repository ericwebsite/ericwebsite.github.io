self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.SharePointLink.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[364],{1380:function(e,t,r){"use strict";var n=r(894),o=r(1),a=Object(o.action)("SET_BPOS_NAV_BAR_DATA ",function(e){return{bposNavBarData:e}});Object(o.mutator)(a,function(e){n.a.bposNavBarData=e.bposNavBarData});var c=r(1388),i=r.n(c);var u=r(1383),s=r(27),f=Object(o.action)("LOAD_BposNavBarData"),l=f;Object(o.orchestrator)(f,function(e){Object(s.n)()||i()().then(function(e){a(e),Object(u.a)()})});var d=r(24);function p(){return n.a.bposNavBarData}r.d(t,"a",function(){return p}),r.d(t,"b",function(){return a}),Object(d.d)(function(){l()})},1383:function(e,t,r){"use strict";var n=r(1);t.a=Object(n.action)("ON_BPOS_NAV_BAR_DATA_LOADED")},1388:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(59);t.default=function(e){return n.makeServiceRequest("GetBposShellInfoNavBarData",{},e)}},4082:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.default=function(e){return n.__assign({__type:"FetchDataProviderResourceRequest:#Exchange"},e)}},4438:function(e,t,r){"use strict";r.d(t,"a",function(){return s});var n=r(0),o=r(4439),a=r.n(o),c=r(4082),i=r.n(c),u=r(12);function s(e,t,r){return n.__awaiter(this,void 0,void 0,function(){var o,c,s,f,l,d,p,v,b,O;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),o=btoa(t),c="u!"+o.replace(/^\=+|\=+$/g,"").replace("/","_").replace("+","-"),s=new RegExp(/.+?\:\/\/.+?(\/)/g).exec(t)[0],f=s+"_api/v2.0/shares/"+c+"/root?select=openWith/wac,officeBundle,@content.downloadUrl,name,size,currentUserRole&action="+(r?"Open":"View"),l=i()({ProviderType:e,Url:f}),d=(new Date).getTime(),[4,a()(l)];case 1:if(200===(p=n.sent()).Status&&p.Body)return v=(new Date).getTime(),(b=JSON.parse(p.Body)).fetchStartTime=d,b.responseStartTime=v,b.openWith.wac.fileGetUrl=b["@content.downloadUrl"],!r&&b.currentUserRole&&(b.currentUserRole.readOnly=!0),[2,b];throw new Error("Result status is: "+p.Status+" or empty response body.");case 2:return O=n.sent(),u.c.warn("Something went wrong while calling fetchDataProviderResourceOperation: "+O),[3,3];case 3:return[2,null]}})})}},4439:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(59),o=r(4082);t.default=function(e,t){return void 0===e||e.__type||(e=o.default(e)),n.makeServiceRequest("FetchDataProviderResource",e,t)}},4512:function(e,t,r){"use strict";r.d(t,"a",function(){return a});var n=r(4629),o=r.n(n);function a(e,t,r,n,a){return void 0===r&&(r=!1),void 0===n&&(n=!1),o()({request:{Url:e,IsEdit:n,ProviderType:t,ShouldGrantAccess:r}},a)}},4629:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(59),o=r(4630);t.default=function(e,t){return void 0===e.request||e.request.__type||(e.request=o.default(e.request)),n.makeServiceRequest("GetWacInfo",e,t)}},4630:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.default=function(e){return n.__assign({__type:"GetWacInfoRequest:#Exchange"},e)}},5450:function(e,t,r){"use strict";r.r(t);var n=r(1),o=Object(n.action)("tryQueueGetWacInfo",function(e){return{url:e}}),a=Object(n.action)("queueGetWacInfo",function(e){return{url:e}}),c=Object(n.action)("processGetWacInfoQueue"),i=Object(n.action)("getWacInfoQueueShift"),u=Object(n.action)("onStartGetWacInfoOperation",function(e){return{url:e}}),s=Object(n.action)("onFinishGetWacInfoOperation",function(e){return{url:e}}),f=Object(n.action)("pushSupressedUrl",function(e){return{url:e}}),l=Object(n.action)("onGetWacInfoSuccess",function(e,t){return{url:e,wacUrlInfo:t}}),d={activeGetWacInfoOperations:[],getWacInfoQueue:[],suppressedUrls:[],docLinkPreviewInfoMap:new(r(8).ObservableMap)},p=Object(n.createStore)("sharePointDocLinkPreview",d)();Object(n.mutator)(u,function(e){var t=e.url;p.activeGetWacInfoOperations.push(t)}),Object(n.mutator)(s,function(e){var t=e.url;p.activeGetWacInfoOperations.splice(p.activeGetWacInfoOperations.indexOf(t),1)}),Object(n.mutator)(l,function(e){var t=e.url,r=e.wacUrlInfo,n={time:Date.now(),wacUrlInfo:r};p.docLinkPreviewInfoMap.set(t,n)}),Object(n.mutator)(a,function(e){var t=e.url;p.getWacInfoQueue.push(t)}),Object(n.mutator)(i,function(){p.getWacInfoQueue.shift()}),Object(n.mutator)(f,function(e){var t=e.url;p.suppressedUrls.push(t)});var v=r(0),b=108e6;function O(e){var t=p.docLinkPreviewInfoMap.get(e);return t&&t.time+b>Date.now()?t:null}var h=r(4512),j=r(4438),S=r(5);function w(e,t){return v.__awaiter(this,void 0,void 0,function(){var r,n,o;return v.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,,5,6]),u(e),r=null,Object(S.d)("doc-SxS-jsApi-ODB-Links")?[4,Object(j.a)(0,e,!0)]:[3,2];case 1:return(n=a.sent())?(r={wacUrl:n.openWith.wac.applicationUrl,jsApiInfo:{bootScriptUrl:n.openWith.wac.bootstrapperUrl,wopiSrcUrl:n.openWith.wac.wopiSrc,accessToken:n.openWith.wac.accessToken,fileSize:n.size,fileGetUrl:n.openWith.wac.fileGetUrl,bundleInfo:n.officeBundle,fetchStartTime:n.fetchStartTime,responseStartTime:n.responseStartTime,openUrl:e,fileName:n.name},readOnly:n.currentUserRole.readOnly},[3,4]):(f(e),[2,null]);case 2:return[4,Object(h.a)(e,0)];case 3:if(9===(o=a.sent()).Status||6===o.Status||5===o.Status)return f(e),[2,null];0===o.Status&&(r={wacUrl:o.WacUrl,bootScriptUrl:o.BootScriptUrl,wopiSrcUrl:o.WopiSrcUrl,accessToken:o.AccessToken,token:o.Token}),a.label=4;case 4:return l(e,r),t?[2,O(e)]:[2,null];case 5:return s(e),[7];case 6:return[2]}})})}Object(n.orchestrator)(c,function(){return v.__awaiter(void 0,void 0,void 0,function(){var e;return v.__generator(this,function(t){switch(t.label){case 0:if(!p.getWacInfoQueue.length)return[2];if(p.activeGetWacInfoOperations.length>=2)return[2];e=p.getWacInfoQueue[0],u(e),i(),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,w(e,!1)];case 2:return t.sent(),[3,4];case 3:return s(e),c(),[7];case 4:return[2]}})})});var m=r(18),_=r(94),I=r(5647),y=r(3912),U="originalsrc",g="shash",k="data-auth",D="&reserved=0",P="SP_LINK_CLICK_EVENT_LISTENER";function W(e,t,r){o(t);var n=function(e){!function(e,t){if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var r=e.currentTarget,n=O(Object(S.d)("doc-SxS-jsApi-ODB-Links")&&G(r)?r.getAttribute(U):r.href);if(n)return Object(y.a)(function(){return Promise.resolve(n.wacUrlInfo)},t),e.preventDefault(),void T(null)}T(e.altKey?"AltKey":e.ctrlKey?"CtrlKey":e.metaKey?"MetaKey":e.shiftKey?"ShiftKey":"NoValidDocLinkPreviewInfo")}(e,r)};e.addEventListener("click",n),e[P]=n,e.addEventListener("mouseup",L)}function L(e){1===e.button&&T("MouseMiddleButton")}function T(e){Object(m.o)("SharePointLinkClick",{newTabReason:e})}Object(n.orchestrator)(y.b,function(e){var t=e.element,r=e.itemId;if("a"===t.tagName.toLowerCase()){var n=t;if(G(n)){var o=t.getAttribute(U);Object(I.a)(o)&&(Object(I.b)(o)?Object(S.d)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&(t.addEventListener("click",R),t[P]=R):Object(S.d)("doc-SxS-jsApi-ODB-Core")&&"Verified"===t.getAttribute(k)&&(Object(S.d)("doc-SxS-jsApi-ODB-Links")?W(t,o,r):W(t,n.href,r)),B())}else{o=n.href;Object(I.a)(o)&&(Object(I.b)(o)?Object(S.d)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&(t.addEventListener("click",R),t[P]=R):Object(S.d)("doc-SxS-jsApi-ODB-Core")&&W(t,o,r),B())}}});var A=!1;function B(){A||(A=!0,Object(m.o)("SharePointLinkFound"))}function G(e){return e.hasAttribute(U)&&e.hasAttribute(g)&&e.hasAttribute(k)}function R(e){var t,r=Date.now(),n=new m.a("ServiceGeneratedLinkClickHandler"),o="CT="+r+"&OR=OWA-NT&CID="+Object(_.a)(),a=e.currentTarget;if(G(a)){var c=a.href,i=c.indexOf(D);if(-1===i)return;var u=encodeURIComponent(btoa(o));t=c.substr(0,i)+"&xdata="+u+D}else{t=a.href+"&"+o}n.end(),window.open(t),e.preventDefault()}function N(e){var t=p.docLinkPreviewInfoMap.get(e),r=!!t;return(!t||t.time+b<=Date.now())&&o(e),r}Object(n.orchestrator)(y.c,function(e){var t=e.elements;t&&t.forEach(function(e){var t=e[P];t&&(e.removeEventListener("click",t),e[P]=null),e.removeEventListener("mouseup",L)})}),Object(n.orchestrator)(o,function(e){var t=e.url;p.getWacInfoQueue.some(function(e){return e===t})||p.activeGetWacInfoOperations.some(function(e){return e===t})||p.suppressedUrls.some(function(e){return e===t})||O(t)||(a(t),c())}),r.d(t,"tryProcessSharePointLink",function(){return y.b}),r.d(t,"tryUndoProcessSharePointLink",function(){return y.c}),r.d(t,"docLinkHadPreviewInfo",function(){return N}),r.d(t,"forceGetWacInfoOperation",function(){return w}),r.d(t,"getValidDocLinkPreviewInfo",function(){return O})},5647:function(e,t,r){"use strict";var n=r(1380),o=r(5),a=r(12),c=r(135),i=["https://microsoft.sharepoint.com","https://microsoft-my.sharepoint.com","https://microsoft.sharepoint-df.com","https://microsoft-my.sharepoint-df.com"];function u(e){var t=Object(n.a)();return t?!!s(e,t.SPO_MySiteHostUrl)||(!!s(e,t.SPO_RootSiteUrl)||!!Object(o.d)("doc-SharePoint-dogfoodUser")&&i.some(function(t){return s(e,t)})):(a.c.info("isSharePointLink:bposNavBarData is null"),!1)}function s(e,t){return Object(c.parse)(e).hostname===Object(c.parse)(t).hostname&&e!==t}function f(e){return!!e&&(e.indexOf("?at=")>0||e.indexOf("&at=")>0)}r.d(t,"a",function(){return u}),r.d(t,"b",function(){return f})},894:function(e,t,r){"use strict";var n=r(1),o=Object(n.createStore)("bposStore",{bposNavBarData:null})();t.a=o}},0,[463,87,464,98]]);
//# sourceMappingURL=owa.SharePointLink.js.map
self.scriptsLoaded['owa.SharePointLink.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.SharePointLink.js'] = (new Date()).getTime();