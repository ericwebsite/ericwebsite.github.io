!function(e){function t(t){for(var i,s,a=t[0],c=t[1],u=t[2],p=0,d=[];p<a.length;p++)s=a[p],r[s]&&d.push(r[s][0]),r[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(l&&l(t);d.length;)d.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(i=!1)}i&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},r={4:0},o=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.swcJsonp=window.swcJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;o.push([526,0]),n()}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(61),r=window;t.swcWindow=r,r.swc=r.swc||r.SkypeWebControl||{};var o=r.swc;t.swc=o,r.swc.shared=r.swc.shared||{},r.swc.scriptLoader=r.swc.scriptLoader||new i.ScriptLoader,r.SKYPE=r.SKYPE||{},r.SkypeWebControl=r.swc,r.swc.vendors=r.swc.vendors||{},t.SKYPE=r.SKYPE||{}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(62),s=n(18),a=function(){function e(){}return Object.defineProperty(e,"ECS",{get:function(){return i({},{frameless:""},r.swc.EcsConfig)},set:function(e){r.swc.EcsConfig=e},enumerable:!0,configurable:!0}),e.getPlatformId=function(){return o.PlatformUtils.getPlatformId()},e.getPlatformName=function(){return o.PlatformUtils.getPlatformName()},e.getClientVersion=function(){if(e.CLIENT_VERSION!==e.DEFAULT_CLIENT_VERSION)return e.CLIENT_VERSION;for(var t=e.ECS.version.split("."),n=t.length,i=0;i<4-n;i++)t.splice(t.length-1,0,"0");return e.CLIENT_VERSION=e.getPlatformId()+"/"+t.join("."),e.CLIENT_VERSION},e.getVersion=function(){if(e.VERSION!==e.DEFAULT_VERSION)return e.VERSION;for(var t=e.ECS.version.split("."),n=t.length,i=0;i<4-n;i++)t.splice(t.length-1,0,"0");return e.VERSION=t.join("."),e.VERSION},e.getChatClientInfo=function(){if(this.CHAT_CLIENT_INFO)return this.CHAT_CLIENT_INFO;var t=r.swc.EcsHeaderConfig&&r.swc.EcsHeaderConfig.CountryCode?r.swc.EcsHeaderConfig.CountryCode:"NR";return this.CHAT_CLIENT_INFO="os=Windows; osVer=10; proc=Win32; lcid=en-us; deviceType=1; country="+t+"; clientName=swc; clientVer="+e.getUiVersion(),this.CHAT_CLIENT_INFO},e.getUiVersion=function(){return this.UI_VERSION?this.UI_VERSION:(this.UI_VERSION=e.getClientVersion()+"//swc",this.UI_VERSION)},e.getClientInfo=function(){if(this.SYSTEM_INFO)return this.SYSTEM_INFO;var t=s.UNKNOWN_VERSION;try{t=window.navigator.platform}catch(e){}return this.SYSTEM_INFO=e.getUiVersion()+"os="+s.default.getOsName()+"; osVer="+s.default.getOsVersion()+"; proc="+t+"; deviceType="+s.default.getDeviceType()+"; browser="+s.default.getBrowserName()+"; browserVer="+s.default.getBrowserVersion(),this.SYSTEM_INFO},e.APPNAME="SWC",e.LOCALE="en-us",e.PES_LOCALE="en",e.ORIGIN="SkypeLWC",e.ORIGIN_CALLING="SkypeCalling",e.MSG_MAX_LENGTH=2e3,e.PLATFORM_ID=912,e.BUTTON_MARKER_CLASS=".skype-button",e.CHAT_MARKER_CLASS=".skype-chat",e.RECENTS_MARKER_CLASS=".skype-recents",e.LOGIN_CLIENT_ID="919866",e.LOGIN_PAGE_URL="https://login.skype.com/login",e.LOGIN_THEME="skype-white",e.LOGOUT_PAGE_URL="https://login.skype.com/logout",e.LOGIN_POPUP_URL="https://demoplayground.skype.com/joinlwc?t=",e.LOGIN_POPUP_FEATURES="width=600, height=620, menubar=no, status=no, titlebar=no, toolbar=no",e.LOGOUT_POPUP_FEATURES="width=1, height=1, menubar=no, status=no, titlebar=no, toolbar=no",e.TEAMS_URL="https://api.teams.skype.com/",e.TEAMS_AUTH_URL="https://authsvc.teams.microsoft.com/v1.0",e.TEAMS_PROFILE_URL="https://teams.microsoft.com/",e.TEAMS_MIDDLE_TIER_URL="https://teams.microsoft.com/api/mt/amer",e.TEAMS_CSA_URL="https://chatsvcagg.teams.microsoft.com",e.SHAREPOINT_URL="https://microsoft-my.sharepoint.com/",e.AMS_HOST_URL="https://api.asm.skype.com/v1/",e.APS_HOST_URL="https://api.aps.skype.com/v1/",e.CDN_SERVICE_HOST="secure.skypeassets.com",e.OA_URL="https://pro.skype.com/v1/onboarding",e.OA_URL_INT="https://havana-latest.skype.com/v1/onboarding",e.URLP_SERVICE_URL="https://urlp.asm.skype.com",e.ECS_GRAPH_URL="https://skypegraph.skype.com/",e.MS_GRAPH_URL="https://graph.microsoft.com/v1.0/me/",e.MS_APP_CLIENT_ID="b8d5facb-2aee-4653-98cb-4acc8f0d0e97",e.MS_APP_REDIRECT_URL_DEMO="https://latest-swc.cdn.skype.com/demo/connect.html",e.MS_APP_REDIRECT_URL_OUTLOOK="https://latest-swc.cdn.skype.com/demo/msauth.html",e.MS_AUTHORIZE_URL="https://login.microsoftonline.com/common/oauth2/v2.0/authorize",e.ECS_GRAPH_ETAG=null,e.ECS_GRAPH_SERVICE_SETTINGS=null,e.INVITE_HOST_URL_INT="https://latest-join.skype.com/api/v1/",e.INVITE_HOST_URL="https://join.skype.com/api/v1/",e.CHAT_CLIENT_INFO="",e.CHAT_GUEST_HOST_URL="https://client-s.gateway.messenger.live.com/v1/",e.CHAT_HOST_URL="https://client-s.gateway.messenger.live.com/v1/",e.CHAT_JOIN_URL="https://latest-join.skype.com/api/v2/conversation",e.SKYPE_CALLER_ID="lwc",e.CONTACTS_HOST_URL="https://edge.skype.com/pcs-df/contacts/v2/",e.CONTACTS_SCD_HOST_URL="https://scd.skype.com/contacts/v3/",e.AGENTS_HOST_URL="https://join.skype.com/",e.AVATAR_SERVICE_URL="https://avatar.skype.com/v1/",e.STRATUS_DOMAIN_HOST_URL="https://profile.skype.com/profile/v1/",e.WX_HOST_URL="https://wx.skype.com/api/v1/scom/",e.USER_OPTIONS_SERVICE={OLD:"https://options.skype.com/",PROD:"https://edge.skype.com/",INT:"https://optionsservice-test-northeurope.cloudapp.net:443/"},e.ECS_CLIENT_NAME="skype",e.ECS_TEAM_NAME="lwc",e.ECS_CLIENT_VERSION="1.00",e.GET_HELP_URL="https://support.skype.com/en/faq/FA34704/what-is-skype-web-control",e.PRIVACY_AND_COOKIES_URL="https://go.microsoft.com/fwlink/?LinkId=521839",e.TERMS_OF_USE_URL="https://go.microsoft.com/fwlink/?LinkID=246338",e.CONCIERGE_BOT_MRI="28:concierge",e.CONCIERGE_BOT_DF_MRI="28:concierge_df",e.BRB_BOT_MRI="28:a62068e3-63e9-4ffc-89a6-14d841e224d2",e.BRB_BOT_MRI_TEAMS="28:5932bde2-77dd-4eb7-a704-d1da88e37485",e.BRB_START_MESSAGE="Sending feedback details...",e.NEW_CHAT_COMPOSER_ID="newChatComposerId",e.DEFAULT_VERSION="0.0.0.0",e.DEFAULT_CLIENT_VERSION=e.getPlatformId()+"/"+e.DEFAULT_VERSION,e.CLIENT_VERSION=e.DEFAULT_CLIENT_VERSION,e.VERSION=e.DEFAULT_VERSION,e.DEFAULT_AVATAR_URI="https://swc.cdn.skype.com/assets/img/defaultAvatar.png",e.MSG_DELETED_CLASSIC_SKYPE="Edited previous message: ",e.UI_VERSION="",e.SYSTEM_INFO="",e.MESSAGE_PROPERTIES={GLOBAL:{ACTIVITY_DATA:"activityData",PINNED:"pinned",PROTOTYPE_SKYPEX:"prototype_skypex"},PER_USER:{EMOTIONS:"emotions",POLL:"poll",TRANSLATIONS:"translations",ACTIVITY_DATA:"activityData",SMS_REPORT:"smsdeliveryreports"}},e.CHAT_SERVICE_COMMANDS={SET_MESSAGE_PROPERTY:"setMessageProperty",REMOVE_MESSAGE_PROPERTY:"removeMessageProperty",REMOVE_ALL_MESSAGES:"removeAllMessage",SET_IS_FAVORITE:"setIsFavorite",SMS_PRICE:"getSmsPrice"},e}();t.Configuration=a},,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(95),s=n(12),a=n(15),c=n(0),u=n(107),l=function(e){function t(){var t=e.call(this)||this;return t.sessionId="",t.backend=a.MessagingBackend.UNDETERMINED,t.style="",t.translatorEnabled=!1,t.frameless=!1,t.callingReady=!1,t.standaloneCalling=!1,t.largeEmoticonClass=!1,t.isParallelView=!1,t.parentProtocol="n/a",t.bridge(),t}return r(t,e),Object.defineProperty(t,"get",{get:function(){return c.swc.shared.app||(c.swc.shared.app=new t),c.swc.shared.app},enumerable:!0,configurable:!0}),t.prototype.getCurrentLocale=function(e){return u.LocaleInfo.instance.getLocale(e)},t.prototype.copy=function(e){e&&Object.getOwnPropertyNames(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);i&&i.writable&&(t[n]=i.value||t[n])})},t.prototype.isTeams=function(){return this.backend===a.MessagingBackend.TEAMS},Object.defineProperty(t.prototype,"theme",{get:function(){return this._theme},set:function(e){e!==this._theme&&(this._theme=e,this.publish("theme",e))},enumerable:!0,configurable:!0}),t.prototype.bridge=function(){var e=this;c.swc.Eventing.registerEvent(o.ApiEventsBridgeTheme.response,function(t){return e.theme=t}),c.swc.Eventing.triggerEvent(o.ApiEventsBridgeTheme.request)},t}(s.default);t.default=l},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(50)),i(n(75)),i(n(76)),i(n(69)),i(n(77)),i(n(70))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(19),s=n(192),a=n(193),c=n(143),u=n(165),l=n(11),p=n(26),d=n(0),f=n(180),h=n(194),g=n(196),m=n(199),v=n(202),y=n(144),_=n(145),b=n(204),w=n(207),C=n(146),S=n(210),T=n(213),E=n(215),P=n(216),I=n(218),k=n(149),M=n(221),O=n(151),A=n(223),x=n(224),N=n(225),L=n(179),R=n(131),D=n(228),U=n(231),F=n(232),j=n(233),B=n(236),H=n(164),G=n(237),z=n(153),W=n(249),V=n(250),K=n(254),q=n(257),J=n(260),Y=n(261),$=n(264),X=n(265),Q=n(267),Z=n(268),ee=n(269),te=n(271),ne=n(181),ie=n(277),re=n(279),oe=n(280),se=n(289),ae=n(323),ce=n(324),ue=function(){function e(){this.activeEndpoints=[]}return Object.defineProperty(e,"unreadCounterStore",{get:function(){return this._unreadCounterStore||(this._unreadCounterStore=new J.UnreadCounterStore(e.mePerson.mri)),this._unreadCounterStore},enumerable:!0,configurable:!0}),e.ready=function(){try{return e.initPromise.then(function(){return e})}catch(e){return Promise.reject("Initialize services first")}},Object.defineProperty(e,"initPromise",{get:function(){return e._initPromise.promise},enumerable:!0,configurable:!0}),e.setExternalLogin=function(t){e._externalLogin||(e._externalLogin=t)},Object.defineProperty(e,"presenceService",{get:function(){return N.UnifiedPresenceService},enumerable:!0,configurable:!0}),e.completePostSignInActions=function(t,n){n.userSettings&&n.userSettings.forceDisplayName&&e.mePerson.forceDisplayName(n.userSettings.forceDisplayName),i.default.get.isTeams()?e.signInManager&&e.signInManager.isAadSupported()&&e.presenceService.startPolling():e.contactsManager.fetchMyContacts(),(new x.PresenceProxyOperator).registerServices(),e.notificationSettingsStore.registerProxy(),e.unreadCounterStore.subscribe(function(e){d.swc.Eventing.triggerEvent("unreadConversationsUpdate",e,null,!0)});var r=function(){return d.swc.Eventing.triggerEvent("swc:recents:loaded")};e.conversations.prefetchRecents().then(function(t){r();var n=[];Object.keys(e.conversations.getAll()).forEach(function(t){var i=e.conversations.get(t);i.isUnread&&n.push(i)}),e.notificationsManager.enableNotifications(),e.notificationsManager.registerUnreadIConversationsSummary(n)}).catch(function(e){r()}).then(function(){return e._polling});var o=t||i.default.get.getCurrentLocale(),s=window.document.dir.length>0?window.document.dir:"ltr";e.signInManager.isAadSupported()&&e.avatarService,d.swc.Telemetry&&(d.swc.Telemetry.Context.ServiceManager.setUsername(e.signInManager.currentUserName),d.swc.Telemetry.Context.ServiceManager.setGuest(e.signInManager.userIdentityType===p.IdentityType.GUEST),d.swc.Telemetry.Context.ServiceManager.setIdentityType(e.signInManager.userIdentityType),d.swc.Telemetry.Context.ServiceManager.setCommercial(e.signInManager.isAadSupported()),d.swc.Telemetry.Context.ServiceManager.setLanguage(o),d.swc.Telemetry.Context.ServiceManager.setRTLMode(s),d.swc.Telemetry.Context.ServiceManager.setBackend(i.default.get.backend),d.swc.Telemetry.Context.ServiceManager.setIsFrame(!i.default.get.frameless))},e.readyAndSignedIn=function(){var t=e.signInManager;return t.onceSignedIn().then(function(){return t.isAadSupported()?R.TokenType.Aad:R.TokenType.Skype})},Object.defineProperty(e,"teamsMiddleTier",{get:function(){return e._teamsMiddleTierPromise||(e._teamsMiddleTierPromise=e.readyAndSignedIn().then(function(t){return t===R.TokenType.Aad?new E.TeamsMiddleTierClient(r.Configuration.TEAMS_MIDDLE_TIER_URL,e.signInManager.aad):Promise.reject("Not supported for Consumer")})),e._teamsMiddleTierPromise},enumerable:!0,configurable:!0}),Object.defineProperty(e,"teamsChatServiceAggregatorClient",{get:function(){return!e._teamsChatServiceAggregatorClient&&e.signInManager.isAadSupported()&&(e._teamsChatServiceAggregatorClient=new T.ChatServiceAggregatorClient(r.Configuration.ECS.teamsCsaUrl||r.Configuration.TEAMS_CSA_URL,e.signInManager.aad,r.Configuration.ECS.teamsCsaHeaders)),e._teamsChatServiceAggregatorClient},enumerable:!0,configurable:!0}),Object.defineProperty(e,"userService",{get:function(){return e._userService||(e._userService=e.readyAndSignedIn().then(function(){return e.teamsMiddleTier.then(function(e){return new ie.UserService(e)})})),e._userService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"i18n",{get:function(){return e._i18n},enumerable:!0,configurable:!0}),Object.defineProperty(e,"signInManager",{get:function(){return e._skypeSignInManager?e._skypeSignInManager:null},enumerable:!0,configurable:!0}),Object.defineProperty(e,"agentsManager",{get:function(){return this._agentsManager||(this._agentsManager=new a.SkypeAgentsManager),this._agentsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cbl",{get:function(){if(!this._cbl){var e=d.swc.SDK.platformId,t=new oe.CblManager;this._cbl=t.get(e)}return this._cbl},enumerable:!0,configurable:!0}),Object.defineProperty(e,"sessionStorage",{get:function(){return q.getSessionStorage()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"polling",{get:function(){return e._polling||(i.default.get.isTeams()?(e._polling=S.getTeamsPolling(),e._polling.start(),r.Configuration.ECS.isLongPollTabActivationEnabled&&r.Configuration.ECS.cnsPollingDisabled&&w.enableLongPollTabActivation(S.getTeamsPolling())):e._polling=new C.Polling),e._polling},enumerable:!0,configurable:!0}),Object.defineProperty(e,"localStorage",{get:function(){return q.getLocalStorage()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"conversations",{get:function(){return e._conversationsManager||(e._conversationsManager=new se.default),e._conversationsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"viewports",{get:function(){return e._viewports||(e._viewports=new re.ViewportManager)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"teamsGraphService",{get:function(){return new X.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"skypeGraphService",{get:function(){return new K.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"microsoftGraphService",{get:function(){return new j.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"stratusService",{get:function(){return e._stratusService||(e._stratusService=i.default.get.isTeams()?new $.default:new Y.default),e._stratusService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"amsManager",{get:function(){if(!e._amsManager)if(i.default.get.isTeams()){var t=!(!e._options||!e._options.fileSharing)&&!!e._options.fileSharing.forceEnterpriseAms;e._amsManager=new u.TeamsAmsManager(new V.SharepointService,new h.AmsService,t)}else e._amsManager=new c.SkypeAmsManager(new h.AmsService);return e._amsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"webApi",{get:function(){return this._webApi},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pesManager",{get:function(){return e._pesManager||(i.default.get.isTeams()?e._pesManager=new W.default:e._pesManager=new z.default),e._pesManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"mePersonManager",{get:function(){return e._mePersonManager||(e._mePersonManager=new s.default),e._mePersonManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"contactsManager",{get:function(){return e._contactsManager||(e._contactsManager=new M.SkypeContactsManager),e._contactsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"searchManager",{get:function(){return e._searchManager||(i.default.get.isTeams()?e._searchManager=new A.TeamsSearchManager:e._searchManager=new O.default),e._searchManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"persons",{get:function(){return e._persons||(e._persons=new ae.default),e._persons},enumerable:!0,configurable:!0}),Object.defineProperty(e,"botsService",{get:function(){return new D.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"agentsService",{get:function(){return e._agentsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"contactsService",{get:function(){return e._contactsService||(e._contactsService=i.default.get.isTeams()?new I.default:new k.default),e._contactsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"userOptionsService",{get:function(){return e._userOptionsService||(e._userOptionsService=new te.UserOptionsService),e._userOptionsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"notificationSettingsStore",{get:function(){return e._notificationSettingsStore||(e._notificationSettingsStore=new B.default),e._notificationSettingsStore},enumerable:!0,configurable:!0}),Object.defineProperty(e,"trouterService",{get:function(){return e._trouterService||(e._trouterService=new ee.Trouter),e._trouterService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"capabilitiesService",{get:function(){if(!e._capabilitiesService){var t=e.signInManager.aad;if(e.signInManager.isAadSupported()){var n=new ne.TeamsUserPolicyService(t,new f.LocalCacheStorage(e.signInManager.currentUserName));e._capabilitiesService=new v.TeamsCapabilitiesService(n)}else e._capabilitiesService=new y.SkypeCapabilitiesService}return e._capabilitiesService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"outlookContactsService",{get:function(){return e._outlookContactsService||(e._outlookContactsService=new P.default),e._outlookContactsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"translatorService",{get:function(){return Z.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"oa",{get:function(){return G},enumerable:!0,configurable:!0}),Object.defineProperty(e,"wx",{get:function(){return e._wx},enumerable:!0,configurable:!0}),Object.defineProperty(e,"mePerson",{get:function(){return e._mePerson},enumerable:!0,configurable:!0}),Object.defineProperty(e,"notificationsManager",{get:function(){return e._notificationsManager||(e._notificationsManager=new H.default),e._notificationsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"avatarService",{get:function(){return e._avatarService||(e._avatarService=new m.default),e._avatarService},enumerable:!0,configurable:!0}),e.setEverOpenedChats=function(t){e._everOpenedChats=t},e.signinStateHandler=function(){switch(this.signInManager.state){case o.SigninState.SignedOut:this.webApi.reset(),this.persons.dispose(),this._mePerson=null;break;case o.SigninState.SignedIn:this._mePerson||(this._mePerson=new F.default("8:"+this.signInManager.currentUserName))}},e.recentVisibilityHandler=function(t){if(e._isRecentsVisible=t,t){var n=Date.now().toString();e.localStorage.setItem("swc-recentslastseen",n),this._webApi.startEndpointActivation()}else e.isActive()||this._webApi.stopEndpointActivation()},e.chatShownHandler=function(t,n){if(n&&n.currentConversationId){if(t)return e._isChatShown=!0,void this.webApi.startEndpointActivation();e._isChatShown=!1;for(var i=Object.getOwnPropertyNames(e._everOpenedChats),r=0;r<i.length;r++){if(e._everOpenedChats[i[r]].onStage){e._isChatShown=!0;break}}e._isChatShown?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()}},e.focusHandler=function(t){e._isFocused=t,e._isFocused?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()},e.callingStateHandler=function(t){var n=!1;if(t)switch(t.status){case 2:case 3:case 4:case 9:n=!0}e._isInCall=n,n?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()},e.updateListOfActiveEndpoints=function(e){},e.isActive=function(){return(e._isInCall||e._isFocused)&&(e._isRecentsVisible||e._isChatShown)},e._isInitialized=!1,e._everOpenedChats={},e._wx=new U.WX,e._agentsService=new g.default,e._pesInitialized=!1,e.isZombie=!0,e.initManagers=function(t,n,r){if(e._initPromise=e._initPromise||new l.CancelablePromise,e._isInitialized)return e.initPromise;e._isInitialized=!0;var o=[Promise.resolve()];return e._i18n||(e._i18n=new L.I18N),o.push(e._i18n.init(t||i.default.get.getCurrentLocale())),e._options=r,e._skypeSignInManager||(e._skypeSignInManager=new ce.default(n.tokenProvider,n.initialToken,n.externalLogin||e._externalLogin,n.tokenType,n.enterpriseAuth),e.signInManager.subscribe("state",e.signinStateHandler.bind(e))),e._webApi||(i.default.get.isTeams()?e._webApi=new b.ConversationTeamsWebApi(e.teamsChatServiceAggregatorClient):e._webApi=new _.ConversationConsumerWebApi),e.notificationsManager.disableNotifications(),e.signInManager.onceSignedIn().then(function(){e.completePostSignInActions(t,r)}),d.swc.Eventing.registerEvent("inappActivityStarted",Q.reportInappActivityStartEvent),d.swc.Eventing.registerEvent("recentsShown",function(){return e.recentVisibilityHandler(!0)}),d.swc.Eventing.registerEvent("recentsHidden",function(){return e.recentVisibilityHandler(!1)}),d.swc.Eventing.registerEvent("onControlShow",function(t){return e.chatShownHandler(!0,t)}),d.swc.Eventing.registerEvent("onControlHide",function(t){return e.chatShownHandler(!1,t)}),d.swc.Eventing.registerEvent("onControlClose",function(t){return e.chatShownHandler(!1,t)}),d.swc.Eventing.registerEvent("onFocused",function(t){return e.focusHandler(t)}),d.swc.Eventing.registerEvent("callStatusChanged",function(t){e.callingStateHandler(t),e.notificationsManager.callStateHandler(t)}),Promise.all(o).then(function(){e._initPromise.resolve()}),e._initPromise.promise},e.initPesManager=function(){e._pesInitialized||(e.signInManager.onceSignedIn().then(function(){e.pesManager.init()}),e._pesInitialized=!0)},e._isRecentsVisible=!1,e._isChatShown=!1,e._isFocused=!1,e._isInCall=!1,e}();t.ServicesManager=ue},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(){}return e.throwError=function(e,t,n,r){var o=new Error(function(){if(!n||0===Object.getOwnPropertyNames(n).length)return e+(t?": "+t:"");if("string"==typeof n)return n;var i="";return Object.getOwnPropertyNames(n).forEach(function(e){i+=e+": "+n[e]+";"}),i}());i.swc.Eventing.triggerEvent("errorCode",e);try{i.swc.Telemetry.sendEvent.runtimeError(e,o.message,e+(t?": "+t:""),o.stack,r)}catch(e){}},e.throwHttpErrorCode=function(e,t){e+=1e3,i.swc.Eventing.triggerEvent("errorCode",e)},e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getComposedBlockClassName=function(){var e=this.blockClassName;return this.props.className&&(e+=" "+this.props.className),e},t}(n(6).Component);t.SwcBaseComponent=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(15),s=n(39),a=n(109),c=n(18),u=n(78),l={"<":"&lt;",">":"&gt;","&lt;":"<","&gt;":">","&LT;":"<","&GT;":">","&":"&amp;",'"':"&quot;","'":"&apos;","&amp;":"&","&quot;":'"',"&apos;":"'","&#39;":"'","&#96;":"`","&AMP;":"&","&QUOT;":'"',"&APOS;":"'"},p='(?:(?:\\s*title="[^"]+?"\\s*)|(?:\\s*tabindex="-1"\\s*)|(?:\\s*target="_blank"\\s*)){0,3}',d=a.default.multilineRegExp(["(&lt;a ",p,'href="((?:https?://|mailto:)[^"]+?)"',p,"&gt;)","((?:(?!&lt;/a&gt;)[\\s\\S])*)","(&lt;/a&gt;)"],"gi"),f={ALLOWED_TAGS:["span","canvas"],ALLOWED_ATTR:["id","type","data-item-id","class","data-is-animated"]},h={ALLOWED_TAGS:["b","i","s","hr","br","at","ss","h1","h2","h3","h4","h5","h6","span","div","quote","ul","li","ol","em","strong","br","canvas","p","title","description"],ALLOWED_ATTR:["tabindex","title","target","id","type","data-item-id","class","data-is-animated"]},g=function(){function e(){}return Object.defineProperty(e,"anchor",{get:function(){return e._anchor||(e._anchor=document.createElement("a"))},enumerable:!0,configurable:!0}),e.sanitizeMessageInputContent=function(t){return t=e.replaceBrWithNewline(t),t=e.normalizeMentions(t),t=s.default.dompurify.sanitize(t,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]}),t=e.unescape(t)},e.map=function(e){return l[e]},e.modifyLinkAnchorOpening=function(e,t){return e.search(a.default.escapeSpecialChars(t))>-1?e:e.replace(/(<a|&lt;a)/,function(e){return e+" "+t})},e.validateUrl=function(t,n){var i=e.anchor;return i&&e.validateUrlFormat(t)&&e.validateURLProtocol(i,n)},e.validateURLProtocol=function(e,t){return(t||["https:"]).indexOf(e.protocol)>-1&&-1===["javascript:"].indexOf(e.protocol)},e.validateUrlFormat=function(e){return!!e.match(/^(https:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g)},e.escapeBrackets=function(e){return e.replace(/([<>])/gi,this.map)},e.unescapeBrackets=function(e){return e.replace(/(&lt;|&gt;)/gi,this.map)},e.unescape=function(e){return e.replace(/(&lt;|&gt;|&amp;|&quot;|&apos;|&#39;|&#96;)/gi,this.map)},e.validateUnescapedLink=function(e){return this.escapeBrackets(e).replace(d,this.validateAnchor)},e.parseTopic=function(t){return t?(t?e.unescape(t):"").replace(/<[^a\/].*?>(.*?)<\/[^a].*?>/gi,"$1").replace(/(<.*?\.{3,})$/,"").trim():t},e.containsMention=function(e){return/<at id="(.*?)">.*?<\/at>/g.test(e)},e.containsEmoticon=function(e){return/<span(\sxmlns=".*")? class="emoticon\s?\w*\s?(animated)?"><canvas(\s?(data-[-a-z]*|height|width|id|textcontent)=".*")*?>.*<\/canvas><\/span>/i.test(e)},e.containsLargeEmoticon=function(e){return/<span(\sxmlns=".*")? class="emoticon\s?\w*\s?(animated)?\s+\w*large"><canvas(\s?(data-[-a-z]*|height|width|id|textcontent)=".*")*?>.*<\/canvas><\/span>/i.test(e)},e.getMessageSanitizedContent=function(e,t){var n={ALLOWED_TAGS:[],ALLOWED_ATTR:[]};return t&&t.noLinks?n=h:t&&t.noFormatting?n=f:(n={ALLOWED_TAGS:h.ALLOWED_TAGS.concat(["a"]),ALLOWED_ATTR:h.ALLOWED_ATTR.concat(["href"])},i.default.get.backend===o.MessagingBackend.TEAMS&&(n.ALLOWED_TAGS.push("img"),n.ALLOWED_ATTR.push("src","style","alt"))),s.default.dompurify.sanitize(e,n)},e.normalizeUrl=function(t){var n=e.anchor;return n.href=t,e.validateUrl(t)&&n.href},e.validateAnchor=function(t,n,i,r,o){var s=e.unescapeBrackets(n),a=e.unescapeBrackets(o);return 0!==i.indexOf("mailto:")&&(s=e.modifyLinkAnchorOpening(s,'target="_blank"')),s=e.modifyLinkAnchorOpening(s,'tabindex="-1"'),(s=e.modifyLinkAnchorOpening(s,'title="'+i+'"'))+r+a},e.webify=function(e){return e.replace(/(\r?\n)|(&lt;br\s?\/&gt;)/gm,"<br/>")},e.attachActionToLinks=function(e,t,n,i){if(1===e.nodeType&&(c.default.isIe()&&(e.matches=Element.prototype.matches),e.matches(t)))for(var r=e.querySelectorAll("a"),o=0;o<r.length;o++){var s=r[o];if(s.href.indexOf(n)>1){var a=u.default.getQueryParameter(s.href,n);a&&(s.setAttribute("data-swc-payload",a),s.addEventListener("click",i))}}},e.getSenderIdFromUrl=function(e){if(!e)return e;var t=e.match(/\/(\d+:[^?\/]*)/);return t&&t[1]?t[1]:(e.match(/(\d+:[^?\/]*)/),e)},e.extractMsgContent=function(e){return 0!==e.indexOf(r.Configuration.MSG_DELETED_CLASSIC_SKYPE)?e:e.slice(r.Configuration.MSG_DELETED_CLASSIC_SKYPE.length,e.length)},e.sanitizeTopic=function(e){return s.default.dompurify.sanitize(e,{ALLOWED_TAGS:h.ALLOWED_TAGS.concat(["img","a"]),ALLOWED_ATTR:h.ALLOWED_ATTR.concat(["src","href"])})},e.getMessagePreviewContent=function(t){return t=e._dropNewLineTag(t),t=e._dropAnchorTag(t),t=e._dropImgTag(t)},e.replaceBrWithNewline=function(e){return e.replace(/<br\s*\/?><br\s*\/?>/g,"\n\n").replace(/<br\s*\/?>/g,"  \n")},e.normalizeMentions=function(e){return e.replace(/<\s*span[^>]*data-mention-id[^>]*>(.*?)<\s*\/\s*span>/g,function(e,t){return"@("+t.substring(1,t.length)+")"})},e._dropNewLineTag=function(e){return e.replace(/<br\s*\/?>/gm," ")},e._dropAnchorTag=function(e){return e.replace(/<\/*a.*?>/g," ")},e._dropImgTag=function(e){return e.replace(/<img .*?>/g,"")},e}();t.MessageUtils=g},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),r=n(0),o=n(7),s=n(54),a=n(166),c=500;t.default=function(e,t,n,i){return 0,new Promise(function(r,o){var s=function(a){u(e,t.timeout,n,i).then(function(e){e.callCount=a,r(e)}).catch(function(e){0===e.status&&a<t.retryCount?setTimeout(function(){s(a+1)},c):o(e)})};s(1)})};var u=function(t,n,c,u){var p=Date.now(),d=u?u.method:null,f=u&&u.headers&&u.headers.hasOwnProperty("BehaviorOverride"),h=function(e){var n=Date.now()-p;return e.ok||(404===e.status&&f?r.swc.Telemetry.sendEvent.serviceQos(t,c+"",n,e,d,399):(a.reportServiceFault(t,e,n),o.default.throwHttpErrorCode(e.status,e.statusText),r.swc.Telemetry.sendEvent.serviceQos(t,c+"",n,e,d))),Promise.resolve(e)},g=function(e){var n=Date.now()-p;return 404===e.status&&f?r.swc.Telemetry.sendEvent.serviceQos(t,c+"",n,e,d,399):(a.reportServiceFault(t,e,n),r.swc.Telemetry.sendEvent.serviceQos(t,c+"",n,e,d)),Promise.reject(e)};return s.get().onceOnline().then(function(){var t=e(c,u),r=new i.CancelablePromise(t);return l(r,n).then(h,g)},function(e){return Promise.reject(e)})},l=function(e,t){var n=setTimeout(function(){n=null,e.cancel({ok:!1,status:0,statusText:"Timeout"})},t),i=function(){n&&clearTimeout(n)};return e.promise.then(i,i),e.promise}}).call(this,n(57))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e){var t=this;this._isCanceled=!1,this._status=i.Pending,this.cancel=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t._isCanceled||(t._isCanceled=!0,e[0]=e[0]||{},e[0].isCanceled=!0,t._status=i.Rejected,t._reject.apply(t._promise,e))},this._promise=new Promise(function(n,r){t._resolve=n,t._reject=r,e&&(e.then(function(e){t._isCanceled||(t._status=i.Resolved,n(e))},function(e){t._status=i.Rejected,r(e)}),e.catch(function(e){t._status=i.Rejected,t._isCanceled?r({isCanceled:!0}):r(e)}))})}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCanceled",{get:function(){return this._isCanceled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),e.prototype.resolve=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._status!==i.Resolved&&(this._status=i.Resolved,this._resolve.apply(this._promise,e))},e.prototype.cancelQuitely=function(){this.status===i.Pending&&(this.promise.then(function(){},function(){}),this.cancel())},e}();t.CancelablePromise=r,function(e){e[e.Pending=0]="Pending",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected"}(i=t.PromiseStatus||(t.PromiseStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){var e=this;this.callbacks={},this.subscribe=function(t,n){void 0===e.callbacks[t]&&(e.callbacks[t]=new Array),e.callbacks[t].push(n)},this.unsubscribe=function(t,n){if(void 0!==e.callbacks[t]){var i=e.callbacks[t].indexOf(n);i>-1&&e.callbacks[t].splice(i,1)}},this.publish=function(t,n){void 0!==e.callbacks[t]&&e.callbacks[t].map(function(e){return e}).forEach(function(e){e(n)})}}return e.prototype.dispose=function(){for(var e in this.callbacks)this.callbacks.hasOwnProperty(e)&&(this.callbacks[e]=null);this.callbacks={}},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.guid={generate:function(){var e=new Uint16Array(8);(window.crypto||window.msCrypto).getRandomValues(e);var t=0,n=function(){return(4369|e[t++]).toString(16)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},isGuid:function(e){return/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/.test(e)}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s,a=n(2),c=n(8);!function(e){e.Small="swcIcon_size_small",e.Medium="swcIcon_size_medium",e.Large="swcIcon_size_large"}(t.SwcIconSize||(t.SwcIconSize={})),function(e){e.SVG="swcIcon_svg",e.CallDisabled="swcIcon_callDisabled",e.CallEnd="swcIcon_callEnd",e.CallRecordDot="swcIcon_callRecordDot",e.CallRecordStroke="swcIcon_callRecordStroke",e.CallStart="swcIcon_callStart",e.Cancel="swcIcon_cancel",e.ChevronDown="swcIcon_chevronDown",e.Clippy="swcIcon_clippy",e.Contact="swcIcon_contact",e.Contacts="swcIcon_contacts",e.ContactAdd="swcIcon_contactAdd",e.ContactGroupPair="swcIcon_contactGroupPair",e.Contract="swcIcon_contract",e.EmoticonStroke="swcIcon_emoticonStroke",e.Error="swcIcon_error",e.Expand="swcIcon_expand",e.Favourite="swcIcon_favourite",e.File="swcIcon_file",e.IconSkypeForBusiness="swcIcon_iconSkypeForBusiness",e.Landline="swcIcon_landline",e.Left="swcIcon_left",e.LogoMicrosoft="swcIcon_logoMicrosoft",e.Message="swcIcon_message",e.Microphone="swcIcon_microphone",e.MicrophoneOff="swcIcon_microphoneOff",e.Minus="swcIcon_minus",e.More="swcIcon_more",e.MsExcel="swcIcon_msExcel",e.MsOneNote="swcIcon_msOneNote",e.MsPowerPoint="swcIcon_msPowerPoint",e.MsVisio="swcIcon_msVisio",e.MsWord="swcIcon_msWord",e.NotificationOff="swcIcon_notificationOff",e.Ok="swcIcon_ok",e.Picture="swcIcon_picture",e.Pdf="swcIcon_pdf",e.Plus="swcIcon_plus",e.PresenceOnline="swcIcon_presenceOnline",e.PresenceAway="swcIcon_presenceAway",e.PresenceDnd="swcIcon_presenceDnd",e.PresenceBlocked="swcIcon_presenceBlocked",e.RadiobuttonUnselected="swcIcon_radiobuttonUnselected",e.Search="swcIcon_search",e.Send="swcIcon_send",e.Settings="swcIcon_settings",e.Skype="swcIcon_skype",e.StarFilled="swcIcon_starFilled",e.Video="swcIcon_video",e.VideoOff="swcIcon_videoOff"}(s=t.SwcIconType||(t.SwcIconType={}));var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcIcon",t}return r(t,e),t.prototype.getComposedBlockClassName=function(){var t=e.prototype.getComposedBlockClassName.call(this);return this.props.size&&(t+=" "+this.props.size),this.props.type&&(t+=" "+this.props.type),this.props.disabled&&(t+=" swcIcon_disabled"),t},t.prototype.render=function(){var e=this.props.type===s.SVG?{dangerouslySetInnerHTML:{__html:this.props.content}}:{};return a.createElement("span",o({"aria-hidden":"true","data-test-id":this.props.dataTestId,className:this.getComposedBlockClassName()},e))},t}(c.SwcBaseComponent);t.SwcIcon=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.SKYPE=100]="SKYPE",e[e.TEAMS=300]="TEAMS"}(t.MessagingBackend||(t.MessagingBackend={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(114),r=n(115),o=n(116),s=n(117),a=n(118),c=n(44),u=n(35),l=n(45),p=n(119);t.setAbilityHelpersOnElement=function(e,t){var n=e.__abilityHelpers||{};Object.keys(t).forEach(function(e){var i=t[e];void 0===i?n&&delete n[e]:n[e]=i}),0===Object.keys(n).length?delete e.__abilityHelpers:e.__abilityHelpers=n},t.getAbilityHelpersOnElement=function(e){return e.__abilityHelpers};var d=function(){return function(e){l.observeMutations(e.document),this.announcer=new i.Announcer(e),this.keyboardNavigation=new a.KeyboardNavigationState(e),this.focusedElement=new s.FocusedElementState(e),this.outline=new p.Outline(e),this.focusDeloser=new o.FocusDeloser(e),this.focusable=new r.Focusable,this.modalityLayer=new u.ModalityLayer(e),this.list=new c.List(e)}}();var f,h=((f=window).__abilityHelpers||(f.__abilityHelpers={helpers:new d(f),mainWindow:f}),f.__abilityHelpers),g=h.helpers;t.AbilityHelpers=g,t.setupIFrame=function(e){var t=e.defaultView;if(t&&!t.__abilityHelpers){t.__abilityHelpers={helpers:h.helpers,mainWindow:h.mainWindow};var n=h.mainWindow;l.observeMutations(e),s.setupFocusedElementStateInIFrame(n,e),a.setupKeyboardNavigationStateInIFrame(n,e),p.setupOutlineInIFrame(n,e),u.setupModalityLayerInIFrame(n,e),c.setupListInIFrame(n,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(98),r=n(4),o=n(169),s=n(0),a=n(9),c=n(42),u=function(){function e(){var e=this;this.encoder=new i.Encoder,this.decodeContent=function(t){return e.encoder.decode(t)}}return e.prototype.generate=function(e){return null},e.prototype._createMessageModel=function(e,t,n){var i;void 0===n&&(n=!1);var u=new o.default(n),l=void 0!==t?t:e.content;n?e.customType&&(u.customType=e.customType):(u.senderId=a.MessageUtils.getSenderIdFromUrl(e.from),u.sender=s.swc.services.persons.getPerson(u.senderId));var p=s.swc.services.mePersonManager.isMe(c.default.normalizePersonId(u.senderId));u.id=e.id,u.content=l?this.decodeContent(l):"";var d=e.skypeeditedid?e.skypeeditedid:e.id,f=new Date(Number(d));u.timestamp=isNaN(f.valueOf())?new Date(e.originalarrivaltime):f,u.originalTimestamp=new Date(e.originalarrivaltime),u.composeTime=new Date(e.composetime),u.skypeEditedId=e.skypeeditedid,u.key=e.skypeeditedid||e.clientmessageid||e.id||"0",u.direction=n||!p?r.Direction.Incoming:r.Direction.Outgoing,u.rawMessageType=e.messagetype,u.clientMessageId=e.clientmessageid,u.amsreferences=e.amsreferences,u.editedTimestamp=e.properties&&e.properties.edittime?new Date(parseInt(e.properties.edittime,10)):null,u.deletedTimestamp=e.properties&&e.properties.deletetime?new Date(parseInt(e.properties.deletetime,10)):null;var h=!!e.skypeeditedid||!!u.editedTimestamp,g=!l&&!!e.skypeeditedid||!!u.deletedTimestamp;if(u.properties=e.properties,u.isEdited=h,u.isDeleted=g,u.version=Number(e.version),u.imdisplayname=e.imdisplayname,e.properties&&e.properties.files)try{var m=void 0;m="string"==typeof e.properties.files?JSON.parse(e.properties.files):e.properties.files,(i=u.files).pushObservable.apply(i,m)}catch(e){}return u},e.prototype._generateOutgoingModel=function(e){var t,n=new o.default(!1,e);if(n.id=e.clientmessageid,n.timestamp=new Date(e.composetime),n.originalTimestamp=n.timestamp,n.key=e.clientmessageid,n.senderId=s.swc.services.mePersonManager.mePerson.mri,n.direction=r.Direction.Outgoing,n.content=this.decodeContent(e.content),n.processedContent=e.processedcontent,n.rawMessageType=e.messagetype,n.clientMessageId=e.clientmessageid,n.amsreferences=e.amsreferences,e.properties&&(n.properties=e.properties,"string"==typeof e.properties))try{var i=JSON.parse(e.properties).files||[];(t=n.files).pushObservable.apply(t,i)}catch(e){}return n},e.prototype.parseContentFor=function(e,t){var n=new RegExp("<"+t+">(.+?)</"+t+">","i"),i=e.match(n);return i?i[1]:""},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o,s=n(0),a=n(28),c=n(13),u={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"};!function(e){e.Desktop="Desktop",e.Mobile="Mobile",e.Tablet="Tablet"}(i=t.DeviceType||(t.DeviceType={})),function(e){e.MSIE="MSIE",e.CHROME="Chrome",e.FIREFOX="Firefox",e.SAFARI="Safari",e.EDGE="Edge",e.EDGE_CHROMIUM="Anaheim",e.ELECTRON="Electron",e.SKYPE_SHELL="SkypeShell",e.PHANTOMJS="PhantomJS",e.UNKNOWN="Unknown"}(r=t.BrowserVendor||(t.BrowserVendor={})),function(e){e.WINDOWS="Windows",e.MACOSX="Mac OS X",e.WINDOWS_PHONE="Windows Phone",e.WINDOWS_RT="Windows RT",e.IOS="iOS",e.ANDROID="Android",e.LINUX="Linux",e.UNKNOWN="Unknown"}(o=t.OperatingSystem||(t.OperatingSystem={})),t.UNKNOWN_VERSION="U";var l=function(){function e(){}return e.getDeviceType=function(){return window.navigator.userAgent.match(/(android|ipod|windows phone|wpdesktop|windows ce|blackberry\w*|meego|webos|palm|symbian|pda|\w*?mobile\w*?|\w*?phone\w*?)/i)?i.Mobile:window.navigator.userAgent.match(/tablet|ipad/i)?i.Tablet:i.Desktop},e.getUserAgent=function(){return a.default.getWindow().navigator.userAgent},e.userAgentContainsString=function(e){return this.getUserAgent().indexOf(e)>-1},e.isChrome=function(){return this.userAgentContainsString(r.CHROME)&&!this.userAgentContainsString(r.EDGE)},e.isIe=function(){return this.userAgentContainsString("Trident")},e.isEdge=function(){return this.userAgentContainsString(r.EDGE)},e.isOpera=function(){return this.userAgentContainsString("OPR/")},e.testSupporedList=function(t){if(!t)return!1;t.constructor!==Array&&"string"==typeof t&&(t=[t]);for(var n=e.getBrowserName().toLocaleLowerCase(),i=0;i<t.length;i++)if(t[i].toLowerCase().indexOf(n)>-1)return!0;return!1},e.getBrowserName=function(){return this.isOpera()?r.UNKNOWN:this.userAgentContainsString(r.PHANTOMJS)?r.PHANTOMJS:this.isEdge()?r.EDGE:this.userAgentContainsString(r.ELECTRON)?r.ELECTRON:this.userAgentContainsString(r.CHROME)?this.userAgentContainsString("Edg")?r.EDGE_CHROMIUM:r.CHROME:this.userAgentContainsString(r.FIREFOX)?r.FIREFOX:this.userAgentContainsString(r.SAFARI)?r.SAFARI:this.userAgentContainsString(r.SKYPE_SHELL)?r.SKYPE_SHELL:this.isIe()?r.MSIE:r.UNKNOWN},e.getBrowserVersion=function(){var e,n,i,o,s,a=this;return this.isIe()?(o=a.getUserAgent(),(s=o.match(new RegExp(r.MSIE+" ([\\d,.]+)")))?s[1]:(i=o.match(new RegExp("rv:([\\d,.]+)")))?i[1]:void 0):((e=this.getBrowserName())===r.SAFARI&&(e="Version"),(n=a.getUserAgent().match(new RegExp(e+"/([\\d,.]+)")))?n[1]:t.UNKNOWN_VERSION)},e.getScreenInfo=function(){var e=a.default.getWindow(),t=a.default.getWindow().navigator;return{width:a.default.getWindow().screen&&a.default.getWindow().screen.width||0,height:a.default.getWindow().screen&&a.default.getWindow().screen.height||0,pixelRatio:a.default.getWindow().devicePixelRatio||0,colorDepth:a.default.getWindow().screen&&a.default.getWindow().screen.colorDepth||0,isTouchEnabled:Object.prototype.hasOwnProperty.call(e,"ontouchstart")||t.MaxTouchPoints>0}},e.getOsName=function(){var e=this.getUserAgent();return e.match(/windows\sphone\s\d+\.\d+/i)?o.WINDOWS_PHONE:e.match(/ arm;/i)?o.WINDOWS_RT:e.match(/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i)?o.IOS:e.match(/android/i)?o.ANDROID:e.match(/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|cros)/i)?o.LINUX:e.match(/(macintosh|mac os x)/i)?o.MACOSX:e.match(/(windows|win32)/i)?o.WINDOWS:o.UNKNOWN},e.getOsVersion=function(e){var n=this;void 0===e&&(e=!1);var i;return this.getOsName()===o.WINDOWS?function(e){var i=n.getUserAgent().match(new RegExp("Windows NT ([\\d,.]+)"));if(i){if(e)return i[1];if(u[i[1]])return u[i[1]]}return t.UNKNOWN_VERSION}(e):this.getOsName()===o.MACOSX&&(i=n.getUserAgent().match(new RegExp(o.MACOSX+" ([\\d,_,.]+)")))?i[1].replace(/_/g,"."):t.UNKNOWN_VERSION},e.getDeviceId=function(){var e=s.swc.services.localStorage,t=e.getItem("swc-deviceId");return t||(t=c.guid.generate(),e.setItem("swc-deviceId",t)),t},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SignedOut=0]="SignedOut",e[e.SigningIn=1]="SigningIn",e[e.SignedIn=2]="SignedIn",e[e.SigningOut=3]="SigningOut"}(t.SigninState||(t.SigninState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(16);t.AbilityHelpers=i.AbilityHelpers,t.setupIFrame=i.setupIFrame},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(64),o=n(48),s=n(0),a=n(63),c=n(130),u={allowedDomains:["swc.cdn.skype.com","latest-swc.cdn.skype.com"]},l=function(){function e(){}return e.combine=function(e,t,n){return e.lastIndexOf("/")!==e.length-1&&"/"!==t.substring(0,1)?e+"/"+t:this.getAppPath(n)+e+t},e.getAbsoluteUrl=function(e,t,n){var i=this.getCompletePath(e,t),r="css"===t?"css/":"";return e===o.PackageName.SDK_LOADER?this.combine(n.loaderUrl,i,n):e===o.PackageName.CONNECT?this.combine(n.loaderUrl,i,n):this.combine(r,i,n)},e.getCompletePath=function(e,t){return i||(i=new r.ConfigFactory),e+((void 0!==i.getDefinitionFromUrl().IsMinified?i.getDefinitionFromUrl().IsMinified:s.swc.EcsConfig.isMinified)?".min":"")+"."+t},e.setQueryParameters=function(e,t){return e+"?"+this.buildQueryParameters(t)},e.buildQueryParameters=function(e){var t=[];return Object.keys(e).forEach(function(n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}),t.join("&")},e.getHost=function(){try{var e=window.location.hostname;return!e&&e.length>0?e:("file:"===window.location.protocol.toLowerCase()&&(e="local"),e)}catch(e){return null}},e.getVendorPath=function(t){return e.getCDNPath(t)+"/vendors"},e.getConnectPagePath=function(t){return e.getAppPath(t)+"connect.html"},e.getAppPath=function(t){var n=a.getBranchParentFolder(t.version);return e.getCDNPath(t)+"/"+n+"/"+t.version+"/"},e.getCDNPath=function(t){var n=t.domain;return e.validateUriOrDie(n,u),n},e.validateUriOrDie=function(e,t){if(!c.UrlValidator.instance.validate(e,t))throw new Error("Invalid URI!")},e.appendQueryParam=function(e,t,n){return e+(-1===e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(n)},e}();t.UrlHelper=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NA="n/a"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.OneOnOne="1on1",e.Chat="chat",e.Space="space",e.Topic="topic",e.SfbInterop="sfbinterop",e.SfbInteropChat="sfbinteropchat",e.Meeting="meeting"}(t.ThreadType||(t.ThreadType={})),function(e){e.EventMessage="EventMessage"}(t.EventType||(t.EventType={})),function(e){e.Text="Text",e.RichText="RichText",e.RichTextUriObject="RichText/UriObject",e.RichTextMedia_GenericFile="RichText/Media_GenericFile",e.ControlClearTyping="Control/ClearTyping",e.ControlTyping="Control/Typing",e.ControlLiveState="Control/LiveState",e.SystemMessage="SystemMessage",e.InviteFreeRelationshipChangedInitialized="InviteFreeRelationshipChanged/Initialized",e.SignalFlamingo="Signal/Flamingo",e.RichTextHtml="RichText/Html",e.EventCall="Event/Call"}(t.MessagePayloadType||(t.MessagePayloadType={})),function(e){e.Audio="Audio",e.Video="Video"}(t.PresenceCapabilities||(t.PresenceCapabilities={})),function(e){e.Online="Online",e.Busy="Busy",e.Offline="Offline",e.Undefined="Undefined",e.OnThePhone="OnThePhone",e.Away="Away",e.Idle="Idle",e.OutToLunch="OutToLunch",e.BeRightBack="BeRightBack",e.DoNotDisturb="DoNotDisturb"}(t.PresenceStatus||(t.PresenceStatus={}))},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Document=0]="Document",e[e.Window=1]="Window"}(i=t.EventFromIFrameDescriptorType||(t.EventFromIFrameDescriptorType={})),t.setupIFrameToMainWindowEventsDispatcher=function(e,t,n,r){var o=t.defaultView;if(!o||o===e)throw new Error("setupIFrameToMainWindowEventsDispatcher() is called on a wrong document.");r.forEach(function(r){switch(r.type){case i.Document:t.addEventListener(r.name,s,r.capture);break;case i.Window:o.addEventListener(r.name,s,r.capture)}function s(i){var s=document.createEvent("HTMLEvents");s.initEvent(n,!0,!0),s.originalEvent=i,s.targetDetails={descriptor:r,target:i.target,document:t,window:o},e.dispatchEvent(s)}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMBER_0:48,NUMBER_9:57,NUMPAD_0:96,NUMPAD_9:105,A:65,G:71,H:72,J:74,K:75,L:76,Z:90,F6:117,F10:121}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.GUEST=100]="GUEST",e[e.SKYPE=200]="SKYPE",e[e.DL_TOKEN=300]="DL_TOKEN",e[e.TEAMS=400]="TEAMS"}(t.IdentityType||(t.IdentityType={}))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getWindow=function(){return window},e.getDocument=function(){return window.document},e.getParentWithClass=function(e,t){for(;e&&!this.hasClass(e,t);)e=e.parentNode;return e},e.isInViewport=function(e,t){return t=t||this.getWindow(),e.bottom>0&&e.right>0&&e.top<t.innerHeight&&e.left<t.innerWidth},e.readDataset=function(e,t,n){return e.dataset?e.dataset[t]:e.getAttribute("data-"+n)},e.writeDataset=function(e,t,n,i){e.dataset?e.dataset[t]=i:e.setAttribute("data-"+n,i)},e.hasClass=function(e,t){if(e.classList)return e.classList.contains(t);for(var n=0,i=e.className?e.className.split(" "):[];n<i.length;n++){if(i[n]===t)return!0}return!1},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(38),r=n(4),o=n(7),s=function(){function e(){}return e.strip=function(e){var t=e.match(this.idRegExp);return t?t[2]:e},e.detectConversationType=function(e){if(!e)return r.ConversationType.UNDEFINED;if(this.typeMapppings[e])return this.typeMapppings[e];var t,n=e.match(this.idRegExp);if(n&&(t=this.getTypeByPrefix(n[1])),t)return this.typeMapppings[e]=t,t;if(0===e.indexOf("https://join.skype.com/"))return this.typeMapppings[e]=r.ConversationType.JOIN,r.ConversationType.JOIN;if(/^(28:)?[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i.test(e))return this.typeMapppings[e]=r.ConversationType.AGENT,r.ConversationType.AGENT;if(/^(19:)?[\S]+[@]([\S].)?[\S]*thread\.skype/i.test(e))return this.typeMapppings[e]=r.ConversationType.GROUP,r.ConversationType.GROUP;return/(?:00|\+)?(^[^a-z][^A-Z])(\d+$)/i.test(e.replace(/\s+|[()\-\+]/gi,""))?(this.typeMapppings[e]=r.ConversationType.PHONE,r.ConversationType.PHONE):(this.typeMapppings[e]=r.ConversationType.PERSON,r.ConversationType.PERSON)},e.getSdkModeFromId=function(e){switch(this.detectConversationType(e)){case r.ConversationType.PERSON:return i.SDKMode.PERSON;case r.ConversationType.AGENT:return i.SDKMode.BOT;case r.ConversationType.JOIN:return i.SDKMode.JOIN_URL;case r.ConversationType.PHONE:return i.SDKMode.PHONE;case r.ConversationType.GROUP:return i.SDKMode.THREAD}return i.SDKMode.UNDEFINED},e.toFullIdentifier=function(e){var t=this.getPrefixForId(e);return 0===e.indexOf(t+":")?e:t?t+":"+e:e},e.addPrefix=function(e,t){return 0===t.indexOf(e+this.SPLITTER)?t:0===t.indexOf(this.SPLITTER)?e+t:e+this.SPLITTER+t},e.getNormalizeId=function(e){return e.match(this.idRegExp)?e.replace(/\d{1,2}:/,""):e},e.isEqual=function(e,t){return this.toFullIdentifier(e).toLowerCase()===this.toFullIdentifier(t).toLowerCase()},e.getPrefixForId=function(e){if(this.hasAlreadyPrefix(e))return"";var t=this.getSdkModeFromId(e);switch(t){case i.SDKMode.PERSON:return"8";case i.SDKMode.BOT:return"28";case i.SDKMode.THREAD:return"19";case i.SDKMode.PHONE:return"4";default:o.default.throwError(10502,"Unable to define conversation prefix",{id:e,sdkMode:t})}return""},e.getTypeByPrefix=function(e){if(!e)return r.ConversationType.UNDEFINED;switch(e.indexOf(":")>-1&&(e=e.replace(":","")),e){case"4":return r.ConversationType.PHONE;case"8":return r.ConversationType.PERSON;case"19":return r.ConversationType.GROUP;case"28":return r.ConversationType.AGENT;default:return r.ConversationType.UNDEFINED}},e.hasAlreadyPrefix=function(e){var t=/^\d+:/.exec(e);return!!t&&!!t[0]},e.SPLITTER=":",e.idRegExp=/(\d{1,2}:)([\S]*)/,e.typeMapppings={},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(90),o=function(){function e(){this.requests={}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e)},enumerable:!0,configurable:!0}),e.prototype.async=function(e,t,n){var r=this;return this.requests[t]=this.requests[t]||new Promise(function(o,s){var a=n&&setTimeout(s,n),c=function(n){n&&n.refId&&n.refId===t&&(a&&clearTimeout(a),i.swc.Eventing.unregisterEvent("proxy:resolve",c),o(r.create(e,n)))};i.swc.Eventing.registerEvent("proxy:resolve",c)}),i.swc.Eventing.triggerEvent("proxy:request",t),this.requests[t]},e.prototype.create=function(e,t){return new e(t)},e}();t.ProxyFactory=o;var s=function(){return function(e){var t=this;this.data={},this.callCount=0,this.exec=function(e,t){return i.swc.Eventing.triggerEvent(e,t)},this.reg=function(e,t){return i.swc.Eventing.registerEvent(e,t)},this.unreg=function(e,t){return i.swc.Eventing.unregisterEvent(e,t)},this.createCID=function(){return r.hashCode((t.callCount++).toString()+t.refId)},this.refId=e.refId,this.data=e,this.init()}}();t.Proxy=s;var a=function(){function e(){var e=this;this.connections={},this.answer=function(t){var n=e.connections[t];n&&i.swc.Eventing.triggerEvent("proxy:resolve",Object.assign(n,{refId:t}))},i.swc.Eventing.registerEvent("proxy:request",this.answer)}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e)},enumerable:!0,configurable:!0}),e.prototype.connect=function(e,t,n){this.connections[e]||(this.connections[e]=t||{},n&&n(),this.answer(e))},e.prototype.disconnect=function(e){delete this.connections[e]},e}();t.ProxyConnector=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(3),o=n(1),s=n(26),a=n(15),c=n(0),u=n(23);t.TEAMS_NOTIFICATION_CHANNEL_ID="48:notifications";var l=function(e){void 0===e&&(e="");var t=e.match((i||(i=r.default.get.backend===a.MessagingBackend.TEAMS?/^(https?:.+?\.microsoft\.com\/V\d+\/)/i:/^(https?:.+?\.live\.com\/V\d+\/)/i),i));return t?t[1]:null};function p(e){return l(e).replace(/\/(v2)\/?$/i,"/v1/")}t.parseChatServiceHostUrl=p,t.handle404Redirect=function(e,t,n){var i=e.headers.get("location");return 404===e.status&&i&&l(i)?(o.Configuration.CHAT_HOST_URL=p(i),n?t(i):t()):Promise.resolve(e)},t.getDomain=function(){return c.swc.services.signInManager.userIdentityType===s.IdentityType.GUEST&&o.Configuration.CHAT_GUEST_HOST_URL!==o.Configuration.CHAT_HOST_URL&&c.swc.Telemetry.sendEvent.serviceQos("webapi-guestInDogfood","",0,null,""),o.Configuration.CHAT_HOST_URL},t.getConversationIdFromUrl=function(e){var t=e&&e.match(/\/(\d+:[^\/]*)[\/]?/);return t&&t[1]?t[1]:void 0},t.reset=function(){o.Configuration.CHAT_HOST_URL=o.Configuration.CHAT_GUEST_HOST_URL},t.normalizePersonId=function(e){var t=e.match(/(\d+:)([\S]*)/);return t?t[2]:e},t.isThread=function(e){try{var t=e.threadtype;if(t&&(t===u.ThreadType.Space||t===u.ThreadType.Topic))return!0}catch(e){}return!1},t.isThreadExtended=function(e){try{var t=(e.threadtype||e.threadType||e.threadProperties&&(e.threadProperties.threadtype||e.threadProperties.threadType)||e.properties&&(e.properties.threadtype||e.properties.threadType)||e.type||"").toLowerCase();if(t&&(t===u.ThreadType.Space||t===u.ThreadType.Topic))return!0}catch(e){}return!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SpacesApi="https://api.spaces.skype.com",e.Sharepoint="https://microsoft-my.sharepoint.com",e.Presence="https://presence.teams.microsoft.com",e.AggregationApi="https://chatsvcagg.teams.microsoft.com"}(t.AadAudience||(t.AadAudience={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SKYPE_TOKEN_KEY="skype|token",t.SKYPE_REGTOKEN_KEY="skype|registrationtoken",t.SKYPE_ENDPOINT_ID_KEY="skype|epid",t.SKYPE_ENDPOINT_KEY="skype|endpoint",t.SKYPE_HAS_HISTORY_KEY="skype|hasHistory",t.SKYPE_GRAPH_ACCESS_TOKEN_KEY="skype|graphAccessToken",t.SKYPE_ENDPOINT_OWNER_KEY="skype|endpointowner",t.SWC_SFB_DISMISSED_KEY="swc-sfb-dismissed"},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0});try{document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT),i=!1}catch(e){i=!0}t.createElementTreeWalker=function(e,t,n){if(t.nodeType===Node.ELEMENT_NODE){var r=i?n:{acceptNode:n};return e.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,r,!1)}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),o=n(24),s=n(45),a=n(34),c="ability-helpers:modality-layer-related",u=0,l={},p=function(){function e(e,t,n){this._isAccessible=!0,this._isFocused=!1,this.internalId="ml"+ ++u,this.userId=t,this._element=e,this._props=n,this._setAccessibilityProps(),this._setInformativeStyle()}return e.prototype.setup=function(e){this._props=i({},this._props,e),this._setAccessibilityProps()},e.prototype.dispose=function(){this._remove()},e.prototype.move=function(e){this._remove(),this._element=e,this._setAccessibilityProps(),this._isAccessible=!this._isAccessible,this._isActive=!this._isActive,this.setAccessible(!this._isAccessible),this.setActive(!this._isActive)},e.prototype.setAccessible=function(e){var t=this;e!==this._isAccessible&&(this._isAccessible=e,this._setAccessibleTimer&&(window.clearTimeout(this._setAccessibleTimer),this._setAccessibleTimer=void 0),e?this._element.removeAttribute("aria-hidden"):this._setAccessibleTimer=setTimeout(function(){t._setAccessibleTimer=void 0,t._element.setAttribute("aria-hidden","true")},0),this._setInformativeStyle())},e.prototype.setActive=function(e){e!==this._isActive&&(this._isActive=e,this._setInformativeStyle())},e.prototype.isActive=function(){return!!this._isActive},e.prototype.isOthersAccessible=function(){return!!this._props.othersAccessible},e.prototype.isAlwaysAccessible=function(){return!!this._props.alwaysAccessible},e.prototype.isNoFocusFirst=function(){return!!this._props.noFocusFirst},e.prototype.isNoFocusDefault=function(){return!!this._props.noFocusDefault},e.prototype.getElement=function(){return this._element},e.prototype.setFocused=function(e){this._isFocused!==e&&(this._isFocused=e,e?this._props.onFocusIn&&this._props.onFocusIn():this._props.onFocusOut&&this._props.onFocusOut(!1),this._setInformativeStyle())},e.prototype.onBeforeFocusOut=function(){return!!this._props.onFocusOut&&this._props.onFocusOut(!0)},e.prototype._remove=function(){this._element.style.removeProperty("--ah-modality-layer")},e.prototype._setAccessibilityProps=function(){this._element.setAttribute("aria-label",this._props.accessibilityLabel),this._element.hasAttribute("tabindex")||(this._element.tabIndex=-1),this._element.tabIndex<0&&r.AbilityHelpers.outline.ignoreElement(this._element)},e.prototype._setInformativeStyle=function(){this._element.style.setProperty("--ah-modality-layer",this.internalId+","+this.userId+","+(this._isActive?"active":"inactive")+","+(this._isAccessible?"accessible":"inaccessible")+","+(this._isFocused?"focused":"not-focused"))},e}();t.ModalityLayerContainer=p;var d=function(){function e(e){this._knownLayers={},this.id="root"+ ++u,this._element=e,this._add()}return e.prototype.dispose=function(){this._updateLayersTimer&&(window.clearTimeout(this._updateLayersTimer),this._updateLayersTimer=void 0),this._remove()},e.prototype.move=function(e){this._remove(),this._element=e,this._add(),this.updateLayers()},e.prototype.getElement=function(){return this._element},e.prototype.getCurrentLayerId=function(){return this._curLayerId},e.prototype.setCurrentLayerId=function(e,t){this._curLayerId=e,this._setInformativeStyle(),t||this.updateLayers()},e.prototype.getLayers=function(){for(var e=[],t=0,n=Object.keys(this._knownLayers);t<n.length;t++){var i=n[t];e.push(this._knownLayers[i])}return e},e.prototype.updateLayers=function(){var e=this;this._updateLayersTimer||(this._updateLayersTimer=window.setTimeout(function(){e._updateLayersTimer=void 0,e._reallyUpdateLayers()},0))},e.prototype._add=function(){this._setInformativeStyle()},e.prototype._remove=function(){this._element.style.removeProperty("--ah-modality-layer-root")},e.prototype._reallyUpdateLayers=function(){if(this._element.ownerDocument){var e=[],t=a.createElementTreeWalker(this._element.ownerDocument,this._element,function(t){var n=r.getAbilityHelpersOnElement(t);return n&&n.modalityLayer?(e.push(n.modalityLayer),NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_SKIP});if(t)for(;t.nextNode(););for(var n=void 0===this._curLayerId,i=!1,o=this._knownLayers,s={},c={},u={},l=0;l<e.length;l++){var p=(m=(g=e[l]).userId)===this._curLayerId;!n&&p&&(n=g.isOthersAccessible()),p&&(i=!0),s[m]=g,m in o||(c[m]=g)}for(var d=0,f=Object.keys(o);d<f.length;d++){var h=f[d];h in s||(u[h]=o[h])}i||this.setCurrentLayerId(void 0,!0),this._knownLayers=s;for(l=0;l<e.length;l++){var g,m=(g=e[l]).userId,v=void 0===this._curLayerId||m===this._curLayerId;g.setActive(v),g.setAccessible(g.isAlwaysAccessible()||n||v)}}},e.prototype._setInformativeStyle=function(){this._element.style.setProperty("--ah-modality-layer-root",this.id+","+(this._curLayerId||"undefined"))},e}();t.ModalityLayerRoot=d;var f=function(){function e(t){var n=this;this._init=function(){n._initTimer=void 0,r.AbilityHelpers.focusedElement.subscribe(n._onElementFocused),n._mainWindow.document.addEventListener(s.MUTATION_EVENT_NAME,n._onMutation),n._mainWindow.addEventListener(c,n._onIFrameEvent),h(n._mainWindow.document)},this._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case s.MUTATION_EVENT_NAME:n._onMutation(e.originalEvent)}},this._onMutation=function(t){if(t.target&&t.details.layer){var n=e._getRootOnly(t.target);n&&n.updateLayers()}},this._onElementFocused=function(t){var i;if(n._focusOutTimer&&(n._mainWindow.clearTimeout(n._focusOutTimer),n._focusOutTimer=void 0),t){var r=e.getLayerFor(t);r&&(i=r.layer)}i?(n._curFocusInLayer&&i!==n._curFocusInLayer&&n._curFocusInLayer.setFocused(!1),n._curFocusInLayer=i,n._curFocusInLayer.setFocused(!0)):n._curFocusInLayer&&(n._focusOutTimer=n._mainWindow.setTimeout(function(){n._focusOutTimer=void 0,n._curFocusInLayer&&(n._curFocusInLayer.setFocused(!1),n._curFocusInLayer=void 0)},0))},this._mainWindow=t,this._initTimer=this._mainWindow.setTimeout(this._init,0)}return e.prototype.dispose=function(){this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._focusOutTimer&&(this._mainWindow.clearTimeout(this._focusOutTimer),this._focusOutTimer=void 0),r.AbilityHelpers.focusedElement.unsubscribe(this._onElementFocused),this._mainWindow.document.removeEventListener(s.MUTATION_EVENT_NAME,this._onMutation),this._mainWindow.removeEventListener(c,this._onIFrameEvent)},e.prototype.addRoot=function(e){var t=r.getAbilityHelpersOnElement(e);if(!t||!t.modalityRoot){var n=new d(e);r.setAbilityHelpersOnElement(e,{modalityRoot:n});for(var i=[],o=e;o;o=o.parentElement)i.push(o);s.dispatchMutationEvent(e,{root:n})}},e.prototype.removeRoot=function(e){var t=r.getAbilityHelpersOnElement(e),n=t&&t.modalityRoot;n&&(s.dispatchMutationEvent(e,{root:n,removed:!0}),r.setAbilityHelpersOnElement(e,{modalityRoot:void 0}),n.dispose())},e.prototype.moveRoot=function(e,t){var n=r.getAbilityHelpersOnElement(e),i=n&&n.modalityRoot;i&&(i.move(t),r.setAbilityHelpersOnElement(t,{modalityRoot:i}),r.setAbilityHelpersOnElement(e,{modalityRoot:void 0}),s.dispatchMutationEvent(e,{root:i,removed:!0}),s.dispatchMutationEvent(t,{root:i}))},e.prototype.addLayer=function(e,t,n){var i=r.getAbilityHelpersOnElement(e);if(i&&i.modalityLayer){if(i.modalityLayer.userId!==t)throw new Error("The element already has a modality layer with different id.")}else{var o=new p(e,t,n);r.setAbilityHelpersOnElement(e,{modalityLayer:o}),r.AbilityHelpers.focusDeloser.add(e,{onFocusLost:n.onFocusLost}),s.dispatchMutationEvent(e,{layer:o})}},e.prototype.removeLayer=function(e){var t=r.getAbilityHelpersOnElement(e),n=t&&t.modalityLayer;n&&(r.setAbilityHelpersOnElement(e,{modalityLayer:void 0}),r.AbilityHelpers.focusDeloser.remove(e),s.dispatchMutationEvent(e,{layer:n,removed:!0}),n.dispose())},e.prototype.moveLayer=function(e,t){var n=r.getAbilityHelpersOnElement(e),i=n&&n.modalityLayer;i&&(i.move(t),r.setAbilityHelpersOnElement(t,{modalityLayer:i}),r.setAbilityHelpersOnElement(e,{modalityLayer:void 0}),r.AbilityHelpers.focusDeloser.move(e,t),s.dispatchMutationEvent(e,{layer:i,removed:!0}),s.dispatchMutationEvent(t,{layer:i}))},e.prototype.focusLayer=function(t,n,i){var o=e.getLayerFor(t);if(o){var s=r.AbilityHelpers.focusDeloser.getActions(o.layer.getElement());if(s)return void 0===n&&(n=o.layer.isNoFocusFirst()),!(n||!r.AbilityHelpers.keyboardNavigation.isNavigatingWithKeyboard()||!s.focusFirst())||(void 0===i&&(i=o.layer.isNoFocusDefault()),!(i||!s.focusDefault())||s.resetFocus())}return!1},e._getRootOnly=function(e){for(var t=e;t;t=t.parentElement){var n=r.getAbilityHelpersOnElement(t);if(n&&n.modalityRoot)return n.modalityRoot}},e.getLayerFor=function(e){if(e.ownerDocument){for(var t,n,i=e;i;i=i.parentElement){var o=r.getAbilityHelpersOnElement(i);if(o&&(!n&&o.modalityLayer&&(n=o.modalityLayer),n&&o.modalityRoot)){t=o.modalityRoot;break}}if(n&&t)return{layer:n,root:t}}},e.getRootId=function(t){var n=e.getLayerFor(t);return n&&n.root.id||"no-root"},e.getRootById=function(e){if("no-root"!==e)return l[e]},e}();function h(e){e.addEventListener(s.MUTATION_EVENT_NAME,function(e){var t=e.details.root;t&&(e.details.removed?delete l[t.id]:l[t.id]=t)})}t.ModalityLayer=f,t.setupModalityLayerInIFrame=function(e,t){h(t),o.setupIFrameToMainWindowEventsDispatcher(e,t,c,[{type:o.EventFromIFrameDescriptorType.Document,name:s.MUTATION_EVENT_NAME,capture:!1}])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="NFKD",r={"":"a","":"o","":"a","":"a","":"a","":"a","":"a","":"a","":"c","":"e","":"e","":"e","":"e","":"i","":"i","":"i","":"i","":"n","":"o","":"o","":"o","":"o","":"o","":"u","":"u","":"u","":"u","":"y","":"y","":"a","":"a","":"a","":"c","":"c","":"c","":"c","":"d","":"e","":"e","":"e","":"e","":"e","":"g","":"g","":"g","":"g","":"h","":"i","":"i","":"i","":"i","":"ij","":"j","":"k","":"l","":"l","":"l","":"l","":"n","":"n","":"n","":"n","":"o","":"o","":"o","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"t","":"t","":"u","":"u","":"u","":"u","":"u","":"u","":"w","":"y","":"z","":"z","":"z","":"s","":"o","":"u","":"dz","":"Lj","":"lj","":"Nj","":"nj","":"a","":"i","":"o","":"u","":"u","":"u","":"u","":"u","":"a","":"a","":"g","":"k","":"o","":"o","":"j","":"dz","":"g","":"n","":"a","":"a","":"a","":"e","":"e","":"i","":"i","":"o","":"o","":"r","":"r","":"u","":"u","":"s","":"t","":"h","":"a","":"e","":"o","":"o","":"o","":"o","":"y","":"h","":"j","":"r","":"w","":"y","":"l","":"s","":"x"};function o(e,t){var n=e.substring(0,t).search(/\S+$/),i=e.substring(t).search(/\s/);return-1===n&&(n=t),-1===i?i=e.length:i+=t,{start:n,end:i}}t.toBoolean=function(e){return e?"true"===e.toLowerCase():null},t.wordAt=function(e,t){var n=o(e,t);return e.substring(n.start,n.end)},t.inject=function(e,t,n,i){return void 0===i&&(i=n),e.substr(0,n)+t+e.substr(i,e.length)},t.wordBoundariesAt=o,t.b64DecodeUnicode=function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},t.normalizeString=function(e){if(e=e.toLowerCase(),String.prototype.normalize)return e.normalize(i).replace(/[\u0300-\u036f]/g,"");var t=parseInt("0xD800",16),n=parseInt("0xDBFF",16),o=0,s="",a="",c=void 0;if(!e)return e;for(;o<e.length;)s+=e.charAt(o),((c=e.charCodeAt(o))<t||c>n)&&(a+=r.hasOwnProperty(s)?r[s]:s,s=""),o++;return a},t.startsWith=function(e,t){return 0===e.indexOf(t)},t.endsWith=function(e,t){return e.lastIndexOf(t)===e.length-t.length}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=n(2),a=n(0),c=n(73),u=n(8),l=n(14),p=n(172);!function(e){e.Online="online",e.Busy="busy",e.Away="away"}(o=t.PresenceStatusUI||(t.PresenceStatusUI={})),function(e){e.SuperSmall="swcAvatar_size_superSmall",e.Small="swcAvatar_size_small",e.Medium="swcAvatar_size_medium",e.MediumLarge="swcAvatar_size_mediumLarge",e.Large="swcAvatar_size_large",e.SuperLarge="swcAvatar_size_superLarge"}(t.SwcAvatarSize||(t.SwcAvatarSize={}));var d=/teams.microsoft.com/,f="#ccc",h=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="swcAvatar",n._handleImageError=function(){n.setState({hasImageError:!0})},n.state=t.avatarUrl?{bgColor:"transparent",showBlock:!!t.showBlock,presenceStatus:t.presenceStatus,initials:"",hasImageError:!1}:{initials:t.title?c.getInitials(t.title):"",bgColor:t.title?c.getBackgroundColor(t.title):f,showBlock:!!t.showBlock,presenceStatus:t.presenceStatus,hasImageError:!1},n}return r(t,e),t.prototype.getComposedBlockClassName=function(){var t=e.prototype.getComposedBlockClassName.call(this);return this.props.size&&(t+=" "+this.props.size),t},t.prototype.componentDidUpdate=function(e){!this.props.avatarUrl&&this.props.title&&this.props.title!==e.title&&this.setState({initials:c.getInitials(this.props.title),bgColor:c.getBackgroundColor(this.props.title)}),this.props.showBlock!==e.showBlock&&this.setState({showBlock:!!this.props.showBlock}),this.props.presenceStatus!==e.presenceStatus&&this.props.presenceStatus&&this.setState({presenceStatus:this.props.presenceStatus})},t.prototype.render=function(){var e=this.state,t=this.props,n=function(e,t){if(e)return l.SwcIconType.PresenceBlocked;switch(t){case o.Away:return l.SwcIconType.PresenceAway;case o.Busy:return l.SwcIconType.PresenceDnd;case o.Online:return l.SwcIconType.PresenceOnline;default:return null}}(e.showBlock,e.presenceStatus),i=t.avatarUrl,r=i&&""!==i&&"avatar NA"!==i,c=s.createElement(g,{initials:e.initials,bgColor:e.bgColor,size:t.size});return e.hasImageError?c:s.createElement("div",{className:this.getComposedBlockClassName(),"aria-label":a.swc.services.i18n.fetch("aria_avatar_label",{title:t.title}),"aria-hidden":!1===t.accessible?"true":void 0},r?s.createElement(p.SwcImageLoader,{className:"swcAvatar__img",useCredentials:d.test(i),src:i,onError:this._handleImageError,placeholder:c}):c,!!n&&s.createElement(l.SwcIcon,{className:"swcAvatar__presence",type:n}))},t}(u.SwcBaseComponent);function g(e){var t=e.initials,n=e.bgColor,i=e.size;return s.createElement("div",{className:"swcAvatar__initials "+i,style:{"background-color":n},"data-test-id":"swcAvatar__initials_test"},t)}t.SwcAvatar=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.PERSON=1]="PERSON",e[e.THREAD=2]="THREAD",e[e.BOT=3]="BOT",e[e.JOIN_URL=4]="JOIN_URL",e[e.PHONE=5]="PHONE"}(t.SDKMode||(t.SDKMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(){}return Object.defineProperty(e,"dompurify",{get:function(){return i.swcWindow.DOMPurify},enumerable:!0,configurable:!0}),e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),r={id:"flik",ariaLabelLocKey:"expressionPicker_mruMojiPack_ariaLabel",titleLocKey:"expressionPicker_mruMojiPack_title",mruLimit:10},o=function(){function e(){var e=this;this.CACHE_KEY="swx|pes",this.SAVED_DATA_VERSION="v1.0",this.FEATURED_IN_PREFIX="FeaturedIn-",this.pesCDNAuthentication={skypeServiceHost:"static.asm.skype.com",tokenSourceEndpoint:"/pes/v1/petoken",cdnServiceHost:"static-asm.secure.skypeassets.com",cookieSourceEndpoint:"/token/token_to_cookies",securedPathsPatter:"static[.]asm[.]skype[.]com",cdnTokenTtlMs:3e5,rewriteRules:[{from:"static.asm.skype.com",to:"static-asm.secure.skypeassets.com"},{from:"api.asm.skype.com",to:"static-asm.secure.skypeassets.com"}]},this.itemTypes={typeKeyName:"type",tab:{id:"tab",ariaLabelLocKey:"expressionPicker_mruTab_ariaLabel",titleLocKey:"expressionPicker_mruTab_title"},emoticon:{id:"emoticon",ariaLabelLocKey:"expressionPicker_mruEmoticonPack_ariaLabel",titleLocKey:"expressionPicker_mruEmoticonPack_title",mruLimit:27},moji:r,image:{id:"image"},message:{id:"message"},sticker:{id:"sticker"},flik:r},this.mru={TAB_ID:"mru",PACK_PREFIX:"mru:"},this.bingSearch={TAB_ID:"bing",PACK_PREFIX:"bing:"},this.giphyImageSearch={TAB_ID:"giphyImages",PACK_PREFIX:"giphy-imh:"},this.localSearch={TAB_ID:"localSearch",PACK_PREFIX:"local:",titleLocKey:"expressionPicker_localSearchPack_title",ariaLabelLocKey:"expressionPicker_localSearchPack_ariaLabel"},this.frameHeights={emoticons:{SMALL:20,LARGE:40,EXTRA_LARGE:60,SUPER_LARGE:120},moji:{THUMBNAIL:40,KEYFRAME:80},packs:{TAB:19}},this.profiles={emoticons:{getSmall:function(){return e.highDpi?"default_40_f":"default_20_f"},getLarge:function(){return e.highDpi?"default_80_f":"default_40_f"},getExtraLarge:function(){return e.highDpi?"default_120_f":"default_60_f"},getSuperLarge:function(){return e.highDpi?"default_240_f":"default_120_f"},getSmallAnimated:function(){return e.highDpi?"default_40_anim_f":"default_20_anim_f"},getLargeAnimated:function(){return e.highDpi?"default_80_anim_f":"default_40_anim_f"},getExtraLargeAnimated:function(){return e.highDpi?"default_120_anim_f":"default_60_anim_f"},getSuperLargeAnimated:function(){return e.highDpi?"default_240_anim_f":"default_120_anim_f"}},moji:{thumbnail:"thumbnail",content:"default"}}}return Object.defineProperty(e.prototype,"highDpi",{get:function(){return this._highDpi||(this._highDpi=i.default.getScreenInfo().pixelRatio>1),this._highDpi},enumerable:!0,configurable:!0}),e}();t.default=new o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(37);t.SwcAvatar=i.SwcAvatar,t.SwcAvatarSize=i.SwcAvatarSize;var r=n(173);t.SwcRecentAvatar=r.SwcRecentAvatar;var o=n(74);t.SwcPersonAvatar=o.SwcPersonAvatar;var s=n(174);t.SwcConversationAvatar=s.SwcConversationAvatar},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(50),r=function(){function e(){}return e._personIdRegExp=/(\d+:)([\S]*)/,e.normalizePersonId=function(t){var n=t&&t.match(e._personIdRegExp);return n?n[2]:t},e.parsePersonId=function(t){var n=t.match(e._personIdRegExp);return n?{id:n[2],type:parseInt(n[1],0)}:{id:t,type:null}},e.getContactType=function(e){var t=/\d{0,}[^:]/g.exec(e.mri);return t&&t[0]?parseInt(t[0],0):i.ContactType.Undefined},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(25).default,r={96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"};function o(e){return e.which||e.keyCode}function s(e){var t=o(e);return t>=i.NUMPAD_0&&t<=i.NUMPAD_9}t.default={swallow:function(e){e.preventDefault()},getKeyCode:o,getNumpadKey:function(e){return!!s(e)&&r[o(e)]},isActivation:function(e){var t=o(e);return t===i.ENTER||t===i.SPACE},isAlphaNumericKey:function(e){var t=o(e);return t>=i.NUMBER_0&&t<=i.NUMBER_9||t>=i.A&&t<=i.Z},isNumPadKey:s,isDeactivation:function(e){return o(e)===i.ESCAPE}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),r=n(24),o=n(45),s=n(34),a="ability-helpers:list-related",c=0,u=function(){function e(e,t,n){this._element=e,this._context=t,this._focus=n}return e.prototype.prev=function(e){var t=i.AbilityHelpers.focusable.findPrevListItem(!1,!1,this._element,this._context);return t&&(this._context=t,e||this._focus(t)),t},e.prototype.next=function(e){var t=i.AbilityHelpers.focusable.findNextListItem(!1,!1,this._element,this._context);return t&&(this._context=t,e||this._focus(t)),t},e.prototype.pageUp=function(e){for(var t=i.AbilityHelpers.focusable.findPrevListItem(!1,!1,this._element,this._context),n=null;t;)n=t,t=f(t)?i.AbilityHelpers.focusable.findPrevListItem(!1,!1,this._element,t):null;return n&&(this._context=n,e||(d.scrollIntoView(n,!1),this._focus(n))),n},e.prototype.pageDown=function(e){for(var t=i.AbilityHelpers.focusable.findNextListItem(!1,!1,this._element,this._context),n=null;t;)n=t,t=f(t)?i.AbilityHelpers.focusable.findNextListItem(!1,!1,this._element,t):null;return n&&(this._context=n,e||(d.scrollIntoView(n,!0),this._focus(n))),n},e.prototype.home=function(e){var t=i.AbilityHelpers.focusable.findFirstListItem(this._element);return t&&(this._context=t,e||this._focus(t)),t},e.prototype.end=function(e){var t=i.AbilityHelpers.focusable.findLastListItem(this._element);return t&&(this._context=t,e||this._focus(t)),t},e}();t.ListNavigation=u;var l=function(){function e(e,t){this.id="list"+ ++c,this._props=t,this._element=e,this._add()}return e.prototype.dispose=function(){this._remove()},e.prototype.move=function(e){this._remove(),this._element=e,this._curItem=void 0,this._add()},e.prototype.getCurrentItem=function(){return this._curItem?this._curItem:this._findCurrentItem()},e.prototype.setCurrentItem=function(e){this._curItem=e,this._setInformativeStyle()},e.prototype.getElement=function(){return this._element},e.prototype._findCurrentItem=function(){var e=this;if(this._element.ownerDocument){var t,n=s.createElementTreeWalker(this._element.ownerDocument,this._element,function(t){return a.call(e,t)});if(n){if(this._props.bottomUp){for(var r=null,o=this._element.lastElementChild;o;o=o.lastElementChild)r=o;r&&a.call(this,r)!==NodeFilter.FILTER_ACCEPT&&(n.currentNode=r,n.previousNode())}else n.nextNode();return t&&t!==this._curItem&&this.setCurrentItem(t),t}}function a(e){var n=i.getAbilityHelpersOnElement(e);return n&&n.listItem?i.AbilityHelpers.focusable.isFocusable(n.listItem.getElement())&&(t||(t=n.listItem),void 0===this._curItem||n.listItem===this._curItem)?(t=n.listItem,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}},e.prototype._add=function(){this._setInformativeStyle()},e.prototype._remove=function(){this._element.style.removeProperty("--ah-list")},e.prototype._setInformativeStyle=function(){this._element.style.setProperty("--ah-list",this._curItem?this._curItem.id:"no-current")},e}();t.ListContainer=l;var p=function(){function e(e){this.id="li"+ ++c,this._element=e,this._add()}return e.prototype.dispose=function(){this._remove()},e.prototype.move=function(e){this._remove(),this._element=e,this._add()},e.prototype.getElement=function(){return this._element},e.prototype._add=function(){this._element.tabIndex=0,this._element.style.setProperty("--ah-list-item",this.id)},e.prototype._remove=function(){this._element.style.removeProperty("--ah-list-item")},e}();t.ListItem=p;var d=function(){function e(t){var n=this;this._init=function(){n._initTimer=void 0,n._mainWindow.document.addEventListener(o.MUTATION_EVENT_NAME,n._onMutation),n._mainWindow.addEventListener(a,n._onIFrameEvent)},this._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case o.MUTATION_EVENT_NAME:n._onMutation(e.originalEvent)}},this._onMutation=function(t){if(t.target){var n=t.details;if(n.list)n.list.setCurrentItem(void 0);else if(n.item){var i=e._getList(t.target);i&&t.details.removed&&i.getCurrentItem()===n.item&&i.setCurrentItem(void 0)}}},this._mainWindow=t,this._initTimer=this._mainWindow.setTimeout(this._init,0)}return e.prototype.dispose=function(){this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._mainWindow.document.removeEventListener(o.MUTATION_EVENT_NAME,this._onMutation),this._mainWindow.removeEventListener(a,this._onIFrameEvent)},e.prototype.add=function(e,t){var n=t||{};i.setAbilityHelpersOnElement(e,{list:new l(e,n)}),i.AbilityHelpers.focusDeloser.add(e,{onFocusLost:n.onFocusLost})},e.prototype.remove=function(e){var t=i.getAbilityHelpersOnElement(e);t&&t.list&&(i.AbilityHelpers.focusDeloser.remove(e),t.list.dispose(),i.setAbilityHelpersOnElement(e,{list:void 0}))},e.prototype.move=function(e,t){var n=i.getAbilityHelpersOnElement(e),r=n&&n.list;r&&(r.move(t),i.setAbilityHelpersOnElement(t,{list:r}),i.setAbilityHelpersOnElement(e,{list:void 0}),i.AbilityHelpers.focusDeloser.move(e,t))},e.prototype.addItem=function(e){var t=i.getAbilityHelpersOnElement(e);if(!t||!t.listItem){var n=new p(e);i.setAbilityHelpersOnElement(e,{listItem:n}),o.dispatchMutationEvent(e,{item:n})}},e.prototype.removeItem=function(e){var t=i.getAbilityHelpersOnElement(e),n=t&&t.listItem;n&&(n.dispose(),i.setAbilityHelpersOnElement(e,{listItem:void 0}),o.dispatchMutationEvent(e,{item:n,removed:!0}))},e.prototype.moveItem=function(e,t){var n=i.getAbilityHelpersOnElement(e),r=n&&n.listItem;r&&(r.move(t),i.setAbilityHelpersOnElement(t,{listItem:r}),i.setAbilityHelpersOnElement(e,{listItem:void 0}),o.dispatchMutationEvent(e,{item:r,removed:!0}),o.dispatchMutationEvent(t,{item:r}))},e.prototype.setActionable=function(e,t){var n=!1!==t||void 0;i.setAbilityHelpersOnElement(e,{listActionable:n}),n?e.style.setProperty("--ah-list-actionable","yes"):e.style.removeProperty("--ah-list-actionable")},e.prototype.setCurrent=function(t,n){var i=e._getList(t);if(i){if(!n)return i.setCurrentItem(void 0),!0;var r=e.getItemFor(n);if(r&&r.list===i)return i.setCurrentItem(r.listItem),!0}return!1},e._getList=function(e){for(var t=e;t;t=t.parentElement){var n=i.getAbilityHelpersOnElement(t);if(n&&n.list)return n.list}},e.getItemFor=function(e){if(e.ownerDocument){for(var t,n,r,o=e;o;o=o.parentElement){var s=i.getAbilityHelpersOnElement(o);if(s&&(!n&&s.listItem&&(n=s.listItem,r=o),n&&s.list)){t=s.list;break}}if(t&&n)return{list:t,listItem:n,isListItem:e===r}}},e.findActionable=function(e){if(!e.ownerDocument)return null;var t=s.createElementTreeWalker(e.ownerDocument,e,function(e){var t=i.getAbilityHelpersOnElement(e);return t&&t.listActionable?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});return t?t.nextNode():null},e.scrollIntoView=function(t,n){var i=e.getItemFor(t);if(i){var r=i.list.getElement(),o=r.getBoundingClientRect(),s=i.listItem.getElement().getBoundingClientRect();r.scrollTop+=n?s.top-o.top:s.bottom-o.bottom}},e}();function f(e){var t=d.getItemFor(e);if(!t)return!1;var n=t.list.getElement().getBoundingClientRect(),i=e.getBoundingClientRect();return i.left>=n.left&&i.top>=n.top&&i.right<=n.right&&i.bottom<=n.bottom}t.List=d,t.setupListInIFrame=function(e,t){r.setupIFrameToMainWindowEventsDispatcher(e,t,a,[{type:r.EventFromIFrameDescriptorType.Document,name:o.MUTATION_EVENT_NAME,capture:!1}])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),r=n(34);function o(e,n){var i=document.createEvent("HTMLEvents");i.initEvent(t.MUTATION_EVENT_NAME,!0,!0),i.details=n,e.dispatchEvent(i)}t.MUTATION_EVENT_NAME="ability-helpers:mutation-event",t.observeMutations=function(e){"undefined"!=typeof MutationObserver&&new MutationObserver(function(t){for(var n={},s={},a={},c={},u=0,l=t;u<l.length;u++){for(var p=l[u],d=p.removedNodes,f=p.addedNodes,h=0;h<d.length;h++)P(d[h],p.target);for(h=0;h<f.length;h++)P(f[h],void 0,p.target)}for(var g=0,m=Object.keys(n);g<m.length;g++){var v=m[g],y=n[v];y.removedFrom&&o(y.removedFrom,{root:y.root,removed:!0}),y.addedTo&&o(y.addedTo,{root:y.root,removed:!1})}for(var _=0,b=Object.keys(s);_<b.length;_++)v=b[_],(S=s[v]).removedFrom&&o(S.removedFrom,{layer:S.layer,removed:!0}),S.addedTo&&o(S.addedTo,{layer:S.layer,removed:!1});for(var w=0,C=Object.keys(a);w<C.length;w++){var S;v=C[w],(S=a[v]).removedFrom&&o(S.removedFrom,{list:S.list,removed:!0}),S.addedTo&&o(S.addedTo,{list:S.list,removed:!1})}for(var T=0,E=Object.keys(c);T<E.length;T++)v=E[T],(h=c[v]).removedFrom&&o(h.removedFrom,{item:h.item,removed:!0}),h.addedTo&&o(h.addedTo,{item:h.item,removed:!1});function P(t,n,i){I(t,n,i);var o=r.createElementTreeWalker(e,t,function(e){return I(e,n,i)});if(o)for(;o.nextNode(););}function I(e,t,r){var o=i.getAbilityHelpersOnElement(e);return o&&(o.modalityRoot&&function(e,t,i){var r=n[e.id];r||(r=n[e.id]={root:e}),t&&(r.removedFrom=t),i&&(r.addedTo=i)}(o.modalityRoot,t,r),o.modalityLayer&&function(e,t,n){var i=s[e.internalId];i||(i=s[e.internalId]={layer:e}),t&&(i.removedFrom=t),n&&(i.addedTo=n)}(o.modalityLayer,t,r),o.list&&function(e,t,n){var i=a[e.id];i||(i=a[e.id]={list:e}),t&&(i.removedFrom=t),n&&(i.addedTo=n)}(o.list,t,r),o.listItem&&function(e,t,n){var i=c[e.id];i||(i=c[e.id]={item:e}),t&&(i.removedFrom=t),n&&(i.addedTo=n)}(o.listItem,t,r)),NodeFilter.FILTER_SKIP}}).observe(e,{childList:!0,subtree:!0})},t.dispatchMutationEvent=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(0),o=function(){function e(e,t,n){var i=this;this._createMessageModel=e,this._generateContent=t,this._subscribedCallbacks={},this.subscribeOnceToPersonsName=function(e){i._subscribedCallbacks[e.id]||(i._subscribedCallbacks[e.id]=i._onDisplayNameChanged.bind(i,e.id),e.subscribe("displayName",i._subscribedCallbacks[e.id]))},this._onDisplayNameChanged=function(e){i._messageModel.content=i._generateContent(i),i._initiator.unsubscribe("displayName",i._subscribedCallbacks[e])},this.getInitiatorFromContent(n.content),this.getTargetsFromContent(n.content),this._messageModel=this._createMessageModel(n,this._generateContent(this),!0),r.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",function(){i._messageModel.content=i._generateContent(i)})}return e.prototype.isSelfAction=function(){return 1===this._targets.length&&this._targets[0].id===this._initiator.id},e.prototype.getInitiatorFromContent=function(e){var t=e.match(/<initiator>(\d+:.+)<\/initiator>/i);t&&(this._initiator=r.swc.services.persons.getPerson(t[1]))},e.prototype.getTargetsFromContent=function(e){var t=this,n=/(?:<target>|<id>)(\d+:.+?)(?:<\/id>|<\/target>)/i,o=e.match(/<target>.+?<\/target>/gi)||[],s=[];o.forEach(function(e){var t=e.match(n);t&&s.push(t[1])}),this._targets=s.map(function(e){return r.swc.services.persons.getPerson(e,!0)}),i.default.get.isTeams()&&this._targets.length>1&&(this._targets=this._targets.filter(function(e){return e.mri!==t._initiator.mri}))},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SEARCH="search",e.CONTACTS="contacts",e.RECENT="recent",e.NEWCHAT="new",e.AVATAR="avatar",e.CONVERSATION_ROSTER="conversationRoster",e.ADD_PARTICIPANTS_TEAMS="addParticipantsTeams",e.NOTIFICATION="openNotification"}(t.OpenChatOrigin||(t.OpenChatOrigin={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.SDK_LOADER="sdk-loader",e.SDK_CORE="sdk-core",e.ASSETS="assets-bundle",e.BUILDER="builder-bundle",e.BUILDER_CORE="builder-core",e.CALLING="calling-bundle",e.CALLING_STANDALONE="callingStandalone-bundle",e.SERVICES="services-bundle",e.CHAT_BUNDLE="chat-bundle",e.RECENTS_BUNDLE="recents-bundle",e.UICOMPONENT_BUNDLE="uicomponent-bundle",e.TELEMETRY_BUNDLE="telemetry-bundle",e.VENDORS="vendors",e.CONNECT="connect",e.POLYFILLS="polyfills",e.HOST_CHAT_PAGE="host-chat",e.HOST_BING_PAGE="host-button",e.HOST_BUILDER_PAGE="host-builder",e.STYLE_BUILDER="swc-builder",e.STYLE_SDK="swc-sdk",e.STYLE_CHAT_SKYPE="swc-chat",e.STYLE_RECENTS_SKYPE="swc-recents",e.STYLE_CHAT_BING="swc-bing",e.STYLE_CHAT_THEME_DARK="swc-dark",e.STYLE_CALLING="swc-calling",e}();t.PackageName=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(19),o=n(0),s=n(13),a=n(10),c=n(167),u=n(31),l={retryCount:3,timeout:5e4,policy:""},p=function(e,t){void 0===t&&(t={});var n=Object.assign({},t);return c.getHeaders().then(function(t){return n.method=e,n.headers=n.headers||{},Object.assign(n.headers,{ClientInfo:i.Configuration.getChatClientInfo(),Pragma:"no-cache",Expires:0,ContextId:"tcid="+s.guid.generate(),BehaviorOverride:"redirectAs404",Accept:"application/json"},t),n})},d=function(e,t,n,i,r){return void 0===r&&(r=3),429===t.status||500===t.status||503===t.status?0===r?Promise.reject(t):a.default("webapi-"+e,l,n,i).then(function(t){return new Promise(function(o){setTimeout(function(){o(d(e,t,n,i,r-1))},2e3*(3-r+1))})}):Promise.resolve(t)},f=function(e,t,n,i,s,h){return p(t,i).then(function(g){if(!u.getDomain())return o.swc.services.signInManager.logout("services:domain is undefined"),Promise.reject({message:"Domain is undefined"});var m=s?n:u.getDomain()+n;return a.default("webapi-"+e,l,m,g).then(c.handleRegTokenExpiry).catch(function(n){return o.swc.services.signInManager.state===r.SigninState.SignedOut?Promise.reject(n):p(t,i).then(function(t){return a.default("webapi-"+e,l,m,t)})}).then(c.handleRegTokenExpiry).catch(function(e){return Promise.reject(e)}).then(function(s){return o.swc.services.signInManager.state===r.SigninState.SignedOut?Promise.reject(s):p(t,i).then(function(t){return d(e,s,u.getDomain()+n,t)})}).then(c.processHeaders).then(function(r){return u.handle404Redirect(r,function(r){return void 0===r&&(r=n),f(e,t,r,i,s)},h)})})};t.get=function(e,t,n,i,r){return f(e,"GET",t,n,i,r)},t.getWithDomain=function(e,t,n,i){return void 0===i&&(i=!1),f(e,"GET",t,n,!0,i)},t.put=function(e,t,n,i,r){return f(e,"PUT",t,n,i,r)},t.del=function(e,t,n){return f(e,"DELETE",t,n)},t.post=function(e,t,n,i){return f(e,"POST",t,n,i)},t.parseJson=function(e){return e.json().then(function(t){return e.ok?Promise.resolve(t):Promise.reject(t)})},t.reset=function(){c.reset(),u.reset()};var h=n(51);t.addGetParamsToUrl=h.addGetParamsToUrl},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Skype=8]="Skype",e[e.Agent=28]="Agent",e[e.Pstn=4]="Pstn",e[e.MSA=1]="MSA",e[e.Undefined=0]="Undefined"}(t.ContactType||(t.ContactType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addGetParamsToUrl=function(e,t){var n=[],i=function(e){if(void 0!==t[e]){var i=encodeURIComponent(e);if(Array.isArray(t[e]))t[e].forEach(function(e){var t=encodeURIComponent(e);n.push(i+"="+t)});else{var r=encodeURIComponent(t[e].toString());n.push(i+"="+r)}}};for(var r in t)i(r);return e+"?"+n.join("&")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.swcPostMessage=function(e,t,n){e.postMessage(t,n||"*")}},function(e,t,n){(function(t){var n="Expected a function",i=NaN,r="[object Symbol]",o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,l="object"==typeof t&&t&&t.Object===Object&&t,p="object"==typeof self&&self&&self.Object===Object&&self,d=l||p||Function("return this")(),f=Object.prototype.toString,h=Math.max,g=Math.min,m=function(){return d.Date.now()};function v(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&f.call(e)==r}(e))return i;if(v(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=v(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var n=a.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):s.test(e)?i:+e}e.exports=function(e,t,i){var r,o,s,a,c,u,l=0,p=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError(n);function _(t){var n=r,i=o;return r=o=void 0,l=t,a=e.apply(i,n)}function b(e){var n=e-u;return void 0===u||n>=t||n<0||d&&e-l>=s}function w(){var e=m();if(b(e))return C(e);c=setTimeout(w,function(e){var n=t-(e-u);return d?g(n,s-(e-l)):n}(e))}function C(e){return c=void 0,f&&r?_(e):(r=o=void 0,a)}function S(){var e=m(),n=b(e);if(r=arguments,o=this,u=e,n){if(void 0===c)return function(e){return l=e,c=setTimeout(w,t),p?_(e):a}(u);if(d)return c=setTimeout(w,t),_(u)}return void 0===c&&(c=setTimeout(w,t)),a}return t=y(t)||0,v(i)&&(p=!!i.leading,s=(d="maxWait"in i)?h(y(i.maxWait)||0,t):s,f="trailing"in i?!!i.trailing:f),S.cancel=function(){void 0!==c&&clearTimeout(c),l=0,r=u=o=c=void 0},S.flush=function(){return void 0===c?a:C(m())},S}}).call(this,n(27))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=n(12),a=n(11),c=function(e){function t(){var t=e.call(this)||this;return t._isOnline=navigator.onLine,t.subscribeOnlineHandlers(),t}return r(t,e),Object.defineProperty(t.prototype,"isOnline",{get:function(){return this._isOnline},set:function(e){e!==this._isOnline&&(this._isOnline=e,this.publish("isOnline",e),e&&this._onlinePromise&&this._onlinePromise.status===a.PromiseStatus.Pending&&this._onlinePromise.resolve())},enumerable:!0,configurable:!0}),t.prototype.onceOnline=function(){return this.isOnline?Promise.resolve():(this._onlinePromise&&this._onlinePromise.status===a.PromiseStatus.Pending||(this._onlinePromise=new a.CancelablePromise),this._onlinePromise.promise)},t.prototype.subscribeOnlineHandlers=function(){window.addEventListener("online",this.onlineStatusHandler.bind(this)),window.addEventListener("offline",this.onlineStatusHandler.bind(this))},t.prototype.onlineStatusHandler=function(){this.isOnline=navigator.onLine},t}(s.default);t.get=function(){return o||(o=new c),o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="px",r="all 0.5s ease";function o(e,t){var n=e.style;n.top=t.top+i,n.left=t.left+i,n.width=t.width+i,n.height=t.height+i}function s(e){return window.getComputedStyle(e)}t.transport=function(e,t,n,i,s,a){var c=e.getBoundingClientRect(),u=function(e){return t.appendChild(e)};a||u(e),e.style.transition=r,o(e,c),setTimeout(function(){return o(e,n)},0),setTimeout(function(){s(),e.style.transition=null,a&&u(e)},i)},t.setRectStyle=o,t.resetRectStyle=function(e){var t=e.style;t.width=t.height=t.top=t.bottom=t.right=t.left=null},t.isInDom=function(e){if(e)for(;e.parentNode;)if((e=e.parentNode)===document.documentElement)return!0;return!1},t.innerSize=function(e){var t=s(e);return{width:e.offsetWidth-parseInt(t.paddingLeft,10)-parseInt(t.paddingRight,10),height:e.offsetHeight-parseInt(t.paddingTop,10)-parseInt(t.paddingBottom,10)}},t.setStyle=function(e,t){e.setAttribute("style",t)},t.style=s,t.copyStyle=function(e,t,n){for(var i=s(t),r=e.style,o=0,a=n;o<a.length;o++){var c=a[o];r[c]=i[c]}},t.isInIframe=function(){try{return window.self!==window.top}catch(e){return!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(47),o=n(0),s=n(21),a="/sdk/v1/",c="sdk",u="js",l=function(){function e(){}return e.startChat=function(e,t,n,r,s){var a={ConversationId:e||"",Style:t.Style,Title:t.Title,SetConversationTopic:t.SetConversationTopic,NewChatFlag:n,DisableAvatarClickAction:t.DisableAvatarClickAction,EnableCalling:t.EnableCalling};s&&(a.ExecuteCall=s),!i.default.get.frameless||o.swc.services.signInManager.isTrusted?o.swc.Eventing.triggerEvent("startChat",a):o.swc.Eventing.triggerLocalEvent("openChatLocal",a),o.swc.Telemetry.sendEvent.recentsAction(e?"openChat":"newChat",r)},e.startCall=function(t,n,i,o,s,a){var c={calleeId:t,withVideo:i,displayName:o,avatarUrl:s,isGroup:a};e.startChat(t,n,!1,r.OpenChatOrigin.RECENT,c)},e.joinGroupCall=function(t,n,i,o,s){var a={threadId:t,withVideo:i,displayName:o,avatarUrl:s,isGroup:!0,accept:!0};e.startChat(t,n,!1,r.OpenChatOrigin.RECENT,a)},e.closeAllOpenChats=function(){o.swc.Eventing.triggerEvent("closeAllChats")},e._getSDKUrl=function(){var e=a+c,t=s.UrlHelper.getCompletePath(e,u);return s.UrlHelper.getCDNPath(o.swc.EcsConfig)+t},e._callingPopup=null,e}();t.default=l},function(e,t,n){(function(t){(function(){!function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=function(e){return e&&DataView.prototype.isPrototypeOf(e)},r=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};l.prototype.append=function(e,t){e=a(e),t=c(t);var n=this.map[e];n||(n=[],this.map[e]=n),n.push(t)},l.prototype.delete=function(e){delete this.map[a(e)]},l.prototype.get=function(e){var t=this.map[a(e)];return t?t[0]:null},l.prototype.getAll=function(e){return this.map[a(e)]||[]},l.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},l.prototype.set=function(e,t){this.map[a(e)]=[c(t)]},l.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(i){e.call(t,i,n,this)},this)},this)},l.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),u(e)},l.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),u(e)},l.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),u(e)},t.iterable&&(l.prototype[Symbol.iterator]=l.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},g.call(m.prototype),g.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:0,statusText:""});return e.type="error",e};var s=[301,302,303,307,308];y.redirect=function(e,t){if(-1===s.indexOf(t))throw new RangeError("Invalid status code");return new y(null,{status:t,headers:{location:e}})},e.Headers=l,e.Request=m,e.Response=y,e.fetch=function(e,n){return new Promise(function(i,r){var o=new m(e,n),s=new XMLHttpRequest;s.onload=function(){var e,t,n={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new l,e.split("\r\n").forEach(function(e){var n=e.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();t.append(i,r)}}),t)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var r="response"in s?s.response:s.responseText;i(new y(r,n))},s.onerror=function(){r(new TypeError("Network request failed"))},s.ontimeout=function(){r(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials&&(s.withCredentials=!0),"responseType"in s&&t.blob&&(s.responseType="blob"),o.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send(void 0===o._bodyInit?null:o._bodyInit)})},e.fetch.polyfill=!0}function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(n[Symbol.iterator]=function(){return n}),n}function l(e){this.map={},e instanceof l?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function d(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function f(e){var t=new FileReader,n=d(t);return t.readAsArrayBuffer(e),n}function h(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&i(e))this._bodyArrayBuffer=h(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!r(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=h(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var e,t,n,i=p(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=d(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),i=0;i<t.length;i++)n[i]=String.fromCharCode(t[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}function m(e,t){var n,i,r=(t=t||{}).body;if("string"==typeof e)this.url=e;else{if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new l(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new l(t.headers)),this.method=(n=t.method||this.method||"GET",i=n.toUpperCase(),o.indexOf(i)>-1?i:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function v(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(r))}}),t}function y(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new l(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this),e.exports=t.fetch}).call(t)}).call(this,n(27))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.read=0]="read"}(t.Permission||(t.Permission={})),function(e){e[e.Success=1]="Success",e[e.InProgress=2]="InProgress",e[e.ScanInProgress=3]="ScanInProgress",e[e.Failed=4]="Failed",e[e.Malware=5]="Malware"}(t.DocumentStatus||(t.DocumentStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(0),o={caseFirst:"upper"},s=function(){function e(){}return e.mapSearchProfileInfo=function(e){return e&&e.results?e.results.map(function(e){var t=e.nodeProfileData.skypeId,n={skypeid:-1===t.indexOf("8:")?"8:"+t:t,name:e.nodeProfileData.name,avatar:e.nodeProfileData.avatarUrl,type:i.ContactType.Skype,contactType:e.nodeProfileData.contactType,annotation:e.nodeAnnotation,jobTitle:e.nodeProfileData.jobTitle,department:e.nodeProfileData.department,location:e.nodeProfileData.location};return e.nodeConnectionData&&(n.distance=e.nodeConnectionData.distance,n.mutualFriendCount=e.nodeConnectionData.mutualFriendCount),n}):[]},e.getWrappedIdWithMri=function(e){var t=/^\d+:/.exec(e.id);if(t&&t[0])return e.id;var n=e.isAgent?/^28:/:/^8:/;return(e.isAgent?"28:":"8:")+e.id.replace(n,"")},e.sortByName=function(e,t){var n=e.person.displayName.localeCompare(t.person.displayName,void 0,o);return 0===n?e.person.id.localeCompare(t.person.id):n},e.getSortedByRelevance=function(t){var n=t.filter(function(e){return e.rawPerson.mutualFriendCount}).sort(function(e,t){return t.rawPerson.mutualFriendCount-e.rawPerson.mutualFriendCount}),i=t.filter(function(e){return!e.rawPerson.mutualFriendCount}).sort(e.sortByName);return n.concat(i)},e.preloadImage=function(e,t,n){if(e.indexOf("data:image/jpeg;base64")>-1)t&&"function"==typeof t&&t(e);else{if(-1!==e.indexOf("https://teams.microsoft.com")){var i=r.swc.services.avatarService;if(i.fetchSingleAvatar&&t&&"function"==typeof t)return void i.fetchSingleAvatar(e).then(function(e){t(e)})}var o=new Image,s=encodeURI(decodeURI(e));o.onload=function(){t&&"function"==typeof t&&t(s)},o.onerror=function(e){n&&"function"==typeof n&&n()},o.src=s}},e.replaceAvatarPath=function(e){return e.indexOf("data:image/jpeg;base64")>-1?e:e=(e=e.replace("URL@","")).indexOf("/views/avatar_fullsize")<0?e+"/views/avatar_fullsize":e},e.resolveConversationAvatar=function(t,n){return n?t?e.replaceAvatarPath(n):n:""},e}();t.default=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(129),c=n(20),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){return s.createElement(o.Fragment,null,this.props.children)},t.prototype.componentDidMount=function(){this._findDOMNode(),c.AbilityHelpers.list.add(this._node)},t.prototype.componentDidUpdate=function(){var e=this._node;this._findDOMNode(),e!==this._node&&(e?c.AbilityHelpers.list.move(e,this._node):c.AbilityHelpers.list.add(this._node))},t.prototype.componentWillUnmount=function(){this._node&&c.AbilityHelpers.list.remove(this._node)},t.prototype._findDOMNode=function(){if(this._node=a.findDOMNode(this),!this._node)throw new Error("Failed to find list container node.")},t}(o.Component);t.AccessibleList=u;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){return s.createElement(o.Fragment,null,this.props.children)},t.prototype.componentDidMount=function(){this._findDOMNode(),c.AbilityHelpers.list.addItem(this._node)},t.prototype.componentDidUpdate=function(){var e=this._node;this._findDOMNode(),this._node!==e&&(e?c.AbilityHelpers.list.moveItem(e,this._node):c.AbilityHelpers.list.addItem(this._node))},t.prototype.componentWillUnmount=function(){this._node&&c.AbilityHelpers.list.removeItem(this._node)},t.prototype._findDOMNode=function(){if(this._node=a.findDOMNode(this),!this._node)throw new Error("Failed to find list item node.")},t}(o.Component);t.AccessibleListItem=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),r=function(){function e(){this.loaded=[],this.progress={}}return e.prototype.addScript=function(e,t,n){var r=this;if(-1===this.loaded.indexOf(e)){var o=this.progress;if(o[e])return t&&-1===o[e].success.indexOf(t)&&o[e].success.push(t),void(n&&-1===o[e].failure.indexOf(n)&&o[e].failure.push(n));o[e]={success:[],failure:[]},t&&o[e].success.push(t),n&&o[e].failure.push(n);var s=i.default.getDocument(),a=s.createElement("script");a.crossOrigin="anonymous",a.type="text/javascript",a.src=e,t&&(a.onload=function(){r.progress[e].success.forEach(function(e){try{e()}catch(e){}}),delete r.progress[e],r.loaded.push(e)}),n&&(a.onerror=function(){r.progress[e].failure.forEach(function(e){try{e()}catch(e){}}),delete r.progress[e]}),s.getElementsByTagName("body")[0].appendChild(a)}else t&&t()},e}();t.ScriptLoader=r},function(e,t,n){"use strict";var i,r,o;Object.defineProperty(t,"__esModule",{value:!0}),window.swc=window.swc||{},function(e){e[e.iwapp=927]="iwapp",e[e.todo=927]="todo",e[e.wac=928]="wac",e[e.wordonline=928]="wordonline",e[e.powerbi=930]="powerbi",e[e.sharepoint=931]="sharepoint",e[e.adminportal=932]="adminportal",e[e.yammer=933]="yammer",e[e.dynamics365=934]="dynamics365",e[e.dynamicsnav=934]="dynamicsnav"}(i||(i={})),function(e){e[e.outlook=915]="outlook",e[e.interviews=916]="interviews",e[e.bing=917]="bing",e[e.msn=918]="msn",e[e.azureportal=919]="azureportal",e[e.onedrive=920]="onedrive",e[e.scom=921]="scom",e[e.office=927]="office",e[e.word=928]="word",e[e.excel=929]="excel",e[e.powerpoint=930]="powerpoint",e[e.sharepoint=931]="sharepoint",e[e.adminportal=932]="adminportal",e[e.yammer=933]="yammer",e[e.dynamics=934]="dynamics",e[e["office default"]=935]="office default"}(r=t.NameMapping||(t.NameMapping={})),function(e){e[e["outlook.live.com"]=915]="outlook.live.com",e[e["outlook-sdf.live.com"]=915]="outlook-sdf.live.com",e[e["outlook.office.com"]=915]="outlook.office.com",e[e["outlook-sdf.office.com"]=915]="outlook-sdf.office.com",e[e["interviews.skype.com"]=916]="interviews.skype.com",e[e["interviews-df.skype.com"]=916]="interviews-df.skype.com",e[e["interviews-int.skype.com"]=916]="interviews-int.skype.com",e[e["www.bing.com"]=917]="www.bing.com",e[e["www.staging-bing-int.com"]=917]="www.staging-bing-int.com",e[e["www.bing-int.com"]=917]="www.bing-int.com",e[e["www.msn.com"]=918]="www.msn.com",e[e["int.msn.com"]=918]="int.msn.com",e[e["int1.msn.com"]=918]="int1.msn.com",e[e["wtskype2.azurewebsites.net"]=919]="wtskype2.azurewebsites.net",e[e["azuresupportextension-ms.hosting.portal.azure.net"]=919]="azuresupportextension-ms.hosting.portal.azure.net",e[e["portal.azure.com"]=919]="portal.azure.com",e[e["rc.portal.azure.com"]=919]="rc.portal.azure.com",e[e["ms.portal.azure.com"]=919]="ms.portal.azure.com",e[e["onedrive.live.com"]=920]="onedrive.live.com",e[e["www.skype.com"]=921]="www.skype.com",e[e["www.office.com"]=927]="www.office.com",e[e["microsoft-my.sharepoint.com"]=931]="microsoft-my.sharepoint.com",e[e["www.onedrive.com"]=920]="www.onedrive.com",e[e["word.office.com"]=928]="word.office.com",e[e["word.live.com"]=928]="word.live.com",e[e["excell.office.com"]=929]="excell.office.com",e[e["excell.live.com"]=929]="excell.live.com",e[e["powerpoint.office.com"]=930]="powerpoint.office.com",e[e["powerpoint.live.com"]=930]="powerpoint.live.com",e[e["sharepoint.office.com"]=931]="sharepoint.office.com",e[e["adminportal.office.com"]=932]="adminportal.office.com",e[e["www.yammer.com"]=933]="www.yammer.com",e[e["dynamics.office.com"]=934]="dynamics.office.com",e[e[".office.com"]=935]=".office.com"}(o||(o={}));var s=function(){function e(){}return e.getPlatformId=function(e){if(void 0===e&&(e=null),this._platformId)return this._platformId;if(swc.SDK&&swc.SDK.platformId&&swc.SDK.platformId>0)return this._platformId=swc.SDK.platformId,this._platformId;var t=-1;return e&&(t=this.getPlatformIdByAttribute(e)),t<=0&&(t=this.getPlatformIdByDomain()),t>0?t:912},e.getPlatformIdByAttribute=function(e){if(e){e=e.trim().toLowerCase();var t=parseInt(e,10);return t&&t>0?t:this.getPlatformIdForOffice(e)}return-1},e.getPlatformName=function(){var e=this.getPlatformId();return r[e]?r[e]:"other"},e.getPlatformIdForOffice=function(e){return i[e]||935},e.getPlatformIdByDomain=function(){var t=e.getHost();if(o.hasOwnProperty(t))return o[t];for(var n in o)if("."===n.charAt(0)&&t.indexOf(n)>0)return o[n];return-1},e.getHost=function(){try{var e=window.location.hostname;return!e&&e.length>0?e:("file:"===window.location.protocol.toLowerCase()&&(e="local"),e)}catch(e){return null}},e}();t.PlatformUtils=s},function(e,t,n){"use strict";function i(e){return!!e&&(0===e.indexOf("fb-")||0===e.indexOf("pr-"))}Object.defineProperty(t,"__esModule",{value:!0}),t.versionRegExp=/^\d+\.\d+\.\d+$/,t.getBranchParentFolder=function(e){return i(e)?"fb":"v"},t.isAppVersion=function(e){return!!e&&t.versionRegExp.test(e)},t.isFeatureBranch=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(67),r=n(68),o=n(4),s=n(7),a=n(29),c=n(89),u=n(36),l=function(){function e(){}return e.prototype.parseBaseDom=function(e,t){var n=t.getAttribute(i.Attributes.ID);n&&(e.ConversationId=a.default.getNormalizeId(n));var r=t.getAttribute(i.Attributes.BOT_ID);r&&(e.ConversationId=a.default.getNormalizeId(r)),(r=t.getAttribute(i.Attributes.CONTACT_EMAIL))&&(e.ConversationId=r),(r=t.getAttribute(i.Attributes.PHONE_NUMBER))&&(e.ConversationId=a.default.getNormalizeId(r)),(r=t.getAttribute(i.Attributes.CONTACT_ID))&&(e.ConversationId=a.default.getNormalizeId(r)),(r=t.getAttribute(i.Attributes.THREAD_ID))&&(e.ConversationId=a.default.getNormalizeId(r)),(r=t.getAttribute(i.Attributes.JOIN_LINK))&&(e.ConversationId=r),(r=t.getAttribute(i.Attributes.TOKEN))&&(e.ConversationId=r),this.parseDom(e,i.Attributes,t)},e.prototype.parseDom=function(e,t,n){c.objectProperties(e,function(i){if(i&&t[i]&&n.getAttribute(t[i])){var r=n.getAttribute(t[i]);if(!r)return;"true"===r.toLowerCase()||"false"===r.toLowerCase()?e[i]=u.toBoolean(r):e[i]=r}})},e.prototype.setBaseDOM=function(e,t){if(this.setDom(e,i.Attributes,t),e.ConversationId){t.removeAttribute(i.Attributes.PHONE_NUMBER),t.removeAttribute(i.Attributes.CONTACT_ID),t.removeAttribute(i.Attributes.BOT_ID),t.removeAttribute(i.Attributes.JOIN_LINK);var n=a.default.detectConversationType(e.ConversationId);n===o.ConversationType.AGENT?t.setAttribute(i.Attributes.BOT_ID,a.default.getNormalizeId(e.ConversationId)):n===o.ConversationType.PERSON?t.setAttribute(i.Attributes.CONTACT_ID,a.default.getNormalizeId(e.ConversationId)):n===o.ConversationType.GROUP?t.setAttribute(i.Attributes.THREAD_ID,e.ConversationId):n===o.ConversationType.JOIN?t.setAttribute(i.Attributes.JOIN_LINK,e.ConversationId):n===o.ConversationType.PHONE?t.setAttribute(i.Attributes.PHONE_NUMBER,e.ConversationId):s.default.throwError(10002,"Unsupported conversation id:",null,e.ConversationId)}},e.prototype.setDom=function(e,t,n,i){c.objectProperties(e,function(r){if(void 0!==e[r]&&null!==e[r]&&""!==e[r]){var o=e[r];if("boolean"==typeof o&&(o=o.toString()),!t[r])return;if(i&&e[r]===i[r])return;n.setAttribute(t[r],o)}})},e.prototype.parseBaseUrlParams=function(e,t){t[i.Attributes.BOT_ID]?e.ConversationId=a.default.getNormalizeId(t[i.Attributes.BOT_ID]):t[i.Attributes.PHONE_NUMBER]?e.ConversationId=a.default.getNormalizeId(t[i.Attributes.PHONE_NUMBER]):t[i.Attributes.CONTACT_ID]?e.ConversationId=a.default.getNormalizeId(t[i.Attributes.CONTACT_ID]):t[i.Attributes.THREAD_ID]?e.ConversationId=a.default.getNormalizeId(t[i.Attributes.THREAD_ID]):t[i.Attributes.JOIN_LINK]?e.ConversationId=t[i.Attributes.JOIN_LINK]:t[i.Attributes.TOKEN]&&(e.ConversationId=t[i.Attributes.TOKEN]),t[i.Attributes.SWC_Locale]&&(e.Locale=t[i.Attributes.SWC_Locale]),t[i.Attributes.SWC_ForceFrame]&&(e.ForceFrame=u.toBoolean(t[i.Attributes.SWC_ForceFrame])),t[i.Attributes.SWC_IsMinified]&&(e.IsMinified=u.toBoolean(t[i.Attributes.SWC_IsMinified])),this.parseUrlParams(e,i.Attributes,t)},e.prototype.parseUrlParams=function(e,t,n){c.objectProperties(e,function(i){if(n[t[i]]){var r=n[t[i]];"true"===r.toLowerCase()||"false"===r.toLowerCase()?e[i]=u.toBoolean(r):e[i]=r}})},e.prototype.getQueryStringParameters=function(){var e=!1,t=window.location.search.substring(1).split("&"),n={};return t.forEach(function(t){if(t){e=!0;var i=t.split("=");n[decodeURIComponent(i[0])]=decodeURIComponent(i[1])||""}}),e?n:null},e.prototype.getDefinitionFromUrl=function(){var e=this.getQueryStringParameters(),t=new r.Definition;return e?(this.parseBaseUrlParams(t,e),this.parseUrlParams(t,i.Attributes,e),t):t},e}();t.ConfigFactory=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Esc=27]="Esc",e[e.Space=32]="Space",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.Left=37]="Left",e[e.Up=38]="Up",e[e.Right=39]="Right",e[e.Down=40]="Down"}(t.Keys||(t.Keys={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._callbacks=[]}return e.prototype.dispose=function(){this._callbacks=[]},e.prototype.subscribe=function(e){this._callbacks.indexOf(e)<0&&this._callbacks.push(e)},e.prototype.unsubscribe=function(e){var t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)},e.prototype.setVal=function(e,t){this._val!==e&&(this._val=e,this._callCallbacks(e,t))},e.prototype.getVal=function(){return this._val},e.prototype._callCallbacks=function(e,t){this._callbacks.forEach(function(n){return n(e,t)})},e}();t.Subscribable=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.Theme="data-theme",e.Locale="data-locale",e.SWC_Locale="swc-locale",e.SWC_ForceFrame="swc-force-frame",e.SWC_IsMinified="swc-min",e.ID="data-id",e.BOT_ID="data-bot-id",e.CONTACT_ID="data-contact-id",e.PHONE_NUMBER="data-phone-number",e.CONTACT_EMAIL="data-contact-email",e.JOIN_LINK="data-join-link",e.THREAD_ID="data-thread-id",e.TOKEN="data-token",e.Payload="data-payload",e.BingDLApi="data-bing-dl-api",e.Title="data-title",e.Avatar="data-avatar",e.Prefill="data-prefill",e.PrivacyUri="data-privacy-uri",e.TermsOfUseUri="data-tou-uri",e.EnableCalling="data-enable-calling",e.CallingOnly="data-calling-only",e.DisableSendingEmoticons="data-disable-sending-emoticons",e.TrafficProvider="data-provider",e.TrafficSource="data-source",e.DisableInOutAnimation="data-disable-inout-animation",e.CorrelationId="data-correlation-id",e.SkypeOnly="data-skype-only",e.Style="data-style",e.DisableInput="data-disable-input",e.EnableParticipantsControl="data-enable-participants-control",e.InputPlaceholder="data-input-placeholder",e.ForceAuthentication="data-force-authentication",e.TitleColor="data-title-color",e.TitleBackground="data-title-background",e.PlatformFeature="data-platform-feature",e}();t.Attributes=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){this.Locale="",this.Theme="",this.Payload="",this.BingDLApi=!1,this.Title="",this.Avatar="",this.PrivacyUri="",this.TermsOfUseUri="",this.Prefill="",this.EnableCalling=null,this.CallingOnly=null,this.DisableSendingEmoticons=!1,this.TrafficProvider="",this.TrafficSource="",this.DisableInOutAnimation=!1,this.SkypeOnly=!1,this.Style="",this.DisableInput=!1,this.EnableParticipantsControl=!0,this.InputPlaceholder="",this.ForceAuthentication=!1,this.PlatformFeature="",this.TitleColor="",this.TitleBackground="",this.Partner="",t instanceof e&&Object.assign(this,t)}return e.prototype.MergeWith=function(e){if(e){var t=e;for(var n in t)t.hasOwnProperty(n)&&0!==n.indexOf("_")&&void 0!==t[n]&&null!==t[n]&&""!==t[n]&&(this[n]=t[n])}},e.prototype.MergeWithJSON=function(e){if(e)for(var t in e)void 0!==e[t]&&null!==e[t]&&""!==e[t]&&(this[t]=e[t])},e}();t.Definition=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.addMember="addMember",e.changeTopic="changeTopic",e.changePicture="changePicture",e.kickMember="kickMember",e.editMsg="editMsg",e.callP2P="callP2P",e.sendText="sendText",e.sendSms="sendSms",e.sendFileP2P="sendFileP2P",e.sendContacts="sendContacts",e.sendVideoMsg="sendVideoMsg",e.sendMediaMsg="sendMediaMsg",e.changeModerated="changeModerated"}(t.ParticipantCapabilities||(t.ParticipantCapabilities={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Admin="Admin",e.User="User"}(t.ParticipantRole||(t.ParticipantRole={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.HideChatWindow="bs:hChat",e.OpenChatWindow="bs:oChat",e.ShowChatWindow="bs:sChat",e.CollapseChatWindow="bs:chat:collapse",e.ExpandChatWindow="bs:chat:expand",e.LoadChatData="bs:sChat:run",e.StartActivation="bs:sChat:startActivation",e.StopActivation="bs:sChat:stopActivation",e.UpdateConversation="swc:chat:update",e.MessageSent="lwc:mSent",e.DockIframe="bs:calling:iframe:dock",e.IframeDocked="bs:calling:iframe:docked",e.UndockIframe="bs:calling:iframe:undock",e.IframeUndocked="bs:calling:iframe:undocked",e.IframeDragging="bs:calling:iframe:drag:dragging",e.IframeDragStart="bs:calling:iframe:drag:start",e.IframeDragStop="bs:calling:iframe:drag:stop",e.TriggerAPI="bs:api:trigger",e.OpenRecentsWindow="swc:recents:open"}(t.ActionNames||(t.ActionNames={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=1048576;t.checkFile=function(e,t){if(!t)return{supportedFileSize:!0,supportedFileExtension:!0,supportedFileType:!0};var n=isNaN(t.size)||e.size/r<=t.size,i=e.name.split("."),o=function(e,t){return!t||!t.length||e&&t.indexOf(e)>-1};return{supportedFileSize:n,supportedFileExtension:o(i.length>1&&"."+i.pop(),t.extensions),supportedFileType:o(e.type,t.types)}},t.isDocumentTypeImage=function(e){return-1!==e.indexOf("image")},t.createImageMessage=function(e,t){var n=i.Configuration.AMS_HOST_URL+"objects/"+t,r=i.Configuration.AMS_HOST_URL+"objects/"+t+"/views/imgt1",o="https://login.skype.com/login/sso?go=webclient.xmm&amp;pic="+t,s=e.name;return['<URIObject type="Picture.1" uri="'+n+'" url_thumbnail="'+r+'">','To view this shared photo, go to: <a href="'+o+'">'+o+"</a>",'<OriginalName v="'+s+'"/><meta type="photo" originalName="'+s+'"/>',"</URIObject>"].join("")},t.createFileMessage=function(e,t){var n=i.Configuration.AMS_HOST_URL+"objects/"+t,r=i.Configuration.AMS_HOST_URL+"objects/"+t+"/views/thumbnail",o="https://login.skype.com/login/sso?go=webclient.xmm&amp;docid="+t,s=e.name;return['<URIObject type="File.1" uri="'+n+'" url_thumbnail="'+r+'">',"<Title>Title: "+s+"</Title>","<Description> Description: "+s+"</Description>",'<a href="'+o+'">'+o+"</a>",'<OriginalName v="'+s+'"/>','<FileSize v="'+e.size+'"/>',"</URIObject>"].join("")},t.getNameAndExtension=function(e){var t=(e||"").split("."),n="",i="";return t.length>1?(i=t.pop().toLowerCase(),n=t.join(".")):(i="",n=t[0]),{name:n,extension:i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(59),r=n(9),o="returnDefaultImage=false",s="returnDefaultImage=true",a="?returnDefaultImage",c="?auth_key=",u=["rgb(153, 180, 51)","rgb(107, 165, 231)","rgb(231, 115, 189)","rgb(0, 163, 0)","rgb(30, 113, 69)","rgb(255, 0, 151)","rgb(126, 56, 120)","rgb(96, 60, 186)","rgb(29, 29, 29)","rgb(0, 171, 169)","rgb(45, 137, 239)","rgb(43, 87, 151)","rgb(218, 83, 44)","rgb(185, 29, 71)","rgb(238, 17, 17)"];t.loadAvatarUri=function(e,t,n){e&&(e.indexOf(c)<0&&(e=e.indexOf(a)<0?function(e){var t=e.split("?")[0],n=e.split("?")[1],i=function(e){return e.indexOf("/profile/avatar")>-1||e.indexOf("/public")>-1}(e);return n?(e=t+"?"+n,e+=i?"&"+o:""):e+=i?"?"+o:"",e}(e):e.replace(s,o)),i.default.preloadImage(e,t,n))},t.getBackgroundColor=function(e){for(var t=0,n=(e&&e.length||0)-1;n>=0;n--){var i=e.charCodeAt(n),r=n%8;t^=(i<<r)+(i>>8-r)}return u[t%u.length]},t.getInitials=function(e){var t="",n=(e=function(e){return r.MessageUtils.getMessageSanitizedContent(e).replace(/\s+/gi," ").trim()}(e)).split(" ");return n.length>1?(t+=n[0][0]?n[0][0]:"",t+=n[1][0]?n[1][0]:""):n.length&&(t+=n[0][0]?n[0][0]:"",t+=n[0][1]?n[0][1]:""),t.toUpperCase()}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(23),a=n(8),c=n(37),u=n(122),l=function(e){function t(n){var i=e.call(this,n)||this;return i.blockClassName="",i._onAvatarUpdate=function(e){i.setState({avatarUrl:e})},i._onTopicUpdate=function(e){i.setState({title:e})},i._onBlockedUpdate=function(e){i.setState({showBlock:e})},i._onPresenceUpdate=function(e){var n=t.getPrecenceType(e);i.setState({presenceStatus:n})},i.state={title:"",avatarUrl:"",showBlock:!1,presenceStatus:null},i}return r(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.person,n=e.isPstn,i=e.customAvatar,r=e.showPresence;this._onTopicUpdate(t.displayName||t.id),t.subscribe("displayName",this._onTopicUpdate),n||(i?this._onAvatarUpdate(i):(t.avatarData&&this._onAvatarUpdate(t.avatarData),t.subscribe("avatarData",this._onAvatarUpdate)),r&&(this._onPresenceUpdate(t.presenceStatus),t.subscribe("presenceStatus",this._onPresenceUpdate)),this._onBlockedUpdate(t.isBlocked),t.subscribe("isBlocked",this._onBlockedUpdate))},t.prototype.componentWillUnmount=function(){var e=this.props.person;e.unsubscribe("avatarData",this._onAvatarUpdate),e.unsubscribe("displayName",this._onTopicUpdate),e.unsubscribe("isBlocked",this._onBlockedUpdate),e.unsubscribe("presenceStatus",this._onPresenceUpdate)},t.prototype.render=function(){return this.props.isPstn?o.createElement(u.SwcPstnAvatar,{className:this.getComposedBlockClassName(),accessible:this.props.accessible,title:this.state.title,size:this.props.size}):o.createElement(c.SwcAvatar,{className:this.getComposedBlockClassName(),size:this.props.size,title:this.state.title,avatarUrl:this.state.avatarUrl,accessible:this.props.accessible,showBlock:this.state.showBlock,presenceStatus:this.state.presenceStatus})},t.getPrecenceType=function(e){var t;switch(e){case s.PresenceStatus.Online:t=c.PresenceStatusUI.Online;break;case s.PresenceStatus.Busy:case s.PresenceStatus.OnThePhone:t=c.PresenceStatusUI.Busy;break;case s.PresenceStatus.Away:case s.PresenceStatus.Idle:case s.PresenceStatus.OutToLunch:case s.PresenceStatus.BeRightBack:t=c.PresenceStatusUI.Away}return t},t}(a.SwcBaseComponent);t.SwcPersonAvatar=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.unknown=0]="unknown",e[e.card=1]="card",e[e.carousel=2]="carousel",e[e.signin=3]="signin",e[e.receipt=4]="receipt",e[e.multiline=5]="multiline",e[e.adaptive=6]="adaptive"}(t.SwiftCardType||(t.SwiftCardType={})),function(e){e[e.unknown=0]="unknown",e[e.hero=1]="hero",e[e.thumb=2]="thumb",e[e.receipt=3]="receipt",e[e.signin=4]="signin",e[e.video=5]="video",e[e.audio=6]="audio",e[e.animation=7]="animation",e[e.actionImage=8]="actionImage",e[e.flex=9]="flex",e[e.adaptive=10]="adaptive"}(t.SwiftCardContentType||(t.SwiftCardContentType={})),function(e){e[e.unknown=0]="unknown",e[e.unsupported=1]="unsupported",e[e.openUrl=2]="openUrl",e[e.imBack=3]="imBack",e[e.signin=4]="signin",e[e.call=5]="call",e[e.showImage=6]="showImage",e[e.payment=7]="payment",e[e.postBack=8]="postBack"}(t.SwiftCardActionType||(t.SwiftCardActionType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UserMessage="UserMessage",e.SwiftCard="SwiftCard",e.SystemMessage="SystemMessage",e.Unsupported="Unsupported",e.SkypeLogo="SkypeLogo",e.Welcome="Welcome",e.Translate="Translate",e.LwcImage="LwcImage",e.LwcFile="LwcFile",e.LwcCallRecording="LwcCallRecording",e.UnreadSplitter="UnreadSplitter"}(t.MessageType||(t.MessageType={})),function(e){e.CallEnd="CallEndMsg",e.MissedCall="MissedCallMsg",e.MissedGroupCall="MissedGroupCallMsg",e.Call="CallMsg",e.Custom="CustomMsg",e.MeLeftGroup="MeLeftGroupConversation"}(t.CustomMessageType||(t.CustomMessageType={})),function(e){e[e.Incoming=0]="Incoming",e[e.Outgoing=1]="Outgoing"}(t.Direction||(t.Direction={})),function(e){e[e.Pending=0]="Pending",e[e.Sent=1]="Sent",e[e.Failed=2]="Failed"}(t.DeliveryStatus||(t.DeliveryStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UNDEFINED="",e.PERSON="person",e.PHONE="phone",e.AGENT="agent",e.JOIN="join",e.GROUP="group"}(t.ConversationType||(t.ConversationType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getQueryParameters=function(){var e=window.location.search.substring(1);return this.extractQueryParameters(e)},e.extractQuery=function(e){var t="";return e.indexOf("?")>-1&&(t=e.split("?")[1]),t},e.getQueryParameter=function(e,t){var n=this.extractQuery(e);return n?this.extractQueryParameters(n)[t]:null},e.extractQueryParameters=function(e){var t=e.split("&"),n={};return t.forEach(function(e){var t=e.split("=");n[decodeURIComponent(t[0])]=decodeURIComponent(t[1])||""}),n},e.extractProtocol=function(e){var t=null;return e.indexOf("://")>-1&&(t=e.split("://")[0]),t},e.extractHostname=function(e){return(e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0].split("?")[0]},e.extractPath=function(e){var t="";e.indexOf("//")>-1&&(e=e.split("//")[1]);var n=e.indexOf("/");return n>-1&&(t=e.substring(n)),t=t.split("?")[0]},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);!function(e){e.StartVideoCall="videocall",e.StartAudioCall="audiocall",e.Feedback="feedback",e.GetHelp="gethelp",e.ThirdPartyNotices="thirdPartyNotices",e.PrivacyAndCookies="privacyAndCookies",e.TermsOfUse="termsOfUse",e.OpenComposer="openComposer",e.AddParticipant="addParticipant",e.Participants="participants",e.Fullscreen="fullscreen",e.MediaSettings="mediaSettings",e.SwitchToChat="switchToChat",e.MinimizeChat="minimizeChat",e.VideoOn="videoOn",e.VideoOff="videoOff",e.AudioOn="audioOn",e.AudioOff="audioOff",e.ScreenSharingOn="screenSharingOn",e.ScreenSharingOff="screenSharingOff",e.ToggleAudio="toggleAudio",e.StopCall="stopCall",e.ExpressionPicker="expressionPicker",e.FilePicker="filePicker",e.DeleteMessage="deleteMessage",e.DeleteConversation="deleteChat",e.LeaveConversation="leaveChat",e.BlockUser="block",e.UnblockUser="unblock",e.ReactionPicker="reactionPicker",e.MarkMessageUnread="markMessageUnread",e.MarkConversationUnread="markConversationUnread",e.MarkConversationsRead="markAllRead",e.SortByTime="sortByTime",e.SortByUnread="sortByUnread",e.SelectStandartView="setRecentsStandardView",e.SelectCompactView="setRecentsCompactView",e.HideFavorites="hideFavorites",e.ShowFavorites="showFavorites",e.AddToFavorites="addToFavorites",e.RemoveFromFavorites="removeFromFavorites",e.StartScreenShare="startScreenShare",e.OpenContacts="contacts",e.OpenRecents="recents",e.StopScreenShare="stopScreenShare",e.RecentsMore="moreRecentsActions",e.NotificationSettings="notificationSettings",e.BackFromNotificationSettings="backFromNotificationSettings",e.ReportProblem="reportProblem",e.CallBack="callBack"}(t.UserActionType||(t.UserActionType={})),t.sendUserActionEvent=function(e){var t={name:"kpi_action",properties:{type:{value:e}}};i.swc.Telemetry.getLogger().logEvent(t)}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(3),o=n(19),s=n(26),a=n(15),c=n(33),u=n(0),l=n(54),p=n(49);t.getPolling=function(){return u.swc.services.polling};var d=function(){t.getPolling().authorization.then(function(){f()?t.activationRequest().then(function(e){t.stopActivation(),e&&e.ok&&(i=setTimeout(d,12e3))},function(){t.stopActivation()}):t.stopActivation()})};function f(){return u.swc.services.signInManager.userIdentityType===s.IdentityType.SKYPE&&u.swc.services.signInManager.state===o.SigninState.SignedIn&&l.get().isOnline&&r.default.get.backend!==a.MessagingBackend.TEAMS}t.activationRequest=function(){var e=u.swc.services.sessionStorage.getItem(c.SKYPE_ENDPOINT_ID_KEY),t="users/ME/endpoints/"+e+"/active",n={body:JSON.stringify({timeout:15})};return!e&&f()?Promise.reject({}):p.post("active",t,n)},t.startActivation=function(){i||f()&&d()},t.stopActivation=function(){i&&(clearTimeout(i),i=null)},l.get().subscribe("isOnline",function(e){e||t.stopActivation()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o=n(3),s=n(23);!function(e){e.Mobile="Mobile",e.Desktop="Desktop",e.Web="Web"}(t.DeviceType||(t.DeviceType={})),function(e){e.Available="Available",e.AvailableIdle="AvailableIdle",e.Busy="Busy",e.BusyIdle="BusyIdle",e.DoNotDisturb="DoNotDisturb",e.BeRightBack="BeRightBack",e.Away="Away",e.Offline="Offline",e.PresenceUnknown="PresenceUnknown"}(i=t.Availability||(t.Availability={})),function(e){e.Available="Available",e.Inactive="Inactive",e.Busy="Busy",e.InMeeting="InAMeeting",e.InCall="InACall",e.InConferenceCall="InAConferenceCall",e.UrgentInterruptionOnly="UrgentInterruptionOnly",e.DoNotDisturb="DoNotDisturb",e.Presenting="Presenting",e.BeRightBack="BeRightBack",e.Away="Away",e.Offwork="Offwork",e.OutOfOffice="OutOfOffice",e.Offline="Offline",e.PresenceUnknown="PresenceUnknown"}(r=t.Activity||(t.Activity={}));var a={};a[i.Available]=[r.Available],a[i.Busy]=[r.Busy],a[i.DoNotDisturb]=[r.DoNotDisturb],a[i.BeRightBack]=[r.BeRightBack],a[i.Away]=[r.Away,r.Offline],t.allowedForcedAvailabilities=[i.Available,i.Busy,i.DoNotDisturb,i.BeRightBack,i.Away],t.isForcedAvailabilityAllowed=function(e){return 1===t.allowedForcedAvailabilities.filter(function(t){return t===e}).length},t.isActivityCombinationAllowed=function(e,t){return!(!a[t]||1!==a[e].filter(function(e){return e===t}).length)},t.getAvailabilityFromStatus=function(e){if(o.default.get.isTeams())switch(e){case s.PresenceStatus.Online:return i.Available;case s.PresenceStatus.Busy:return i.Busy;case s.PresenceStatus.BeRightBack:return i.BeRightBack;case s.PresenceStatus.Away:return i.Away;case s.PresenceStatus.DoNotDisturb:return i.DoNotDisturb;default:return}else switch(e){case s.PresenceStatus.Online:return i.Available;case s.PresenceStatus.Away:return i.Away;case s.PresenceStatus.Busy:return i.Busy;default:return}},t.getStatusFromAvailability=function(e){if(o.default.get.isTeams())switch(e){case i.Available:case i.AvailableIdle:return s.PresenceStatus.Online;case i.Away:return s.PresenceStatus.Away;case i.BeRightBack:return s.PresenceStatus.BeRightBack;case i.DoNotDisturb:return s.PresenceStatus.DoNotDisturb;case i.Busy:case i.BusyIdle:return s.PresenceStatus.Busy;default:return s.PresenceStatus.Offline}else switch(e){case i.Available:case i.AvailableIdle:return s.PresenceStatus.Online;case i.Away:return s.PresenceStatus.Away;case i.BeRightBack:return s.PresenceStatus.BeRightBack;case i.DoNotDisturb:return s.PresenceStatus.DoNotDisturb;case i.Busy:case i.BusyIdle:return s.PresenceStatus.Busy;default:return s.PresenceStatus.Offline}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(15),r=n(31),o=n(4),s=n(156),a=n(84),c=n(9),u=n(42);t.UNREAD_TYPES={Text:1,RichText:1,"RichText/UriObject":1,"RichText/Media_GenericFile":1,"Event/Call":1,"Signal/Flamingo":1,"RichText/Html":1};var l=function(){function e(){}return e.getType=function(e){return a.getConversationType(e)},e.getBackend=function(e,t){if(t!==i.MessagingBackend.UNDETERMINED)return t;switch(e.split(":")[0]){case"8":case"28":case"19":t=i.MessagingBackend.SKYPE;break;default:return i.MessagingBackend.UNDETERMINED}return t},e.replaceMapped=function(e,t,n){return n&&(t[n]=""),this.replaceMap(e,t)},e.replaceMap=function(e,t){return Object.keys(t).forEach(function(n){e=e.replace(n,t[n])}),e.trim().replace(/(^,|[ ],|,$)/,"").trim()},e.parseConversationTopic=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n=""),n&&t[n]&&delete t[n],!e&&t)return Object.keys(t).map(function(e){return t[e]}).sort().join(", ");if(e){e=this.replaceMapped(e,t,n);var i=u.default.normalizePersonId(n),r={};Object.keys(t).forEach(function(e){r[u.default.normalizePersonId(e)]=t[e]}),e=this.replaceMapped(e,r,i)}return c.MessageUtils.parseTopic(e)||""},e.isConversationReadOnServer=function(e,t){if(!e)return!1;var n=new s.ConsumptionHorizon;n.set(e);var i=t.skypeeditedid||t.clientmessageid||t.messageid||t.id||"0",r=n.lastReadMessageId===i||""===n.lastReadMessageId||n.lastReadMessageId===t.id,o=new Date(t.originalarrivaltime).getTime();t.skypeeditedid&&+t.skypeeditedid>0&&(o=new Date(+t.skypeeditedid).getTime());var a=n.lastReadMessageTimestamp>=o;return r||a},e.isUnread=function(n,i,s,a){if(!a)return!1;if(e.getType(i)===o.ConversationType.PHONE)return!1;if(!t.UNREAD_TYPES[a.messagetype])return!1;if(a.from){var u=r.normalizePersonId(c.MessageUtils.getSenderIdFromUrl(a.from));if(r.normalizePersonId(n)===u)return!1}return!!a.content&&(!s.consumptionhorizon&&"AcceptPendingRecipient"===s.conversationstatus||!e.isConversationReadOnServer(s.consumptionhorizon,a))},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4);t.getConversationType=function(e){if(0===e.indexOf("http"))return i.ConversationType.JOIN;switch(e.split(":")[0]){case"4":return i.ConversationType.PHONE;case"8":return i.ConversationType.PERSON;case"28":case"99":return i.ConversationType.AGENT;case"19":return i.ConversationType.GROUP;default:return i.ConversationType.UNDEFINED}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.transformRawToXml=function(e,t,n,i){var r=[];for(r.push(t);0!==r.length;){var o=r.pop();o.nodeType===Node.TEXT_NODE?this.encodeTextNodeToXml(e,o,n,i):this.isElementAllowed(o)&&this.pushChildNodes(r,o)}},e.prototype.wordMatcher=function(){return/[\w()#:\-=<>;'\|\$"\]\*\^&\+@\{\?\/\\!~]+/g},e.prototype.getAllWords=function(e){for(var t,n=this.wordMatcher(),i=new Array;null!==(t=n.exec(e));)i.push(t);return i},e.prototype.encodeTextNodeToXml=function(e,t,n,i){var r=t.parentNode,o=this.encodeWords(e,t,n,i);o&&o.length&&(o.forEach(function(e){r.insertBefore(e,t)}),r.removeChild(t))},e.prototype.encodeWords=function(e,t,n,i){var r=this,o=t.nodeValue,s=this.getAllWords(o),a=0,c=[];return s.forEach(function(t){var s=r.wordRawToXml(e,t[0],n,i);0!==s.length&&(a!==t.index&&c.push(e.createTextNode(o.substring(a,t.index))),a=t.index+t[0].length,c=c.concat(s))}),0!==a&&a<o.length&&c.push(e.createTextNode(o.substring(a))),c},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e}();t.WordDomTransformer=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(12),a=n(0),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isFocused=!0,t.restart=function(){t.dispose(),t._initManagers&&t._initManagers(),t._signInManager.getSkypeToken().then(null,function(){}),a.swc.services.mePersonManager.fetch(),t.restoreLastConversation()},t}return r(t,e),Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.initServices=function(e){t._initParams=e;var n=t._initParams;return a.swc.Eventing.registerEvent("callStatusChanged",function(e){if(e)switch(e.status){case 2:case 3:case 4:case 9:t._isInCall=!0;break;default:t._isInCall=!1}}),a.swc.services.initManagers(e&&e.locale||o.default.get.getCurrentLocale(),{tokenProvider:n.skypeTokenProvider||n.tokenProvider,initialToken:n.initialSkypeTokenData,externalLogin:n.externalLogin,tokenType:n.tokenType,enterpriseAuth:n.enterpriseAuth},{fileSharing:n.fileSharing,userSettings:n.userSettings}).then(function(){t.instance.SignInManager,a.swc.services.persons})},t.prototype.dispose=function(){var e;(e=this._mePersonManager)&&(e.dispose(),e=null),this._amsManager&&this._amsManager.dispose(),this._persons&&this._persons.dispose(),this._isCleared=!1},Object.defineProperty(t.prototype,"SignInManager",{get:function(){return this._signInManager||(this._signInManager=a.swc.services.signInManager,this._signInManager&&this._signInManager.subscribe("resurrect",this.restart)),this._signInManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCleared",{get:function(){return this._isCleared},set:function(e){e!==this._isCleared&&(this._isCleared=e,this.publish("isCleared",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFocused",{get:function(){return this._isFocused},set:function(e){e!==this._isFocused&&(this._isFocused=e,this.publish("isFocused",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isInCall",{get:function(){return t._isInCall},enumerable:!0,configurable:!0}),t.prototype.setRestoreOfLastConversation=function(e){this._lastConversationCallback=e},t.prototype.restoreLastConversation=function(){this._lastConversationCallback&&this._lastConversationCallback()},t.prototype.setManagersInit=function(e){this._initManagers||(this._initManagers=e)},t._isInCall=!1,t}(s.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0),o=n(13),s=n(126),a=function(){function e(e){this.id=o.guid.generate(),this.title="",this.description="",this.sender="",this.avatarUrl="",this.actions=[],this.type=e,this.sound=this._getSoundFile(e)}return e.prototype._getSoundFile=function(e){var t=null;switch(e){case"UnreadMessage":t=s.SupportedSounds.Notification,this.loopSound=!1;break;case"Calling":t=s.SupportedSounds.Ringing,this.loopSound=!0}return t},e.prototype.getAvatar=function(e,t){var n=i.Configuration.DEFAULT_AVATAR_URI;return t&&t.avatarData?n=t.avatarData:e.avatar&&(n=(n=e.avatar).replace("returnDefaultImage=false","returnDefaultImage=true")),n},e.prototype.hide=function(){r.swc.Eventing.triggerEvent("hideNotification",this.id)},e}();t.Notification=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(7),o={version:"1.0.0.0",urls:["https://config.edge.skype.com"]};t.configLoader=function(e,t,n){return new Promise(function(n,c){var u=function(){var e=i.Configuration.ECS?i.Configuration.ECS.version:o.version;/\d\.\d\.\d/.test(e)||(e=o.version);for(var t=e.split(".",4),n=i.Configuration.getPlatformId();t.length<4;)t.unshift("0");var r=t.join(".");return n?n+"_"+r:r}(),l=a(e,u,t),p=0,d=function(){if(p<l.length){var t=l[p++];s(e,t).then(function(e){return e?n(e):d()}).catch(function(e){var n="Error: "+e+" URL: "+t;r.default.throwError(12001,n),d()})}else{var i="Unable to fetch config from ECS, name: "+e+", urls: "+l;r.default.throwError(12001,i),c(i)}};d()})};var s=function(e,t){return new Promise(function(n,i){var o=encodeURIComponent("jsonSwcEcsFetch"+e+Date.now()),s=document.querySelector("body"),a=document.createElement("script"),c=-1===t.indexOf("?")?"?":"&",u=""+t+c+"callback="+o;a.src=u;var l=function(){delete window[o],s.removeChild(a)};window[o]=function(e){clearTimeout(p),l(),n(e)};var p=setTimeout(function(){l();var e="[configLoader.fetchJson] ECS timed out after 10000 ms, url: "+u;r.default.throwError(12003,"[configLoader.fetchJson] ECS returned values:"+e),i("ECS timed out "+e)},1e4);s.appendChild(a)})},a=function(e,t,n){var i,r,s=[],a=(r=[],i=(i=n)||{},Object.keys(i).forEach(function(e){r.push(encodeURIComponent(e)+"="+encodeURIComponent(i[e]))}),r.join("&"));return o.urls.forEach(function(n){s.push(n+"/config/v1/"+e+"/"+t+(a?"?"+a:""))}),s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.objectProperties=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t&&t(n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hashCode=function(e){var t=0,n=e.length,i=0;if(n>0)for(;i<n;)t=(t<<5)-t+e.charCodeAt(i++)|0;return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(123));var i=n(81);t.startEndpointActivation=i.startActivation,t.stopEndpointActivation=i.stopActivation,t.getPolling=i.getPolling},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this)||this}return r(t,e),t.create=function(){var e=Object.create(t.prototype);return e.callbacks=[],e},t.prototype.pushObservable=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.push.apply(this,t);var i=new s(t);return this.publish(i),this.length},t.prototype.popObservable=function(){var t=e.prototype.pop.call(this);return this.publish(),t},t.prototype.shiftObservable=function(){var t=e.prototype.shift.call(this);return this.publish(),t},t.prototype.unshiftObservable=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.unshift.apply(this,t);var i=new s(t);return this.publish(i),this.length},t.prototype.sortObservable=function(t){var n=e.prototype.sort.call(this,t);return this.publish(),n},t.prototype.spliceObservable=function(t,n){for(var i,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];i=n?r?e.prototype.splice.apply(this,[t,n].concat(r)):e.prototype.splice.call(this,t,n):e.prototype.splice.call(this,t);var a=new s([],i);return this.publish(a),i},t.prototype.subscribe=function(e){this.callbacks.push(e)},t.prototype.unsubscribe=function(e){var t=this.callbacks.indexOf(e);t>-1&&this.callbacks.splice(t,1)},t.prototype.dispose=function(){var e=this;this.callbacks.forEach(function(t,n){e.callbacks[n]=null}),this.callbacks=[]},t.prototype.publish=function(e){var t=this;e||(e=new s),this.callbacks.forEach(function(n){n(t,e)})},t}(Array);t.ObservableCollection=o;var s=function(){return function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.newItems=e,this.oldItems=t}}()},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.request="bridge:request:theme",e.response="bridge:request:return"}(t.ApiEventsBridgeTheme||(t.ApiEventsBridgeTheme={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(38),r=n(4),o=n(7),s=function(){function e(){}return e.strip=function(e){var t=e.match(this.idRegExp);return t?t[2]:e},e.detectConversationType=function(e){if(!e)return r.ConversationType.UNDEFINED;if(this.typeMapppings[e])return this.typeMapppings[e];var t,n=e.match(this.idRegExp);if(n&&(t=this.getTypeByPrefix(n[1])),t)return this.typeMapppings[e]=t,t;if(0===e.indexOf("https://join.skype.com/"))return this.typeMapppings[e]=r.ConversationType.JOIN,r.ConversationType.JOIN;if(/^(28:)?[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i.test(e))return this.typeMapppings[e]=r.ConversationType.AGENT,r.ConversationType.AGENT;if(/^(19:)?[\S]+[@]([\S].)?[\S]*thread\.skype/i.test(e))return this.typeMapppings[e]=r.ConversationType.GROUP,r.ConversationType.GROUP;return/(?:00|\+)?(^[^a-z][^A-Z])(\d+$)/i.test(e.replace(/\s+|[()\-\+]/gi,""))?(this.typeMapppings[e]=r.ConversationType.PHONE,r.ConversationType.PHONE):(this.typeMapppings[e]=r.ConversationType.PERSON,r.ConversationType.PERSON)},e.getSdkModeFromId=function(e){switch(this.detectConversationType(e)){case r.ConversationType.PERSON:return i.SDKMode.PERSON;case r.ConversationType.AGENT:return i.SDKMode.BOT;case r.ConversationType.JOIN:return i.SDKMode.JOIN_URL;case r.ConversationType.PHONE:return i.SDKMode.PHONE;case r.ConversationType.GROUP:return i.SDKMode.THREAD}return i.SDKMode.UNDEFINED},e.toFullIdentifier=function(e){var t=this.getPrefixForId(e);return 0===e.indexOf(t+":")?e:t?t+":"+e:e},e.addPrefix=function(e,t){return 0===t.indexOf(e+this.SPLITTER)?t:0===t.indexOf(this.SPLITTER)?e+t:e+this.SPLITTER+t},e.getNormalizeId=function(e){return e.match(this.idRegExp)?e.replace(/\d{1,2}:/,""):e},e.isEqual=function(e,t){return this.toFullIdentifier(e).toLowerCase()===this.toFullIdentifier(t).toLowerCase()},e.getPrefixForId=function(e){if(this.hasAlreadyPrefix(e))return"";var t=this.getSdkModeFromId(e);switch(t){case i.SDKMode.PERSON:return"8";case i.SDKMode.BOT:return"28";case i.SDKMode.THREAD:return"19";case i.SDKMode.PHONE:return"4";default:o.default.throwError(10502,"Unable to define conversation prefix",{id:e,sdkMode:t})}return""},e.getTypeByPrefix=function(e){if(!e)return r.ConversationType.UNDEFINED;switch(e.indexOf(":")>-1&&(e=e.replace(":","")),e){case"4":return r.ConversationType.PHONE;case"8":return r.ConversationType.PERSON;case"19":return r.ConversationType.GROUP;case"28":return r.ConversationType.AGENT;default:return r.ConversationType.UNDEFINED}},e.hasAlreadyPrefix=function(e){var t=/^\d+:/.exec(e);return!!t&&!!t[0]},e.SPLITTER=":",e.idRegExp=/(\d{1,2}:)([\S]*)/,e.typeMapppings={},e}();t.default=s},function(e,t,n){"use strict";var i,r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Outlook="OUTLOOK",e.Scom="SCOM",e.Office="OFFICE"}(i=t.NotificationSupportedHost||(t.NotificationSupportedHost={})),function(e){e.All="ALL",e.Notification="NOTIFICATION",e.Off="OFF"}(r=t.NotificationAllowedValue||(t.NotificationAllowedValue={})),function(e){e.swc="swc",e.api="api"}(t.NotificationSettingSource||(t.NotificationSettingSource={})),function(e){e.IncomingCall="swc.notification.incoming-call",e.NewMessage="swc.notification.new-message"}(t.NotificationSettingType||(t.NotificationSettingType={})),t.NOTIFICATION_DEFAULT=[{host:i.Outlook,value:r.All},{host:i.Scom,value:r.All},{host:i.Office,value:r.All}]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(125),r=n(15),o=n(0),s=n(294),a=n(3),c=n(295),u=n(296),l=n(297),p=n(160),d=n(299),f=n(300),h={LARGE:"large",EXTRA_LARGE:"extraLarge"},g=3,m=function(e){var t;return(o.swc.services.pesManager.config?o.swc.services.pesManager.config.items:[]).forEach(function(n){t||n.id!==e||(t=n)}),t},v=function(){return function(e,t){var n=this;this.outgoingDomTransformers=[],this.incomingDomTransformers=[],this.encode=function(e,t,r){var o=new DOMParser,s=i(e),a=c.default.addFormatting(s),u=o.parseFromString(a,"text/html");if(0!==u.getElementsByTagName("parsererror").length)return s;try{return n.outgoingDomTransformers.forEach(function(e){try{e.transformRawToXml(u,u.body,t,r)}catch(e){}}),n.convertHtmlDomToXmlString(u)}catch(e){return s}},this.decode=function(e){var t,i,c,u=n;a.default.get.backend===r.MessagingBackend.TEAMS&&(e=s.TeamsMessageUtil.prepare(e));try{var l=n._private.parseXML(n._private.encapsulateInRootElement(e));if(l)return i=l.documentElement,o.swc.services.pesManager.canRenderConfigItems()&&function(e){var n=a.default.get.largeEmoticonClass?h.EXTRA_LARGE:h.LARGE,r=i.getElementsByTagName("ss"),o=[],s=r.length<=g&&r.length>0;if(s){var c=i.childNodes;for(a.default.get.isTeams()&&1===c.length&&"message"===c[0].tagName&&(c=c[0].childNodes),t=0;t<c.length;++t){var l=0===c[t].textContent.replace(" ","").replace(/<br\s*\/?>/g,"").replace(/\n/g,"").length;s=s&&("ss"===c[t].tagName||l)}}var p,d,f=r.length>20;for(t=0;t<r.length;++t){var m=u.emoticonEncoder.createHtmlElement(e,r[t].getAttribute("type"),r[t].textContent,s,f,n);m&&o.push([m,r[t]])}for(t=0;t<o.length;++t)p=o[t][0],(d=o[t][1]).parentNode&&d.parentNode.replaceChild(p,d)}(l),(c=i.getElementsByTagName("e_m"))&&0!==c.length&&c[0].parentNode.removeChild(c[0]),n.incomingDomTransformers.forEach(function(e){try{e.transformRawToXml(l,i)}catch(e){}}),u.emoticonEncoder.fixInvalidHtml(n._private.decapsulateFromRootElement(n._private.xmlToString(l)))}catch(e){}return e},this.convertHtmlDomToXmlString=function(e){for(var t=e.implementation.createDocument(e.body.namespaceURI,"message",null);0!==e.body.childNodes.length;)t.childNodes[0].appendChild(e.body.childNodes[0]);var i=t.childNodes[0].outerHTML;return a.default.get.backend===r.MessagingBackend.TEAMS&&(i=n._translateToTeamsEmoticons(i,e,t)),i.replace(/(?:^<message.*?>|<\/message>$)/g,"")},this._translateToTeamsEmoticons=function(e,t,n){var i=e.match(/<ss[^>]+>[^<]+<\/ss>/g);if(i){var r=i.length===n.firstChild.childNodes.length&&i.length<=g&&i.length>0,s=o.swc.services.pesManager.map;for(var a in i){var c=i[a],u=c.match(/<ss type="([^"]+)">([^<]+)<\/ss>/),l=u[1],p=s[u[2]];p.match(/^\(.*\)$/)||(p="("+p+")");var d=m(l),f=t.implementation.createDocument(t.body.namespaceURI,"emoticon",null),h=f.createElement("span"),v=r?50:20;h.setAttribute("class","animated-emoticon-"+v+"-"+l),h.setAttribute("title",l),h.setAttribute("type",p);var y=f.createElement("img");y.setAttribute("alt",d.description),y.setAttribute("itemid",l),y.setAttribute("itemscope",""),y.setAttribute("itemtype","http://schema.skype.com/Emoji"),y.setAttribute("src","https://statics.teams.microsoft.com/evergreen-assets/funstuff/skype-emoticons-f/"+l+"/default_"+v+".png"),y.setAttribute("style","width:"+v+"px;height:"+v+"px;"),h.appendChild(y),f.childNodes[0].appendChild(h);var _=f.childNodes[0].outerHTML.replace(/(?:^<emoticon.*?>|<\/emoticon>$)/g,"");e="<div><div>"+(e=e.replace(c,_))+"</div></div>"}}return e},this._private={separators:{"   ":!0,"\n":!0,"\r":!0," ":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0},createFlagElement:function(e,t,n){var i=e.createElement("span");return i.textContent=n,i.setAttribute("class","flag "+t),i.textContent="(flag:"+t+")",i},encapsulateInRootElement:function(e){for(var t;t!==e;)t=e,e=e.replace(/<\s*?root[\s\S]*?>.*?(<\s*?\/\s*?root\s*?>)?/gi,"");return"<root>"+e+"</root>"},decapsulateFromRootElement:function(e){return e.match(/<root ?\/>/)?"":e.length==="</root>".length?"":e.substring("<root>".length,e.length-"</root>".length)},parseXML:function(e){var t;try{if(o.swcWindow.DOMParser){var n=new DOMParser;n.async=!1,t=n.parseFromString(e,"text/xml")}else{var i=new ActiveXObject("Microsoft.XMLDOM");if(i.async=!1,i.loadXML(e))return i}}catch(e){return null}var r=t.parseError;return r&&0!==r.errorCode?null:t.getElementsByTagName("parsererror").length>0?null:t},xmlToString:function(e){var t;try{t=(new XMLSerializer).serializeToString(e)}catch(n){t=e.xml}return t},xmlEscapeMap:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},escapeXml:function(e){var t=this.xmlEscapeMap;return e.replace(/[<>&"']/g,function(e){return t[e]})},unescapeXml:function(e){var t={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};return e.replace(/&lt;|&gt;|&amp;|&quot;|&apos/g,function(e){return t[e]})}},this.emoticonEncoder=new u.default,e?e.forEach(function(e){n.incomingDomTransformers.push(e)}):this.incomingDomTransformers=[new d.NewLineDomTransformer,new l.MentionDomDecoder],t?t.forEach(function(e){n.outgoingDomTransformers.push(e)}):this.outgoingDomTransformers=[new f.URLDomTransformer,new d.NewLineDomTransformer,new p.MentionDomEncoder,this.emoticonEncoder]}}();t.Encoder=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(0),o=function(){function e(){}return Object.defineProperty(e,"Marked",{get:function(){return r.swc.vendors.marked},enumerable:!0,configurable:!0}),Object.defineProperty(e,"renderer",{get:function(){return this._renderer||(this._renderer=new e.Marked.Renderer),this._renderer},enumerable:!0,configurable:!0}),e.parse=function(t,n){return e.Marked.setOptions({renderer:this.renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1}),i.default.get.isTeams()&&(t=t.replace(/<br\/><br\/>/g,"<br/>").replace(/<br\s*\/?>\r\n/g,"  \n")),t=t.replace(/<br\s*\/?><br\s*\/?>/g,"\n\n").replace(/<br\s*\/?>/g,"  \n").replace(/<\/p>\n<p>/g,"\n\n"),t=(t=e.Marked(t).trim()).replace(/(^<p>)|(<\/p>$)/g,"").replace(/<\/p>\n<p>/g,"<br><br />")},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.BUTTON_SEND_CLICK=1]="BUTTON_SEND_CLICK",e[e.KEYPRESS_ENTER=2]="KEYPRESS_ENTER",e[e.WELCOME_MESSAGE=3]="WELCOME_MESSAGE",e[e.TYPING=4]="TYPING",e[e.SUGGESTED_ACTION=5]="SUGGESTED_ACTION",e[e.BUTTON_SWIFT_CLICKED=6]="BUTTON_SWIFT_CLICKED",e[e.INVITE=7]="INVITE",e[e.ADDON=8]="ADDON"}(t.ActionTrigger||(t.ActionTrigger={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(98),r=n(99),o=n(9),s=function(){function e(){}return Object.defineProperty(e,"encoder",{get:function(){return e._encoder||(e._encoder=new i.Encoder),this._encoder},enumerable:!0,configurable:!0}),e.INVALID_VALUE="invalidValue",e.filterOutNotValidItems=function(t,n){for(var i=e.mapArray(t,n),r=[],o=0;o<i.length;o++){var s=i[o];s.isValid&&!s.isValid()||r.push(s)}return r},e.filterOutDisabledItems=function(t,n){for(var i=e.mapArray(t,n),r=[],o=0;o<i.length;o++){var s=i[o];s.isDisabled&&s.isDisabled()||r.push(s)}return r},e.getItemIfNotDisabled=function(e){return e.isDisabled&&e.isDisabled()?null:e},e.mapArray=function(e,t){var n=[];if(!e)return n;for(var i=0;i<e.length;i++){var r=e[i];r&&n.push(t(r))}return n},e.normalizeText=function(e){return e?o.MessageUtils.getMessageSanitizedContent(e):null},e.normalizeUrl=function(e){return o.MessageUtils.normalizeUrl(e)},e.normalizeDestination=function(t){return/^(skype|tel):/i.test(t)?o.MessageUtils.getMessageSanitizedContent(t):e.INVALID_VALUE},e.normalizeRichText=function(t){if(!t)return"";t=e.encoder.decode(e.encoder.encode(t)),t=o.MessageUtils.unescapeBrackets(t);var n=r.default.parse(t);return o.MessageUtils.getMessageSanitizedContent(n)},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(e){try{var t=i.swc.services.mePerson.mri;return i.swc.services.webApi.createThread([{id:t,role:"Admin"},{id:e,role:"Admin"}]).then(function(e){return e.headers.get("location").match(/threads\/(19:.*)$/)[1]})}catch(e){}return Promise.resolve(void 0)};t.generateOneToOneConversationId=function(e){try{if(t.isEnterpriseObjectId(e))return function(e){try{var t=i.swc.services.contactsService;if(t.getContactByObjectId)return t.getContactByObjectId(e).then(function(e){return r(e.mri)})}catch(e){}return Promise.resolve(void 0)}(t.getGuidFromEnterpriseObjectId(e));if(t.isEnterpriseUserMri(e))return r(e)}catch(e){}return Promise.resolve(void 0)},t.isEnterpriseUserMri=function(e){return/^8:orgid:[^@]+$/.test(e)},t.isEnterpriseObjectId=function(e){return/^objectId:[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/.test(e)},t.getGuidFromEnterpriseObjectId=function(e){return e.replace("objectId:","")}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(3),a=n(0),c=function(e){function t(t){var n=e.call(this,t)||this;return n.refreshState=function(e){n.setState({lang:e})},n.state={lang:""},n}return r(t,e),t.prototype.getChildContext=function(){return{locale:this.state.lang}},t.prototype.componentDidMount=function(){this.setState({lang:s.default.get.getCurrentLocale()}),a.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",this.refreshState)},t.prototype.componentWillUnmount=function(){a.swc.Eventing.unregisterEvent("proxy:configuration:setLanguage:response",this.refreshState)},t.prototype.render=function(){return this.props.children},t}(o.Component);t.I18nContextComponent=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(129),c=n(20),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._snapshots={},t}return r(t,e),t.prototype.render=function(){return s.createElement(o.Fragment,null,this.props.children)},t.prototype.getChildContext=function(){return{modality:this}},t.prototype.componentDidMount=function(){this._findDOMNode(),this._addLayer()},t.prototype.componentDidUpdate=function(){var e=this._node;this._findDOMNode(),e!==this._node&&(e?c.AbilityHelpers.modalityLayer.moveLayer(e,this._node):this._addLayer())},t.prototype.componentWillUnmount=function(){this._focusTimer&&(window.clearTimeout(this._focusTimer),this._focusTimer=void 0),this._node&&(c.AbilityHelpers.modalityLayer.removeLayer(this._node),this._node=void 0)},t.prototype.addSnapshot=function(e){e>0&&(this._snapshots[e]?this._snapshots[e]++:this._snapshots[e]=1),this._setSnapshot()},t.prototype.removeSnapshot=function(e){e>0&&this._snapshots[e]&&(this._snapshots[e]--,this._snapshots[e]||delete this._snapshots[e]),this._setSnapshot()},t.prototype._addLayer=function(){var e=this;this._focusTimer&&(window.clearTimeout(this._focusTimer),this._focusTimer=void 0),c.AbilityHelpers.modalityLayer.addLayer(this._node,this.props.id,{accessibilityLabel:this.props.accessibilityLabel,othersAccessible:this.props.othersAccessible,alwaysAccessible:this.props.alwaysAccessible}),this._setSnapshot(),this._focusTimer=window.setTimeout(function(){if(e._focusTimer=void 0,e._node){var t=c.AbilityHelpers.focusDeloser.getActions(e._node);c.AbilityHelpers.keyboardNavigation.isNavigatingWithKeyboard()?t.focusFirst():t.focusDefault()||t.resetFocus()}},0)},t.prototype._setSnapshot=function(){if(this._node){var e=0;Object.keys(this._snapshots).forEach(function(t){e=Math.max(+t,e)});var t=c.AbilityHelpers.focusDeloser.getActions(this._node);t&&t.setSnapshot(e)}},t.prototype._findDOMNode=function(){if(this._node=a.findDOMNode(this),!this._node)throw new Error("Failed to find the node for modality layer.");this._node.hasAttribute("role")||this._node.setAttribute("role","region")},t}(o.Component);t.Modality=u;var l=function(e){function t(t,n){var i=e.call(this,t,n)||this;if(!i.context.modality)throw new Error("No modality layer container found.");return i}return r(t,e),t.prototype.render=function(){return s.createElement(o.Fragment,null,this.props.children)},t.prototype.componentDidMount=function(){this.context.modality.addSnapshot(this.props.index)},t.prototype.componentWillUnmount=function(){this.context.modality.removeSnapshot(this.props.index)},t}(o.Component);t.ModalitySnapshot=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r="px",o=25,s="swc-scroll-hide",a=200;function c(){return"rtl"===document.dir}var u=function(){function e(e,t){var n=this;this.container=e,this.viewport=t,this.recount=function(){n.vh=n.viewport.offsetHeight,n.sh=n.viewport.scrollHeight,n.vw=n.container.offsetWidth;var e=n.viewport.getBoundingClientRect();n.vpOffsetX=e.left,n.vpOffsetY=e.top,n.vh2sh=n.vh/n.sh,n.sh2vh=n.sh/n.vh;var t=Math.round(n.vh*n.vh2sh),i=n.slider.style;if(t<o){var s=n.vh-o+t;n.vh2sh=s/n.sh,i.height=o+r,n.sliderH=o}else i.height=t+r,n.sliderH=t;n.show(),n.updateSlider()},this.update=function(){n.ticking=!1,n.updateSlider()},this.show=function(){n.sh<=n.vh||!n.active?n.hide():n.visible||(n.rail.style.display="",n.visible=!0)},this.hide=function(){n.visible&&(n.rail.style.display="none",n.viewport.classList.remove("active"),n.visible=!1)},this.updateSlider=function(){var e=n.viewport.scrollTop*n.vh2sh;n.currentTop!==e&&(n.currentTop=e,n.slider.style.top=n.currentTop+r)},this.requestTick=function(e){n.ticking||(n.ownerWindow&&n.ownerWindow.requestAnimationFrame(n.update),n.update()),n.ticking=!0,n.update()},this.bindEvents=function(){n.viewport.addEventListener("scroll",n.requestTick,!1),n.container.addEventListener("mousedown",n.onMouseDown),n.container.addEventListener("mousemove",n.onMouseMove),n.container.addEventListener("mouseenter",n.onMouseEnter),n.container.addEventListener("mouseleave",n.onMouseLeave)},this.onMouseMove=function(e){n.dragging?n.viewport.scrollTop=(e.clientY-n.vpOffsetY)*n.sh2vh:(c()?e.clientX-n.vpOffsetX<=10:e.clientX-n.vpOffsetX>n.vw-10)?(n.rail.classList.add("active"),n.hover=!0):n.hover&&(n.rail.classList.remove("active"),n.hover=!1)},this.onMouseEnter=function(){n.active=!0,n.recount()},this.onMouseLeave=function(){n.active=!1,n.dragging||n.hide()},this.onMouseDown=function(e){var t=e.clientX-n.vpOffsetX,i=e.clientY-n.vpOffsetY;if(c()?t<10:t>=n.vw-10){var r=parseInt(n.slider.style.top,10);i>r&&i<r+n.sliderH?n.startDrag(e):n.viewport.scrollTop=i*n.sh2vh,e.preventDefault(),e.stopPropagation()}},this.handleDrag=function(e){n.viewport.scrollTop=(e.clientY-n.dragOffset)*n.sh2vh},this.startDrag=function(e){n.dragging||(n.viewport.classList.add("scrolling"),n.dragOffset=e.pageY-n.slider.offsetTop,n.dragging=!0,n.container.removeEventListener("mousemove",n.onMouseMove),n.container.ownerDocument.addEventListener("mouseup",n.stopDrag),n.container.ownerDocument.addEventListener("mousemove",n.handleDrag)),e.preventDefault()},this.stopDrag=function(){n.container.ownerDocument.removeEventListener("mousemove",n.handleDrag),n.container.ownerDocument.removeEventListener("mouseup",n.stopDrag),n.container.addEventListener("mousemove",n.onMouseMove),n.viewport.classList.remove("scrolling"),n.dragging=!1},this.container.classList.add("swc-scroll-wrapper"),this.viewport.classList.add("swc-scroll-viewport"),this.build(),this.init(),function(e){if(i)return i;var t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",t.style.left="-9999px",t.className="swc-scroll-viewport",t.innerHTML="<style>.swc-scroll-viewport{-ms-overflow-style:none;}.swc-scroll-viewport::-webkit-scrollbar{width:0;}</style>";var n=e.ownerDocument||document;return n.body.appendChild(t),i=new Promise(function(e){var i=function(){var r=t.offsetWidth;if(r){var o=r-t.clientWidth;e(o),n.body.removeChild(t)}else setTimeout(i,a)};i()})}(e).then(function(e){e&&n.viewport.classList.add(s)})}return Object.defineProperty(e.prototype,"ownerWindow",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.bindEvents()},e.prototype.build=function(){this.slider=document.createElement("div"),this.slider.className="swc-scroll-slider",this.rail=document.createElement("div"),this.rail.className="swc-scroll-rail",this.rail.appendChild(this.slider),this.rail.style.display="none",this.container.appendChild(this.rail)},e}();t.default=u},,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),s=n(0),a=function(e){function t(){var t=e.call(this)||this;return s.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",function(e){t.locale=e}),t}return r(t,e),Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t)},enumerable:!0,configurable:!0}),t.prototype.getLocale=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=null),t?(this.locale=t,this._locale):e?(this.locale=e,this._locale):this._locale?this._locale:s.swc.SDK&&s.swc.SDK.locale?(this.locale=s.swc.SDK.locale,this._locale):document.documentElement.lang?document.documentElement.lang.toLowerCase():window.navigator.languages&&0!==window.navigator.languages.length?window.navigator.languages[0].toLowerCase():navigator.language.toLowerCase()},Object.defineProperty(t.prototype,"locale",{set:function(e){e&&this._locale!==e.toLowerCase()&&(this._locale=e.toLowerCase(),this.publish("locale",this._locale))},enumerable:!0,configurable:!0}),t}(o.default);t.LocaleInfo=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(195),s={retryCount:3,timeout:12e4,policy:""};t.request=function(e,t,n){var o=0===t.indexOf("http")?t:i.Configuration.AMS_HOST_URL+t;return r.default("ams-"+e,s,o,n)},t.putData=function(e,n,i){return o.getHeaders().then(function(r){var o={method:"PUT"};return o.body=i,o.headers=r,t.request(e,n,o)})},t.getData=function(e,n){return o.getHeaders().then(function(i){i.append("Accept","image/webp,image/*,*/*;q=0.8"),i.append("Accept-Encoding","gzip, deflate, sdch, br");var r={method:"GET"};return r.headers=i,t.request(e,n,r).then(function(e){return e.blob()})})},t.getJson=function(e,n){return o.getHeaders().then(function(i){i.append("Accept","image/webp,image/*,*/*;q=0.8"),i.append("Accept-Encoding","gzip, deflate, sdch, br");var r={method:"GET"};return r.headers=i,t.request(e,n,r).then(function(e){return e.json()})})},t.post=function(e,n,i){return o.getHeaders().then(function(r){r.append("Content-Type","application/json");var o={method:"POST"};return o.body=i,o.headers=r,t.request(e,n,o)})},t.postForm=function(e,n,i){return o.getHeaders().then(function(r){r.append("Content-Type","application/x-www-form-urlencoded");var o={method:"POST"};return o.headers=r,o.credentials="include",i&&(o.body=i),t.request(e,n,o)})},t.get=function(e,n){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var r={method:"GET"};return r.headers=i,t.request(e,n,r)})},t.parseJson=function(e){return e.json().then(function(t){return e.ok?Promise.resolve(t):Promise.reject(t)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.multilineRegExp=function(e,t){return new RegExp(e.join(""),t)},e.escapeSpecialChars=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},e}();t.default=i},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o={isEnabled:!0,pollingInterval:240};t.getConfig=function(){return i({},o,r.Configuration.ECS.presence)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.callback=e,this.timeout=t}return e.prototype.start=function(){this.reset(),this.retryTimeout=setTimeout(this.callback,this.timeout)},e.prototype.reset=function(){this.retryTimeout&&clearTimeout(this.retryTimeout)},e}();t.FixedTimeout=i,t.build=function(e,t){return new i(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maxLength=16,t.minLength=2,t.firstLetters="8:(B;|I]>+xX<*\\",t.firstLettersMap={8:"8",":":":","(":"(",B:"B",";":";","|":"|",I:"I","]":"]",">":">","+":"+",x:"x",X:"X","<":"<","*":"*","\\":"\\"},t.clearShortcutMap=function(){t.shortcutIdMap={}},t.idEmoticonMap={},t.shortcutIdMap={":)":"smile",":-)":"smile",":=)":"smile","(smile)":"smile",":(":"sad",":-(":"sad",":=(":"sad","(sad)":"sad",":<":"sad",":-<":"sad",":D":"laugh",":-D":"laugh",":=D":"laugh",":d":"laugh",":-d":"laugh",":=d":"laugh","(laugh)":"laugh",":>":"laugh",":->":"laugh","(lol)":"laugh","(LOL)":"laugh","(cool)":"cool","8-)":"cool","8=)":"cool","B-)":"cool","B=)":"cool",":O":"surprised",":-O":"surprised",":=O":"surprised",":o":"surprised",":-o":"surprised",":=o":"surprised","(surprised)":"surprised",";)":"wink",";-)":"wink",";=)":"wink","(wink)":"wink",";(":"cry",";-(":"cry",";=(":"cry","(cry)":"cry",":'(":"cry","(:|":"sweat","(sweat)":"sweat",":|":"speechless",":-|":"speechless",":=|":"speechless","(speechless)":"speechless","(kiss)":"kiss",":*":"kiss",":-*":"kiss",":=*":"kiss","(xo)":"kiss","(K)":"kiss","(k)":"kiss",":P":"tongueout",":-P":"tongueout",":=P":"tongueout",":p":"tongueout",":-p":"tongueout",":=p":"tongueout","(tongueout)":"tongueout",":$":"blush",":-$":"blush",":=$":"blush",':">':"blush","(blush)":"blush",":^)":"wonder","(wonder)":"wonder","|-)":"sleepy","I-)":"sleepy","I=)":"sleepy","(snooze)":"sleepy","|-(":"dull","|(":"dull","|=(":"dull","(dull)":"dull","(inlove)":"inlove","(love)":"inlove",":]":"inlove",":-]":"inlove","]:)":"eg",">:)":"eg","(grin)":"eg","(yn)":"fingerscrossed","(fingers)":"fingerscrossed","(fingerscrossed)":"fingerscrossed","(crossedfingers)":"fingerscrossed","(yawn)":"yawn","(puke)":"puke",":&":"puke",":-&":"puke",":=&":"puke","+o(":"puke","(doh)":"doh","(angry)":"angry",":@":"angry",":-@":"angry",":=@":"angry","x(":"angry","x-(":"angry","X(":"angry","X-(":"angry","x=(":"angry","X=(":"angry",";@":"angry",";-@":"angry","(wasntme)":"wasntme","(wm)":"wasntme","(party)":"party","<O)":"party","<o)":"party","<:o)":"party","(worry)":"worry",":S":"worry",":s":"worry",":-s":"worry",":-S":"worry",":=s":"worry",":=S":"worry","(mm)":"mmm","(mmm)":"mmm","(mmmm)":"mmm","(nerd)":"nerdy","8-|":"nerdy","B-|":"nerdy","8|":"nerdy","B|":"nerdy","8=|":"nerdy","B=|":"nerdy",":x":"lipssealed",":-x":"lipssealed",":X":"lipssealed",":-X":"lipssealed",":#":"lipssealed",":-#":"lipssealed",":=x":"lipssealed",":=X":"lipssealed",":=#":"lipssealed","(wave)":"hi","(hi)":"hi","(bye)":"hi","(BYE)":"hi","(Bye)":"hi","(Hi)":"hi","(HI)":"hi","(facepalm)":"facepalm","(fail)":"facepalm","(devil)":"devil","(6)":"devil","(angel)":"angel","(A)":"angel","(a)":"angel","(envy)":"envy","(V)":"envy","(v)":"envy","(wait)":"wait","(hug)":"hug","(bear)":"hug","(makeup)":"makeup","(kate)":"makeup","(chuckle)":"giggle","(giggle)":"giggle","(clap)":"clap","(think)":"think",":-?":"think",":?":"think",":=?":"think","*-)":"think","(bow)":"bow","(rofl)":"rofl","(rotfl)":"rofl","(whew)":"whew","(phew)":"whew","(happy)":"happy","(smirk)":"smirk","(nod)":"nod","(shake)":"shake","(waiting)":"waiting","(forever)":"waiting","(impatience)":"waiting","(emo)":"emo","(y)":"yes","(Y)":"yes","(ok)":"yes","(yes)":"yes","(OK)":"yes","(oK)":"yes","(Ok)":"yes","(n)":"no","(N)":"no","(no)":"no","(handshake)":"handshake","(highfive)":"highfive","(hifive)":"highfive","(h5)":"highfive","(heart)":"heart","(h)":"heart","(H)":"heart","(l)":"heart","(L)":"heart","<3":"heart","(lalala)":"lalala","(lalalala)":"lalala","(lala)":"lalala","(notlistening)":"lalala","(heidy)":"heidy","(squirrel)":"heidy","(F)":"flower","(f)":"flower","(flower)":"flower","(rain)":"rain","(london)":"rain","(st)":"rain","(ST)":"rain","(St)":"rain","(sun)":"sun","(#)":"sun","(tumbleweed)":"tumbleweed","(music)":"music","(8)":"music","(bandit)":"bandit","(tmi)":"tmi","(coffee)":"coffee","(c)":"coffee","(C)":"coffee","(pi)":"pizza","(pizza)":"pizza","(cash)":"cash","(mo)":"cash","($)":"cash","(flex)":"muscle","(muscle)":"muscle","(^)":"cake","(cake)":"cake","(beer)":"beer","(bricklayers)":"beer","(B)":"beer","(b)":"beer","(d)":"drink","(D)":"drink","(drink)":"drink","\\o/":"dance","\\:D/":"dance","\\:d/":"dance","(dance)":"dance","(ninja)":"ninja","(J)":"ninja","(j)":"ninja","(*)":"star","(star)":"star","(headbang)":"headbang","(banghead)":"headbang","(swear)":"swear","(drunk)":"drunk","(finger)":"finger","(poolparty)":"poolparty","(hrv)":"poolparty","(rock)":"rock","(smoking)":"smoke","(smoke)":"smoke","(ci)":"smoke","(bug)":"bug","(toivo)":"toivo","(wfh)":"wfh","(@h)":"wfh","(@H)":"wfh","(hollest)":"hollest","(zilmer)":"priidu","(e)":"mail","(m)":"mail","(mail)":"mail","(E)":"mail","(o)":"time","(O)":"time","(time)":"time","(clock)":"time","(0)":"time","(~)":"movie","(film)":"movie","(movie)":"movie","(mp)":"phone","(ph)":"phone","(phone)":"phone","(talk)":"talk","(call)":"call","(T)":"call","(t)":"call","(punch)":"punch","*|":"punch","*-|":"punch","(skype)":"skype","(ss)":"skype","(u)":"brokenheart","(U)":"brokenheart","(brokenheart)":"brokenheart","(mooning)":"mooning","(oliver)":"oliver","(bartlett)":"bertlett","(football)":"bertlett","(soccer)":"bertlett","(so)":"bertlett","(talktothehand)":"talktothehand","(idea)":"idea",":i":"idea",":I":"idea","*-:)":"idea","(sheep)":"sheep","(bah)":"sheep","(cat)":"cat",":3":"cat","(@)":"cat","(meow)":"cat","(bike)":"bike","(bicycle)":"bike","(sander)":"bike","(dog)":"dog",":o3":"dog","(&)":"dog"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(21),r=n(40),o={small:"getSmall",large:"getLarge",extraLarge:"getExtraLarge",superLarge:"getSuperLarge"};t.buildEmoticonUrl=function(e,n,s,a){var c=e+"/"+n.id+"/views/";c=t.rewriteUrls(c,r.default.pesCDNAuthentication.rewriteRules);var u=o[s]+(a?"Animated":"");return i.UrlHelper.setQueryParameters(c+r.default.profiles.emoticons[u](),{etag:n.etag})},t.rewriteUrls=function(e,t){if("string"!=typeof e)return e;var n,i=e;for(n in t)if(-1!==n.search(n.from)){i=i.replace(n.from,n.to);break}return i}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r={title:"Latest accessibility announcements",historyLength:10,parent:void 0},o=function(){function e(e){this._props=r,this._announcements=[],this._mainWindow=e}return e.prototype.setup=function(e){this._props=i({},this._props,e),e.parent&&this._container&&this._container.parentElement!==e.parent&&e.parent.appendChild(this._container),e.title&&this._container&&this._container.setAttribute("aria-label",e.title),e.historyLength&&this._shrinkHistory()},e.prototype.dispose=function(){var e=this;this._container&&(this._cleanupTimer&&(this._mainWindow.clearTimeout(this._cleanupTimer),this._cleanupTimer=void 0),this._announcements.forEach(function(t){t.timer&&(e._mainWindow.clearTimeout(t.timer),t.timer=void 0)}),this._announcements=[],this._container.parentNode&&(this._container.parentNode.removeChild(this._container),this._container=void 0))},e.prototype.announce=function(e,t){if(e.trim()&&(this._container||this._init(),this._container)){var n=document.createElement("div");n.setAttribute("role",t?"alert":"log"),n.setAttribute("aria-live",t?"assertive":"polite");var i=n.style;i.position="absolute",i.left=i.top=i.right=i.bottom="0";var r={node:n};r.timer=this._mainWindow.setTimeout(function(){delete r.timer,r.node.innerText=e},100),this._announcements.push(r),this._container.appendChild(n),this._shrinkHistory()}},e.prototype._shrinkHistory=function(){if(this._container)for(;this._announcements.length>this._props.historyLength;){var e=this._announcements.shift();e&&(e.timer&&this._mainWindow.clearTimeout(e.timer),this._container.removeChild(e.node))}},e.prototype._init=function(){if(!this._container){this._container=document.createElement("div"),this._container.setAttribute("role","list"),this._container.setAttribute("aria-label",this._props.title);var e=this._container.style;e.position="absolute",e.overflow="hidden",e.width=e.height="1px",e.right=e.bottom="0",e.opacity="0",e.zIndex="-1",(this._props.parent||this._mainWindow.document.body).appendChild(this._container)}},e}();t.Announcer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),r=n(44),o=n(35),s=n(34),a=n(20),c=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","*[tabindex]","*[contenteditable]"].join(", "),u=function(){function e(){}return e.prototype.getInfo=function(e){var t=i.getAbilityHelpersOnElement(e),n=t&&t.focusable;return{isDefaultFocusable:!(!n||!n.default)||e.classList.contains("ability-helpers-default-focusable"),isIgnoredFocusable:!(!n||!n.ignored)}},e.prototype.setup=function(e,t){i.setAbilityHelpersOnElement(e,{focusable:{default:t.isDefaultFocusable,ignored:t.isIgnoredFocusable}});var n=[];t.isDefaultFocusable&&n.push("default"),t.isIgnoredFocusable&&n.push("ignored"),n.length?e.style.setProperty("--ah-focusable",n.join(",")):e.style.removeProperty("--ah-focusable")},e.prototype.isFocusable=function(e,t,n){return!(!e.matches||!e.matches(c)||!t&&-1===e.tabIndex)&&(this.isVisible(e)&&(!!n||this.isAccessible(e)))},e.prototype.isVisible=function(e){if(null===e.offsetParent)return!1;var t=e.ownerDocument&&e.ownerDocument.defaultView;return!!t&&"hidden"!==t.getComputedStyle(e).visibility},e.prototype.isAccessible=function(e){for(var t=e;t;t=t.parentElement){var n=i.getAbilityHelpersOnElement(t);if(n&&n.modalityLayer&&!n.modalityLayer.isActive())return!0;var r=t.getAttribute("aria-hidden");if(r&&"true"===r.toLowerCase())return!1;if((r=t.getAttribute("aria-disabled"))&&"true"===r.toLowerCase())return!1}return!0},e.prototype.findFirst=function(e,t,n){return this._findNextElement(e,e,!1,t,n)},e.prototype.findLast=function(e,t,n){return this._findLast(e,!1,t,n)},e.prototype.findNext=function(e,t,n,i){return this._findNext(!1,!1,e,t,n,i)},e.prototype.findPrev=function(e,t,n,i){return this._findNext(!1,!0,e,t,n,i)},e.prototype.findFirstListItem=function(e,t,n){return this._findNextElement(e,e,!0,t,n)},e.prototype.findLastListItem=function(e,t,n){return this._findLast(e,!0,t,n)},e.prototype.findNextListItem=function(e,t,n,i){return this._findNext(!0,!1,e,t,n,i)},e.prototype.findPrevListItem=function(e,t,n,i){return this._findNext(!0,!0,e,t,n,i)},e.prototype.findDefault=function(e){var t=this;if(!e.ownerDocument)return null;var n=s.createElementTreeWalker(e.ownerDocument,e,function(e){return t.getInfo(e).isDefaultFocusable&&a.AbilityHelpers.focusable.isFocusable(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});return n?n.nextNode():null},e.prototype._findNext=function(e,t,n,i,r,o){return o||(o=a.AbilityHelpers.focusedElement.getFocusedElement()),o&&o.ownerDocument&&(r=r||o.ownerDocument.body).contains(o)?this._findNextElement(r,o,e,n,i,t):null},e.prototype._findLast=function(e,t,n,i){for(var r=null,o=e.lastElementChild;o;o=o.lastElementChild)r=o;return r?this._acceptElement(r,t,n,i)===NodeFilter.FILTER_ACCEPT?r:this._findNextElement(e,r,t,n,i,!0):null},e.prototype._findNextElement=function(e,t,n,i,r,o){var a=this;if(!e.ownerDocument)return null;var c=s.createElementTreeWalker(e.ownerDocument,e,function(e){return a._acceptElement(e,n,i,r)});return c?(t&&(c.currentNode=t),o?c.previousNode():c.nextNode()):null},e.prototype._acceptElement=function(e,t,n,i){var s=o.ModalityLayer.getLayerFor(e);if(i||!s||s.root.getCurrentLayerId()===s.layer.userId||s.layer.isAlwaysAccessible()){var c=r.List.getItemFor(e);return!t&&c&&c.listItem!==c.list.getCurrentItem()?NodeFilter.FILTER_REJECT:(!t||c&&c.isListItem)&&a.AbilityHelpers.focusable.isFocusable(e,n)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}return s?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP},e}();t.Focusable=u},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),o=n(35),s=10,a=0,c=function(){function e(t,n){var i=this;this._isActive=!1,this._history=[[]],this._snapshotIndex=0,this.isActive=function(){return i._isActive},this.setSnapshot=function(e){i._snapshotIndex=e,i._history.length>e+1&&i._history.splice(e+1,i._history.length-e-1),i._history[e]||(i._history[e]=[]),i._setInformativeStyle()},this.focusFirst=function(){if(!i._element)return!1;var e=r.AbilityHelpers.focusable.findFirst(i._element,!1,!0);return!!e&&(i.clearHistory(!0),r.AbilityHelpers.focusedElement.focus(e),!0)},this.focusDefault=function(){if(!i._element)return!1;var e=r.AbilityHelpers.focusable.findDefault(i._element);return!!e&&(r.AbilityHelpers.focusedElement.focus(e),!0)},this.resetFocus=function(){if(!r.AbilityHelpers.focusable.isVisible(i._element))return!1;if(r.AbilityHelpers.focusable.isFocusable(i._element,!0,!0))r.AbilityHelpers.focusedElement.focus(i._element,!0);else{var t=i._element.getAttribute("tabindex"),n=i._element.getAttribute("aria-hidden");i._element.tabIndex=-1,i._element.setAttribute("aria-hidden","true"),e.lastResetElement=i._element,r.AbilityHelpers.focusedElement.focus(i._element,!0,!0),i._setOrRemoveAttribute(i._element,"tabindex",t),i._setOrRemoveAttribute(i._element,"aria-hidden",n)}return!0},this.clearHistory=function(e){var t=i._element;i._history[i._snapshotIndex]=t?i._history[i._snapshotIndex].filter(function(n){return!!e&&t.contains(n)}):[]},this.id="fd"+ ++a,this._element=t,this._props=n,this._setInformativeStyle()}return e.prototype.setup=function(e){this._props=i({},this._props,e)},e.prototype.move=function(e){this._remove(),this._element=e,this._setInformativeStyle()},e.prototype.dispose=function(){this._isActive=!1,this._history=[[]],this._snapshotIndex=0,this._remove()},e.prototype.setActive=function(e){this._isActive=e,this._setInformativeStyle()},e.prototype.getActions=function(){return{focusDefault:this.focusDefault,focusFirst:this.focusFirst,resetFocus:this.resetFocus,clearHistory:this.clearHistory,setSnapshot:this.setSnapshot,isActive:this.isActive}},e.prototype.unshift=function(e){var t=this._history[this._snapshotIndex];for((t=this._history[this._snapshotIndex]=t.filter(function(t){return t!==e})).unshift(e);t.length>s;)t.pop()},e.prototype.findAvailable=function(){if(!r.AbilityHelpers.focusable.isVisible(this._element))return null;var e=this._history[this._snapshotIndex].slice(0);this.clearHistory(!0);for(var t=function(t){var i=e[t];if(n._element.contains(i)){if(r.AbilityHelpers.focusable.isFocusable(i))return{value:i}}else{var o=[];if(i.id&&o.push("#"+i.id),i.className&&i.className.split(" ").forEach(function(e){(e=e.trim())&&o.push("."+e)}),o.length){o.unshift(i.tagName.toLowerCase());for(var s=n._element.querySelectorAll(o.join("")),a=0;a<s.length;a++){var c=s[a];if(c&&r.AbilityHelpers.focusable.isFocusable(c))return{value:c}}}}},n=this,i=0;i<e.length;i++){var o=t(i);if("object"==typeof o)return o.value}if(r.AbilityHelpers.keyboardNavigation.isNavigatingWithKeyboard()){var s=r.AbilityHelpers.focusable.findFirst(this._element,!1,!0);if(s)return s}return r.AbilityHelpers.focusable.findDefault(this._element)},e.prototype.customFocus=function(e){return!!this._props.onFocusLost&&this._props.onFocusLost(e,this.getActions())},e.prototype._setOrRemoveAttribute=function(e,t,n){null===n?e.removeAttribute(t):e.setAttribute(t,n)},e.prototype._setInformativeStyle=function(){this._element.style.setProperty("--ah-focus-deloser",(this._isActive?"active":"inactive")+",snapshot-"+this._snapshotIndex)},e.prototype._remove=function(){this._element.style.removeProperty("--ah-focus-deloser")},e}();t.FocusDeloserContainer=c;var u=function(){function e(e){var t=this;this._isInSomeDeloser=!1,this._history=[],this._isPaused=!1,this._init=function(){t._initTimer=void 0,r.AbilityHelpers.focusedElement.subscribe(t._onElementFocused)},this._onElementFocused=function(e){t._restoreFocusTimer&&(t._mainWindow.clearTimeout(t._restoreFocusTimer),t._restoreFocusTimer=void 0);var n=t._curFocusedElement;if(t._curFocusedElement=e,e&&(t._lastFocusedElement=e),!e)return n&&n===c.lastResetElement||t._scheduleRestoreFocus(),void(c.lastResetElement=void 0);var i=t._getFocusDeloser(e);if(i){t._isInSomeDeloser=!0;var r=o.ModalityLayer.getRootId(e);i!==t._curDeloser&&(t._curDeloser&&t._curDeloser.setActive(!1),t._curDeloser=i,i.setActive(!0));for(var a=void 0,u=-1,l=0;l<t._history.length;l++){var p=t._history[l];if(p.rootId===r){a=p,u=l;break}}if(a){t._history.splice(u,1);var d=a.history.indexOf(i);d>-1&&a.history.splice(d,1)}else a={rootId:r,history:[]};a.history.unshift(i),t._history.unshift(a);var f=o.ModalityLayer.getLayerFor(e);f&&f.root.getCurrentLayerId()!==f.layer.userId||i.unshift(e),a.history.splice(s,t._history.length-s),t._history.splice(s,t._history.length-s)}else t._isInSomeDeloser=!1,t._curDeloser=void 0},this._mainWindow=e,this._initTimer=this._mainWindow.setTimeout(this._init,0)}return e.prototype.dispose=function(){this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),r.AbilityHelpers.focusedElement.unsubscribe(this._onElementFocused)},e.prototype.getActions=function(e){for(var t=e;t;t=t.parentElement){var n=r.getAbilityHelpersOnElement(t);if(n&&n.focusDeloser)return n.focusDeloser.getActions()}},e.prototype.add=function(e,t){var n=r.getAbilityHelpersOnElement(e);n&&n.focusDeloser||r.setAbilityHelpersOnElement(e,{focusDeloser:new c(e,t||{})})},e.prototype.remove=function(e){var t=r.getAbilityHelpersOnElement(e);if(t){var n=t.focusDeloser;n&&(this._history.forEach(function(e){e.history=e.history.filter(function(e){return e!==n})}),this._history=this._history.filter(function(e){return e.history.length>0}),n.isActive()&&this._scheduleRestoreFocus(),n.dispose(),r.setAbilityHelpersOnElement(e,{focusDeloser:void 0}))}},e.prototype.move=function(e,t){var n=r.getAbilityHelpersOnElement(e);n&&n.focusDeloser&&(n.focusDeloser.move(t),r.setAbilityHelpersOnElement(t,{focusDeloser:n.focusDeloser}),r.setAbilityHelpersOnElement(e,{focusDeloser:void 0}))},e.prototype.pause=function(){this._isPaused=!0,this._restoreFocusTimer&&(this._mainWindow.clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0)},e.prototype.resume=function(e){this._isPaused=!1,e&&this._scheduleRestoreFocus()},e.prototype._getFocusDeloser=function(e){for(var t=e;t;t=t.parentElement){var n=r.getAbilityHelpersOnElement(t);if(n&&n.focusDeloser)return n.focusDeloser}},e.prototype._isLastFocusedAvailable=function(){return!(!this._lastFocusedElement||!this._lastFocusedElement.offsetParent)},e.prototype._scheduleRestoreFocus=function(){var e=this;this._isPaused||(this._restoreFocusTimer=this._mainWindow.setTimeout(function(){if(e._restoreFocusTimer=void 0,e._isInSomeDeloser&&!e._isLastFocusedAvailable()){if(e._curDeloser){if(e._lastFocusedElement&&e._curDeloser.customFocus(e._lastFocusedElement))return;var t=e._curDeloser.findAvailable();if(t&&r.AbilityHelpers.focusedElement.focus(t))return}e._focusAvailable()||(e._isInSomeDeloser=!1,e._curDeloser&&(e._curDeloser.setActive(!1),e._curDeloser=void 0))}},100))},e.prototype._focusAvailable=function(){for(var e=0;e<this._history.length;e++){for(var t=this._history[e],n={},i=0;i<t.history.length;i++)if(g(t.history[i],n))return!0;var s=o.ModalityLayer.getRootById(t.rootId),a=s&&s.getLayers();if(a)for(var c=0,u=a;c<u.length;c++){var l=u[c].getElement(),p=r.getAbilityHelpersOnElement(l),d=p&&p.focusDeloser;if(d&&g(d,n))return!0}for(var f=0,h=Object.keys(n);f<h.length;f++){if(n[h[f]].resetFocus())return!0}}return!1;function g(e,t){if(e){var n=e.findAvailable();if(n)return r.AbilityHelpers.focusedElement.focus(n),!0;e.id in t||(t[e.id]=e)}return!1}},e}();t.FocusDeloser=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,s,a,c=n(16),u=n(24),l=n(65),p=n(44),d=n(35),f=n(66),h="ability-helpers:focused-element-related",g=(o=window,s=o.HTMLElement.prototype.focus,a=!1,o.HTMLElement.prototype.focus=function(){a=!0},o.document.createElement("button").focus(),o.HTMLElement.prototype.focus=s,a);function m(e){e.__shouldIgnoreFocus=!0}function v(e){return!!e.__shouldIgnoreFocus}t.ignoreFocus=m,t.shouldIgnoreFocus=v;var y=function(e){function t(n){var i=e.call(this)||this;return i._init=function(){i._initTimer=void 0,t.replaceFocus(i._mainWindow.document),i._mainWindow.document.addEventListener("focusin",i._onFocusIn,!0),i._mainWindow.document.addEventListener("focusout",i._onFocusOut,!0),i._mainWindow.document.addEventListener("mousedown",i._onMouseDown,!0),i._mainWindow.addEventListener("keydown",i._onKeyDown,!0),i._mainWindow.addEventListener(h,i._onIFrameEvent,!0)},i._onFocusIn=function(e){i._setFocusedElement(e.target,e.relatedTarget||void 0)},i._onFocusOut=function(e){i._setFocusedElement(void 0,e.relatedTarget||void 0)},i._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case"mousedown":i._onMouseDown(e.originalEvent);break;case"focusin":i._setFocusedElement(e.targetDetails.target,e.originalEvent.relatedTarget||void 0);break;case"focusout":i._setFocusedElement(void 0,e.originalEvent.relatedTarget||void 0);break;case"keydown":i._onKeyDown(e.originalEvent)}},i._onMouseDown=function(e){var t=p.List.getItemFor(e.target);t&&t.list.getCurrentItem()!==t.listItem&&t.list.setCurrentItem(t.listItem)},i._onKeyDown=function(e){var t=i.getVal();if(t&&t.ownerDocument){switch(e.keyCode){case l.Keys.Tab:case l.Keys.Down:case l.Keys.Right:case l.Keys.Up:case l.Keys.Left:case l.Keys.Enter:case l.Keys.Space:case l.Keys.PageDown:case l.Keys.PageUp:case l.Keys.Home:case l.Keys.End:break;default:return}if(e.keyCode===l.Keys.Tab){var n=d.ModalityLayer.getLayerFor(t);if(!n)if(!(s=p.List.getItemFor(t)))return;var r=e.shiftKey?c.AbilityHelpers.focusable.findPrev():c.AbilityHelpers.focusable.findNext();if(n&&n.layer){var o=r&&d.ModalityLayer.getLayerFor(r);if((!o||n.root.id!==o.root.id||o.root.getCurrentLayerId()!==o.layer.userId)&&n.layer.onBeforeFocusOut())return void e.preventDefault()}r?(e.preventDefault(),_(r)):i._moveOutWithDefaultAction(n?n.root.getElement():t.ownerDocument.body,e.shiftKey)}else{var s;if(!(s=p.List.getItemFor(t)))return;if(e.keyCode===l.Keys.Enter||e.keyCode===l.Keys.Space){var a=s.listItem.getElement();return void(a===t&&(e.preventDefault(),e.stopImmediatePropagation(),(p.List.findActionable(a)||a).click()))}e.preventDefault(),e.stopImmediatePropagation();var u=new p.ListNavigation(s.list.getElement(),t,function(e){return _(e)});switch(e.keyCode){case l.Keys.Down:case l.Keys.Right:u.next();break;case l.Keys.Up:case l.Keys.Left:u.prev();break;case l.Keys.PageDown:u.pageDown();break;case l.Keys.PageUp:u.pageUp();break;case l.Keys.Home:u.home();break;case l.Keys.End:u.end()}}}},i._validateFocusedElement=function(e,t){if(i._insideListTimer&&(i._mainWindow.clearTimeout(i._insideListTimer),i._insideListTimer=void 0),e){var n=p.List.getItemFor(e),r=d.ModalityLayer.getLayerFor(e),o=r?r.root.getCurrentLayerId():void 0;if(!n||r&&void 0!==o&&r.layer.userId!==o)i._curList=void 0;else if(i._curList===n.list)n&&n.list.getCurrentItem()!==n.listItem&&n.list.setCurrentItem(n.listItem);else{i._curList=n.list;var s=n.list.getCurrentItem(),a=s?s.getElement():void 0;if(a&&a!==e&&!a.contains(e))return void c.AbilityHelpers.focusedElement.focus(a)}if(!r)return;var u=r.layer;if(o===u.userId)return;if(void 0===o||t.isFocusedProgrammatically)return void r.root.setCurrentLayerId(u.userId);if(u&&e.ownerDocument){var l=c.AbilityHelpers.focusable.findFirst(r.root.getElement());if(l){if(e.compareDocumentPosition(l)&document.DOCUMENT_POSITION_PRECEDING&&!(l=c.AbilityHelpers.focusable.findLast(e.ownerDocument.body)))throw new Error("Something went wrong.");c.AbilityHelpers.focusedElement.focus(l)}else e.blur()}}else i._curList&&(i._insideListTimer=i._mainWindow.setTimeout(function(){i._insideListTimer=void 0,i._curList=void 0},0))},i._mainWindow=n,i._initTimer=i._mainWindow.setTimeout(i._init,0),i}return r(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._mainWindow.document.removeEventListener("focusin",this._onFocusIn,!0),this._mainWindow.document.removeEventListener("focusout",this._onFocusOut,!0),this._mainWindow.removeEventListener(h,this._onIFrameEvent,!0),this._mainWindow.removeEventListener("keydown",this._onKeyDown,!0),this._mainWindow.document.removeEventListener("mousedown",this._onMouseDown,!0)},t.prototype.getFocusedElement=function(){return this.getVal()},t.prototype.focus=function(e,n,i){return!!c.AbilityHelpers.focusable.isFocusable(e,n,i)&&(t._lastFocusedProgrammatically=e,e.focus(),!0)},t.prototype._setFocusedElement=function(e,n){var i={relatedTarget:n};if(e){if(v(e))return;(g||t._lastFocusedProgrammatically)&&(i.isFocusedProgrammatically=e===t._lastFocusedProgrammatically,t._lastFocusedProgrammatically=void 0)}var r=this._nextVal={element:e,details:i};e!==this._val&&this._validateFocusedElement(e,i),this._nextVal===r&&this.setVal(e,i),this._nextVal=void 0},t.replaceFocus=function(e){var n=e.defaultView;if(!n)throw new Error("Wrong document for replaceFocus().");var i=n.HTMLElement.prototype.focus;function r(){return t._lastFocusedProgrammatically=this,i.apply(this,arguments)}i.__abilityHelpersFocus||(n.HTMLElement.prototype.focus=r,r.__abilityHelpersFocus=i)},t.prototype._moveOutWithDefaultAction=function(e,t){var n=this,i=e.ownerDocument&&e.ownerDocument.defaultView;if(i){this._removeMoveOutInput(),this._moveOutInput=i.document.createElement("input"),m(this._moveOutInput);var r=this._moveOutInput.style;r.position="absolute",r.opacity="0",r.zIndex="-1",r.left=r.top="-100500px",this._moveOutInput.setAttribute("aria-hidden","true"),this._moveOutInput.addEventListener("focusout",function(){n._removeMoveOutInput()}),t&&e.firstChild?e.insertBefore(this._moveOutInput,e.firstChild):e.appendChild(this._moveOutInput),_(this._moveOutInput)}},t.prototype._removeMoveOutInput=function(){this._moveOutInput&&(this._moveOutInput.parentElement&&this._moveOutInput.parentElement.removeChild(this._moveOutInput),this._moveOutInput=void 0)},t}(f.Subscribable);function _(e){var t=e.focus;t.__abilityHelpersFocus?t.__abilityHelpersFocus.call(e):e.focus()}t.FocusedElementState=y,t.setupFocusedElementStateInIFrame=function(e,t){y.replaceFocus(t),u.setupIFrameToMainWindowEventsDispatcher(e,t,h,[{type:u.EventFromIFrameDescriptorType.Document,name:"focusin",capture:!0},{type:u.EventFromIFrameDescriptorType.Document,name:"focusout",capture:!0},{type:u.EventFromIFrameDescriptorType.Document,name:"mousedown",capture:!0},{type:u.EventFromIFrameDescriptorType.Window,name:"keydown",capture:!0}])}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(16),s=n(24),a=n(65),c=n(66),u="ability-helpers:keyboard-navigation-related",l=function(e){function t(t){var n=e.call(this)||this;return n._isMouseUsed=!1,n._init=function(){n._initTimer=void 0,n._mainWindow.document.body.addEventListener("mousedown",n._onMouseDown,!0),n._mainWindow.addEventListener("keydown",n._onKeyDown,!0),n._mainWindow.addEventListener(u,n._onIFrameEvent,!0),o.AbilityHelpers.focusedElement.subscribe(n._onElementFocused)},n._onMouseDown=function(e){0===e.buttons||0===e.clientX&&0===e.clientY&&0===e.screenX&&0===e.screenY||(n._isMouseUsed=!0,n.setVal(!1,void 0))},n._onKeyDown=function(e){var t=n.isNavigatingWithKeyboard();t||e.keyCode!==a.Keys.Tab?t&&e.keyCode===a.Keys.Esc&&n._scheduleDismiss():n.setVal(!0,void 0)},n._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case"mousedown":n._onMouseDown(e.originalEvent);break;case"keydown":n._onKeyDown(e.originalEvent)}},n._onElementFocused=function(e,t){e&&(n._isMouseUsed?n._isMouseUsed=!1:n.isNavigatingWithKeyboard()||t.relatedTarget&&(t.isFocusedProgrammatically||void 0===t.isFocusedProgrammatically||n.setVal(!0,void 0)))},n._mainWindow=t,n._initTimer=n._mainWindow.setTimeout(n._init,0),n}return r(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._dismissTimer&&(this._mainWindow.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),this._mainWindow.document.body.removeEventListener("mousedown",this._onMouseDown,!0),this._mainWindow.removeEventListener("keydown",this._onKeyDown,!0),this._mainWindow.removeEventListener(u,this._onIFrameEvent,!0),o.AbilityHelpers.focusedElement.unsubscribe(this._onElementFocused)},t.prototype.isNavigatingWithKeyboard=function(){return this.getVal()||!1},t.prototype._scheduleDismiss=function(){var e=this;this._dismissTimer&&(this._mainWindow.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);var t=o.AbilityHelpers.focusedElement.getFocusedElement();this._dismissTimer=this._mainWindow.setTimeout(function(){e._dismissTimer=void 0;var n=o.AbilityHelpers.focusedElement.getFocusedElement();t&&n&&t===n&&e.setVal(!1,void 0)},500)},t}(c.Subscribable);t.KeyboardNavigationState=l,t.setupKeyboardNavigationStateInIFrame=function(e,t){s.setupIFrameToMainWindowEventsDispatcher(e,t,u,[{type:s.EventFromIFrameDescriptorType.Document,name:"mousedown",capture:!0},{type:s.EventFromIFrameDescriptorType.Window,name:"keydown",capture:!0}])}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r,o,s=n(16),a=n(24),c="ability-helpers:outline-related",u={areaClass:"focus-outline-area",outlineClass:"focus-outline",outlineColor:"#ff4500",outlineWidth:2,zIndex:2147483647};"onfullscreenchange"in document?(r="fullscreenchange",o="fullscreenElement"):"onwebkitfullscreenchange"in document?(r="webkitfullscreenchange",o="webkitFullscreenElement"):"onmozfullscreenchange"in document?(r="mozfullscreenchange",o="mozFullScreenElement"):"onmsfullscreenchange"in document&&(r="msfullscreenchange",o="msFullscreenElement");var l=function(){function e(e,t,n,i){this.left=e,this.top=t,this.right=n,this.bottom=i}return e.prototype.equalsTo=function(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom},e.prototype.clone=function(){return new e(this.left,this.top,this.right,this.bottom)},e}(),p=function(){function e(t){var n=this;this._isVisible=!1,this._allOutlineElements=[],this._init=function(){n._initTimer=void 0,s.AbilityHelpers.keyboardNavigation.subscribe(n._onKeyboardNavigationStateChanged),s.AbilityHelpers.focusedElement.subscribe(n._onElementFocused),n._mainWindow.addEventListener("scroll",n._onScroll,!0),n._mainWindow.addEventListener(c,n._onIFrameEvent,!0),r&&n._mainWindow.document.addEventListener(r,n._onFullScreenChanged)},this._onFullScreenChanged=function(e){if(o&&e.target){var t=e.target.body||e.target,i=n._getOutlineDOM(t);if(t.ownerDocument&&i){var r=t.ownerDocument[o];r?(r.appendChild(i.container),n._fullScreenElement=r):(t.ownerDocument.body.appendChild(i.container),n._fullScreenElement=void 0)}}},this._onKeyboardNavigationStateChanged=function(){n._onElementFocused(s.AbilityHelpers.focusedElement.getFocusedElement())},this._onElementFocused=function(e){!n._updateOutlinedElement(e)&&n._isVisible&&n._setOutlineVisibility(!1)},this._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case"scroll":n._onScroll(e.originalEvent);break;case r:n._onFullScreenChanged(e.originalEvent)}},this._onScroll=function(t){n._outlinedElement&&e._isParentChild(t.target,n._outlinedElement)&&(n._scrollTimer&&n._mainWindow.clearTimeout(n._scrollTimer),n._curPos=void 0,n._setOutlinePosition())},this._mainWindow=t,this._mainWindow.setTimeout(this._init,0)}return e.prototype.setup=function(e){u=i({},u,e);var t=this._mainWindow;t.__abilityHelpers&&(t.__abilityHelpers.outlineStyle||(t.__abilityHelpers.outlineStyle=d(this._mainWindow.document,u)))},e.prototype.ignoreElement=function(e,t){s.setAbilityHelpersOnElement(e,{outline:t?void 0:{ignored:!0}})},e.prototype.dispose=function(){var e=this;this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._updateTimer&&(this._mainWindow.clearTimeout(this._updateTimer),this._updateTimer=void 0),this._scrollTimer&&(this._mainWindow.clearTimeout(this._scrollTimer),this._scrollTimer=void 0),s.AbilityHelpers.keyboardNavigation.unsubscribe(this._onKeyboardNavigationStateChanged),s.AbilityHelpers.focusedElement.unsubscribe(this._onElementFocused),this._mainWindow.removeEventListener("scroll",this._onScroll,!0),this._mainWindow.removeEventListener(c,this._onIFrameEvent,!0),r&&this._mainWindow.document.removeEventListener(r,this._onFullScreenChanged),this._allOutlineElements.forEach(function(t){return e._removeOutlineDOM(t.container)}),this._allOutlineElements=[]},e.prototype._shouldShowCustomOutline=function(e){var t=s.getAbilityHelpersOnElement(e);if(t&&t.outline&&t.outline.ignored)return!1;for(var n=e;n;n=n.parentElement)if(n.classList&&n.classList.contains(u.areaClass))return!0;return!1},e.prototype._updateOutlinedElement=function(e){var t=this;if(this._outlinedElement=void 0,this._updateTimer&&(this._mainWindow.clearTimeout(this._updateTimer),this._updateTimer=void 0),this._curPos=void 0,!s.AbilityHelpers.keyboardNavigation.isNavigatingWithKeyboard())return!1;if(e){if("INPUT"===e.tagName){if(!(e.type in{button:!0,checkbox:!0,file:!0,image:!0,radio:!0,range:!0,reset:!0,submit:!0}))return!1}else if("TEXTAREA"===e.tagName)return!1;return!!this._shouldShowCustomOutline(e)&&(this._updateTimer=this._mainWindow.setTimeout(function(){t._updateTimer=void 0,s.AbilityHelpers.keyboardNavigation.isNavigatingWithKeyboard()&&(t._outlinedElement=e,t._updateOutline())},0),!0)}return!1},e.prototype._updateOutline=function(){var e=this;this._setOutlinePosition(),this._updateTimer&&(this._mainWindow.clearTimeout(this._updateTimer),this._updateTimer=void 0),this._outlinedElement&&(this._updateTimer=this._mainWindow.setTimeout(function(){e._updateTimer=void 0,e._updateOutline()},30))},e.prototype._setOutlineVisibility=function(e){this._isVisible=e,this._curOutlineElements&&(e?this._curOutlineElements.container.classList.add(u.outlineClass+"_visible"):(this._curOutlineElements.container.classList.remove(u.outlineClass+"_visible"),this._curPos=void 0))},e.prototype._setOutlinePosition=function(){if(this._outlinedElement){var e=this._outlinedElement.getBoundingClientRect(),t=new l(e.left,e.top,e.right,e.bottom);if(!this._curPos||!t.equalsTo(this._curPos)){var n=this._getOutlineDOM(this._outlinedElement),i=this._outlinedElement.ownerDocument&&this._outlinedElement.ownerDocument.defaultView;if(n&&i){this._curOutlineElements!==n&&(this._setOutlineVisibility(!1),this._curOutlineElements=n),this._curPos=t;var r=t.clone(),o=!1,s=n.container;if(s.parentElement){for(var a=this._outlinedElement.parentElement;a&&a!==this._fullScreenElement;a=a.parentElement){e=a.getBoundingClientRect();var c=a.ownerDocument&&a.ownerDocument.defaultView;if(!c)return;var p=c.getComputedStyle(a);"absolute"===p.position&&(o=!0),o&&"hidden"!==p.overflow||(e.left>r.left&&(r.left=e.left),e.top>r.top&&(r.top=e.top),e.right<r.right&&(r.right=e.right),e.bottom<r.bottom&&(r.bottom=e.bottom))}var d=s.parentElement.clientWidth,f=s.parentElement.clientHeight,h=u.outlineWidth;r.left=r.left>h?r.left-h:0,r.top=r.top>h?r.top-h:0,r.right=r.right<d-h?r.right+h:d,r.bottom=r.bottom<f-h?r.bottom+h:f;var g=r.right-r.left,m=r.bottom-r.top;if(g>2*h&&m>2*h){var v=n.left,y=n.top,_=n.right,b=n.bottom,w=this._fullScreenElement?0:i.pageXOffset,C=this._fullScreenElement?0:i.pageYOffset;v.style.left=y.style.left=b.style.left=r.left+w+"px",_.style.left=r.left+w+g-h+"px",v.style.top=_.style.top=y.style.top=r.top+C+"px",b.style.top=r.top+C+m-h+"px",v.style.height=_.style.height=m+"px",y.style.width=b.style.width=g+"px",this._setOutlineVisibility(!0)}else this._setOutlineVisibility(!1)}}}}},e.prototype._getOutlineDOM=function(e){var t=e.ownerDocument,n=t&&t.defaultView;if(t&&n&&n.__abilityHelpers){if(n.__abilityHelpers.outlineStyle||(n.__abilityHelpers.outlineStyle=d(t,u)),!n.__abilityHelpers.outline){var i={container:t.createElement("div"),left:t.createElement("div"),top:t.createElement("div"),right:t.createElement("div"),bottom:t.createElement("div")};i.container.className=u.outlineClass,i.left.className=u.outlineClass+"__left",i.top.className=u.outlineClass+"__top",i.right.className=u.outlineClass+"__right",i.bottom.className=u.outlineClass+"__bottom",i.container.appendChild(i.left),i.container.appendChild(i.top),i.container.appendChild(i.right),i.container.appendChild(i.bottom),t.body.appendChild(i.container),n.__abilityHelpers.outline=i}return n.__abilityHelpers.outline}},e.prototype._removeOutlineDOM=function(e){var t=e.ownerDocument&&e.ownerDocument.defaultView,n=t&&t.__abilityHelpers,i=n&&n.outline;n&&(n.outlineStyle&&n.outlineStyle.parentNode&&(n.outlineStyle.parentNode.removeChild(n.outlineStyle),delete n.outlineStyle),i&&(i.container.parentNode&&i.container.parentNode.removeChild(i.container),delete n.outline))},e._isParentChild=function(e,t){return t===e||!!(e.compareDocumentPosition(t)&document.DOCUMENT_POSITION_CONTAINED_BY)},e}();function d(e,t){var n=e.createElement("style");return n.type="text/css",n.appendChild(e.createTextNode(function(e){return"\n        ."+e.areaClass+" *, ."+e.areaClass+" *:focus {\n            outline: none !important;\n        }\n\n        ."+e.outlineClass+" {\n            display: none;\n            position: absolute;\n            background: "+e.outlineColor+";\n            width: 0;\n            height: 0;\n            left: 0;\n            top: 0;\n            z-index: "+e.zIndex+";\n        }\n\n        ."+e.outlineClass+"."+e.outlineClass+"_visible {\n            display: block;\n        }\n\n        ."+e.outlineClass+"__left {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-top-left-radius: "+e.outlineWidth+"px;\n            border-bottom-left-radius: "+e.outlineWidth+"px;\n        }\n\n        ."+e.outlineClass+"__top {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-top-left-radius: "+e.outlineWidth+"px;\n            border-top-right-radius: "+e.outlineWidth+"px;\n        }\n\n        ."+e.outlineClass+"__right {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-top-right-radius: "+e.outlineWidth+"px;\n            border-bottom-right-radius: "+e.outlineWidth+"px;\n        }\n\n        ."+e.outlineClass+"__bottom {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-bottom-left-radius: "+e.outlineWidth+"px;\n            border-bottom-right-radius: "+e.outlineWidth+"px;\n        }"}(t))),e.head.appendChild(n),n}t.Outline=p,t.setupOutlineInIFrame=function(e,t){var n=[{type:a.EventFromIFrameDescriptorType.Window,name:"scroll",capture:!0}];r&&n.push({type:a.EventFromIFrameDescriptorType.Document,name:r,capture:!1}),a.setupIFrameToMainWindowEventsDispatcher(e,t,c,n);var i=t.defaultView;if(!i||!i.__abilityHelpers)throw new Error("Wrong document to set Outline up.");i.__abilityHelpers.outlineStyle||(i.__abilityHelpers.outlineStyle=d(t,u))}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),s=n(4),a=function(e){function t(t,n){var i=e.call(this)||this;return i._isTyping=!1,i._person=t,i._role=n&&n.role?n.role:s.ParticipantRole.User,i._capabilities=n&&n.capabilities?n.capabilities:[],i}return r(t,e),Object.defineProperty(t.prototype,"person",{get:function(){return this._person},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"role",{get:function(){return this._role},set:function(e){e!==this._role&&(this._role=e,this.publish("role",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capabilities",{get:function(){return this._capabilities},set:function(e){e!==this._capabilities&&(this._capabilities=e,this.publish("capabilities",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTyping",{get:function(){return this._isTyping},set:function(e){if(this._isTyping=e,this.publish("isTyping",e),this._typingIndicatorTimoutId&&clearTimeout(this._typingIndicatorTimoutId),e){var t=this;this._typingIndicatorTimoutId=setTimeout(function(){t.isTyping=!1,t._typingIndicatorTimoutId=void 0},5e3)}},enumerable:!0,configurable:!0}),t}(o.default);t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(0),a=n(8),c=n(37),u=n(74),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="",t}return r(t,e),t.prototype.render=function(){var e=s.swc.services.persons.getPerson(this.props.personId);return o.createElement(u.SwcPersonAvatar,{person:e,className:this.getComposedBlockClassName(),size:c.SwcAvatarSize.Medium,isPstn:this.props.isPstn,customAvatar:this.props.customAvatar,showPresence:this.props.showPresence,accessible:this.props.accessible})},t}(a.SwcBaseComponent);t.SwcPersonIdAvatar=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(0),a=n(73),c=n(8),u=n(14),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcAvatar",t}return r(t,e),t.prototype.getComposedBlockClassName=function(){var t=e.prototype.getComposedBlockClassName.call(this);return this.props.size&&(t+=" "+this.props.size),t},t.prototype.render=function(){var e={"background-color":a.getBackgroundColor(this.props.title)||"transparent"};return o.createElement("div",{className:this.getComposedBlockClassName(),style:e,"aria-hidden":!1===this.props.accessible?"true":void 0,"aria-label":s.swc.services.i18n.fetch("aria_avatar_label",{title:this.props.title})},o.createElement("span",{className:"swcAvatar__initials"},o.createElement(u.SwcIcon,{type:u.SwcIconType.Landline})))},t}(c.SwcBaseComponent);t.SwcPstnAvatar=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(81);!function(e){e[e.default=100]="default",e[e.extended=200]="extended"}(t.PAGE_SIZE||(t.PAGE_SIZE={})),t.SYNC_STATE_LINK_REGEX=/syncState=([^&]+)/;var o=function(){function e(){this.resetCallbacks=[],this.allConversations=[],this.syncState="",this.updateConsumptionHorizonToLastMessage=function(e){}}return e.prototype.subscribeConversation=function(e,t,n){return r.getPolling().subscribeConversation(e,t,n)},e.prototype.unsubscribeConversation=function(e){r.getPolling().unsubscribeConversation(e)},e.prototype.subscribeResource=function(e,t){return r.getPolling().subscribeResource(e,t)},e.prototype.unsubscribeResource=function(e){r.getPolling().unsubscribeResource(e)},e.prototype.startEndpointActivation=function(){r.startActivation()},e.prototype.stopEndpointActivation=function(){r.stopActivation()},e.prototype.addResetSubscriber=function(e){e&&this.resetCallbacks.push(e)},e.prototype.reset=function(){return this.allConversations=[],this.syncState="",this.resetCallbacks.forEach(function(e){e()}),i.swc.Telemetry.flushAll(),r.getPolling().reset().then(null,function(){})},e.prototype.getSyncState=function(e){if(!e||!t.SYNC_STATE_LINK_REGEX.test(e))return"";var n=e.match(t.SYNC_STATE_LINK_REGEX);return n?n[1]:""},e}();t.ConversationWebApi=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.TEXT=100]="TEXT",e[e.IMAGE=200]="IMAGE",e[e.FILE=300]="FILE",e[e.SWIFT=400]="SWIFT",e[e.TYPING=500]="TYPING",e[e.EMOTICON=600]="EMOTICON",e[e.QUICK_REPLY=700]="QUICK_REPLY",e[e.LIVE_STATE=9999999999]="LIVE_STATE"}(t.MessageType||(t.MessageType={}))},function(e,t,n){(function(t){var n=1/0,i="[object Symbol]",r=/[&<>"'`]/g,o=RegExp(r.source),s="object"==typeof t&&t&&t.Object===Object&&t,a="object"==typeof self&&self&&self.Object===Object&&self,c=s||a||Function("return this")();var u,l=(u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},function(e){return null==u?void 0:u[e]}),p=Object.prototype.toString,d=c.Symbol,f=d?d.prototype:void 0,h=f?f.toString:void 0;function g(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&p.call(e)==i}(e))return h?h.call(e):"";var t=e+"";return"0"==t&&1/e==-n?"-0":t}e.exports=function(e){var t;return(e=null==(t=e)?"":g(t))&&o.test(e)?e.replace(r,l):e}}).call(this,n(27))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Connecting="Skype_Call_Connecting.m4a",e.Dialing="Skype_Call_Dialing.m4a",e.Ended="Skype_Call_Ended.m4a",e.Reconnected="Skype_Call_Reconnected.m4a",e.Ringback="Skype_Call_Ringback.m4a",e.Ringing="Skype_Call_Ringing.m4a",e.Notification="Skype_Notification.m4a",e.Message_Received="Skype_Msg_Received.m4a"}(t.SupportedSounds||(t.SupportedSounds={}))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o=n(20),s=n(0),a=n(43),c=n(25);function u(){s.swc.Eventing.triggerLocalEvent("hideBubbleWindow")}!function(e){e.Info="info",e.List="list",e.ReactionPreview="reactionPreview",e.ReactionPane="reactionPane"}(i=t.BubbleType||(t.BubbleType={})),function(e){e.nextToElement="nextToElement",e.onContextMenu="onContextMenu"}(r=t.BubblePosition||(t.BubblePosition={}));var l=function(){function e(){}return e.add=function(t,n,a,c,l){void 0===l&&(l=r.nextToElement),e._clearTimeouts();for(var p=e.build(),d=c===i.Info,f=p.content;f.firstChild;)f.removeChild(f.firstChild);if(f.appendChild(a),p.container.className="swc-bubble "+c,p.arrow.style.display=d?"block":"none",l===r.nextToElement){var h,g=t.getBoundingClientRect(),m=n.getBoundingClientRect(),v=g.top-m.top,y=m.bottom-g.bottom,_=g.left-m.left,b=m.right-g.right,w=d?10:0,C=void 0,S=g.width/2;if(_<b)p.container.style.right="",(h=(C=g.left-m.left+S)-90)<0?(p.container.style.left=C-90-h+S+"px",p.arrow.style.left=90-S+h-8+"px"):(p.container.style.left=C-90+S+"px",p.arrow.style.left="82px");else p.container.style.left="",(h=(C=m.right-g.right+S)-90)<0?(p.container.style.right=C-90+S-h+"px",p.arrow.style.left=90+S-h-8+"px"):(p.container.style.right=C-90+S+"px",p.arrow.style.left="82px");v>y?(p.container.style.top="",p.container.style.bottom=m.bottom-g.top+w+"px",p.arrow.style.top="",p.arrow.style.bottom="-10px",p.arrow.style.borderBottom="",p.arrow.style.borderTop="10px solid #d8d8d8",p.arrowInner.style.bottom="2px",p.arrowInner.style.borderBottom="",p.arrowInner.style.borderTop="9px solid #fdc856"):(p.container.style.bottom="",p.container.style.top=g.bottom-m.top+w+"px",p.arrow.style.bottom="",p.arrow.style.top="-10px",p.arrow.style.borderTop="",p.arrow.style.borderBottom="10px solid #d8d8d8",p.arrow.style.top="-10px",p.arrowInner.style.top="2px",p.arrowInner.style.borderTop="",p.arrowInner.style.borderBottom="9px solid #fdc856"),n.appendChild(p.container)}else{var T=t,E=T.target,P={x:T.clientX,y:T.clientY},I=n.getBoundingClientRect(),k=n.parentElement?n.parentElement.getBoundingClientRect():null;if(!t||!E)return;var M=P.y-k.top,O=k.bottom-P.y,A=P.x-I.left,x=I.right-P.x;p.container.style.display="none",n.appendChild(p.container),e._positionTimer=window.setTimeout(function(){e._positionTimer=void 0,p.container.style.display="";var t=p.container.offsetWidth,n=p.container.offsetHeight,i=x>t?A:A-t,r=O>n?M+k.top-I.top:M+k.top-I.top-n;p.container.style.left=i+"px",p.container.style.right="",p.container.style.top=r+"px",p.container.style.bottom=""},0)}e._focusTimer=window.setTimeout(function(){var t;e._focusTimer=void 0,p.container&&p.container.parentElement&&(o.AbilityHelpers.modalityLayer.addLayer(p.container,"bubble",{accessibilityLabel:(t="context_menu",s.swc.services.i18n.fetch(t)),othersAccessible:!0,onFocusOut:function(){return u(),!0}}),o.AbilityHelpers.modalityLayer.focusLayer(p.container))},0),p.container.addEventListener("keydown",e._onKeyDown),n.addEventListener("click",u),s.swc.Eventing.registerEvent("hideBubbleWindow",e.remove)},e.remove=function(){if(e.instance&&e.instance.container){e._clearTimeouts();var t=e.instance.container.parentElement;t&&(o.AbilityHelpers.modalityLayer.removeLayer(e.instance.container),t.removeEventListener("click",u),e.instance.container.removeEventListener("keydown",e._onKeyDown),s.swc.Eventing.unregisterEvent("hideBubbleWindow",e.remove),t.removeChild(e.instance.container))}},e.build=function(){if(!e.instance){var t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div");n.className="swc-content",i.className="swc-arrow",r.className="swc-arrow-inner",i.appendChild(r),t.appendChild(i),t.appendChild(n),e.instance={container:t,content:n,arrow:i,arrowInner:r}}return e.instance},e._clearTimeouts=function(){e._positionTimer&&(window.clearTimeout(e._positionTimer),e._positionTimer=void 0),e._focusTimer&&(window.clearTimeout(e._focusTimer),e._focusTimer=void 0)},e._onKeyDown=function(e){e.stopPropagation(),a.default.getKeyCode(e)===c.default.ESCAPE&&u()},e}();t.default=l},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={allowedProtocols:["https:"]},r=function(){function e(){this.probe=document.createElement("a")}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},e.prototype.validate=function(e,t){if(!e)return!1;var n=Object.assign(i,t||{}),r=function(e,t){if(!t)return!0;for(var n,i=0,r=t;i<r.length;i++){if(n=r[i]===e)break}return n};this.probe.href=e;var o=r(this.probe.protocol,n.allowedProtocols)&&r(this.probe.hostname,n.allowedDomains)&&r(this.probe.port,n.allowedPorts);return this.probe.href="",o},e}();t.UrlValidator=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(191))},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(82)),i(n(110))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(134),o=function(){function e(e){void 0===e&&(e=[]),this._namespace=e}return e.prototype.createChild=function(t,n){return new e(this._namespace.concat(["string"==typeof t?function(){return t}:t]))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.reportError("warn",e),e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.reportError("error",e),e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},Object.defineProperty(e.prototype,"_prefix",{get:function(){return this._namespace.map(function(e){return e()}).join("/")},enumerable:!0,configurable:!0}),e.prototype.reportError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(t&&0!==t.length)try{i.swc.Telemetry.sendEvent.callingError(this._prefix,t.join("; "),e)}catch(e){}},e.prototype.reportEvent=function(e,t){var n=i.swc.Telemetry.getLogger("trouter"),o=r.createTrouterEvent(e,t);n.logEvent(o)},e}();t.LocalCallingLogger=o},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(18);t.createTrouterEvent=function(e,t){return{name:e,properties:i({},t,{AppInfo_Version:r.Configuration.getUiVersion(),"DeviceInfo.BrowserName":o.default.getBrowserName(),"DeviceInfo.BrowserVersion":o.default.getBrowserVersion(),"DeviceInfo.OsName":o.default.getOsName(),"DeviceInfo.OsVersion":o.default.getOsVersion(),"DeviceInfo.Id":o.default.getDeviceId().replace(/-/g,""),ua:"SWC"})}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),a=n(0),c=n(13),u=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="emoticon",n._id=c.guid.generate(),n.state=o({isAnimated:!1,textOnly:!1},n._getNewState(t)),t.setUpdateCallback&&t.setUpdateCallback(function(e){n.setState(function(){return n._getNewState(e)})}),n}return r(t,e),t.prototype._getNewState=function(e){var t=a.swc.services.pesManager.emoticonMap,n=e.emoticonId||this.props.emoticonId,i=e.textContent||this.props.textContent,r=e.title||this.props.title;if(!n||!t.hasOwnProperty(n))return{textOnly:!0,textContent:i};var o={textOnly:!1,textContent:i,title:r,emoticonId:n};return!0===e.isAnimated?o.isAnimated=!0:!1===e.isAnimated&&(o.isAnimated=!1),o},t.prototype.componentDidMount=function(){var e=this;this.setState(function(t,n){return e._getNewState(n)})},t.prototype.componentWillReceiveProps=function(e){var t=this;this.setState(function(n,i){return t._getNewState(e)})},t.prototype.getComposedBlockClassName=function(){var t=e.prototype.getComposedBlockClassName.call(this);return this.props.large&&(t+=" "+this.props.largeEmoticonClass),t},t.prototype.render=function(){if(this.state.textOnly)return s.createElement("span",null,this.state.textContent);var e={"data-item-id":this.state.emoticonId,"data-is-animated":this.state.isAnimated,textContent:this.state.textContent,title:this.state.title};return this.props.large&&["emoticon"].push(this.props.largeEmoticonClass),s.createElement("span",{className:this.getComposedBlockClassName()},s.createElement("canvas",o({},e,{id:this._id}),this.state.textContent))},t}(n(8).SwcBaseComponent);t.SwcEmoticon=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(160),r=n(100),o=n(4),s=n(0),a=n(101),c="https://www.skype.com/",u="width=600, height=620, menubar=no, status=no, titlebar=no, toolbar=no, rel=noopener noreferrer",l=function(){function e(e,t,n){var l=this;switch(this.type=o.SwiftCardActionType.unknown,this.actions={},this.isValid=function(){return!!l.title||!!l.value||!!l.fallbackUri},this.isDisabled=function(){return!1},this.isSupported=function(){return null!==l.type&&l.type!==o.SwiftCardActionType.unknown},this.action=function(){return l.isValid()?l.actions[o.SwiftCardActionType[l.type]]().then(function(){}).catch(function(){}):Promise.resolve()},this.openUrl=function(){return l.value.match(/^skype:\?payments/)||l.value.match(/^skype:/),window.open(l.value,"_blank").opener=null,Promise.resolve()},this.imBack=function(){return l.conversation.sendSwift({title:l.title,value:l.value}).then(function(){return Promise.resolve()}).catch(function(){})},this.showImage=function(){var e=l.value||"";return l.conversation.sendMessage(e,r.ActionTrigger.SUGGESTED_ACTION),Promise.resolve()},this.postBack=function(){return l.conversation.sendSwift({title:l.title,value:l.value,image:l.image}),Promise.resolve()},this.payment=function(){var e=l.fallbackUri?l.fallbackUri:l.value;if(e){var t=window.open(e,"_blank",u);return t&&window.focus&&t.focus(),t.opener=null,Promise.resolve()}},this.convertToActionType=function(e){if(!e)return null;try{switch(e.toLowerCase()){case"unsupported":return o.SwiftCardActionType.unsupported;case"openurl":return o.SwiftCardActionType.openUrl;case"imback":return o.SwiftCardActionType.imBack;case"signin":return o.SwiftCardActionType.signin;case"call":return o.SwiftCardActionType.call;case"showimage":return o.SwiftCardActionType.showImage;case"payment":case"anypayment":return o.SwiftCardActionType.payment;case"postback":return o.SwiftCardActionType.postBack;default:return o.SwiftCardActionType.unknown}}catch(e){return o.SwiftCardActionType.unknown}},this.type=this.convertToActionType(e.type),this.isCallActionType=this.type===o.SwiftCardActionType.call,this.title=a.default.normalizeText(e.title),this.value=e.value?a.default.normalizeUrl(e.value):null,this.senderId=n,this.tooltip=this.title,this.image=e.image?e.image:null,this.fallbackUri=e.fallback&&e.fallback.uri?a.default.normalizeUrl(e.fallback.uri):null,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.call]]=this.call,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.imBack]]=this.imBack,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.postBack]]=this.postBack,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.openUrl]]=this.openUrl,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.showImage]]=this.showImage,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.signin]]=this.openUrl,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.payment]]=this.payment,this.type){case o.SwiftCardActionType.call:this.value=a.default.normalizeDestination(this.value);break;case o.SwiftCardActionType.imBack:if(t.isGroup){var p=this.value,d=n.substring(3),f=function(){var e=new i.MentionDomEncoder,n=e.getMentionUserData(d,t);if(n){var r=e.createXmlElement(document,n).outerHTML;l.value=r+" "+p}};t.participants.filter(function(e){return e.person.id.toLowerCase()===d}).forEach(function(e){e.person.subscribe("displayName",f)}),f()}break;case o.SwiftCardActionType.showImage:this.value&&(this.value=a.default.normalizeUrl(e.value)),this.title||(this.title=s.swc.services.i18n.fetch("s_showImageTitle"));break;case o.SwiftCardActionType.payment:this.value&&(this.value.match(/^skype:\?payments/)?this.value=a.default.normalizeDestination(this.value):this.value=a.default.normalizeUrl(e.value));break;case o.SwiftCardActionType.openUrl:this.value&&(this.value.match(/^skype:/)?this.value=a.default.normalizeDestination(this.value):this.value=a.default.normalizeUrl(e.value),this.tooltip?this.tooltip+="\n\n"+this.value:this.tooltip=this.value);break;case o.SwiftCardActionType.signin:this.value=a.default.normalizeUrl(e.value),this.title||(this.title=s.swc.services.i18n.fetch("s_signInTitle"));break;case o.SwiftCardActionType.unsupported:this.type=o.SwiftCardActionType.openUrl,this.title||(this.title=s.swc.services.i18n.fetch("s_unsupported_button")),this.value||(this.value=c);break;case o.SwiftCardActionType.postBack:this.title=a.default.normalizeText(this.title),this.value=a.default.normalizeText(this.value),this.tooltip||(this.tooltip=this.title)}this.conversation=t}return e.prototype.call=function(){return Promise.reject("Calling is not supported")},e}();t.default=l},,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(60),c=n(14),u=n(8);!function(e){e.Wide="swcMenuList_wide"}(t.SwcMenuListSize||(t.SwcMenuListSize={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcMenuList",t._disableContextMenu=function(e){e.preventDefault(),e.stopPropagation()},t._onItemClick=function(e,t){e.action&&e.action(e,t)},t}return r(t,e),t.prototype.getComposedBlockClassName=function(){var t=e.prototype.getComposedBlockClassName.call(this);return this.props.size&&(t+=" "+this.props.size),t},t.prototype.render=function(){var e=this,t="swcMenuList__item  "+(this.props.itemClassName||"");return s.createElement(a.AccessibleList,null,s.createElement("div",{onContextMenu:this._disableContextMenu},this.props.groups.map(function(n){return s.createElement("ul",{key:n.id,className:e.getComposedBlockClassName()+" "+(n.className||"")},n.items.map(function(n){return s.createElement(a.AccessibleListItem,{key:n.title},s.createElement("li",{tabIndex:n.disabled?void 0:0,key:n.title,"aria-label":n.title,title:n.title,onClick:o.linkEvent(n,e._onItemClick),className:t+" "+n.className},n.title,n.innerElement,n.selected&&s.createElement(c.SwcIcon,{type:c.SwcIconType.Ok})))}))})))},t}(u.SwcBaseComponent);t.SwcMenuList=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(3),s=n(1),a=n(138),c=n(21),u=function(){function e(){}return e.createMenuItem=function(e){return{title:e.title,group:e.itemLevel||1,action:e.action,selected:e.selected,className:e.className||"",innerElement:e.innerElement,disabled:e.disabled}},e.getFeedbackUri=function(){var e={p:s.Configuration.getPlatformId(),v:s.Configuration.ECS.version,lang:o.default.get.getCurrentLocale()||"",e:s.Configuration.getPlatformName()};return o.default.get.correlationId&&(e.tcg=o.default.get.correlationId),c.UrlHelper.setQueryParameters("https://go.skype.com/feedback.sor",e)},e.createMenuList=function(e,t,n){var o=document.createDocumentFragment(),s=r.createElement(a.SwcMenuList,{groups:e,className:t,size:n});return i.render(s,o),o},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),r=function(){function e(){}return e.addStyle=function(e,t){if(!(t=t||i.default.getDocument()).head||function(e,t){for(var n=0;n<document.styleSheets.length;n++)if(document.styleSheets[n].href===e)return!0;return!1}(e))return Promise.resolve();var n=t.createElement("link");return n.type="text/css",n.rel="stylesheet",n.href=e,new Promise(function(e,i){n.onload=function(){return e()},n.onerror=function(){return i()},t.head.appendChild(n)})},e}();t.StyleLoader=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ME="ME",function(e){e.Bridged="bridged",e.Unbridged="unbridged"}(t.DeliveryMode||(t.DeliveryMode={})),function(e){e[e.CONFIRMED=0]="CONFIRMED",e[e.CANCELED=1]="CANCELED"}(t.DialogResult||(t.DialogResult={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=[{language:"ar",defaultLocale:"ar-sa"},{language:"bg",defaultLocale:"bg-bg"},{language:"ca",defaultLocale:"ca-es"},{language:"cs",defaultLocale:"cs-cz"},{language:"cy",defaultLocale:"cy-gb"},{language:"da",defaultLocale:"da-dk"},{language:"de",defaultLocale:"de-de"},{language:"el",defaultLocale:"el-gr"},{language:"en-ca",defaultLocale:"en-gb"},{language:"en-au",defaultLocale:"en-gb"},{language:"en-in",defaultLocale:"en-gb"},{language:"en-hk",defaultLocale:"en-gb"},{language:"en-ie",defaultLocale:"en-gb"},{language:"en-pk",defaultLocale:"en-gb"},{language:"en-sg",defaultLocale:"en-gb"},{language:"en-gb",defaultLocale:"en-gb"},{language:"en",defaultLocale:"en-us"},{language:"es-ar",defaultLocale:"es-mx"},{language:"es-uy",defaultLocale:"es-mx"},{language:"es-py",defaultLocale:"es-mx"},{language:"es-co",defaultLocale:"es-mx"},{language:"es-cl",defaultLocale:"es-mx"},{language:"es-pe",defaultLocale:"es-mx"},{language:"es-ec",defaultLocale:"es-mx"},{language:"es-ve",defaultLocale:"es-mx"},{language:"es-cr",defaultLocale:"es-mx"},{language:"es-do",defaultLocale:"es-mx"},{language:"es-pa",defaultLocale:"es-mx"},{language:"es-gt",defaultLocale:"es-mx"},{language:"es-bo",defaultLocale:"es-mx"},{language:"es-ev",defaultLocale:"es-mx"},{language:"es-hn",defaultLocale:"es-mx"},{language:"es-ni",defaultLocale:"es-mx"},{language:"es-pu",defaultLocale:"es-mx"},{language:"es-br",defaultLocale:"es-mx"},{language:"es-419",defaultLocale:"es-mx"},{language:"es-us",defaultLocale:"es-us"},{language:"es",defaultLocale:"es-es"},{language:"et",defaultLocale:"et-ee"},{language:"eu",defaultLocale:"eu-es"},{language:"gl",defaultLocale:"gl-es"},{language:"fi",defaultLocale:"fi-fi"},{language:"fr-ca",defaultLocale:"fr-ca"},{language:"fr",defaultLocale:"fr-fr"},{language:"iw",defaultLocale:"he-il"},{language:"he",defaultLocale:"he-il"},{language:"hi",defaultLocale:"hi-in"},{language:"hr",defaultLocale:"hr-hr"},{language:"hu",defaultLocale:"hu-hu"},{language:"in",defaultLocale:"id-id"},{language:"id",defaultLocale:"id-id"},{language:"it",defaultLocale:"it-it"},{language:"ja",defaultLocale:"ja-jp"},{language:"kk",defaultLocale:"kk-kz"},{language:"ko",defaultLocale:"ko-kr"},{language:"lt",defaultLocale:"lt-lt"},{language:"lv",defaultLocale:"lv-lv"},{language:"ms",defaultLocale:"ms-my"},{language:"no",defaultLocale:"nb-no"},{language:"nb",defaultLocale:"nb-no"},{language:"nn",defaultLocale:"nn-no"},{language:"nl",defaultLocale:"nl-nl"},{language:"pl",defaultLocale:"pl-pl"},{language:"pt-pt",defaultLocale:"pt-pt"},{language:"pt-br",defaultLocale:"pt-br"},{language:"pt",defaultLocale:"pt-br"},{language:"ro",defaultLocale:"ro-ro"},{language:"ru",defaultLocale:"ru-ru"},{language:"sk",defaultLocale:"sk-sk"},{language:"sl",defaultLocale:"sl-si"},{language:"sr",defaultLocale:"sr-latn-rs"},{language:"sr-cyrl",defaultLocale:"sr-cyrl-rs"},{language:"sr-latn",defaultLocale:"sr-latn-rs"},{language:"sv",defaultLocale:"sv-se"},{language:"th",defaultLocale:"th-th"},{language:"tr",defaultLocale:"tr-tr"},{language:"uk",defaultLocale:"uk-ua"},{language:"vi",defaultLocale:"vi-vn"},{language:"zh",defaultLocale:"zh-cn"},{language:"zh-tw",defaultLocale:"zh-tw"},{language:"zh-hant",defaultLocale:"zh-tw"},{language:"zh-cht",defaultLocale:"zh-tw"},{language:"zh-hk",defaultLocale:"zh-hk"},{language:"zh-mo",defaultLocale:"zh-tw"}],r=[{locale:"am-et",pesLocale:"am"},{locale:"ar-sa",pesLocale:"ar"},{locale:"az-latn-az",pesLocale:"az"},{locale:"be-by",pesLocale:"be-BY"},{locale:"bg-bg",pesLocale:"bg"},{locale:"bn-bd",pesLocale:"bn"},{locale:"bn-in",pesLocale:"bn"},{locale:"bs-latn-ba",pesLocale:"bs-Latn-BA"},{locale:"ca-es",pesLocale:"ca"},{locale:"ca-es-valencia",pesLocale:"ca"},{locale:"cs-cz",pesLocale:"cs"},{locale:"cy-gb",pesLocale:"cy-GB"},{locale:"da-dk",pesLocale:"da"},{locale:"de-de",pesLocale:"de"},{locale:"el-gr",pesLocale:"el"},{locale:"en-gb",pesLocale:"en"},{locale:"en-us",pesLocale:"en"},{locale:"es-es",pesLocale:"es"},{locale:"et-ee",pesLocale:"et"},{locale:"eu-es",pesLocale:"eu"},{locale:"fa-ir",pesLocale:"fa"},{locale:"fi-fl",pesLocale:"fi"},{locale:"fil-ph",pesLocale:"fil_PH"},{locale:"fr-fr",pesLocale:"fr"},{locale:"gd-gb",pesLocale:"gd-GB"},{locale:"gl-es",pesLocale:"gl"},{locale:"gu-in",pesLocale:"gu-IN"},{locale:"he-il",pesLocale:"he"},{locale:"hi-in",pesLocale:"hi"},{locale:"hr-hr",pesLocale:"hr"},{locale:"hu-hu",pesLocale:"hu"},{locale:"id-id",pesLocale:"id"},{locale:"is-is",pesLocale:"is"},{locale:"it-it",pesLocale:"it"},{locale:"ja-jp",pesLocale:"ja"},{locale:"ka-ge",pesLocale:"ka-GE"},{locale:"kk-kz",pesLocale:"kk"},{locale:"kn-in",pesLocale:"kn"},{locale:"ko-kr",pesLocale:"ko"},{locale:"ku-arab-iq",pesLocale:"ku-Arab-IQ"},{locale:"lb-lu",pesLocale:"lb-LU"},{locale:"lt-lt",pesLocale:"lt"},{locale:"lv-lv",pesLocale:"lv"},{locale:"mk-mk",pesLocale:"mk"},{locale:"ml-in",pesLocale:"ml"},{locale:"mr-in",pesLocale:"mr-IN"},{locale:"ms-my",pesLocale:"ms"},{locale:"nb-no",pesLocale:"no"},{locale:"nl-nl",pesLocale:"nl"},{locale:"nn-no",pesLocale:"no"},{locale:"or-in",pesLocale:"or-IN"},{locale:"pl-pl",pesLocale:"pl"},{locale:"pt-pt",pesLocale:"pt-PT"},{locale:"pt-br",pesLocale:"pt-BR"},{locale:"ro-ro",pesLocale:"ro"},{locale:"ru-ru",pesLocale:"ru"},{locale:"sk-sk",pesLocale:"sk"},{locale:"sl-sl",pesLocale:"sl"},{locale:"sq-al",pesLocale:"sq"},{locale:"sr-cyrl-ba",pesLocale:"sr"},{locale:"sr-cyrl-rs",pesLocale:"sr"},{locale:"sr-latn-rs",pesLocale:"sr"},{locale:"sv-se",pesLocale:"sv"},{locale:"sw-ke",pesLocale:"sw"},{locale:"ta-in",pesLocale:"ta"},{locale:"te-in",pesLocale:"te"},{locale:"th-th",pesLocale:"th"},{locale:"tr-tr",pesLocale:"tr"},{locale:"uk-ua",pesLocale:"uk"},{locale:"ur-pk",pesLocale:"ur-PK"},{locale:"uz-latn-uz",pesLocale:"uz"},{locale:"vi-vn",pesLocale:"vi"},{locale:"zh-cn",pesLocale:"zh_Hans"},{locale:"zh-tw",pesLocale:"zh_Hant"}],o=function(){function e(){}return e.prototype.getLocale=function(e){var t=this.getMappingByLanguage(e);if(t)return t.defaultLocale;var n=e.lastIndexOf("-");return n>-1?this.getLocale(e.substring(0,n)):e},e.prototype.getPesLocale=function(e){var t,n;return e?(t=this.getPESMapping(e))&&t.pesLocale?t.pesLocale:(n=this.getLocale(e))!==e&&(t=this.getPESMapping(n))?t.pesLocale:"default":"default"},e.prototype.getPESMapping=function(e){for(var t=0;t<r.length;t++)if(r[t].locale.toLowerCase()===e.toLowerCase())return r[t];return null},e.prototype.getMappingByLanguage=function(e){for(var t=0;t<i.length;t++)if(i[t].language.toLowerCase()===e.toLowerCase())return i[t];return null},e}();t.default=new o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),s=n(58),a=n(0),c=function(e){function t(t){var n=e.call(this)||this;return n._amsService=t,n._authenticated=!1,n._cache={},n._uploads={},n}return r(t,e),t.prototype.isEnterpriseAmsUsed=function(){return!1},t.prototype.downloadFileByDocumentId=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadFile(e)})},t.prototype.downloadRawFile=function(e){return Promise.reject("Not supported")},t.prototype.authenticate=function(){return this._authenticated?Promise.resolve():(this._authenticated=!0,this._amsService.authenticate())},t.prototype.sendFile=function(e,t){var n=this,i=Date.now().toString();this._uploads[i]=s.DocumentStatus.InProgress;var r=this.createAmsDocument(e,t),o=r.then(function(e){return{documentId:e.id}}),a=r.then(function(i){return n.uploadFileContent(e,i.id,t)}).catch(function(){n._uploads[i]=s.DocumentStatus.Failed});return e.sendFile({file:t,clientMessageId:i,uploadPromise:a,registerPromise:o})},t.prototype.createAmsDocument=function(e,t){var n=this;return this.authenticate().then(function(){return n._amsService.createNewDocument(e.id,t)})},t.prototype.retryFileUpload=function(e,t){var n=this._cache[t];return n?this.uploadFileContent(e,t,n):Promise.reject(null)},t.prototype.uploadFileContent=function(e,t,n){var i=this,r=Date.now();return this._cache[t]=n,this._amsService.sendFile(t,n).then(function(o){return delete i._cache[t],a.swc.Telemetry.sendEvent.fileUpload(n,Date.now()-r,o.status,e),o})},t.prototype.getFileStatus=function(e,t){var n=this._uploads[e];return n?Promise.resolve({uploadStatus:n}):this._amsService.getFileStatus(e,t)},t.prototype.downloadPictureThumbnail=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadPictureThumbnail(e)})},t.prototype.getPictureThumbnail=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.getPictureThumbnail(e)})},t.prototype.downloadPicture=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadPicture(e)})},t.prototype.getCallRecordingThumbnail=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.getCallRecordingThumbnail(e)})},t.prototype.downloadCallRecording=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadCallRecording(e)})},t.prototype.dispose=function(){this._authenticated=!1,this._cache=null},t}(o.default);t.SkypeAmsManager=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(18),o=function(){function e(){}return e.prototype.getCommonCapabilities=function(e){var t=e.CanUploadFile,n=e.DisableSendingEmoticons,o=r.default.testSupporedList(i.Configuration.ECS.callingSupportedBrowsers)&&e.EnableCalling;return Promise.resolve({allowEditMessage:!0,allowDeleteMessage:!0,allowChat:!0,allowUploadFiles:t,allowSendEmoticons:!n&&i.Configuration.ECS.expressionPickerEnabled,allowCalling:o})},e.prototype.getCapabilitiesForConversation=function(e){return this.getCommonCapabilities(e.definition).then(function(t){var n=e.isWithMe(),i=e.isChatEnabled,r=e.isUnderQuarantine,o=!n&&i&&!r,s=t.allowCalling&&!n;return{allowEditMessage:o&&t.allowEditMessage,allowDeleteMessage:o&&t.allowDeleteMessage,allowChat:o&&t.allowChat,allowUploadFiles:o&&t.allowUploadFiles,allowSendEmoticons:t.allowSendEmoticons,allowCalling:s}})},e}();t.SkypeCapabilitiesService=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(1),a=n(11),c=n(15),u=n(7),l=n(9),p=n(4),d=n(5),f=n(91),h=n(123),g=n(49),m=n(31),v={"8:echo123":!0},y=["Online","Busy","Away","Hidden"],_=function(){return f.getPolling()},b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._createConsumptionHorizon=function(e){var t=e.skypeeditedid||e.clientmessageid||e.id||"0";return new Date(e.originalarrivaltime).getTime()+";"+(new Date).getTime()+";"+t},t._createConsumptionHorizonFromProcessedMessage=function(e){var t=e.skypeEditedId||e.clientMessageId||e.id||"0";return e.originalTimestamp.getTime()+";"+(new Date).getTime()+";"+t},t.updateConsumptionHorizonToLastMessage=function(e){if(null!==e.lastMessage){var n=t._createConsumptionHorizonFromProcessedMessage(e.lastMessage);o.default.get.isTeams()&&e.isUnreadBookmark?t.updateConsumptionHorizonBookmark(e.id,n).then(function(){e.updateConsumptionHorizon(n)}):t.updateConsumptionHorizon(e.id,n).then(function(){e.updateConsumptionHorizon(n)})}},t.markAllConversationsAsRead=function(){var e=t.recents();Object.keys(e).forEach(function(n){e[n].isUnread&&t.updateConsumptionHorizonToLastMessage(e[n])})},t.markConversationAsUnread=function(e,n){var i=function(n){var i=t._createConsumptionHorizon(n);t.updateConsumptionHorizon(e,i)};n?i(n):t.fetchMessages(e).then(function(e){var t=e.messages;if(!(t.length<=1)){var n=t.filter(function(e){return m.normalizePersonId(l.MessageUtils.getSenderIdFromUrl(e.from))!==d.ServicesManager.signInManager.currentUserName}).sort(function(e,t){return t.originalarrivaltime>e.originalarrivaltime?-1:1});i(n[n.length-2])}})},t.markConversationAsRead=function(e){t.updateConsumptionHorizonToLastMessage(t.recents()[e])},t.fetchMessagesByLink=function(e){return e=e.substring(e.indexOf("users/ME/conversations/")),_().authorization.then(function(){return g.get("fetchMessagesByLink",e).then(function(e){return g.parseJson(e)})},console.warn)},t.sendDataToBot=function(e,t){var n="agents/"+e+"/invoke";return g.post("invoke",n,{body:JSON.stringify(t)}).then(function(e){return g.parseJson(e).then(void 0,console.warn).catch(function(e){})})},t.getMyPresence=function(){return _().authorization.then(function(){return g.get("getPresence","users/ME/presenceDocs/messagingService?view=expanded").then(function(e){return e.ok||e.json?e.json():null})})},t}return r(t,e),t.prototype.recents=function(){return d.ServicesManager.conversations.getAll()},t.prototype.prefetchRecents=function(e,t){return this._prefetchPromise||(this._prefetchPromise=this.fetchRecentConversations(e,t)),this._prefetchPromise},t.prototype.fetchRecentConversations=function(e,t){var n=this;if(this._prefetchPromise){var i=this._prefetchPromise;if(this._prefetchPromise=void 0,t<=h.PAGE_SIZE.default)return i}if((this._fetchRecentsPromise?this._fetchRecentsPromise.status:void 0)===a.PromiseStatus.Pending)return this._fetchRecentsPromise.promise;var r;return this._fetchRecentsPromise&&this._fetchRecentsPromise.status===a.PromiseStatus.Pending||(this._fetchRecentsPromise=new a.CancelablePromise),r=e,_().authorization.then(function(){var e={pageSize:t,view:"supportsExtendedHistory|msnp24Equivalent"};r&&!n.syncState&&Object.assign(e,{startTime:r}),n.syncState?Object.assign(e,{syncState:n.syncState}):Object.assign(e,{targetType:"All|InviteFree|Agent"});var i=g.addGetParamsToUrl("users/ME/conversations",e);g.get("fetchRecents",i).then(function(e){e.ok?n._fetchRecentsPromise.isCanceled||g.parseJson(e).then(function(e){n.syncState=n.getSyncState(e._metadata.syncState);var t=e.conversations.filter(function(e){return e.id.lastIndexOf("48:",0)});n.allConversations=n.allConversations.concat(t),n._fetchRecentsPromise.resolve({conversations:n.allConversations,hasMoreConversations:!!e._metadata.backwardLink})}).catch(function(t){u.default.throwError(111,"fetchRecentConversations::getConversationsPage unable to parse response",t),n._fetchRecentsPromise.cancel(e,n.allConversations)}):n._fetchRecentsPromise.cancel(e,n.allConversations)},function(e){n._fetchRecentsPromise.cancel(e,n.allConversations)})}),this._fetchRecentsPromise.promise},t.prototype.fetchMeProperties=function(){return _().authorization.then(function(){return g.get("fetchMeProperties","users/ME/properties",null,!1,!0).then(function(e){return g.parseJson(e)})})},t.prototype.setMeProperty=function(e,t){var n="users/ME/properties?name="+e,i={};return i[e]=t,_().authorization.then(function(){return g.put("setMeProperty",n,{body:JSON.stringify(i)},!1,!0).then(function(e){})})},t.prototype.fetchMeProperty=function(e){var t="users/ME/properties?name="+e;return _().authorization.then(function(){return g.get("setMeProperty",t,null,!1,!0).then(function(t){return g.parseJson(t).then(function(t){return t[e]||void 0})})})},t.prototype.fetchMessages=function(e,t,n){void 0===t&&(t=20),void 0===n&&(n=0);var i={pageSize:t,view:"supportsExtendedHistory|msnp24Equivalent|supportsMessageProperties",startTime:n},r=g.addGetParamsToUrl("users/ME/conversations/"+e+"/messages",i);return _().authorization.then(function(){return g.get("fetchMessages",r).then(function(e){return g.parseJson(e).then(function(e){return e})})})},t.prototype.fetchConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e,{view:"msnp24Equivalent",targetType:"All"});return g.get("fetchConversation",t).then(function(e){return g.parseJson(e).catch(function(e){return e})})},t.prototype.deleteConversation=function(e){var t="users/ME/conversations/"+e+"/messages";return g.del("deleteConversation",t)},t.prototype.sendMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages";return _().authorization.then(function(){return g.post("sendMessage",n,{body:JSON.stringify(t)})}).then(function(e){return g.parseJson(e)})},t.prototype.editMessage=function(e,t,n,i){var r="users/ME/conversations/"+e+"/messages/"+t,o={messagetype:n,content:i};return g.put("edit",r,{body:JSON.stringify(o)})},t.prototype.deleteMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages/"+t;return g.del("deleteMessage",n)},t.prototype.enableJoining=function(e,t){void 0===t&&(t=!0);var n=g.addGetParamsToUrl("threads/"+e+"/properties",{name:"joiningenabled"}),i={body:JSON.stringify({joiningenabled:t})};return g.put("enableJoining",n,i)},t.prototype.discloseHistory=function(e,t){void 0===t&&(t=!0);var n=g.addGetParamsToUrl("threads/"+e+"/properties",{name:"historydisclosed"}),i={body:JSON.stringify({historydisclosed:t})};return g.put("historyDisclosed",n,i)},t.prototype.fetchThread=function(e){var t=g.addGetParamsToUrl("threads/"+e,{view:"msnp24Equivalent"});return g.get("fetchThread",t,null,!1,!0).then(function(e){return g.parseJson(e)})},t.prototype.createThread=function(e){var t={headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript"},body:JSON.stringify({members:e})};return g.post("thread","threads",t)},t.prototype.setConversationTopic=function(e,t){var n=g.addGetParamsToUrl("threads/"+e+"/properties",{name:"topic"});return _().authorization.then(function(){return g.put("setTopic",n,{body:JSON.stringify({topic:t})})})},t.prototype.muteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"alerts"});return _().authorization.then(function(){return g.put("muteConversation",t,{body:JSON.stringify({alerts:"false"})})})},t.prototype.unmuteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"alerts"});return _().authorization.then(function(){return g.put("unmuteConversation",t,{body:JSON.stringify({alerts:"true"})})})},t.prototype.setFavoriteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"favorite"});return this.setPinnedConversation(e),_().authorization.then(function(){return g.put("setFavoriteConversation",t,{body:JSON.stringify({favorite:"true"})})})},t.prototype.removeFavoriteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"favorite"});return this.removePinnedConversation(e),_().authorization.then(function(){return g.put("removeFavoriteConversation",t,{body:JSON.stringify({favorite:"false"})})})},t.prototype.setPinnedConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"pinned"});return _().authorization.then(function(){return g.put("setPinnedConversation",t,{body:JSON.stringify({pinned:"true"})})})},t.prototype.removePinnedConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"pinned"});return _().authorization.then(function(){return g.put("removePinnedConversation",t,{body:JSON.stringify({pinned:"false"})})})},t.prototype.addParticipant=function(e,t,n){var i="threads/"+e+"/members/"+t,r=n?"Admin":"User";return _().authorization.then(function(){return g.put("addParticipant",i,{body:JSON.stringify({role:r})})})},t.prototype.removeParticipant=function(e,t){var n="threads/"+e+"/members/"+t;return _().authorization.then(function(){return g.del("removeParticipant",n,{body:""})})},t.prototype.acceptConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"conversationstatus"});return g.put("acceptConversation",t,{body:JSON.stringify({conversationstatus:"Accepted"})})},t.prototype.setBlockedConversation=function(e,t){var n=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"conversationblocked"});return g.put("setBlockedConversation",n,{body:JSON.stringify({conversationblocked:t?"true":"false"})})},t.prototype.updateConsumptionHorizon=function(e,t){var n=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"consumptionhorizon"});return g.put("consumptionHorizon",n,{body:JSON.stringify({consumptionhorizon:t})})},t.prototype.updateConsumptionHorizonBookmark=function(e,t){var n=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"consumptionHorizonBookmark"});return g.put("consumptionHorizonBookmark",n,{body:JSON.stringify({consumptionHorizonBookmark:t})})},t.prototype.getUsersPresence=function(e){e.length>10&&e.splice(10);var t=g.addGetParamsToUrl("users/ME/contacts/ALL/presenceDocs/messagingService",{cMri:e});return _().authorization.then(function(){return g.get("getUsersPresence",t).then(function(e){return e.json().then(function(e){return e.Responses})})})},t.prototype.sendLocalSystemMessage=function(e,t,n){var i=new Date,r=m.getDomain()+"users/ME/conversations/"+e+"/messages/"+i.getTime(),o={id:i.getTime()+"",from:"",messagetype:p.MessageType.SystemMessage,originalarrivaltime:i.toISOString(),content:t};n&&(o.customType=n);var s={resource:o,resourceLink:r,resourceType:"NewMessage"};_().sendLocalMessage(s)},t.prototype.setMessageProperty=function(e,t,n,i){var r=this.messageProperties(e,t,n),a={};return o.default.get.backend===c.MessagingBackend.TEAMS&&n===s.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS&&"yes"===i.key&&(i.key="like"),a[n]=JSON.stringify(i),g.put(s.Configuration.CHAT_SERVICE_COMMANDS.SET_MESSAGE_PROPERTY,r,{body:JSON.stringify(a),headers:{"Content-Type":"application/json"}})},t.prototype.messageProperties=function(e,t,n){return"users/ME"+("/conversations"+("/"+e+"/messages")+("/"+t+"/properties"))+"?name="+n},t.prototype.removeMessageProperty=function(e,t,n,i){var r=this.messageProperties(e,t,n),a={};return o.default.get.backend===c.MessagingBackend.TEAMS&&n===s.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS&&"yes"===i.key&&(i.key="like"),a[n]=JSON.stringify(i),g.del(s.Configuration.CHAT_SERVICE_COMMANDS.REMOVE_MESSAGE_PROPERTY,r,{body:JSON.stringify(a),headers:{"Content-Type":"application/json"}})},t.prototype.subscribeContactPresence=function(e){var t=this;return s.Configuration.ECS.contactPresenceEnabled?(-1===e.indexOf("8:")&&(e="8:"+e),v[e]?Promise.resolve():_().authorization.then(function(){return _().subscribeContactPresence(e).then(function(){return t.getUsersPresence([e]).then(function(t){d.ServicesManager.persons.handlePresenceData(e,t[0].Payload)})})})):Promise.resolve()},t.prototype.unsubscribeContactPresence=function(e){return _().unsubscribeContactPresence(e)},t.prototype.setMyPresence=function(e){return y.some(function(t){return t===e})?_().authorization.then(function(){return g.put("setPresence","users/ME/presenceDocs/messagingService",{body:JSON.stringify({status:e})})}):Promise.reject("Unsupported presence")},t.prototype.setEndpointPresence=function(){return _().authorization.then(function(){return _().setEndpointPresence()})},t}(f.ConversationWebApi);t.ConversationConsumerWebApi=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(53),r=n(1),o=n(11),s=n(33),a=n(0),c=n(7),u=n(96),l=n(208),p=n(209),d=n(111),f=n(4),h=n(81),g=n(49),m=n(31);t.SET_ENDPOINT_PROPERTY="supportsMessageProperties";var v=5e3,y=3,_=1,b=2,w=2e3,C={get:function(e){if(e)try{var t=JSON.parse(a.swc.services.sessionStorage.getItem(s.SKYPE_ENDPOINT_KEY)||"");if(t&&t.validUntil>Date.now()&&e===t.username)return t.value}catch(e){}return""},set:function(e,t){var n={username:e,value:t,validUntil:Date.now()+6e5};a.swc.services.sessionStorage.setItem(s.SKYPE_ENDPOINT_KEY,JSON.stringify(n))},invalidate:function(){a.swc.services.sessionStorage.removeItem(s.SKYPE_ENDPOINT_KEY)}},S=function(){function e(){var n=this;this._handledConversations={},this._handledResourceTypes={},this._isPolling=!1,this._followedContacts={},this.reset=function(){return h.stopActivation(),n._waitingForRetry=!1,n._handledConversations={},n._handledResourceTypes={},n._followedContacts={},n._stopPolling(),n._authPromise.promise.then(null,function(){}).catch(),n._authPromise.cancel(),n._removeEndpoint()},this.subscribeConversation=function(e,t,i){return n._handledConversations[e]||(n._handledConversations[e]={eventHandler:t,backfillCallback:i}),n._endpointCreationPromise&&!n._endpointCreationPromise.isCanceled||n._startPollingSequence(),n._endpointCreationPromise.promise},this.unsubscribeConversation=function(e){n._handledConversations[e]&&delete n._handledConversations[e]},this.subscribeContactPresence=function(e){return n._followedContacts[e]?Promise.resolve():(n._followedContacts[e]=!0,!n._endpointCreationPromise||n._endpointCreationPromise.isCanceled?n._startPollingSequence():n._subscriptionId&&n._updateSubscription(),n._endpointCreationPromise.promise)},this.unsubscribeContactPresence=function(e){n._followedContacts[e]&&(delete n._followedContacts[e],n._endpointCreationPromise.status===o.PromiseStatus.Resolved&&n._updateSubscription())},this.subscribeResource=function(e,t){return n._handledResourceTypes[e]&&c.default.throwError(10004,"Resource with that name was already handled",e),n._handledResourceTypes[e]=t,Promise.resolve()},this.unsubscribeResource=function(e){n._handledResourceTypes[e]&&delete n._handledResourceTypes[e]},this.sendLocalMessage=function(e){var t={eventMessages:[e]};n._handlePollData(t)},this._poll=function(e){n._isPolling||(n._pollingRetryInterval&&n._pollingRetryInterval.reset(),n._pollingRetryInterval=new d.FixedTimeout(n._poll.bind(n,e),v),n._isPolling=!0,n._waitingForRetry=!1,n._pollingPromise=new o.CancelablePromise(g.post("polling","users/ME/endpoints/SELF/subscriptions/"+e+"/poll",{body:JSON.stringify({})})),n._pollingPromise.promise.then(function(t){n._isPolling=!1,t.ok||404===t.status?(n._pollingFailedCount=0,t.json().then(function(t){n._pollingPromise.isCanceled||(n._handlePollData(t),729===t.errorCode?(C.invalidate(),n._startPollingSequence()):450===t.errorCode?(n._subscribeToEndpoint(),n.triggerBackfilling()):n._endpointCreationPromise&&n._endpointCreationPromise.status===o.PromiseStatus.Resolved&&n._poll(e))}).catch(function(t){n._poll(e)})):n.retryPollingIfNeeded(t,e)},function(e){n._isPolling=!1,n.retryPollingIfNeeded()}))},this._handlePollData=function(e){if(e&&e.eventMessages){e.eventMessages.forEach(function(e){!function(e){var t=e.resourceType,i=n._handledResourceTypes[t];i&&i(m.getConversationIdFromUrl(e.resourceLink),e.resource)}(e),"NewMessage"===e.resourceType||"MessageUpdate"===e.resourceType||"ConversationUpdate"===e.resourceType?function(e){var t;t=e.resource&&e.resource.conversationid?e.resource.conversationid:e.resource.conversationLink?m.getConversationIdFromUrl(e.resource.conversationLink):m.getConversationIdFromUrl(e.resourceLink);var i=n._handledConversations[t];i||a.swc.services.conversations.get(t);var r=i&&i.eventHandler,o=e.resource,s=m.getConversationIdFromUrl(o.from),c=l.ThreadNotifications.instance;s&&!c.empty&&u.default.detectConversationType(s)===f.ConversationType.AGENT&&c.notify(u.default.getNormalizeId(s),t,o.content);if(r){if("ConversationUpdate"===e.resourceType){var p=e.resource;a.swc.services.conversations.get(p.id).update(p),a.swc.services.unreadCounterStore.update(p)}r(e.resourceType,o)}}(e):"UserPresence"===e.resourceType?function(e){var t=m.getConversationIdFromUrl(e.resourceLink);if(!t&&e.resource&&e.resource.selfLink&&(t=m.getConversationIdFromUrl(e.resource.selfLink)),t){var i=a.swc.services.mePerson.mri===t;(n._followedContacts[t]||i)&&a.swc.services.persons.handlePresenceData(t,e.resource)}}(e):"ThreadUpdate"===e.resourceType&&function(e){if("ThreadUpdate"===e.resourceType){var t=e.resource;a.swc.services.conversations.get(t.id).updateThread(t)}}(e)})}},this.retryPollingIfNeeded=function(e,t){if(!n._pollingPromise.isCanceled){if(n._pollingFailedCount>=y)return n._startPollingSequence(),void n.triggerBackfilling();n._pollingFailedCount++,e&&"Timeout"===e.statusText?n._poll(t):(n._pollingRetryInterval.start(),n.triggerBackfilling())}},this.triggerBackfilling=function(){for(var e in n._handledConversations){if(n._handledConversations.hasOwnProperty(e))n._handledConversations[e].backfillCallback()}},this._startPollingSequence=function(e){if(n._endpointCreationPromise&&n._endpointCreationPromise.status===o.PromiseStatus.Pending)return n._endpointCreationPromise.promise;if(n._isPolling)return Promise.resolve();if(n._waitingForRetry&&!e)return Promise.resolve();n._endpointRetryInterval.reset(),p.stop(),n._pollingFailedCount=0,n._pollingRetryInterval&&n._pollingRetryInterval.reset(),n._pollingRemoved=!1,n._authPromise.status!==o.PromiseStatus.Pending&&(n._authPromise=new o.CancelablePromise);return n._endpointCreationPromise=new o.CancelablePromise(n._createEndpoint().then(function(e){p.reset(),e.json().then(function(e){if(!n._endpointCreationPromise.isCanceled){if(!(e.subscriptions&&e.subscriptions.length>0))return n._subscribeToEndpoint();n._poll(e.subscriptions[0].id)}})},function(){n._endpointCreationPromise.isCanceled||(n._endpointFailedCount++,n._waitingForRetry=!0,n._endpointFailedCount>=_?(p.execute(n._startPollingSequence.bind(n,!0)),n._endpointFailedCount>=b&&a.swc.Eventing.triggerEvent("chatServiceUnavailable",null,!0)):n._endpointRetryInterval.start())})),n._endpointCreationPromise.promise},this._storeEpid=function(t){var n=(t=t||"").match(/endpoints\/(%7B[\da-z\-]+%7D)/),i=n&&n[1]||e._epid;i&&(e._epid=i,a.swc.services.sessionStorage.setItem(s.SKYPE_ENDPOINT_ID_KEY,e._epid))},this.onEndpointCreation=function(e){n._setEndpointProperty(t.SET_ENDPOINT_PROPERTY,!0),n.setEndpointPresence()},this._createEndpoint=function(){var e={endpointFeatures:"Agent,InviteFree,MessageProperties"},t=function(e){if(!e.ok)return Promise.reject("Failed to create endpoint");n._storeEpid(e.headers.get("location"));var t=n._authPromise.resolve.bind(n._authPromise);return setTimeout(t,1),a.swc.services.isActive()&&h.startActivation(),n.onEndpointCreation(e),a.swc.Eventing.triggerEvent("endpointRegistered",null,!0),e},i=a.swc.services.mePerson?a.swc.services.mePerson.id:"",o=C.get(i);if(o){return g.put("endpointCreation",o,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"}},!0,!0).then(function(e){return r.Configuration.CHAT_HOST_URL=m.parseChatServiceHostUrl(e.url),e}).then(t).catch(function(e){return C.invalidate(),n._createEndpoint()})}return g.post("endpointCreation","users/ME/endpoints",{body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(function(e){if(e.ok){var t=e.headers.get("location");C.set(i,t)}return e}).then(t)},this._requestSubscription=function(){var e={channeltype:"httpLongPoll",interestedResources:n._getInterestedResources()};return g.post("endpointSubscription","users/ME/endpoints/SELF/subscriptions",{body:JSON.stringify(e)})},this.setEndpointPresence=function(){var t={id:"messagingService",privateInfo:{epname:"skype"},epname:"skype",publicInfo:{capabilities:"video|audio",nodeInfo:"",skypeNameVersion:"skype.com",type:1},version:r.Configuration.getClientVersion(),selfLink:"uri",type:"EndpointPresenceDoc"};return g.put("setEndpointPresence","users/ME/endpoints/"+e._epid+"/presenceDocs/messagingService",{body:JSON.stringify(t)})},this.modifySubscription=function(){var e={interestedResources:n._getInterestedResources()};if(void 0===n._subscriptionId)return Promise.resolve();var t="users/ME/endpoints/SELF/subscriptions/"+n._subscriptionId+"?name=interestedResources",i=e.interestedResources.length;return g.put("endpointSubscription",t,{body:JSON.stringify(e)}).then(function(e){e&&!e.ok&&c.default.throwError(10005,"Unable to update subscription. Number of followed contacts: "+i,e)},function(e){c.default.throwError(10005,"Unable to update subscription. Number of followed contacts: "+i,e)})},e._epid=a.swc.services.sessionStorage.getItem(s.SKYPE_ENDPOINT_ID_KEY),this._authPromise=new o.CancelablePromise,this._endpointRetryInterval=new d.FixedTimeout(this._startPollingSequence.bind(this,!0),v),this._pollingFailedCount=0,this._endpointFailedCount=0,this._updateSubscription=i(this.modifySubscription.bind(this),w,{leading:!0}),l.ThreadNotifications.init()}return Object.defineProperty(e.prototype,"authorization",{get:function(){return this._startPollingSequence(),this._authPromise.promise},enumerable:!0,configurable:!0}),e.prototype._setEndpointProperty=function(e,n){var i={};return i[e]=n,g.put("endpointProperties","users/ME/endpoints/SELF/properties?name="+t.SET_ENDPOINT_PROPERTY,{body:JSON.stringify(i),headers:{"Content-Type":"application/json"}})},e.prototype._getInterestedResources=function(){var e=["/v1/users/ME/conversations/ALL/messages","/v1/users/ME/conversations/ALL/properties","/v1/threads/ALL"];return Object.getOwnPropertyNames(this._followedContacts).forEach(function(t){e.push("/v1/users/ME/contacts/"+t)}),e},e.prototype._subscribeToEndpoint=function(){var e=this;return this._requestSubscription().then(function(t){if(!e._endpointCreationPromise.isCanceled){var n=(t.headers.get("location")||"").match(/\/(\d+)$/);n?(e._subscriptionId=n[1],e._poll(n[1])):e._startPollingSequence()}},function(t){if(!t||!t.json)return e._waitingForRetry=!0,void e._endpointRetryInterval.start();t.json().then(function(t){!t||729!==t.errorCode&&201!==t.errorCode||(729===t.errorCode&&C.invalidate(),e._startPollingSequence())},function(){})})},e.prototype._removeEndpoint=function(){if(this._pollingRemoved)return Promise.resolve();function t(){g.reset(),e._epid=null}return this._pollingRemoved=!0,e._epid||(e._epid=a.swc.services.sessionStorage.getItem(s.SKYPE_ENDPOINT_ID_KEY)),e._epid?g.del("deleteEndpoint","users/ME/endpoints/"+e._epid).then(t,t):(g.reset(),Promise.resolve())},e.prototype._stopPolling=function(){this._endpointRetryInterval.reset(),this._pollingRetryInterval&&this._pollingRetryInterval.reset(),this._pollingFailedCount=0,this._endpointFailedCount=0,this._endpointCreationPromise&&this._endpointCreationPromise.cancel(),this._pollingPromise&&(this._pollingPromise.cancel(),this._isPolling=!1)},e}();t.Polling=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(214),r=n(10),o={retryCount:3,timeout:5e4,policy:""},s=function(){function e(e,t){this.serviceName=e,this.baseUrl=t,this.authentication=function(e){return Promise.resolve(e)}}return e.prototype.issueRequest=function(e,t,n){var s=this;void 0===t&&(t={}),void 0===n&&(n={});var a=i.buildUriFromTemplate(this.baseUrl,e,t);return n.headers=n.headers||{},n.headers["Content-Type"]="application/json",this.onBeforeRequest(n).then(function(t){return r.default(s.serviceName+"-"+e,o,a,t).then(function(e){return e.ok?e.json():Promise.reject(e)})})},e.prototype.onBeforeRequest=function(e){return this.authentication(e)},e.prototype.setAuthentication=function(e){this.authentication=e},e.prototype.post=function(e,t,n,i){return void 0===t&&(t={}),void 0===i&&(i={}),i.method="POST",i.body=JSON.stringify(n),this.issueRequest(e,t,i)},e.prototype.get=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n={}),n.method="GET",this.issueRequest(e,t,n)},e}();t.JsonClient=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(217),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n,o){var a;return a=o?o+t:i.Configuration.CONTACTS_HOST_URL+t,r.default("contacts-"+e,s,a,n)};t.get=function(e,t){return o.getHeaders().then(function(n){var i={method:"GET"};return i.headers=n,i.cache="no-cache",a(e,t,i).then(function(e){return e.json()})})},t.getRaw=function(e,t,n){return o.getHeaders().then(function(i){n&&Object.getOwnPropertyNames(n).forEach(function(e){i.append(e,n[e])});var r={method:"GET"};return r.headers=i,r.cache="no-cache",a(e,t,r)})},t.post=function(e,t,n,i){return o.getHeaders().then(function(r){r.append("Content-Type","application/json");var o={method:"POST"};return o.body=n,o.headers=r,a(e,t,o,i)})},t.put=function(e,t,n){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var r={method:"PUT"};return r.body=n,r.headers=i,a(e,t,r)})},t.deleteMethod=function(e,t){return o.getHeaders().then(function(n){var i={method:"DELETE"};return i.headers=n,a(e,t,i)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(19),s=n(11),a=n(0),c=n(7),u=n(219),l=n(5),p=n(220),d=n(148),f=n(150),h="X-Skype-Continuation-Token",g="If-None-Match",m="Etag",v=4e3,y=3;t.reasons={DEFAULT:"default",NOTIFICATION:"notification"};var _=function(){function e(){var e=this;this._contacts=[],this._groups=[],this._blocklist=[],this._pendingContactFetching={},this._haveAllContacts=!1,this._retryCount=0,this._retryTimeout=v,this._etagHeader="",this.fetchMyContacts=function(t,n){void 0===t&&(t=100);var i=Date.now(),r=0;if(e._fetchContactsPromise)return n&&n(e._contacts),e._fetchContactsPromise.promise;var o=new p.ContactsInfo,d=function(s,p){var f=function(g){if(r++,!e._fetchContactsPromise||!e._fetchContactsPromise.isCanceled){var v=Date.now(),_=l.ServicesManager.signInManager.currentUserName;e.fetchContacts(_,t,g).then(function(l){if(!e._fetchContactsPromise||!e._fetchContactsPromise.isCanceled){if(!l.ok){if(429===l.status||500===l.status||502===l.status)return void(e._retryCount<y&&new Promise(function(t,n){setTimeout(function(){d(s,p)},e._retryTimeout),e._retryTimeout=2*e._retryTimeout,e._retryCount++}));var g={code:l.status,message:l.statusText};return c.default.throwError(11001,"Unable to fetch contacts",g),p(g),void(e._fetchContactsPromise=null)}l.json().then(function(c){return function(c){if(e._haveAllContacts=!0,!c)return e._contacts?s(o):(p({status:l.status,statusText:l.statusText}),e._fetchContactsPromise=null),void a.swc.Telemetry.sendEvent.contactsLoadedQos(l.status,r);c.duration=Date.now()-v,o.update(c);var u={"If-None-Match":"/"};n&&n(c.contacts);var d=l.headers.get(h),g=l.headers.get(m);return g&&(e._etagHeader=g),d?(u[h]=d,f(u)):(e._contacts=o.contacts.getItems(),c.contacts=e._contacts,e._groups=o.groups.getItems(),c.groups=e._groups,e._blocklist=o.blocklist.getItems(),c.blocklist=e._blocklist,c.scope=o.firstScope,c.duration=o.duration,s(c),void a.swc.Telemetry.sendEvent.contactsLoadedQos(l.status,r,c.contacts.length,c.blocklist.length,c.groups.length,o.filter(4).length,o.filter(8).length,o.filter(28).length,t,Date.now()-i))}(c)},function(t){c.default.throwError(11001,"Unable to fetch contacts",t),p(t),e._fetchContactsPromise=null,u.reportContactsLoadedQosError(l.status,t)})}})}};l.ServicesManager.signInManager.onceSignedIn().then(f.bind(e))},f=new Promise(d);return e._fetchContactsPromise=new s.CancelablePromise(f),e._fetchContactsPromise.promise},this.getContactsUpdate=function(n){return e._fetchContactsDelta(t.reasons.NOTIFICATION).then(function(e){return e.json()})},this.fetchContacts=function(e,t,n){if(void 0===t&&(t=100),i.default.get.isTeams())return Promise.resolve({status:200,statusText:"Aad is here"});var r="users/"+encodeURIComponent(e)+"?page_size="+t+"&reason=default";return d.getRaw("fetchContacts",r,n)},this._fetchContactsDelta=function(n){void 0===n&&(n=t.reasons.DEFAULT),n=n||t.reasons.DEFAULT;var r=l.ServicesManager.signInManager.currentUserName,o=e._etagHeader||"/",s={};if(s[g]=o,i.default.get.isTeams())return Promise.resolve({status:200,statusText:"Aad is here"});var a="users/"+encodeURIComponent(r)+"?delta&reason="+encodeURIComponent(n);return d.getRaw("fetchContactsDelta",a,s)},this.getContact=function(t,n){if(e._fetchContactsPromise&&e._fetchContactsPromise.status===s.PromiseStatus.Pending)return e._fetchContactsPromise.promise.then(function(){for(var t,i=0;i<e._contacts.length;i++)if(e._contacts[i].mri===n){t=e._contacts[i];break}return t});if(e._pendingContactFetching[n])return e._pendingContactFetching[n];for(var i,r=0;r<e._contacts.length;r++)if(e._contacts[r].mri===n){i=e._contacts[r];break}return i?(delete e._pendingContactFetching[n],Promise.resolve(i)):e._haveAllContacts?Promise.resolve():(e._pendingContactFetching[n]=new Promise(function(i,r){e.fetchContact(t,n).then(function(t){return t.json().then(function(t){var r,o=t.contacts||[];t.contacts&&t.contacts.length&&e._contacts.push(o),delete e._pendingContactFetching[n];for(var s=0;s<o.length;s++)if(o[s].mri&&o[s].mri===n){r=o[s];break}i(r)},function(t){delete e._pendingContactFetching[n],c.default.throwError(11002,"Unable to fetch contact",t),r(t)})},function(t){delete e._pendingContactFetching[n],c.default.throwError(11002,"Unable to fetch contact",t)})}),e._pendingContactFetching[n])},this.fetchContact=function(e,t){if(i.default.get.isTeams())return Promise.resolve({status:200,statusText:"Aad is here"});var n=f.default.normalizePersonId(t),r="users/"+e+"/contacts?$filter=mri%2Fnamespace+eq+%27"+f.default.parsePersonId(t).type+"%27+and+mri%2Fidentifier+eq+%27"+n+"%27";return d.getRaw("fetchContact",r)},l.ServicesManager.signInManager.subscribe("state",function(t){t===o.SigninState.SignedOut&&e.dispose()})}return Object.defineProperty(e.prototype,"fetchMyContactsPromise",{get:function(){return this._fetchContactsPromise&&this._fetchContactsPromise.promise},enumerable:!0,configurable:!0}),e.prototype.addContact=function(e,t){var n="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts",i={mri:e,greeting:t};return d.post("addContact",n,JSON.stringify(i))},e.prototype.addFavoriteContact=function(e){var t="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts/favorites/"+e;return d.put("addFavoriteContact",t,"")},e.prototype.removeFavoriteContact=function(e){var t="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts/favorites/"+e;return d.deleteMethod("removeFavoriteContact",t)},e.prototype.blockContact=function(e,t,n){var i=this;void 0===t&&(t=!0),void 0===n&&(n="spam");var o=l.ServicesManager.signInManager.currentUserName,s="users/"+o+"/contacts/blocklist/"+e,a={delete_contact:!1,report_abuse:t,ui_version:r.Configuration.getUiVersion(),reason:n};return this.invalidateCache(),t?d.put("blockContact",s,JSON.stringify(a)).then(function(){return i.reportAbuse(o,e,n)}):d.put("blockContact",s,JSON.stringify(a))},e.prototype.reportAbuse=function(e,t,n){void 0===n&&(n="spam");var i="users/"+e+"/contacts/"+t+"/report",o={ui_version:r.Configuration.getUiVersion(),reason:n,report_context:"contact_request",content:{hash:"af94h"}};return d.post("reportAbuse",i,JSON.stringify(o))},e.prototype.unblockContact=function(e){var t="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts/blocklist/"+e;return this.invalidateCache(),d.deleteMethod("unblockContact",t)},e.prototype.invalidateCache=function(){this._fetchContactsPromise&&(this._fetchContactsPromise.cancel(),this._fetchContactsPromise=null),this.fetchMyContacts()},e.prototype.getContactByMriIfPresent=function(e){var t=this._contacts.filter(function(t){return t.mri===e});return t.length?t[0].display_name:null},e.prototype.getContactByMri=function(e){var t=this._contacts.filter(function(t){return t.mri===e});return t.length?t[0]:void 0},e.prototype.getBlockedList=function(){return this._fetchContactsPromise?this._fetchContactsPromise.promise.then(function(e){return e.blocklist}):Promise.resolve()},Object.defineProperty(e.prototype,"contactsList",{get:function(){return this._contacts},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._contacts=[],this._groups=[],this._blocklist=[],this._fetchContactsPromise&&this._fetchContactsPromise.status===s.PromiseStatus.Pending&&this._fetchContactsPromise.cancel(),this._fetchContactsPromise=null},e}();t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(50),r=function(){function e(){}return e._personIdRegExp=/(\d+:)([\S]*)/,e.normalizePersonId=function(t){var n=t.match(e._personIdRegExp);return n?n[2]:t},e.parsePersonId=function(t){var n=t.match(e._personIdRegExp);return n?{id:n[2],type:parseInt(n[1],0)}:{id:t,type:null}},e.getContactType=function(e){var t=/\d{0,}[^:]/g.exec(e.mri);return t&&t[0]?parseInt(t[0],0):i.ContactType.Undefined},e.replaceAvatarPath=function(e){return e.indexOf("data:image/jpeg;base64")>-1?e:e=(e=e.replace("URL@","")).indexOf("/views/avatar_fullsize")<0?e+"/views/avatar_fullsize":e},e.resolveConversationAvatar=function(t,n){return n?t?e.replaceAvatarPath(n):n:""},e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),s=n(12),a=n(0),c=n(4),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.searchSkypeDirectory=function(e){return this._searchPromise&&this._searchPromise.status===o.PromiseStatus.Pending&&(this._searchPromise.cancel(),this._searchPromise=null),this._searchKey=e,this._searchPromise=new o.CancelablePromise(a.swc.services.skypeGraphService.fetchProfiles(e)),this._searchPromise.promise},t.prototype.searchAgents=function(e){return new Promise(function(t,n){return a.swc.services.agentsService.searchAgents(e).then(function(e){if(e&&e.agentDescriptions){var n=e.agentDescriptions.map(function(e){return{skypeid:"28:"+e.agentId,name:e.displayName,avatar:e.userTileSmallUrl||e.userTileStaticUrl||"",type:c.ContactType.Agent}});t(n)}else t([])})})},t}(s.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(1),a=n(12),c=n(51),u=n(73),l=n(9),p=n(7),d=n(42),f=n(5),h="guest:";var g=function(e){function t(t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!0);var r=e.call(this)||this;r._id=t,r._displayName="",r._isAgent=!1,r._isGuest=!1,r._isPstn=!1,r._isBlocked=!1,r._isFavorite=!1,r._avatarData="",r._email="",r._setAvatarDataIfValidUrl=function(e,t){u.loadAvatarUri(e,function(e){r.avatarData=e},t)},r.getPersonData=function(){if(r.displayName&&r.avatarData&&r._isFilled)return Promise.resolve();if(r._isFilled=!0,r.isAgent||r.isPstn)return Promise.resolve();if(r._ongoingStratusRequest)return r._ongoingStratusRequest;var e=function(e){p.default.throwError(10801,"Unable to resolve user details",e)};if(r._isMePerson){r._ongoingStratusRequest=f.ServicesManager.stratusService.fetchMeProperties().then(function(e){if(e){var t=e.firstname||"";t+=e.lastname?" "+e.lastname:"",r.displayName=t||r.displayName;var n=e.avatarUrl||e.avatarData;r._setAvatarDataIfValidUrl(n)}},e)}else{if(!r.shouldFetchProfile())return Promise.resolve();r._ongoingStratusRequest=f.ServicesManager.stratusService.fetchPerson(r._id).then(function(e){var t=(e=e||[]).filter(function(e){return e.username===r._id||e.username===r._mri})[0];if(t){var n=t.displayname?t.displayname:"",i=t.username?t.username:"",o=n||i;o&&(r.displayName=o),r._id===r._mri&&(r._mri=(r.isAgent?"28:":"8:")+r._id),t.avatarUrl&&r._setAvatarDataIfValidUrl(t.avatarUrl,function(){}),t.avatarData&&(r.avatarData=t.avatarData)}else p.default.throwError(10801,"Unable to resolve user details")},e)}return r._ongoingStratusRequest},r.getDataFromContactsService=function(){return r._ongoingContactsRequest?r._ongoingContactsRequest:r.isPstn?Promise.resolve():(r._ongoingContactsRequest=f.ServicesManager.signInManager.getSkypeToken().then(function(){var e=f.ServicesManager.signInManager.currentUserName;return e.indexOf("guest")>-1||r.isGuest||r._isMePerson?r._fetchDisplayNameAndAvatar():f.ServicesManager.contactsService.getContact(e,r._mri).then(function(e){if(e){var t=e.avatar,n=e.display_name;return t||(t=e.profile?e.profile.avatar_url:""),n&&(r.displayName=n),t?r._setAvatarDataIfValidUrl(t):r._fetchDisplayNameAndAvatar(),r._ongoingContactsRequest=null,""}return r._ongoingContactsRequest=null,r._fetchDisplayNameAndAvatar()},function(){return r._ongoingContactsRequest=null,r._fetchDisplayNameAndAvatar()})},function(){return r._ongoingContactsRequest=null}),r._ongoingContactsRequest)};var o=/^\d+:/;o.test(r._id)?(r._mri=r._id,r._id=r.id.replace(o,"")):r._mri="8:"+r._id,r._mri.indexOf("https://");var s=d.default.normalizePersonId(r._id);return s!==r._id&&(r._id=s),r._isAgent=n||r._mri.indexOf("28:")>-1,r._isGuest=r._id.indexOf(h)>-1,r._isPstn=r._mri.indexOf("4:")>-1,r._description="",r._isMePerson=r._id===f.ServicesManager.signInManager.currentUserName||d.default.normalizePersonId(r._id)===f.ServicesManager.signInManager.currentUserName,i&&r.fetchDisplayNameAndAvatar(),r}return r(t,e),Object.defineProperty(t.prototype,"isAgent",{get:function(){return this._isAgent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPstn",{get:function(){return this._isPstn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return this._isBlocked},set:function(e){e!==this._isBlocked&&(this._isBlocked=e,this.publish("isBlocked",this._isBlocked))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFavorite",{get:function(){return this._isFavorite},set:function(e){e!==this._isFavorite&&(this._isFavorite=e,this.publish("isFavorite",this._isFavorite))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGuest",{get:function(){return this._isGuest},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mri",{get:function(){return this._mri},set:function(e){this._mri=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._displayName||this.fetchDisplayNameAndAvatar(),this._displayName},set:function(e){this.setDisplayName(e)},enumerable:!0,configurable:!0}),t.prototype.setDisplayName=function(e){e&&e!==this._displayName&&(this._displayName=l.MessageUtils.parseTopic(e),this.publish("displayName",this._displayName))},t.prototype.getDisplayName=function(){return this._displayName},Object.defineProperty(t.prototype,"description",{get:function(){return this._description},set:function(e){e!==this._description&&(this._description=e,this.publish("description",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatarData",{get:function(){return o.default.get.isTeams()?(e=this._mri,t=this._displayName,n=s.Configuration.TEAMS_MIDDLE_TIER_URL+"/beta/users/"+e+"/profilepicturev2",i={displayname:t},c.addGetParamsToUrl(n,i)):this._avatarData;var e,t,n,i},set:function(e){e!==this._avatarData&&(this._avatarData=e,this.publish("avatarData",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extraLargeAvatarUrl",{get:function(){return this.extraLargeAvatarUrl},set:function(e){e!==this._extraLargeAvatarUrl&&(this._extraLargeAvatarUrl=e,this.publish("extraLargeAvatarUrl",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"email",{get:function(){return this._email},set:function(e){e!==this._email&&(this._email=e,this.publish("email",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"presenceStatus",{get:function(){return this._presenceStatus},set:function(e){this._presenceStatus!==e&&(this._presenceStatus=e,this.publish("presenceStatus",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFilled",{get:function(){return this._isFilled},enumerable:!0,configurable:!0}),t.prototype.fetchDisplayNameAndAvatar=function(){return this.isFilled?Promise.resolve():this.getDataFromContactsService()},t.prototype._fetchDisplayNameAndAvatar=function(){var e=this;return this._isFilled=!0,this.isAgent?f.ServicesManager.agentsService.getAgentDetails(this._id).then(function(t){if(t&&t.agentDescriptions&&1===t.agentDescriptions.length){var n=t.agentDescriptions[0].displayName;e._description=t.agentDescriptions[0].description,e._setAvatarDataIfValidUrl(t.agentDescriptions[0].userTileExtraLargeUrl),n&&(e.displayName=n)}return e._displayName}):this.getPersonData().then(function(){return e.displayName})},t.prototype.shouldFetchProfile=function(){return this._mri.indexOf("8:")>-1&&(!o.default.get.isTeams()||o.default.get.isTeams()&&!this._displayName)},t}(a.default);t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(7),o=n(240),s=function(){function e(){var e=this;this.pesManager=null,this.isLoading=!1,this.setLoadingFinished=function(){e.isLoading=!1},this.init=function(){return e.initSkype()},this.canRenderConfigItems=function(){return e.pesManager.canRenderConfigItems()},this.getConfiguration=function(){return new Promise(function(t,n){e.config?t(e.config):e.init().then(function(n){t(e.config)})})},this.pesManager=new o.PesManager}return e.prototype.refresh=function(){this.pesManager.refresh()},e.prototype.initSkype=function(){var e=this;return this.getConfigurationPromise?this.getConfigurationPromise:(this.isLoading=!0,this.getConfigurationPromise=new Promise(function(t,n){i.swc.services.mePersonManager.fetch().then(function(n){e.pesManager.isInitialized||e.pesManager.init(n.id).then(function(n){e.config=n,e.setLoadingFinished(),t(e.config)},e.setLoadingFinished)},function(t){e.setLoadingFinished(),n(t),r.default.throwError(10503,"Unable to fetch me person and load PES",t)})}),this.getConfigurationPromise)},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this.isLoading||this.pesManager.isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this.pesManager.map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emoticonMap",{get:function(){return this.pesManager.emoticonMap},enumerable:!0,configurable:!0}),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SMALL="small",e.LARGE="large",e.EXTRA_LARGE="extraLarge",e.SUPER_LARGE="superLarge"}(t.ITEM_SIZES||(t.ITEM_SIZES={})),t.STATIC_MEDIA_INFO={firstFrame:0,framesCount:1,fps:1},function(e){e.camel="drawState",e.dash="draw-state"}(t.DRAW||(t.DRAW={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._items={}}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this._items).length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items={}},e.prototype.getItem=function(e){return this._items[e]},e.prototype.key=function(e){return null},e.prototype.removeItem=function(e){delete this._items[e]},e.prototype.setItem=function(e,t){this._items[e]=t},e}();t.MemoryStorage=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this)||this;return n.lastReadMessageTimestamp=-1,n.modificationTime=-1,n.lastReadMessageId="",n.value="",t&&n.set(t),n}return r(t,e),t.prototype.set=function(e,t){if(e){var n=e.split(";");this.lastReadMessageTimestamp=Number(n[0]),this.modificationTime=Number(n[1]),this.lastReadMessageId=n[2],this.value=e,!0===t&&this.publish("value",this.value)}},t}(n(12).default);t.ConsumptionHorizon=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.callbacks=[]}return e.prototype.subscribe=function(e){return 0===this.callbacks.filter(function(t){return t===e}).length&&(this.callbacks.push(e),!0)},e.prototype.unsubscribe=function(e){this.callbacks=this.callbacks.filter(function(t){return t!==e})},e.prototype.notify=function(e){this.callbacks.forEach(function(t){t(e)})},e.prototype.dispose=function(){delete this.callbacks},e}();t.SubscribeableStore=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(281),r=n(282),o=n(283),s=function(){function e(){}return Object.defineProperty(e.prototype,"messages",{get:function(){return new r.MessagesCblBase},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skypeSignInManager",{get:function(){return new o.SkypeSignInManagerCblBase},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deleteMemberProcessor",{get:function(){return new i.DeleteMemberProcessorCblBase},enumerable:!0,configurable:!0}),e}();t.CblBase=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(124),r=function(){function e(){}return e.getSentMessageType=function(t){switch(t){case i.MessageType.FILE:case i.MessageType.IMAGE:return e.File;case i.MessageType.SWIFT:return e.Card;default:return e.Text}},e.getReceivedMessageType=function(t){switch(t){case"":return e.File;default:return e.Text}},e.Text="text",e.File="file",e.Card="card",e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(85),a=/(\(|\))/g,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"i"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("mention")},t.prototype.wordRawToXml=function(e,t,n,i){for(var r,o=[],s=/[\.,_:\-;?]$/,a=t.substring(1),c=this.getMentionUserData(a,n,i);!c&&a.match(s);)r=a.charAt(a.length-1),a=a.substring(0,a.length-1),c=this.getMentionUserData(a,n,i);return c&&(o.push(this.createXmlElement(e,c)),r&&o.push(e.createTextNode(r))),o},t.prototype.getMentionUserData=function(e,t,n){var i,r={defaultDisplayName:"",displayName:"",skypeId:"",mri:"",isMePerson:!1};if(!e)return null;var s=0===(e=e.toLowerCase()).indexOf("("),c=s?e.substring(1,e.length-1):"",u=o.swc.services.i18n.fetch("text_all").toLowerCase();if(c===u)return{defaultDisplayName:u,displayName:u,skypeId:"*",mri:"*",isMePerson:!1};var l=t?t.participants:[];if(r.isMePerson=!!n&&(e===n.id.toLowerCase()||s&&n.displayName.replace(a,"").toLowerCase()===c),r.isMePerson)i=n;else{var p=l.filter(function(t){return t.person.id.toLowerCase()===e||s&&t.person.displayName.replace(a,"").toLowerCase()===c});p.length&&(i=p[0].person)}return i?(r.skypeId=i.id,r.mri=i.mri,r.displayName=i.displayName,r.defaultDisplayName||(r.defaultDisplayName=r.displayName),r):null},t.prototype.wordMatcher=function(){return/@([a-z0-9\.,\-_:]+|\(.+?\))/gi},t.prototype.createXmlElement=function(e,t){var n=e.createElement("at");return n.setAttribute("id",t.mri),n.innerText=t.defaultDisplayName,n},t}(s.WordDomTransformer);t.MentionDomEncoder=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(9),o=n(150),s=function(){function e(){}return e._processUsers=function(e,t){for(var n=i.swc.services.mePersonManager.mePerson,s=0;s<e.users.length;s++){var a=null,c=e.users[s],u=o.default.normalizePersonId(c.mri);c.person=n.id===u?n:i.swc.services.persons.getPerson(c.mri,!0),c.value=c.value?r.MessageUtils.getMessageSanitizedContent(c.value):"";for(var l=0;l<t.users.length;l++){var p=t.users[l];if(c.mri===p.mri){a=p;break}}a||t.users.push(c)}},e.parseMessageProperties=function(t,n){n.properties&&t.supportedAnnotations.forEach(function(i){var r=n.properties?n.properties[i]:[],o=t[i];if(r)for(var s=function(t){var n=null,i=r[t];i&&"reactionsConsumptionHorizon"!==i.key&&function(){for(var t=0;t<o.length;t++){var r=o[t];i.key===r.key&&(n=r)}n||(n={key:i.key,users:[]},o.pushObservable(n)),e._processUsers(i,n)}()},a=0;a<r.length;a++)s(a)})},e.updateMessageProperties=function(e,t){t&&e.supportedAnnotations.forEach(function(n){var i=e[n],r=t[n];i&&r&&(i.spliceObservable(0,i.length),r&&r.forEach(function(e){i.pushObservable(e)}))})},e}();t.default=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(47),s=n(0),a=n(56),c=n(31),u=n(5),l=function(e){function t(n,i){var r=e.call(this,"Reminder")||this;return r.title=r.getTitle(n),r.description=t.getDescription(n),r.conversationId=i.id,r.sender="",r.avatarUrl=r.getAvatar(i),r.actionsInformation=t.getActionsInformation(),r}return r(t,e),t.getActionsInformation=function(){return{accept:{title:s.swc.services.i18n.fetch("open"),description:s.swc.services.i18n.fetch("open_client_descr")},ignore:{title:s.swc.services.i18n.fetch("ignore"),description:s.swc.services.i18n.fetch("ignore_reminder_notificaton_descr")}}},t.prototype.getTitle=function(e){var t="",n=s.swc.services.i18n.fetch("separator");return e.forEach(function(e){if(e.isGroup)t+=""===t?e.topic:n+" "+e.topic;else{var i=u.ServicesManager.contactsService.getContactByMriIfPresent(e.id)||c.normalizePersonId(e.id);t+=""===t?i:n+" "+i}}),t},t.getDescription=function(e){return s.swc.services.i18n.fetch("notification_reminder_desc",{count:e.length})},t.getActions=function(e,t){return[{type:"Accept",title:e.actionsInformation.accept.title,description:e.actionsInformation.accept.description,action:function(){a.default.startChat(e.conversationId,t,!1,o.OpenChatOrigin.NOTIFICATION),s.swc.Telemetry.sendEvent.notificationAction("Reminder","Accept")}},{type:"Ignore",title:e.actionsInformation.ignore.title,description:e.actionsInformation.ignore.description,action:function(){s.swc.Telemetry.sendEvent.notificationAction("Reminder","Ignore")}}]},t}(n(87).Notification);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(47),s=n(0),a=n(56),c=n(9),u=n(31),l=n(5),p=n(39),d=function(e){function t(n,i){var r=e.call(this,"UnreadMessage")||this;return r.title=t.getTitle(n,i.sender),r.conversationId=n.id,r.description=t.getDescription(i),r.sender=t.getSender(n,i),r.avatarUrl=r.getAvatar(n,i.sender),r.actionsInformation=t.getActionsInformation(),r}return r(t,e),t.getActionsInformation=function(){return{accept:{title:s.swc.services.i18n.fetch("open"),description:s.swc.services.i18n.fetch("open_client_descr")},ignore:{title:s.swc.services.i18n.fetch("ignore"),description:s.swc.services.i18n.fetch("ignore_unread_notificaton_descr")}}},t.getTitle=function(e,t){if(e.isGroup)return e.topic;var n=l.ServicesManager.contactsService,i=t?t.displayName:null;return n.getContactByMriIfPresent(e.id)||i||u.normalizePersonId(e.id)},t.getDescription=function(e){switch(e.rawMessageType){case"RichText/UriObject":case"RichText/Html":return s.swc.services.i18n.fetch("pic_sent");case"RichText/Media_GenericFile":return s.swc.services.i18n.fetch("file_sent");case"Event/Call":return s.swc.services.i18n.fetch(t.getCallMessage(e.content));default:var n=p.default.dompurify.sanitize(e.content,{ALLOWED_TAGS:[]});return c.MessageUtils.unescape(n)}},t.getCallMessage=function(e){return/<partlist type="missed"="/.test(e)?"message_text_missedCall":(/<partlist type="ended"="/.test(e),"message_text_endedCall")},t.getActions=function(e,t){return[{type:"Accept",title:e.actionsInformation.accept.title,description:e.actionsInformation.accept.description,action:function(){a.default.startChat(e.conversationId,t,!1,o.OpenChatOrigin.NOTIFICATION),s.swc.Telemetry.sendEvent.notificationAction("UnreadMessage","Accept")}},{type:"Ignore",title:e.actionsInformation.ignore.title,description:e.actionsInformation.ignore.description,action:function(){s.swc.Telemetry.sendEvent.notificationAction("UnreadMessage","Ignore")}}]},t.getSender=function(e,t){return e.isGroup&&t.sender?t.sender.displayName:""},t}(n(87).Notification);t.UnreadMessageNotification=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0),o=n(7),s=n(5),a=n(331),c=n(97),u=n(332),l=n(333),p=n(162),d=n(163),f={"Event/Call":1,"Signal/Flamingo":1},h=function(){function e(){this.activeCallNotifications={},this.idOfShowedMessageNotifications={},this.everOpenedChats={},this.notifications=[],this.unreadMessageObserver=new l.default,this.isEnabled=!0,this.isConversationWithConciergeBot=function(e){return e===i.Configuration.CONCIERGE_BOT_MRI||e===i.Configuration.CONCIERGE_BOT_DF_MRI}}return e.prototype.enableNotifications=function(){this.isEnabled=!0},e.prototype.disableNotifications=function(){this.isEnabled=!1},e.prototype.registerUnreadMessage=function(e,t){var n=this;if(!(this.idOfShowedMessageNotifications[t.id]||this.isOpenedIConversation(e.id)||this.isConversationWithConciergeBot(t.senderId)||f[t.rawMessageType])){var i=this.unreadMessageObserver.getNotification(e,t);i&&(this.idOfShowedMessageNotifications[t.id]=!0,this.notifications.push(i),r.swc.services.notificationSettingsStore.get(c.NotificationSettingType.NewMessage).then(function(e){n._canNotify(e)&&n.showNotifications()}))}},e.prototype.registerUnreadIConversationsSummary=function(e){var t=this;if(u.default.isEnabled&&0!==(e=e.filter(function(e){return!e.alertsOff&&!t.isConversationWithConciergeBot(e.id)})).length&&!u.default.isIgnored()){var n=this.getUnreadIConversationsNotification(e);n&&this.notifications.push(n),this.showNotifications()}},e.prototype._canNotify=function(e){return!!e&&(e.value===c.NotificationAllowedValue.All||e.value===c.NotificationAllowedValue.Notification)},e.prototype.registerCall=function(e){var t=this,n=new a.default(e),i=n.getNotification();i?r.swc.services.notificationSettingsStore.get(c.NotificationSettingType.IncomingCall).then(function(e){t._canNotify(e)&&(t.activeCallNotifications[n.callId]=i,r.swc.Eventing.triggerEvent("sendNotification",i),r.swc.Telemetry.sendEvent.notificationCreated(i.type))}):o.default.throwError(200003,"Unable to create call notification")},e.prototype.callStateHandler=function(e){this.activeCallNotifications[e.id]&&1!==e.status&&(this.activeCallNotifications[e.id].hide(),delete this.activeCallNotifications[e.id])},e.prototype.setOpenedConversations=function(e){this.everOpenedChats=e,s.ServicesManager.setEverOpenedChats(e)},e.prototype.isOpenedIConversation=function(e){var t=this.everOpenedChats[e];return t&&t.onStage},e.prototype.showNotifications=function(){if(this.isEnabled)for(var e=this.notifications.length,t=0;t<e;t++){var n=this.notifications.pop();n=JSON.parse(JSON.stringify(n)),r.swc.Eventing.triggerEvent("sendNotification",n),r.swc.Telemetry.sendEvent.notificationCreated(n.type)}else this.notifications=[]},e.getActionsForNotification=function(e,t){switch(e.type){case"UnreadMessage":return d.UnreadMessageNotification.getActions(e,t);case"Summary":return u.default.getActions(e);case"Reminder":return p.default.getActions(e,t);case"Calling":return a.default.getActions(e,t);default:return[]}},e.prototype.getUnreadIConversationsNotification=function(e){var t=r.swc.services.localStorage.getItem("swc-recentslastseen");if(!t)return new u.default(e);var n=e.filter(function(e){return e.lastMessage.originalTimestamp.getTime()>+t});return n.length?new u.default(n):null},e}();t.default=h},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=n(58),a=n(0),c=n(72),u=function(e){function t(t,n,i){void 0===i&&(i=!1);var r=e.call(this,n)||this;return r._sharepointService=t,r._useAms=!1,r._useAms=!!i,r}return r(t,e),t.prototype.isEnterpriseAmsUsed=function(){return this._useAms},t.prototype.downloadRawFile=function(e){return this._useAms?this.downloadEnterpriseFile(e):this._sharepointService.downloadFile(e)},t.prototype.downloadEnterpriseFile=function(t){return d(t)?e.prototype.downloadPicture.call(this,t.id):e.prototype.downloadFileByDocumentId.call(this,t.id)},t.prototype.getFileStatus=function(t,n){return this._useAms?e.prototype.getFileStatus.call(this,t,n):Promise.resolve({uploadStatus:this._sharepointService.getFileStatus(t)})},t.prototype.sendFile=function(e,t){return this._useAms?this.sendAmsEnterpriseFile(e,t):this.sendFileViaSharepoint(e,t)},t.prototype.sendAmsEnterpriseFile=function(e,t){var n=this,i=Date.now().toString();this._uploads[i]=s.DocumentStatus.InProgress;var r=p(t,null),o=this.createAmsDocument(e,t),a=o.then(function(e){var n=p(t,e.id);return{documentId:e.id,clientMessageId:i,files:[n]}}),c=o.then(function(i){return n.uploadFileContent(e,i.id,t)}).catch(function(){n._uploads[i]=s.DocumentStatus.Failed});return e.sendFilesAsAmsProperties({clientMessageId:i,files:[r],registerPromise:a,uploadPromise:c})},t.prototype.sendFileViaSharepoint=function(e,t){var n=this;return(c.isDocumentTypeImage(t.type)?this.createAndUploadAmsDocument(e,t):Promise.resolve({documentId:void 0,uploadPromise:Promise.resolve()})).then(function(i){return n.sendAndShare(e,t,i)})},t.prototype.createAndUploadAmsDocument=function(e,t){var n=this;return this.createAmsDocument(e,t).then(function(i){return{uploadPromise:n.uploadFileContent(e,i.id,t),documentId:i.id}})},t.prototype.sendAndShare=function(e,t,n){var i=this,r=n.documentId,s=n.uploadPromise,u=function(e,t){return{"@type":"http://schema.skype.com/File",version:2,id:Date.now().toString(),baseUrl:"",type:e.type,title:e.name,state:"active",objectUrl:"",providerData:'{"code":null,"type":0}',itemid:"",fileName:e.name,fileType:c.getNameAndExtension(e.name).extension,fileInfo:{fileUrl:"",siteUrl:"",serverRelativeUrl:""},botFileProperties:{},filePreview:{previewUrl:t?URL.createObjectURL(e):void 0},fileChicletState:{serviceName:"p2p",state:"active"}}}(t,r),l=this._sharepointService.checkAndUploadFile(t,u.id),p=l.then(function(e){var t=function(e,t){return{"@type":"http://schema.skype.com/File",version:2,id:e.objectId,baseUrl:e.siteInfo.siteUrl,type:e.type,title:e.title,state:"active",objectUrl:e.objectUrl,providerData:'{"code":null,"type":0}',itemid:e.objectId,fileName:e.title,fileType:e.type,fileInfo:{fileUrl:e.objectUrl,siteUrl:e.siteInfo.siteUrl,serverRelativeUrl:e.serverRelativeUrl},botFileProperties:{},filePreview:{previewUrl:t?o.Configuration.AMS_HOST_URL+"objects/"+t+"/views/imgo":void 0},fileChicletState:{serviceName:"p2p",state:"active"}}}(e.fileCheckValue,r);return{clientMessageId:u.id,files:[t]}}),d=l.then(function(t){var n=t.fileCheckValue,r=t.uploadPromise,o=e.members.map(function(e){return a.swc.services.contactsService.getContact("",e.id)}),c=Promise.all(o).then(function(e){return r.then(function(){var t=e.filter(function(e){return e&&e.email}).map(function(e){return e.email});return i._sharepointService.shareFile(n.objectUrl,t)})});return Promise.all([c,s])});return e.sendFilesAsProperties({clientMessageId:u.id,files:[u],registerPromise:p,uploadPromise:d}),d},t}(n(143).SkypeAmsManager);function l(e,t){var n=c.isDocumentTypeImage(t)?"imgpsh_fullsize":"original";return o.Configuration.AMS_HOST_URL+"objects/"+e+"/views/"+n}function p(e,t){return{"@type":"http://schema.skype.com/File",type:e.type,itemid:"",baseUrl:"",providerData:"",version:2,id:t,title:e.name,state:"active",objectUrl:l(t,e.type),fileName:e.name,fileType:c.getNameAndExtension(e.name).extension,botFileProperties:{url:t?l(t,e.type):void 0},fileInfo:{fileUrl:"",siteUrl:"",serverRelativeUrl:""},filePreview:{previewUrl:""}}}function d(e){switch(e.fileType){case"jpeg":case"jpg":case"gif":case"png":case"bmp":case"tiff":case"jfif":return!0;default:return!1}}t.TeamsAmsManager=u,t.isImage=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(22);t.reportServiceFault=function(e,t,n){t=t||{};var o=r.NA;t.headers&&"function"==typeof t.headers.get&&(o=t.headers.get("contextid")||t.headers.get("X-Skype-Caller")||t.headers.get("X-Skype-Request-Id")),i.swc.Telemetry.sendEvent.serviceFault(e,t.status,t.statusText||t.message,i.swc.services.isZombie,t.url,o,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(3),o=n(15),s=n(33),a=n(0),c=!1,u=function(e){return{value:null,expiry:null,failureCount:e.value?e.failureCount+1||1:e.failureCount||0}};t.handleRegTokenExpiry=function(e){var t=403===e.status&&(!e.headers||"Quarantine limit Exceeded"!==e.headers.get("StatusText")),n=401===e.status;return t||n?(i=u(i),a.swc.services.sessionStorage.setItem(s.SKYPE_REGTOKEN_KEY,JSON.stringify(i)),a.swc.services.signInManager.checkAuthFailuresCount(i.failureCount),Promise.reject(e)):Promise.resolve(e)},t.handleSkypeTokenExpiry=function(e){return 401===e.status?(a.swc.services.signInManager.logout("services:401"),Promise.reject(e)):Promise.resolve(e)},t.processHeaders=function(e){var t=e.headers.get("set-registrationtoken");if(t){var n=t.match(/registrationToken=(.+); expires=(\d+)/);n&&(i.value=n[1],i.expiry=parseInt(n[2],10),i.expiry<1e10&&(i.expiry*=1e3),delete i.failureCount,a.swc.services.sessionStorage.setItem(s.SKYPE_REGTOKEN_KEY,JSON.stringify(i)))}return e},t.getHeaders=function(){c&&i.expiry<Date.now()&&(i=u(i));var e={};r.default.get.backend===o.MessagingBackend.TEAMS&&(e["x-ms-user-type"]="user",e["x-ms-client-type"]="web");var t=function(){return i.value?(e.RegistrationToken="registrationToken="+i.value,Promise.resolve(e)):new Promise(function(t,n){a.swc.services.signInManager.getSkypeToken().then(function(n){e.Authentication="skypetoken="+n,t(e)},function(){return n()})})};return c?t():a.swc.services.signInManager.onceSignedIn().then(function(){return function(){var e,t=null;if(!i){try{t=a.swc.services.sessionStorage.getItem(s.SKYPE_REGTOKEN_KEY)}catch(e){}if(t)try{e=JSON.parse(t)}catch(e){}i=e&&e.value&&e.expiry?e:{value:null,expiry:null}}c=!0}(),t()})},t.reset=function(){i={value:null,expiry:null}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLastItemFromArray=function(e,t){return e&&e.length>0?e[e.length-1]:t}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=n(12),a=n(92),c=n(4),u=function(e){function t(t,n){var i=e.call(this)||this;return i.customType=c.CustomMessageType.Custom,i.supportedAnnotations=[],i.type=c.MessageType.UserMessage,i._isDeleted=!1,i._isEdited=!1,i.timestamp=new Date,i.originalTimestamp=i.timestamp,i._payload=n,i._status=c.DeliveryStatus.Pending,i.suggestedActions=a.ObservableCollection.create(),t&&(i.type=c.MessageType.SystemMessage),i.supportedAnnotations.push(o.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS),i.emotions=a.ObservableCollection.create(),i._files=a.ObservableCollection.create(),i}return r(t,e),Object.defineProperty(t.prototype,"files",{get:function(){return this._files},set:function(e){this._files=e,this.publish("files",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientMessageId",{get:function(){return this._clientMessageId},set:function(e){this._clientMessageId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"composeTime",{get:function(){return this._composeTime},set:function(e){e!==this._composeTime&&(this._composeTime=e,this.publish("composeTime",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return this._content},set:function(e){e.indexOf("customDebug"),e!==this._content&&(this._content=e,this.publish("content",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){e!==this._direction&&(this._direction=e,this.publish("direction",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(e){e!==this._id&&(this._id=e,this.publish("id",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageContent",{get:function(){return this._imageContent},set:function(e){e!==this._imageContent&&(this._imageContent=e,this.publish("imageContent",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDeleted",{get:function(){return this._isDeleted},set:function(e){e!==this._isDeleted&&(this._isDeleted=e,this.publish("isDeleted",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEdited",{get:function(){return this._isEdited},set:function(e){e!==this._isEdited&&(this._isEdited=e,this.publish("isEdited",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFirst",{get:function(){return this._isFirst},set:function(e){e!==this._isFirst&&(this._isFirst=e,this.publish("isFirst",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTranslated",{get:function(){return this._isTranslated},set:function(e){e!==this._isTranslated&&(this._isTranslated=e,this.publish("isTranslated",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key},set:function(e){e!==this._key&&(this._key=e,this.publish("key",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originalTimestamp",{get:function(){return this._originalTimestamp},set:function(e){e!==this._originalTimestamp&&(this._originalTimestamp=e,this.publish("originalTimestamp",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){return this._payload},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processedContent",{get:function(){return this._processedContent},set:function(e){e!==this._processedContent&&(this._processedContent=e,this.publish("processedContent",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawMessageType",{get:function(){return this._rawMessageType},set:function(e){this._rawMessageType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sender",{get:function(){return this._sender},set:function(e){e!==this._sender&&(this._sender=e,this.publish("sender",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"senderId",{get:function(){return this._senderId},set:function(e){e!==this._senderId&&(this._senderId=e,this.publish("senderId",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skypeEditedId",{get:function(){return this._skypeEditedId},set:function(e){e!==this._skypeEditedId&&(this._skypeEditedId=e,this.publish("skypeEditedId",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(e){e!==this._status&&(this._status=e,this.publish("status",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timestamp",{get:function(){return this._timestamp},set:function(e){e!==this._timestamp&&(this._timestamp=e,this.publish("timestamp",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"translation",{get:function(){return this._content},set:function(e){e!==this._translation&&(this._translation=e,this.publish("translation",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},set:function(e){e!==this._version&&(this._version=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imdisplayname",{get:function(){return this._imdisplayname},set:function(e){e!==this._imdisplayname&&(this._imdisplayname=e)},enumerable:!0,configurable:!0}),t.prototype.getKey=function(){return this._key||this._skypeEditedId||this._clientMessageId||this._id||"0"},Object.defineProperty(t.prototype,"amsreferences",{get:function(){return this._amsreferences},set:function(e){e!==this._amsreferences&&(this._amsreferences=e,this.publish("amsreferences",e))},enumerable:!0,configurable:!0}),t}(s.default);t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.implode=function(e){return e.join(",")},e.explode=function(e){return e?e.replace(/\s/g,"").split(","):[]},e.find=function(t,n){return e.explode(t).indexOf(n)>-1},e.add=function(t,n,i){if(!i||!e.find(t,n)){var r=e.explode(t);r.push(n),t=e.implode(r)}return t},e}();t.default=i},,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=function(e){function t(t){var n=e.call(this,t)||this;return n._onError=function(){n.props.onLoad&&n.props.onError()},n._onLoad=function(){n.setState({loaded:!0}),n.props.onLoad&&n.props.onLoad()},n.state={loaded:!1},n}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.src,n=e.className,i=e.useCredentials,r=e.placeholder,a=this.state.loaded;return s.createElement(o.Fragment,null,!a&&r&&r,i?s.createElement("img",{crossOrigin:"use-credentials",src:t,hidden:!a,onError:this._onError,onLoad:this._onLoad,className:n}):s.createElement("img",{src:t,hidden:!a,onError:this._onError,onLoad:this._onLoad,className:n}))},t}(o.Component);t.SwcImageLoader=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(8),a=n(37),c=n(121),u=n(122),l=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="",n._onAvatarUpdate=function(e){n.setState({avatarUrl:e})},n._onTopicUpdate=function(e){n.setState({title:e})},n.state={title:"",avatarUrl:"",isPerson:!1,isPstn:!1},n}return r(t,e),t.prototype.componentDidMount=function(){var e=this;this._lowPriorityTimeout=setTimeout(function(){if(e.props.item){var t=e.props.item;e.setState({isPerson:t.isPerson,isPstn:t.isPstn}),t.isPerson||(e._onTopicUpdate(t.topic),t.subscribe("topic",e._onTopicUpdate),t.isPstn||(t.avatar&&e._onAvatarUpdate(t.avatar),t.subscribe("avatar",e._onAvatarUpdate)))}},0)},t.prototype.componentWillUnmount=function(){var e=this.props.item;clearTimeout(this._lowPriorityTimeout),e.unsubscribe("avatar",this._onAvatarUpdate),e.unsubscribe("topic",this._onTopicUpdate)},t.prototype.render=function(){if(this.state.isPstn)return o.createElement(u.SwcPstnAvatar,{className:this.getComposedBlockClassName(),size:a.SwcAvatarSize.Medium,title:this.state.title,accessible:!1});if(this.state.isPerson){var e=this.props.item.id;return this.props.item.withPerson&&(e=this.props.item.withPerson.mri),o.createElement(c.SwcPersonIdAvatar,{className:this.getComposedBlockClassName(),personId:e,showPresence:!0,accessible:!1})}return o.createElement(a.SwcAvatar,{className:this.getComposedBlockClassName(),size:a.SwcAvatarSize.Medium,title:this.state.title,avatarUrl:this.state.avatarUrl,accessible:!1})},t}(s.SwcBaseComponent);t.SwcRecentAvatar=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(8),a=n(37),c=n(175),u=n(74),l=n(121),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="",t}return r(t,e),t.prototype.render=function(){return this.props.conversation.isOneOnOne?this.props.conversation.isTeamsOneOnOne?o.createElement(u.SwcPersonAvatar,{className:this.getComposedBlockClassName(),size:a.SwcAvatarSize.Medium,person:this.props.conversation.theOtherParticipant.person,showPresence:!0,customAvatar:this.props.customAvatar}):o.createElement(l.SwcPersonIdAvatar,{className:this.getComposedBlockClassName(),personId:this.props.conversation.id,showPresence:!0,customAvatar:this.props.customAvatar}):o.createElement(c.SwcGroupAvatar,{className:this.getComposedBlockClassName(),group:this.props.conversation,customAvatar:this.props.customAvatar,customTitle:this.props.customTitle})},t}(s.SwcBaseComponent);t.SwcConversationAvatar=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),a=n(8),c=n(37),u=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="",n._onAvatarUpdate=function(e){n.setState({avatarUrl:e})},n._onTopicUpdate=function(e){n.setState({title:e})},n.state={title:n.props.customTitle||"",avatarUrl:n.props.customAvatar||""},n}return r(t,e),t.prototype.componentDidMount=function(){var e=this.props.group;this.props.customTitle?this._onTopicUpdate(this.props.customTitle):(this._onTopicUpdate(e.topic),e.subscribe("topic",this._onTopicUpdate)),this.props.customAvatar?this._onAvatarUpdate(this.props.customAvatar):(e.avatar&&this._onAvatarUpdate(e.avatar),e.subscribe("avatar",this._onAvatarUpdate))},t.prototype.componentWillUnmount=function(){var e=this.props.group;e.unsubscribe("avatar",this._onAvatarUpdate),e.unsubscribe("topic",this._onTopicUpdate)},t.prototype.render=function(){return s.createElement(c.SwcAvatar,o({className:this.getComposedBlockClassName(),size:c.SwcAvatarSize.Medium},this.state))},t}(a.SwcBaseComponent);t.SwcGroupAvatar=u},,,,function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(11),o=n(30),s=n(0),a=n(21),c=n(142),u=n(189),l=n(190),p=function(){function t(){var e=this;this.initPromise=new r.CancelablePromise,this._retryCount=0,this.setLanguage=function(t){return e.lang=c.default.getLocale(t.toLowerCase()),e.defaults.then(function(){return e.load(e.lang).then(function(t){l.default.merge(t),u.default.init(e.lang)})})},this.whenReady=function(){return e.initPromise.promise},this.defaults=this.load(i.Configuration.LOCALE),this.defaults.then(function(e){l.default.set(e)}),this.lang=i.Configuration.LOCALE,u.default.init(i.Configuration.LOCALE),this.registerProxy()}return t.prototype.registerProxy=function(){var e=this;s.swc.Eventing.registerEvent("proxy:configuration:setLanguage",function(t){e.setLanguage(t).then(function(){s.swc.Eventing.triggerEvent("proxy:configuration:setLanguage:response",e.lang,!0)})}),o.ProxyConnector.instance.connect("configurationProxy",{})},t.prototype.init=function(e){var t=this;return e||(e=i.Configuration.LOCALE),this.setLanguage(e).then(function(){t.initPromise.resolve()}).catch(function(){t._retryCount<2&&(t._retryCount++,t.init(t.lang))})},t.prototype.load=function(t){var n=a.UrlHelper.getAppPath(s.swc.EcsConfig)+"resources/i18n/"+t+"/Strings.json";return e(n).then(function(e){return e.json()})},t.prototype.fetch=function(e,t){void 0!==t&&void 0!==t.count&&(e+=u.default.getPluralSuffix(t.count));var n=this._getKeyValueText(e);return this._replaceParams(n,t)},t.prototype.getResources=function(){return l.default.get()},t.prototype._replaceParams=function(e,t){for(var n in void 0===t&&(t={}),t)if(t.hasOwnProperty(n)){var i=t[n].toString(),r="{"+n+"}";e=e.replace(r,i)}return e},t.prototype._getKeyValueText=function(e){var t=l.default.get();return t&&t[e]?t[e]:e},t}();t.I18N=p}).call(this,n(57))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.username=e;try{this.storage=window.localStorage}catch(e){}}return e.prototype.isValid=function(e){return e.username===this.username&&e.expiresAt>Date.now()},e.prototype.get=function(e){try{var t=JSON.parse(this.storage.getItem(e));if(t&&this.isValid(t))return t.value;this.storage.removeItem(e)}catch(e){}},e.prototype.set=function(e,t,n){void 0===n&&(n=864e5);var i={username:this.username,expiresAt:Date.now()+n,value:t};try{this.storage.setItem(e,JSON.stringify(i))}catch(e){}},e}();t.LocalCacheStorage=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(273);t.TeamsUserPolicyService=i.TeamsUserPolicyService},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.actionType=o.SwiftCardActionType.unknown,r.originalPayload=t,r.actionType=t.type,r.image=t.image||t.image_url||null,r}return r(t,e),t}(n(136).default);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){var e=this;this.getDataPart=function(e){var t=e.substring(e.indexOf(".")+1);return t.substring(0,t.indexOf("."))},this.retrieveMeName=function(t){return t&&e.getTokenData(t).skypeid||""},this.getTokenData=function(t){return JSON.parse(atob(e.getDataPart(t)))}}}();t.TokenParser=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Calling="calling",e.Messaging="chat",e.Recents="recents"}(t.ModuleType||(t.ModuleType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(0),s=function(){function e(){}return e.add=function(t,n,s){if(t&&n){var a=e.build(t.ownerDocument);a.renderDialogSubscription=function(){var e=r.createElement(s,{dialogContent:n()});i.render(e,a.container)},o.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",a.renderDialogSubscription),a.renderDialogSubscription(),t.insertBefore(a.container,t.firstChild)}},e.remove=function(){if(e.instance&&e.instance.container){var t=e.instance.container.parentElement;t&&t.removeChild(e.instance.container),i.render(null,e.instance.container),this.unsubscribe()}},e.build=function(t){if(!e.instance){var n=t.createElement("div");e.instance={container:n,renderDialogSubscription:function(){}}}return i.render(null,e.instance.container),this.unsubscribe(),e.instance},e.unsubscribe=function(){o.swc.Eventing.unregisterEvent("proxy:configuration:setLanguage:response",e.instance.renderDialogSubscription)},e}();t.ConfirmationDialog=s},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),r={af:"af",am:"am",ar:"ar",as:"as",az:"az",be:"be",bg:"bg",bn:"bn",bs:"bs",chr:"chr",ca:"ca",cs:"cs",cy:"cy",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",eu:"eu",fa:"fa",fi:"fi",fil:"fil",fr:"fr",ga:"ga",gd:"gd",gl:"gl",gu:"gu",ha:"ha",he:"he",hi:"hi",hr:"hr",hu:"hu",hy:"hy",id:"id",ig:"ig",is:"is",it:"it",iw:"iw",ja:"ja",ka:"ka",kk:"kk",km:"km",kn:"kn",ko:"ko",kok:"kok",ku:"ku",ky:"ky",lb:"lb",lt:"lt",lv:"lv",mi:"mi",ml:"ml",mn:"mn",mr:"mr",ms:"ms",ne:"ne",nl:"nl",nn:"nn",nb:"nb",no:"no",nso:"nso",or:"or",pa:"pa",pl:"pl",prs:"prs",pt_br:"pt-br",pt_pt:"pt-pt",qps:"qps",qut:"qut",quz:"quz",ro:"ro",ru:"ru",rw:"rw",sd:"sd",si:"si",sl:"sl",sk:"sk",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",tg:"tg",th:"th",ti:"ti",tk:"tk",tn:"tn",tr_tr:"tr-tr",tt:"tt",ug:"ug",uk:"uk",ur:"ur",uz:"uz",vi:"vi",wo:"wo",xh:"xh",yo:"yo",zh:"zh",zu:"zu"},o={group0:{languages:[r.ja,r.id,r.ko,r.tr_tr,r.vi,r.zh,r.az,r.ig,r.fa,r.ka,r.km,r.kn,r.ms,r.prs,r.th,r.tt,r.ug,r.wo,r.yo]},group1:{languages:[r.bg,r.ca,r.cy,r.da,r.de,r.el,r.en,r.es,r.et,r.fi,r.he,r.hu,r.it,r.iw,r.nb,r.nl,r.no,r.pt_pt,r.qps,r.sv,r.af,r.as,r.bn,r.chr,r.eu,r.gl,r.gu,r.ha,r.hy,r.is,r.kk,r.kok,r.ku,r.ky,r.lb,r.mi,r.ml,r.mn,r.mr,r.ne,r.nn,r.or,r.pa,r.qut,r.quz,r.rw,r.sd,r.si,r.sq,r.sw,r.ta,r.te,r.tk,r.tn,r.ur,r.xh,r.zu]},group2:{languages:[r.fr,r.pt_br,r.am,r.fil,r.hi,r.nso,r.tg,r.ti,r.uz]},group3:{languages:[r.lv]},group4:{languages:[r.gd]},group5:{languages:[r.ro]},group6:{languages:[r.lt]},group7:{languages:[r.ru,r.uk,r.hr,r.sr,r.be,r.bs,r.sl]},group8:{languages:[r.cs,r.sk]},group9:{languages:[r.pl]},group11:{languages:[r.ga]},group12:{languages:[r.ar]}},s=function(){function e(){}return e.prototype.init=function(e){void 0===e&&(e=r.en);var t=e.replace("-","_").toLowerCase();if(!r[t]){var n=t.split("_");1===n.length&&i.default.throwError(10050,"Unsupported language:"+e),t=n[0]}this._currentLocale=t},e.prototype.getPluralSuffix=function(e){var t,n=null,i="";for(t in o)-1!==o[t].languages.indexOf(this._currentLocale)&&(n=t);switch(n){case"group0":i=1===e?"":"_few";break;case"group1":i=1===e?"":"_many";break;case"group2":i=e>1?"_many":"";break;case"group3":i=e%10==1&&e%100!=11?"":0===e?"_few":"_many";break;case"group4":i=1===e||11===e?"":2===e||12===e?"_few":"_many";break;case"group5":i=1===e?"":0===e||e%100>0&&e%100<20?"_few":"_many";break;case"group6":i=e%10==1&&e%100!=11?"":e%10>=2&&(e%100<10||e%100>=20)?"_many":"_few";break;case"group7":i=e%10==1&&e%100!=11?"":e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?"_few":"_many";break;case"group8":i=1===e?"":e>=2&&e<=4?"_few":"_many";break;case"group9":i=1===e?"":e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?"_few":"_many";break;case"group11":i=1===e?"":e>=2&&e<=10?"_few":"_many";break;case"group12":i=1===e?"":2===e?"_few":"_many";break;default:i=""}return i},e}();t.default=new s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),r=function(){function e(){this._resourcesLocation={}}return e.prototype.set=function(e){this._throwIfFalsy(e),this._resourcesLocation=e},e.prototype.merge=function(e){this._throwIfFalsy(e),Object.assign(this._resourcesLocation,e)},e.prototype.get=function(){return this._resourcesLocation},e.prototype._throwIfFalsy=function(e){e||i.default.throwError(10009,"[i18n / resources] Specified destination for localizations resources is not reachable")},e}();t.default=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Skype="skype",e.Aad="aad"}(t.TokenType||(t.TokenType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(11),o=n(26),s=n(15),a=n(23),c=n(0),u=n(7),l=function(){function e(){var e=this;this.fetch=function(){return e.mePerson?Promise.resolve(e.mePerson):e._mePersonPromise&&e._mePersonPromise.status===r.PromiseStatus.Pending?e._mePersonPromise.promise:(e._mePersonPromise=new r.CancelablePromise(e._fetchMePerson()),e._mePersonPromise.promise.catch(function(e){u.default.throwError(10007,"Unable to fetch me person",e)}),e._mePersonPromise.promise)},this.getFavouriteConversations=function(t){return void 0===t&&(t=!1),e.getMeProperties(t).then(function(e){return e.favorites?JSON.parse(e.favorites):{}})},this.getMeProperties=function(t){return void 0===t&&(t=!1),!t&&e._mePropertiesPromise||(e._mePropertiesPromise=new Promise(function(e,t){c.swc.services.signInManager.userIdentityType!==o.IdentityType.GUEST?c.swc.services.webApi.fetchMeProperties().then(function(t){e(t)}):t()})),e._mePropertiesPromise}}return Object.defineProperty(e.prototype,"mePerson",{get:function(){return c.swc.services.mePerson},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(){var e=this;c.swc.services.signInManager.userIdentityType!==o.IdentityType.GUEST&&(this.getMeProperties().then(function(t){e.fillDetails(t)}),c.swc.services.webApi.getMyPresence().then(function(t){t&&t.status?e.mePerson.presenceStatus=t.status:e.mePerson.presenceStatus=a.PresenceStatus.Offline}),this.mePerson.fetchDisplayNameAndAvatar())},e.prototype.fillDetails=function(e){if(e)if(i.default.get.backend===s.MessagingBackend.TEAMS){var t=e.userDetails?JSON.parse(e.userDetails):{},n=e.personalFileSite?JSON.parse(e.personalFileSite):{},r=e.favorites?JSON.parse(e.favorites):{};n&&(this.mePerson.personalFileSite=n),r&&(this.mePerson.pinnedConversations=r),t.name&&(this.mePerson.displayName=t.name),t.avatarUrl&&(this.mePerson.avatarData=t.avatarUrl),this.mePerson.msaId=t.upn}else this.mePerson.msaId=e.cid},e.prototype.isMe=function(e){return!!this.mePerson&&(this.mePerson.id===e||this.mePerson.msaId===e||this.mePerson.mri===e)},e.prototype._fetchMePerson=function(){var e=this;return this.mePerson?Promise.reject("[skypeConversationsManager] mePerson has been already fetched."):c.swc.services.signInManager.onceSignedIn().then(function(){return e.getDetails(),e.mePerson})},e.prototype.dispose=function(){this._mePersonPromise&&this._mePersonPromise.status!==r.PromiseStatus.Pending&&(this._mePersonPromise=null),this.mePerson&&this.mePerson.dispose()},e}();t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),s=n(0),a=function(e){function t(){var t=e.call(this)||this;return t.addAgent=function(e){return t._botsService.addAgentToContacts(e)},t.getAgent=function(e){return t._agentsService.getAgentDetails(e)},t._agentsService=s.swc.services.agentsService,t._botsService=s.swc.services.botsService,t}return r(t,e),t}(o.default);t.SkypeAgentsManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(72),o=n(5),s=n(58),a=n(108),c=function(){function e(){}return e.prototype.createNewDocument=function(e,t){var n,i,o={filename:t.name,type:(i=t.type,r.isDocumentTypeImage(i)?"pish/image":"sharing/file"),permissions:(n={},n[e]=[s.Permission[s.Permission.read]],n)};return a.post("createNewDocument","objects",JSON.stringify(o)).then(function(e){return e.json()})},e.prototype.sendFile=function(e,t){var n="objects/"+e+"/content/"+(r.isDocumentTypeImage(t.type)?"imgpsh":"original");return a.putData("sendFile",n,t)},e.prototype.getFileStatus=function(t,n){void 0===n&&(n=!1);var i=n?e.composeStatusUri(t,"imgpsh_fullsize"):e.composeStatusUri(t,"original");return this.getViewStatus(i).then(function(e){return e.scan&&"malware"===e.scan.status?{uploadStatus:s.DocumentStatus.Malware}:"ready"===e.view_state?{uploadStatus:s.DocumentStatus.Success}:e.scan&&"in progress"===e.scan.status?{uploadStatus:s.DocumentStatus.ScanInProgress}:"failed"!==e.view_state?{uploadStatus:s.DocumentStatus.InProgress}:{uploadStatus:s.DocumentStatus.Failed}})},e.prototype.downloadPictureThumbnail=function(t){var n=this,i=e.composeStatusUri(t,"imgt1");return new Promise(function(e){n.getViewUri(i).then(function(t){a.getData("downloadPictureThumbnail",t).then(e)})})},e.prototype.downloadFile=function(t){var n=this,i=e.composeStatusUri(t,"original");return new Promise(function(e){n.getViewUri(i).then(function(t){return a.getData("downloadPicture",t).then(e)})})},e.prototype.downloadPicture=function(t){var n=this,i=e.composeStatusUri(t,"imgpsh_fullsize");return new Promise(function(e){n.getViewUri(i).then(function(t){return a.getData("downloadPicture",t).then(e)})})},e.prototype.getCallRecordingThumbnail=function(e){return a.getData("getRecordingThumbnail",e)},e.prototype.downloadCallRecording=function(e){return a.getData("downloadRecording",e)},e.prototype.getPictureThumbnail=function(e){return new Promise(function(t){return a.get("getPictureThumbnail",e).then(function(e){return a.parseJson(e)}).then(t)})},e.prototype.authenticate=function(){return new Promise(function(e){o.ServicesManager.signInManager.getSkypeToken().then(function(t){var n="skypetoken="+t;return a.postForm("authenticate","skypetokenauth",n).then(e)},function(){})})},e.prototype.logout=function(){return a.get("logout","skypetokenauth/expire")},e.composeStatusUri=function(e,t){return i.Configuration.AMS_HOST_URL+"objects/"+e+"/views/"+t+"/status"},e.prototype.getViewUri=function(e,t){var n=this;return void 0===t&&(t=0),this.getViewStatus(e,t).then(function(t){var i=t.scan&&"malware"===t.scan.status;return!t.view_location||"failed"===t.view_state||i?Promise.reject({}):"ready"!==t.view_state?n.getViewUri(e,500):"expired"===t.content_state?Promise.reject({}):Promise.resolve(t.view_location)})},e.prototype.getViewStatus=function(e,t,n){var i=this;return void 0===t&&(t=0),void 0===n&&(n=3),0===n?Promise.reject({}):new Promise(function(e){setTimeout(e,t)}).then(function(){return a.getJson("getViewStatus",e).then(function(e){return e.status_location&&!e.view_state?i.getViewStatus(e.status_location,t,n):Promise.resolve(e)}).catch(function(r){return 401===r.status||403===r.status?(n--,i.authenticate().then(function(){return i.getViewStatus(e,t,n)})):Promise.reject({})})})},e}();t.AmsService=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(5);t.getHeaders=function(){var e=new Headers,t=i.Configuration.getClientVersion();return new Promise(function(n){r.ServicesManager.signInManager.getSkypeToken().then(function(r){e.append("Authorization","skype_token "+r),i.Configuration.ECS.version&&e.append("X-MS-Client-Version",t),n(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(197),o=function(){function e(){var e=this;this._agents={},this.addAgentToContacts=function(e,t){var n="relationship/"+t+"/"+e;return r.put("addAgentToContacts",n)},this.getAgentDetails=function(t){if(e._agents[t])return Promise.resolve({agentDescriptions:[e._agents[t]]});var n="agents?agentId="+t;return r.get("getAgentDetails",n).then(function(t){return t&&t.agentDescriptions&&t.agentDescriptions.forEach(function(t){e._agents[t.agentId]=t;var n=i.ServicesManager.persons.getPerson("28:"+t.agentId);n.displayName=t.displayName,n.avatarData=t.userTileSmallUrl||t.userTileStaticUrl||""}),t})},this.searchAgents=function(t){var n="agents?q="+t;return r.get("searchAgents",n).then(function(t){return t&&t.agentDescriptions&&t.agentDescriptions.forEach(function(t){e._agents[t.agentId]=t;var n=i.ServicesManager.persons.getPerson("28:"+t.agentId);n.displayName=t.displayName,n.avatarData=t.userTileSmallUrl||t.userTileStaticUrl||""}),t})}}return Object.defineProperty(e.prototype,"agents",{get:function(){return this._agents},enumerable:!0,configurable:!0}),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(198),s={retryCount:3,timeout:12e4,policy:""};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n){return r.default("aps-"+e,s,i.Configuration.APS_HOST_URL+t,n).then(function(e){return e.json()})}(e,t,o)})},t.put=function(e,t,n){return void 0===n&&(n=""),o.putHeaders().then(function(o){var a={method:"PUT"};return a.body=n,a.headers=o,function(e,t,n){return r.default("aps-"+e,s,i.Configuration.APS_HOST_URL+t,n)}(e,t,a)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5);t.getHeaders=function(){var e=new Headers;return new Promise(function(t){i.ServicesManager.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),e.append("Pragma","no-cache"),e.append("Cache-Control","no-cache, no-store, must-revalidate"),t(e)},function(){})})},t.putHeaders=function(){var e=new Headers;return new Promise(function(t){i.ServicesManager.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),t(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(200),o=function(){function e(){var e=this;this.resetAuth=function(){e.authenticationPromise=null},this.authenticate()}return e.prototype.authenticate=function(){var e=this;if(this.authenticationPromise)return this.authenticationPromise;return this.authenticationPromise=r.postRaw("cookie","/beta/imageauth/cookie"),this.authenticationPromise.then(function(){setTimeout(function(){e.authenticationPromise=null},54e4)}),this.authenticationPromise},e.prototype.fetchAvatars=function(e,t){var n=this,i="/beta/users/"+e+"/profilepicturev2",o={displayname:t,voidCache:"true"},s=r.addGetParamsToUrl(i,o);return this.authenticate().then(function(){return n.fetchSingleAvatar(s)},this.resetAuth)},e.prototype.fetchSingleAvatar=function(e){return r.getRaw("avatars",e,{cache:"default"}).then(function(e){return e.url},this.resetAuth)},e.prototype.fetchMergedAvatars=function(e){var t=e.filter(function(e){return e.userId!==i.ServicesManager.mePerson.mri});t.length>4&&(t=t.slice(0,3));var n="/beta/users/mergedProfilePicturev2?usersInfo="+encodeURIComponent(JSON.stringify(t))+"&size=HR64x64&voidCache=true";return this.authenticate().then(function(){return r.getRaw("mergedAvatars",n).then(function(e){return e.url})},this.resetAuth)},e}();t.default=o},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(10),s=n(201),a={retryCount:3,timeout:12e4,policy:""},c=function(e,t,n){return 0!==t.toString().indexOf("http")&&(t=r.Configuration.AVATAR_SERVICE_URL+t),o.default("avatar-"+e,a,t,n)};t.get=function(e,n){return t.getRaw(e,n).then(function(e){return e.json()})},t.getRaw=function(e,t,n){return void 0===n&&(n={}),s.getHeaders().then(function(r){var o={method:"GET"};return o.headers=r,o.cache="no-cache",o.credentials="include",c(e,t,i({},o,n||{}))})},t.post=function(e,n){return t.postRaw(e,n).then(function(e){return e.json()})},t.postRaw=function(e,t){var n="cookie"===e;return s.getHeaders(n).then(function(n){var i={method:"POST"};return i.headers=n,i.cache="no-cache",i.credentials="include",c(e,t,i)})};var u=n(51);t.addGetParamsToUrl=u.addGetParamsToUrl},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(15),s=n(5);t.getHeaders=function(e){return void 0===e&&(e=!1),i.default.get.backend===o.MessagingBackend.TEAMS?s.ServicesManager.signInManager.aad().then(function(t){var n=new Headers;return e&&n.append("authorization",t),n.append("x-ms-client-type","web"),n.append("x-ms-user-type","user"),n}):new Promise(function(e){s.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("x-skypetoken",t),n.append("x-skype-client",r.Configuration.getClientVersion()),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(203);t.TeamsCapabilitiesService=i.TeamsCapabilitiesService},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var n=e.call(this)||this;return n.userPolicyService=t,n}return r(t,e),t.prototype.getCommonCapabilities=function(t){return Promise.all([e.prototype.getCommonCapabilities.call(this,t),this.userPolicyService.getMessagingPolicy(),this.userPolicyService.getCallingPolicy()]).then(function(e){var t=e[0],n=e[1],i=e[2];return{allowEditMessage:t.allowEditMessage&&n.allowUserEditMessage,allowDeleteMessage:t.allowDeleteMessage&&n.allowUserDeleteMessage,allowChat:t.allowChat&&n.allowUserChat,allowUploadFiles:t.allowUploadFiles,allowSendEmoticons:t.allowSendEmoticons,allowCalling:t.allowCalling&&(i.allowPrivateCalling||i.allowGroupCalling)}})},t.prototype.getCapabilitiesForConversation=function(t){return Promise.all([e.prototype.getCapabilitiesForConversation.call(this,t),this.userPolicyService.getCallingPolicy()]).then(function(e){var t=e[0],n=e[1];return o({},t,{allowCalling:t.allowCalling&&n.allowPrivateCalling})})},t}(n(144).SkypeCapabilitiesService);t.TeamsCapabilitiesService=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),a=n(11),c=n(7),u=n(21),l=n(132),p=n(32),d=n(5),f=n(10),h=n(205),g=n(91),m=n(145),v=n(23),y=n(49),_=[v.ThreadType.Chat,v.ThreadType.SfbInterop,v.ThreadType.SfbInteropChat];function b(e){var t={conversations:[],users:[],_metadata:{},hasMoreConversations:!!e.continuationToken},n={};return e.items.forEach(function(e){t.conversations.push(w(e)),e.members.forEach(function(e){return n[e.mri]=e})}),Object.keys(n).map(function(e){return t.users.push(n[e])}),t}function w(e){var t=e.consumptionHorizon,n=t?t.timeStamp+";"+t.originalArrivalTime+";"+t.clientMessageId:void 0,i=e.lastMessage;return{id:e.id,lastMessage:{id:i.id,clientmessageid:i.clientMessageId,from:i.from,messagetype:i.messageType,originalarrivaltime:i.originalArrivalTime,content:i.content,composetime:i.composeTime,version:i.version+"",messageid:i.id},isOneOnOne:e.isOneOnOne,properties:{consumptionhorizon:n,picture:"",lastimreceivedtime:""},threadProperties:{topic:e.title,picture:"",historydisclosed:!0,threadType:C(e)},version:e.version,members:e.members.map(function(e){return{id:e.mri,role:e.role,name:e.displayName}})}}function C(e){return 1===e.interopType||-1!==e.id.indexOf("@sfb.unq.gbl.spaces")?v.ThreadType.SfbInterop:v.ThreadType.Chat}var S=function(e){function t(t){var n=e.call(this)||this;return n.chatServiceAggregatorClient=t,n.setContinuationToken=function(e){return e.continuationToken&&(n.csaContinuationToken=e.continuationToken),e},n.fetchMessagesByLink=function(e){if(-1===e.indexOf("startTime")&&(e=u.UrlHelper.appendQueryParam(e,"startTime",0)),0!==e.indexOf(s.Configuration.CHAT_HOST_URL))try{var t=new URL(e),n=new URL(s.Configuration.CHAT_HOST_URL);t.hostname=n.hostname,e=t.toString()}catch(e){}return g.getPolling().authorization.then(function(){return y.getWithDomain("fetchMessagesByLink",e,{},!0).then(function(e){return y.parseJson(e)})},console.warn)},n}return r(t,e),t.prototype.fetchRecentConversationsV2=function(e){if(this.chatServiceAggregatorClient)return this.chatServiceAggregatorClient.getUserChats(e,this.csaContinuationToken).then(this.setContinuationToken).then(b);return Promise.resolve({conversations:[],users:[],_metadata:{},hasMoreConversations:!1})},t.prototype.fetchRecentConversations=function(e,t){var n=this;if(this._prefetchPromise){var i=this._prefetchPromise;return this._prefetchPromise=void 0,i}if(s.Configuration.ECS.isCsaV2Enabled)return this.fetchRecentConversationsV2(t);if(this._fetchRecentsPromise&&this._fetchRecentsPromise.status===a.PromiseStatus.Pending)return this._fetchRecentsPromise.promise;var r=d.ServicesManager.signInManager.aad(p.AadAudience.AggregationApi).then(function(i){return d.ServicesManager.signInManager.onceSignedIn().then(function(){return f.default("teams-recents",{retryCount:1,timeout:12e4,policy:""},"https://chatsvcagg.teams.microsoft.com/api/v1/teams/users/me/chats?isPrefetch=false&enableMembershipSummary=false",{method:"get",headers:{Authorization:i,"x-ms-client-type":"swc","x-ms-user-type":s.Configuration.getUiVersion()}}).then(function(i){return i?i.json&&i.json().then(function(e){var t=[],n=[],i={};return e.forEach(function(e){var r=w(e);t.push(r),e.members.forEach(function(e){!i[e.mri]&&e.displayName&&(i[e.mri]=!0,n.push(e))})}),{conversations:t,users:n,_metadata:{},hasMoreConversations:!1}},function(i){return n.fetchRecentConversationsFallback(e,t)}):n.fetchRecentConversationsFallback(e,t)},function(i){return n.fetchRecentConversationsFallback(e,t)})},function(){n._fetchRecentsPromise.cancel(),n._fetchRecentsPromise=null})});return this._fetchRecentsPromise=new a.CancelablePromise(r),this._fetchRecentsPromise.promise},t.prototype.fetchRecentConversationsFallback=function(e,t){var n=this;if(void 0===e&&(e=1),void 0===t&&(t=100),!this._fetchRecentsPromise||this._fetchRecentsPromise.status!==a.PromiseStatus.Pending){return Promise.resolve({conversations:[],_metadata:{},hasMoreConversations:!1})}var i={view:"supportsExtendedHistory|msnp24Equivalent|supportsMessageProperties",pageSize:t,startTime:e};this.syncState?i.syncState=this.syncState:i.targetType="Passport|Skype|Lync|Thread|Agent|ShortCircuit|PSTN|SmsMms|Flxt|NotificationStream|Highlights|Cast|CortanaBot|ModernBots|InviteFree";var r=y.addGetParamsToUrl("users/ME/conversations",i);return y.get("fetchRecents-teams",r).then(function(e){e.ok?n._fetchRecentsPromise.isCanceled||y.parseJson(e).then(function(e){n.syncState=n.getSyncState(e._metadata.syncState);var t=e.conversations.filter(function(e){return e.threadProperties&&(t=e.threadProperties.threadType,_.some(function(e){return e===t}));var t});n.allConversations=n.allConversations.concat(t),n._fetchRecentsPromise.resolve({conversations:n.allConversations,hasMoreConversations:!!e._metadata.backwardLink})}).catch(function(t){c.default.throwError(112,"fetchRecentConversationsFallback unable to parse response",t),n._fetchRecentsPromise.cancel(e,n.allConversations)}):n._fetchRecentsPromise.cancel(e,n.allConversations)}),this._fetchRecentsPromise=new a.CancelablePromise,this._fetchRecentsPromise.promise},t.prototype.fetchMessages=function(e,t,n){void 0===t&&(t=20),void 0===n&&(n=0);var i={pageSize:t,view:"msnp24Equivalent|supportsMessageProperties",startTime:n},r=y.addGetParamsToUrl("users/ME/conversations/"+e+"/messages",i);return g.getPolling().authorization.then(function(){return y.get("fetchMessages",r).then(function(e){return y.parseJson(e).then(function(e){return e})})})},t.prototype.sendMessage=function(t,n){var i=o({},n,{messagetype:n.messagetype===v.MessagePayloadType.RichText?v.MessagePayloadType.RichTextHtml:n.messagetype});if(h.isInteropEnabled(t)){if(n.messagetype===v.MessagePayloadType.ControlTyping||n.messagetype===v.MessagePayloadType.ControlClearTyping)return Promise.reject("Typing not supported in SFB");i=h.addInteropDataToMessage(t,n)}return e.prototype.sendMessage.call(this,t,i)},t.prototype.editMessage=function(t,n,i,r){return i=i===v.MessagePayloadType.RichText?v.MessagePayloadType.RichTextHtml:i,e.prototype.editMessage.call(this,t,n,i,r)},t.prototype.deleteMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages/"+t,i=y.addGetParamsToUrl(n,{behavior:"softDelete"});return y.del("deleteMessage",i)},t.prototype.addParticipant=function(e,t,n){var i="threads/"+e+"/members",r={members:[{id:t,role:"Admin",shareHistoryTime:-1}]};return y.post("addParticipant",i,{body:JSON.stringify(r)})},t.prototype.setFavoriteConversation=function(e,t){var n=y.addGetParamsToUrl("users/ME/properties",{name:"favorites"});return g.getPolling().authorization.then(function(){return y.put("setFavoriteConversation",n,{body:JSON.stringify({favorites:JSON.stringify(t)})})})},t.prototype.removeFavoriteConversation=function(e,t){return this.setFavoriteConversation(e,t)},t.prototype.createThread=function(e){e.forEach(function(e){return e.role="Admin"});var t={members:e,properties:{chatFilesIndexId:2,threadType:v.ThreadType.Chat}};2===e.length&&(t.properties=o({},t.properties,{fixedRoster:!0,uniquerosterthread:!0}));var n={headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript"},body:JSON.stringify(t)};return y.post("thread","threads",n)},t.prototype.setBlockedConversation=function(e,t){return Promise.resolve(null)},t.prototype.subscribeContactPresence=function(e){return s.Configuration.ECS.contactPresenceEnabled?(-1===e.indexOf("8:")&&(e="8:"+e),d.ServicesManager.presenceService.subscribe(e,function(t){var n=d.ServicesManager.persons.getPerson(e);t.presence&&(n.presenceStatus=l.getStatusFromAvailability(t.presence.availability))}),Promise.resolve()):Promise.resolve()},t}(m.ConversationConsumerWebApi);t.ConversationTeamsWebApi=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(206))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(23);t.isInteropEnabled=function(e){return-1!==e.indexOf("@sfb.unq.gbl.spaces")},t.addInteropDataToMessage=function(e,t){try{var n=i.swc.services.conversations.get(e),c=s(n).email,u=a(n).mri;return t={clientmessageid:t.clientmessageid,content:t.content,contenttype:t.contenttype,messagetype:r.MessagePayloadType.Text,amsreferences:t.amsreferences||[],imdisplayname:t.imdisplayname,properties:{importance:"",interopType:"receiverSfB",subject:null},fromSipUri:"sip:"+c,toSipUri:"sip:"+o(u)}}catch(e){}return t};var o=function(e){var t=i.swc.services.contactsService.getContactByMri(e);return t?t.email:void 0},s=function(e){return e.selfParticipant.person},a=function(e){var t,n=e.selfParticipant.person.mri;return e.participants.some(function(e){return e.person.mri!==n&&(t=e.person,!0)}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.enableLongPollTabActivation=function(e){i.swcWindow.addEventListener("focus",function(){e.resume()}),i.swcWindow.addEventListener("blur",function(){e.pause()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(30),r=n(0),o=function(){function e(){var e=this;this.registrations={},this.setupProxy=function(){r.swc.Eventing.registerEvent("proxy:threadNotifications:register",function(t){return e.register(t.botId,t.conversationId)}),r.swc.Eventing.registerEvent("proxy:threadNotifications:unregister",function(t){return e.unregister(t.botId,t.conversationId)})},i.ProxyConnector.instance.connect("threadNotifications",null,this.setupProxy)}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},Object.defineProperty(e.prototype,"empty",{get:function(){return!Object.keys(this.registrations).length},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t){var n=this.registrations[e]=this.registrations[e]||[];t&&-1===n.indexOf(t)&&n.push(t)},e.prototype.unregister=function(e,t){var n=this.registrations[e];if(n)if(t){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}else delete this.registrations[e]},e.prototype.notify=function(e,t,n){var i=this.registrations[e];!i||i.length&&-1===i.indexOf(t)||r.swc.Eventing.triggerEvent("proxy:threadNotifications:notify",{botId:e,conversationId:t,message:n})},e}();t.ThreadNotifications=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=null,o=1;function s(){i&&clearTimeout(i)}t.execute=function(e){s(),null===r&&(r=1e3),i=setTimeout(e,r+.5*Math.random()*r),r<12e4&&(r*=++o)},t.stop=function(){s()},t.reset=function(){s(),r=null,o=1}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s,a,c,u=n(1),l=n(11),p=n(13),d=n(54),f=n(5),h=n(211),g=n(49);!function(e){e.ConversationProperties="/v1/users/ME/conversations/ALL/properties",e.ConversationMessages="/v1/users/ME/conversations/ALL/messages",e.Threads="/v1/threads/ALL"}(s||(s={})),function(e){e.Agent="Agent",e.Presence="Presence2015",e.MessageProperties="MessageProperties",e.CustomUserProperties="CustomUserProperties",e.NotificationStream="NotificationStream"}(a||(a={})),function(e){e.Poll="HttpLongPoll"}(c||(c={}));var m={baseUrl:"",isActiveUrl:"",longPollUrl:"",clientInfo:"",cnsEnabled:!1},v=function(){return o({},m,{baseUrl:u.Configuration.CHAT_HOST_URL.replace(/\/v\d\/?$/,""),clientInfo:u.Configuration.getChatClientInfo(),cnsEnabled:!u.Configuration.ECS.cnsPollingDisabled})};t.getTeamsPolling=function(){return v().cnsEnabled?new b:new h.PollingTeams};var y,_=!1,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentAttempt=0,t._startPollingSequence=function(e){return Promise.resolve()},t.reset=function(){return t.stop(),t.start(),Promise.resolve()},t.setupPolling=function(e){return m.isActiveUrl=e.isActiveUrl,m.longPollUrl=e.subscriptions.pop().longPollUrl,v().longPollUrl},t.createEndpoint=function(){var e={startingTimeSpan:0,endpointFeatures:[a.Agent,a.MessageProperties].join(","),subscriptions:[{channelType:c.Poll,interestedResources:[s.ConversationMessages,s.ConversationProperties,s.Threads]}]},n=new Headers,i={headers:n,body:JSON.stringify(e)},r=f.ServicesManager.signInManager.getSkypeToken().then(function(e){n.set("authentication","skypetoken="+e),n.set("BehaviorOverride","redirectAs404"),n.set("clientinfo",u.Configuration.getChatClientInfo()),n.set("content-type","application/json");var t=p.guid.generate();return g.put("polling-teams",v().baseUrl+"/v2/users/ME/endpoints/"+t,i,!0,!0)}).then(function(e){return e.ok&&e.json?(t._authPromise.resolve(),e.json()):Promise.reject("Failed to create endpoint")});return t._endpointCreationPromise=new l.CancelablePromise(r),r},t.poll=function(e){if(t.longPollPromise)return t.longPollPromise;var n=new Headers,i={headers:n};return t.longPollPromise=new l.CancelablePromise(f.ServicesManager.signInManager.getSkypeToken().then(function(t){return n.set("authentication","skypetoken="+t),n.set("BehaviorOverride","redirectAs404"),n.set("clientinfo",v().clientInfo),n.set("content-type","application/json"),y=void 0,g.get("polling-teams",e,i,!0)}).then(function(e){t.longPollPromise.isCanceled||(t.longPollPromise=void 0,e.ok&&e.json&&e.json().then(function(e){return e.eventMessages&&t.dispatch(e.eventMessages),y=e.next,_?Promise.reject("[PollingTeamsCns.poll] Polling Paused, stopping"):e.next?t.poll(e.next):Promise.reject("[PollingTeamsCns.poll] No next link returned, reseting")}))}).catch(function(){return t.longPollPromise=void 0})),t.longPollPromise},t.dispatch=function(e){t.handlePollData({eventMessages:e})},t}return r(t,e),t.prototype.pause=function(){_=!0},t.prototype.resume=function(){_&&y&&(_=!1,this.poll(y))},t.prototype.start=function(){var e=this;if(!this.isPolling){this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0);var t=this.createEndpoint().then(this.setupPolling).then(this.poll).then(function(){e.currentAttempt=0}).catch(function(t){var n=1e3*Math.exp(++e.currentAttempt);e.retryTimeout=setTimeout(e.reset,n)});this._pollingPromise=new l.CancelablePromise(t),d.get().subscribe("isOnline",function(t){t?e.reset():e.stop()})}},t.prototype.stop=function(){try{this._pollingPromise.cancel(),this.longPollPromise.cancel()}catch(e){}},Object.defineProperty(t.prototype,"isPolling",{get:function(){return!!this.longPollPromise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authorization",{get:function(){return this._authPromise.promise},enumerable:!0,configurable:!0}),t}(h.PollingTeams);t.PollingTeamsCns=b},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(7),a=n(132),c=n(212),u=n(146),l=n(31),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setEndpointPresence=function(){if(o.swc.services.signInManager.isAadSupported())try{var e=o.swc.services.mePerson.mri;o.swc.services.presenceService.subscribe(e,t.handleNotifications),o.swc.services.presenceService.startPolling()}catch(e){s.default.throwError(103501,"Presence init failed.")}return Promise.resolve()},t.handleNotifications=function(e){e.etagMatch||("Self"===e.presence.sourceNetwork&&e.presence.deviceType===a.DeviceType.Desktop?o.swc.services.notificationsManager.disableNotifications():o.swc.services.notificationsManager.enableNotifications())},t.onEndpointCreation=function(e){0===o.swc.services.signInManager.currentUserName.indexOf("teamsvisitor:")||(t._setEndpointProperty(u.SET_ENDPOINT_PROPERTY,!0),t.setEndpointPresence())},t.filterOutUnsupportedEvents=function(e){var n=!!e.resource,i=e.resource,r=n&&"ThreadActivity/MemberConsumptionHorizonUpdate"===i.messagetype,o=l.getConversationIdFromUrl(e.resourceLink),s=n&&o===l.TEAMS_NOTIFICATION_CHANNEL_ID,a=n&&l.isThread(i),u=!a&&n&&i.threadtype,p=!a&&n&&i.properties&&i.properties.consumptionHorizonBookmark;return!(r||s||a)&&(!(!u&&!p||a)||(c.reportEnterprisePollFormatViolation(e),(!n||!l.isThreadExtended(i))&&(t.validateAndDispatch(e),!1)))},t.ongoingValidations={},t.validateAndDispatch=function(e){var n=l.getConversationIdFromUrl(e.resourceLink);t.ongoingValidations[n]||(t.ongoingValidations[n]=o.swc.services.webApi.fetchConversation(n)),t.ongoingValidations[n].then(function(n){!l.isThreadExtended(n)&&n.id&&(o.swc.services.conversations.get(n.id).update(n),t._handlePollData({eventMessages:[e]}))})},t.handlePollData=function(e){e.eventMessages&&(e.eventMessages=e.eventMessages.filter(t.filterOutUnsupportedEvents)),t._handlePollData(e)},t}return r(t,e),t.prototype.start=function(){},t.prototype._getInterestedResources=function(){return["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/threads/ALL","/v1/users/ME/contacts/ALL"]},t}(u.Polling);t.PollingTeams=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(31),o=n(22);function s(e,t){var n=t.split("."),i=e;return!1===n.some(function(e){return!i[e]||(i=i[e],!1)})?i:void 0}t.reportEnterprisePollFormatViolation=function(e){try{var t=r.getConversationIdFromUrl(e.resourceLink),n=(c=e,["resource.threadtype","resource.threadType","resource.threadProperties.threadtype","resource.threadProperties.threadType","resource.properties.threadtype","resource.properties.threadType","resource.type"].some(function(e){return!!s(c,e)&&(u=e,!0)}),u),a=s(e,n);i.swc.Telemetry.sendEvent.pollingFormatViolation(t,n,a,e.resourceType,e.resource&&e.resource.messagetype||o.NA,e.resource&&e.resource.type||o.NA)}catch(e){}var c,u}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(32),s=n(147),a="teams-csa",c=function(){function e(e,t,n){void 0===n&&(n={}),this.customHeaders=n,this.client=new s.JsonClient(a,e),this.createAuthenticationHandler(t),this.client.setAuthentication(this.authenticationHandler)}return e.prototype.createAuthenticationHandler=function(e){var t=this;this.authenticationHandler=function(n){return void 0===n&&(n={}),n.headers=n.headers||{},e(o.AadAudience.AggregationApi).then(function(e){var o=i({Authorization:e,"x-ms-client-type":"swc","x-ms-client-version":r.Configuration.getClientVersion()},t.customHeaders);return Object.assign(n.headers,o),n})}},e.prototype.getUserChats=function(e,t){void 0===e&&(e=20);var n={version:"v2",pageSize:e,continuationToken:t};return this.client.get("/api/:version/teams/users/me/chats",n)},e}();t.ChatServiceAggregatorClient=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(51);t.buildUriFromTemplate=function(e,t,n){n=Object.assign({},n);var r=t.split("/");return r.forEach(function(e,t){var i=e.substr(1);(function(e){return 0===e.indexOf(":")})(e)&&n[i]&&(r[t]=n[i].toString(),delete n[i])}),t=r.join("/"),e.lastIndexOf("/")===e.length-1&&(e=e.substr(0,e.length-1)),0!==t.indexOf("/")&&(t="/"+t),i.addGetParamsToUrl(""+e+t,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(32),o=n(147),s="teams-middletier",a=function(){function e(e,t){this.client=new o.JsonClient(s,e),this.createAuthenticationHandler(t),this.client.setAuthentication(this.authenticationHandler)}return e.prototype.createAuthenticationHandler=function(e){this.authenticationHandler=function(t){return void 0===t&&(t={}),t.headers=t.headers||{},e(r.AadAudience.SpacesApi).then(function(e){0!==e.toLowerCase().indexOf("bearer")&&(e="Bearer "+e);var n={Authorization:e,"x-ms-client-type":"swc","x-ms-client-version":i.Configuration.getClientVersion()};return Object.assign(t.headers,n),t})}},e.prototype.getUsers=function(e){return this.client.post("/:version/users/fetch",{version:"v2",isMailAddress:!1,canBeSmtpAddress:!1,enableGuest:!0,skypeTeamsInfo:!0},e).then(function(e){return e.value})},e}();t.TeamsMiddleTierClient=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(19),o=n(11),s=n(5),a=n(148),c=function(){function e(){var e=this;this._contactsByEmail=[],this._haveAllContactsByEmail=!1,this.fetchContactsByMail=function(t,n,i){void 0===t&&(t=100),void 0===n&&(n=10);var r=0;if(e._fetchContactsByMailPromise)return i&&i(e._contactsByEmail),e._fetchContactsByMailPromise.promise;var a=new Promise(function(o,a){var c=function(){if(!e._fetchContactsByMailPromise||!e._fetchContactsByMailPromise.isCanceled){s.ServicesManager.microsoftGraphService.fetchCommonEmails(t,r*t).then(function(s){if(!e._fetchContactsByMailPromise.isCanceled)if(s&&s.value){if(0===s.value.length)return void(e._haveAllContactsByEmail=!0);var u=[];s.value.forEach(function(e){e.scoredEmailAddresses.forEach(function(e){u.push(e.address)})}),e.getContactsByEmail(u).then(function(s){if(!e._fetchContactsByMailPromise.isCanceled){if(!s.ok){var l={code:s.status,message:s.statusText};return a(l),void(e._fetchContactsByMailPromise=null)}s.json().then(function(l){return function(l){if(!l)return e._haveAllContactsByEmail=!0,void(e._contactsByEmail?o(e._contactsByEmail):(a({status:s.status,statusText:s.statusText}),e._fetchContactsByMailPromise=null));i&&i(l.contacts),e._contactsByEmail=e._contactsByEmail.concat(l.contacts),e._haveAllContactsByEmail=e._haveAllContactsByEmail||e._contactsByEmail.length>=n||u.length<t,e._haveAllContactsByEmail?o(e._contactsByEmail):(r++,c())}(l)},function(t){a(t),e._fetchContactsByMailPromise=null})}}).catch(function(e){a(e)})}else e._contactsByEmail?o(e._contactsByEmail):(a({status:0,statusText:"No emails to get skypeIds"}),e._fetchContactsByMailPromise=null)}).catch(function(e){a(e)})}};s.ServicesManager.signInManager.onceSignedIn().then(c.bind(e))});return e._fetchContactsByMailPromise=new o.CancelablePromise(a),e._fetchContactsByMailPromise.promise},s.ServicesManager.signInManager.subscribe("state",function(t){t===r.SigninState.SignedOut&&e.dispose()})}return Object.defineProperty(e.prototype,"fetchContactsByMailPromise",{get:function(){return this._fetchContactsByMailPromise&&this._fetchContactsByMailPromise.promise},enumerable:!0,configurable:!0}),e.prototype.getContactsByEmail=function(e){var t={Emails:e};return a.post("fetchContactsByEmail","scdemaillookup",JSON.stringify(t),i.Configuration.CONTACTS_SCD_HOST_URL)},e.prototype.dispose=function(){this._contactsByEmail=[],this._fetchContactsByMailPromise&&this._fetchContactsByMailPromise.status===o.PromiseStatus.Pending&&this._fetchContactsByMailPromise.cancel(),this._fetchContactsByMailPromise=null},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(1);t.getHeaders=function(){return new Promise(function(e){i.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),n.append("X-Skype-Caller",r.Configuration.getUiVersion()),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),r=n(7),o=n(5),s=function(){function e(){var e=this;this._rawContacts=[],this._rawContactIds={},this.fetchMyContacts=function(t,n){if(e._fetchContactsPromise)return e._fetchContactsPromise.promise;var s=o.ServicesManager.webApi.fetchRecentConversations().then(function(t){e._rawContacts=[];var n=t;if(!n)return r.default.throwError(11010,"Unable to fetch contacts"),{};if(!n.users)return{contacts:[],count:0,scope:"",duration:0};var i=o.ServicesManager.mePerson;return n.users.forEach(function(t){if(t.mri===i.mri)return i.displayName=t.displayName,void(i.email=t.userPrincipalName);e._rawContacts.push({id:t.mri,person_id:t.mri,type:t.type,display_name:t.displayName,authorized:!0,blocked:!1,avatar_url:"",mood:"",name:{first:t.givenName,surname:t.surname,nickname:"",company:""},mri:t.mri,email:t.userPrincipalName,objectId:t.objectId}),e._rawContactIds[t.mri]=!0}),{contacts:e._rawContacts,count:n.users.length,scope:"",duration:0}},function(t){e._fetchContactsPromise=null,r.default.throwError(11010,"Unable to fetch contacts",t)});return e._fetchContactsPromise=new i.CancelablePromise(s),e._fetchContactsPromise.promise},this.getContactsUpdate=function(e){return Promise.resolve()},this.getContact=function(t,n){var i=e._rawContacts.filter(function(e){return e.mri.indexOf(n)>-1});return i.length?Promise.resolve(i[0]):e.fetchContactById(n)},this.addContact=function(t,n,i){return i&&!e._rawContactIds[i.mri]&&e._rawContacts.push(i),Promise.resolve()},this.blockContact=function(e,t,n){return Promise.resolve()},this.unblockContact=function(e){return Promise.resolve()},this.addFavoriteContact=function(e){return Promise.resolve()},this.removeFavoriteContact=function(e){return Promise.resolve()},this.dispose=function(){},this.getContactByObjectId=function(t){var n;return e._rawContacts.some(function(e){return t===e.objectId&&(n=e,!0)}),n?Promise.resolve(n):e.fetchContactById(t)}}return e.prototype.getContactByMri=function(e){var t=this._rawContacts.filter(function(t){return t.mri===e});return t.length?t[0]:void 0},Object.defineProperty(e.prototype,"contactsList",{get:function(){return this._rawContacts},enumerable:!0,configurable:!0}),e.prototype.getBlockedList=function(){return Promise.resolve([])},e.prototype.getContactByMriIfPresent=function(e){return""},e.prototype.fetchContactById=function(t){var n=this;return o.ServicesManager.stratusService.fetchShortProfile([t]).then(function(t){return e.createContactFromShortProfile(t[0])}).then(function(e){return n.addContact(e.mri,"",e),e})},e.createContactFromShortProfile=function(e){return{id:e.mri,person_id:e.mri,type:e.type,display_name:e.displayName,authorized:!0,blocked:!1,avatar_url:"",mood:"",mri:e.mri,email:e.email,objectId:e.objectId}},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.reportContactsLoadedQosError=function(e,t){i.swc.Telemetry.sendEvent.contactsLoadedQos(e,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.items=[],this.key=e}return e.prototype.reset=function(){this.items=[]},e.prototype.add=function(e,t){var n=this;e&&(e.forEach(function(e){n.items=n.items.filter(function(t){return t[n.key]!==e[n.key]})}),t&&(e=e.filter(function(e){return!e.deleted})),this.items=this.items.concat(e))},e.prototype.getItems=function(){return this.items},e.prototype.getItemsByType=function(e){return this.items.filter(function(t){return 0===t.person_id.indexOf(e+":")})},e}(),r=function(){function e(){this.callCount=0,this.contacts=new i("mri"),this.blocklist=new i("mri"),this.groups=new i("id"),this.duration=0,this.firstScope=""}return e.prototype.reset=function(){this.firstScope="",this.contacts.reset(),this.groups.reset(),this.blocklist.reset()},e.prototype.update=function(e){this.callCount++,e&&(this.callCount>1&&"full"===e.scope&&this.reset(),e.scope&&!this.firstScope&&(this.firstScope=e.scope),this.contacts.add(e.contacts,!0),this.groups.add(e.groups,!1),this.blocklist.add(e.blocklist,!0))},e.prototype.filter=function(e){return this.contacts.getItemsByType(e)},e}();t.ContactsInfo=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(19),a=n(12),c=n(26),u=n(0),l=n(42),p=n(36),d=n(91),f=n(5),h=n(133),g=n(222),m=n(149),v="8:echo123",y=function(e){function t(){var t=e.call(this)||this;return t._contactsData={contacts:[],blocked:[],groups:[]},t._fetchContactsResolved=!1,t._updateContact=function(e,t){var n=f.ServicesManager.persons.getPerson(e.skypeid,!1);e.blocked=n.isBlocked=t.blocked,e.favorite=n.isFavorite=t.favorite;var i=t.profile&&t.profile.avatar_url?t.profile.avatar_url:null;i&&i!==e.avatar&&(e.avatar=n.avatarData=i),t.display_name&&t.display_name!==e.name&&(e.name=n.displayName=t.display_name)},t._addNewContact=function(e){var n=t._mapContact(e);t._contactsData.contacts.push(n),t._createPerson(n),u.swc.Eventing.triggerEvent("contactAdded",n)},t._handleContactUpdate=function(e){e.contacts&&e.contacts.length&&e.contacts.forEach(function(e){for(var n=!1,i=0;i<t._contactsData.contacts.length;i++){var r=t._contactsData.contacts[i];if(r.skypeid===e.mri){t._updateContact(r,e),n=!0;break}}n||t._addNewContact(e)})},t._onContactListChangedNotification=function(){t._contactsService.getContactsUpdate(m.reasons.NOTIFICATION).then(t._handleContactUpdate)},t._mapContact=function(e){return{skypeid:e.mri,name:e.display_name,favorite:e.favorite,blocked:e.blocked,normalized_name:p.normalizeString(e.display_name),avatar:e.profile&&e.profile.avatar_url?e.profile.avatar_url:"",type:l.default.getContactType({mri:e.mri})}},t.fetchMyContacts=function(e){var n=Date.now();return t._fetchContactsResolved?new Promise(function(e){e(t._contactsData)}):t._contactsService.fetchMyContacts(d.PAGE_SIZE.default).then(function(e){if(!t._fetchContactsResolved&&e){var i=[];e&&e.contacts&&(i=e.contacts.filter(function(e){return!(e.mri.indexOf("4:")>-1)&&e.mri!==v})),t._contactsData.groups=e.groups,t._contactsData.contacts=i.map(t._mapContact),t._createPersonForAllContacts(t._contactsData.contacts),e.blocklist&&(t._contactsData.blocked=e.blocklist.map(function(e){return{skypeid:e.mri}})),t._fetchContactsResolved=!0,t._sendTelemetryData(t._contactsData,n)}return t._contactsData},function(e){})},t.isPersonContact=function(e){return new Promise(function(n,i){t._isPersonContactPromiseRejectCallback=i,u.swc.services.signInManager.getSkypeToken().then(function(i){var r=u.swc.services.signInManager.currentUserName;if(u.swc.services.signInManager.userIdentityType===c.IdentityType.GUEST)return n(!0);t._contactsService.getContact(r,e).then(function(i){t._isPersonContactPromiseRejectCallback=null,n(t.isContact(i,e))},function(e){t._isPersonContactPromiseRejectCallback(!1),t._isPersonContactPromiseRejectCallback=null})},t._isPersonContactPromiseRejectCallback.bind(t,{source:"onSigninFailed"}))})},t.addContact=function(e,n){return t._contactsService.addContact(e,n)},t.blockContact=function(e,n,i){return t._contactsService.blockContact(e,n,i)},t.unblockContact=function(e){return t._contactsService.unblockContact(e)},t.addFavoriteContact=function(e){return t._contactsService.addFavoriteContact(e)},t.removeFavoriteContact=function(e){return t._contactsService.removeFavoriteContact(e)},t.getBlockedlist=function(){return t._contactsService.getBlockedList()},t.signinStateChangedHandler=function(){u.swc.services.signInManager.state===s.SigninState.SignedOut&&(t._contactsService.dispose(),t._isPersonContactPromiseRejectCallback&&t._isPersonContactPromiseRejectCallback({source:"signout"}),t._contactsData={blocked:[],groups:[],contacts:[]},t._fetchContactsResolved=!1)},t.isContact=function(e,t){return!!e&&(!!e&&e.mri===t&&e.authorized)},t._sendTelemetryData=function(e,t){var n=e.contacts?e.contacts:[];u.swc.Telemetry.sendEvent.contactsLoaded(n.length,n.filter(function(e){return 4===e.type}).length,n.filter(function(e){return 8===e.type}).length,n.filter(function(e){return 28===e.type}).length,Date.now()-t)},t._contactsService=u.swc.services.contactsService,t._outlookContactsService=u.swc.services.outlookContactsService,u.swc.services.signInManager.subscribe("state",t.signinStateChangedHandler),t._initTrouter(),t}return r(t,e),t.prototype._initTrouter=function(){var e=new h.LocalCallingLogger,t=f.ServicesManager.signInManager.getSkypeToken.bind(f.ServicesManager.signInManager),n={onContactListChangedNotification:this._onContactListChangedNotification};f.ServicesManager.trouterService.init(e,t,o.default.get.sessionId),f.ServicesManager.trouterService.registerMessageHandler(this._handleTrouterMessage(n))},t.prototype._getEventId=function(e){return e.eventId?e.eventId:e.body&&e.body.eventId},t.prototype._handleTrouterMessage=function(e){var t=this;return{handleMessage:function(e){switch(t._getEventId(e)){case g.trouterEvents.CONTACTLIST_CHANGE:return t._onContactListChangedNotification(),g.HANDLER_RESULT_STATUS_OK}return g.HANDLER_RESULT_STATUS_UNHANDLED}}},t.prototype._createPerson=function(e){var t=f.ServicesManager.persons.getPerson(e.skypeid,!1);return t.displayName=e.name,t.avatarData=e.avatar,t.isBlocked=e.blocked,t.isFavorite=e.favorite,t},t.prototype._createPersonForAllContacts=function(e){e.forEach(this._createPerson)},t.prototype.dispose=function(){this._contactsService.dispose(),this._isPersonContactPromiseRejectCallback&&this._isPersonContactPromiseRejectCallback({source:"onDispose"}),u.swc.services.signInManager.unsubscribe("state",this.signinStateChangedHandler)},t}(a.default);t.SkypeContactsManager=y,t.default=y},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.OK=200]="OK",e[e.created=201]="created",e[e.badRequest=400]="badRequest",e[e.unauthorized=401]="unauthorized",e[e.notFound=404]="notFound",e[e.forbidden=403]="forbidden",e[e.preconditionFailed=412]="preconditionFailed",e[e.unprocessableEntity=422]="unprocessableEntity",e[e.internalServerError=500]="internalServerError"}(i=t.httpStatusCodes||(t.httpStatusCodes={})),function(e){e[e.CONTACTLIST_CHANGE=6]="CONTACTLIST_CHANGE",e[e.OFFLINE_AUTHREQUEST=14]="OFFLINE_AUTHREQUEST",e[e.INCOMING_SKYPE_NGC_CALL=107]="INCOMING_SKYPE_NGC_CALL",e[e.INCOMING_SKYPE_P2P_CALL=108]="INCOMING_SKYPE_P2P_CALL",e[e.INCOMING_SKYPE_NGC_GVC_CALL=109]="INCOMING_SKYPE_NGC_GVC_CALL",e[e.INCOMING_LYNC_NGC_CALL=105]="INCOMING_LYNC_NGC_CALL",e[e.INCOMING_STOP_RINGER=104]="INCOMING_STOP_RINGER",e[e.INCOMING_SKYPE_NGC_STOP_RINGER=110]="INCOMING_SKYPE_NGC_STOP_RINGER",e[e.INCOMING_SKYPE_NGC_PSTN_CALL=111]="INCOMING_SKYPE_NGC_PSTN_CALL",e[e.USER_SERVICES_CHANGE=601]="USER_SERVICES_CHANGE",e[e.INCOMING_CONTACT_INVITE=801]="INCOMING_CONTACT_INVITE",e[e.OUTGOING_CONTACT_INVITE_ACCEPTED=802]="OUTGOING_CONTACT_INVITE_ACCEPTED",e[e.CONTACT_INVITES_LIST_CHANGE=803]="CONTACT_INVITES_LIST_CHANGE",e[e.USER_PROFILE_CHANGE=20]="USER_PROFILE_CHANGE",e[e.USER_AVATAR_CHANGE=21]="USER_AVATAR_CHANGE"}(t.trouterEvents||(t.trouterEvents={})),t.HANDLER_RESULT_STATUS_OK={isHandled:!0,resultCode:i.OK},t.HANDLER_RESULT_STATUS_UNHANDLED={isHandled:!1}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),s=n(0),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._searchAadDirectory=function(e){return t._searchPromise&&t._searchPromise.status===o.PromiseStatus.Pending&&(t._searchPromise.cancel(),t._searchPromise=null),t._searchKey=e,t._searchPromise=new o.CancelablePromise(s.swc.services.teamsGraphService.fetchProfiles(e)),t._searchPromise.promise},t}return r(t,e),t.prototype.searchSkypeDirectory=function(e){var t=function(e){return{nodeProfileData:{avatarUrl:"",city:"",contactType:"",country:"",countryCode:"",language:"",state:"",name:e.displayName,skypeId:e.mri,jobTitle:e.jobTitle,department:e.department,location:e.userLocation},nodeAnnotation:"",nodeConnectionData:{distance:0,mutualFriendCount:0}}},n=function(e){return!!e.mri};return this._searchAadDirectory(e).then(function(e){return{requestId:"",results:e.filter(n).map(t)}})},t}(n(151).default);t.TeamsSearchManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(141),s=n(30),a=n(0),c=n(42),u=n(23),l=n(82),p=function(e){return a.swc.services.i18n.fetch(e)},d=function(){function e(){this.isConnected=!1}return e.prototype.registerServices=function(){var e=a.swc.services;e.signInManager&&e.signInManager.isAadSupported()?this.registerEnterpriseProxy(e.presenceService,e.persons,e.mePerson):this.registerConsumerProxy(e.persons)},e.prototype.registerSharedProxy=function(){a.swc.Eventing.registerEvent("proxy:presence:getStatusList",function(){i.default.get.isTeams()?a.swc.Eventing.triggerEvent("proxy:presence:getStatusList:response",[{key:"Online",description:p("presence_status_online"),url:r.Configuration.ECS.domain+"/assets/personas/status/Available.svg"},{key:"BeRightBack",description:p("presence_status_berightback"),url:r.Configuration.ECS.domain+"/assets/personas/status/Away.svg"},{key:"Away",description:p("presence_status_away"),url:r.Configuration.ECS.domain+"/assets/personas/status/Away.svg"},{key:"Busy",description:p("presence_status_busy"),url:r.Configuration.ECS.domain+"/assets/personas/status/Busy.svg"},{key:"DoNotDisturb",description:p("presence_status_donotdisturb"),url:r.Configuration.ECS.domain+"/assets/personas/status/DoNotDisturb.svg"}]):a.swc.Eventing.triggerEvent("proxy:presence:getStatusList:response",[{key:"Online",description:p("presence_status_online"),url:r.Configuration.ECS.domain+"/assets/personas/status/Available.svg"},{key:"Busy",description:p("presence_status_busy"),url:r.Configuration.ECS.domain+"/assets/personas/status/Busy.svg"},{key:"Away",description:p("presence_status_away"),url:r.Configuration.ECS.domain+"/assets/personas/status/Away.svg"}])})},e.prototype.registerEnterpriseProxy=function(e,t,n){if(e.isEnabled&&!this.isConnected){this.registerSharedProxy(),a.swc.Eventing.registerEvent("proxy:presence:getStatus",function(){e.getMyPresence().catch(function(){return l.Availability.PresenceUnknown}).then(function(e){var t=l.getStatusFromAvailability(e);a.swc.Eventing.triggerEvent("proxy:presence:getStatus:response",t)})}),a.swc.Eventing.registerEvent("proxy:presence:setStatus",function(t){var n=l.getAvailabilityFromStatus(t);n?e.setMyPresence(n).then(function(){a.swc.Eventing.triggerEvent("proxy:presence:setStatus:response",{status:!0})}):a.swc.Eventing.triggerEvent("proxy:presence:setStatus:response",{status:!1})});var i=function(e){a.swc.Eventing.triggerEvent("proxy:presence:announceUserStatus",{userId:c.default.normalizePersonId(e.mri),status:l.getStatusFromAvailability(e.presence.availability)})};a.swc.Eventing.registerEvent("proxy:presence:subscribeToUserStatus",function(r){if(o.ME!==r){var s=t.getPerson(r);s&&e.subscribe(s.mri,i)}else e.subscribe(n.mri,function(e){e.mri=o.ME,i(e)})}),a.swc.Eventing.registerEvent("proxy:presence:unsubscribeFromUserStatus",function(r){o.ME===r&&e.unsubscribe(n.mri,i);var s=t.getPerson(r);s&&e.unsubscribe(s.mri,i)}),a.swc.Eventing.registerEvent("proxy:presence:getUserStatus",function(n){var i=t.getPerson(n);if(i){var r=function(t){a.swc.Eventing.triggerEvent("proxy:presence:getUserStatus:response",{userId:n,status:l.getStatusFromAvailability(t.presence.availability)}),e.unsubscribe(i.mri,r)};e.subscribe(i.mri,r)}}),s.ProxyConnector.instance.connect("presence",{}),this.isConnected=!0}},e.prototype.registerConsumerProxy=function(e){this.isConnected||(this.registerSharedProxy(),a.swc.Eventing.registerEvent("proxy:presence:getStatus",function(){var t=e.getMyStatus()||u.PresenceStatus.Offline;a.swc.Eventing.triggerEvent("proxy:presence:getStatus:response",t)}),a.swc.Eventing.registerEvent("proxy:presence:setStatus",function(t){e.setMyStatus(t).then(function(){return a.swc.Eventing.triggerEvent("proxy:presence:setStatus:response",{status:!0})}).catch(function(){return a.swc.Eventing.triggerEvent("proxy:presence:setStatus:response",{status:!1})})}),a.swc.Eventing.registerEvent("proxy:presence:subscribeToUserStatus",function(t){o.ME!==t?e.subscribeToUserStatus(t,function(e,n){a.swc.Eventing.triggerEvent("proxy:presence:announceUserStatus",{userId:t,status:n})}):e.subscribeToMyStatus(function(e){a.swc.Eventing.triggerEvent("proxy:presence:announceUserStatus",{ME:o.ME,status:e})})}),a.swc.Eventing.registerEvent("proxy:presence:unsubscribeFromUserStatus",function(t){e.unsubscribeFromUserStatus(t)}),a.swc.Eventing.registerEvent("proxy:presence:getUserStatus",function(t){e.getUserStatus(t).then(function(e){a.swc.Eventing.triggerEvent("proxy:presence:getUserStatus:response",{userId:t,status:e})}).catch(function(){a.swc.Eventing.triggerEvent("proxy:presence:getUserStatus:response",{userId:t,status:null})})}),s.ProxyConnector.instance.connect("presence",{}),this.isConnected=!0)},e}();t.PresenceProxyOperator=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(7),o=n(5),s=n(110),a=n(82),c=n(226),u=n(227),l=function(e,t){return void 0===t&&(t=function(){}),o.ServicesManager.signInManager.aad&&s.getConfig().isEnabled?e():t()},p=function(){function e(){}return Object.defineProperty(e,"isEnabled",{get:function(){return l(function(){return!0},function(){return!1})},enumerable:!0,configurable:!0}),e.setMyPresence=function(t,n){if(void 0===n&&(n=null),!a.isForcedAvailabilityAllowed(t))return Promise.reject("Availability can only be one of ("+a.allowedForcedAvailabilities.join(",")+")");if(null!==n&&!a.isActivityCombinationAllowed(t,n))return Promise.reject("Combination of '"+t+"/"+n+"' is not allowed");return l(function(){var i={activity:n,availability:t};return u.put("Presence.setMyPresence","/me/forceAvailability",JSON.stringify(i)).then(function(n){return n.ok?(e.lastStatus=t,Promise.resolve()):(r.default.throwError(103503),Promise.reject("Unable to set Presence"))})},function(){return Promise.resolve()})},e.getMyPresence=function(){return l(function(){return e.lastStatus?Promise.resolve(e.lastStatus):new Promise(function(t,n){var i=0,r=setInterval(function(){return i++>5?(clearInterval(r),n("Unable to getPresence info")):e.lastStatus?(clearInterval(r),t(e.lastStatus)):void 0},1e3)})},function(){return Promise.reject("Presence is disabled")})},e.getMeEndpoints=function(){return l(function(){return u.get("Presence.getMeEndpoints","/me/endpoints")},function(){return Promise.resolve([])})},e.pollPresence=function(e){return l(function(){return u.post("Presence.pollPresence","/presence/getpresence",JSON.stringify(e))},function(){return Promise.resolve([])})},e.subscribe=function(t,n){var i=c.PresencePollingService.get(e.pollPresence);i.subscribe(t,n),i.isRunning&&i.forceDelayedPoll()},e.unsubscribe=function(t,n){c.PresencePollingService.get(e.pollPresence).unsubscribe(t,n)},e.subscribeToMyUpdates=function(){if(e.mePersonMri)return Promise.resolve();var t=i.swc.services;return t.signInManager&&t.signInManager.isAadSupported()?t.signInManager.onceSignedIn().then(function(){e.mePersonMri=t.mePerson.mri,e.subscribe(e.mePersonMri,function(t){t.presence&&t.presence.availability&&(e.lastStatus=t.presence.availability)})}):Promise.reject("subscribeToMyUpdates failed")},e.startPolling=function(){l(function(){e.subscribeToMyUpdates().then(function(){c.PresencePollingService.get(e.pollPresence).start()})})},e}();t.UnifiedPresenceService=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(110),r=n(82),o=function(){function e(e){var t=this;this.pollPresence=e,this.subscriptions={},this.subscribe=function(e,n){/^\d+:orgid:/.test(e)&&(t.subscriptions[e]||(t.subscriptions[e]={handlers:[]}),0===t.subscriptions[e].handlers.filter(function(e){return e===n}).length&&t.subscriptions[e].handlers.push(n))},this.unsubscribe=function(e,n){t.subscriptions[e]||(t.subscriptions[e].handlers=t.subscriptions[e].handlers.filter(function(e){return e!==n}))},this.start=function(){t.isRunning||(t.poll(),t.pollInterval=setInterval(function(){return t.poll()},1e3*i.getConfig().pollingInterval))},this.stop=function(){clearInterval(t.pollInterval),t.clearForcedDelayedPoll(),t.pollInterval=void 0},this.getUsers=function(){return Object.keys(t.subscriptions).map(function(e){return{mri:e,etag:t.subscriptions[e].etag||""}})},this.handlePoll=function(e){return e.forEach(function(e){if(e.status>=2e4&&e.status<=29999&&t.subscriptions.hasOwnProperty(e.mri))if(e.etagMatch&&t.subscriptions[e.mri].lastResponse)t.subscriptions[e.mri].handlers.forEach(function(n){return n(t.subscriptions[e.mri].lastResponse)});else if(e.presence)try{var n=t.subscriptions[e.mri].lastResponse&&t.subscriptions[e.mri].lastResponse.presence.availability||r.Availability.Offline;e.presence.availability!==n&&t.subscriptions[e.mri].handlers.forEach(function(t){return t(e)}),t.subscriptions[e.mri].etag=e.etag,t.subscriptions[e.mri].lastResponse=e}catch(e){}}),e},this.poll=function(){var e=t.getUsers();return t.clearForcedDelayedPoll(),e?t.pollPresence(e).then(t.handlePoll):Promise.resolve([])}}return e.get=function(t){return e.instance||(e.instance=new e(t)),e.instance},Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.pollInterval},enumerable:!0,configurable:!0}),e.prototype.forceDelayedPoll=function(){var e=this;this.forcedPollTimeout||(this.forcedPollTimeout=setTimeout(function(){e.poll()},1e4))},e.prototype.clearForcedDelayedPoll=function(){this.forcedPollTimeout&&(clearTimeout(this.forcedPollTimeout),this.forcedPollTimeout=void 0)},e}();t.PresencePollingService=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0),o=n(7),s=n(13),a=n(32),c=n(10),u={baseUrl:"https://presence.teams.microsoft.com/v1"},l={retryCount:3,timeout:12e4,policy:""},p=function(e,t,n){return c.default("presence-"+e,l,u.baseUrl+t,n).then(function(i){if(404===i.status){var r=i.headers.get("location");if(r){var o=/^(https:\/\/[^\/]+\/v1)/g.exec(r)[0];return u.baseUrl=o,c.default("presence-"+e,l,u.baseUrl+t,n)}}return i})},d=function(e){void 0===e&&(e=a.AadAudience.SpacesApi);var t=r.swc.services.signInManager;return t.isAadSupported()&&t.aad?Promise.all([t.aad(e),t.getSkypeToken()]).then(function(e){var t=e[0],n=new Headers;return n.append("Authorization",t),n.append("Accept","application/json"),n.append("x-skype-client",i.Configuration.getClientVersion()),n.append("x-ms-correlation-id",s.guid.generate()),n.append("x-ms-client-type","Web"),n.append("x-ms-client-version",i.Configuration.getClientVersion()),n.append("x-ms-client-user-agent","swc"),n.append("content-type","application/json;charset=UTF-8"),n.append("BehaviorOverride","redirectAs404"),n}):(o.default.throwError(103502,"Unable to get AAD Token"),Promise.reject("Unable to get AAD Token"))};t.post=function(e,t,n){return d().then(function(i){return p(e,t,{method:"POST",cache:"no-cache",headers:i,body:n}).then(function(e){return e.ok?e.json():Promise.reject("Failed")})})},t.put=function(e,t,n){return d().then(function(i){return p(e,t,{method:"PUT",cache:"no-cache",headers:i,body:n})})},t.get=function(e,t){return d().then(function(n){var i={method:"GET"};return i.headers=n,p(e,t,i).then(function(e){return e.ok?e.json():Promise.reject("Failed")})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(229),r=function(){return function(){this.addAgentToContacts=function(e){var t="api/v1/bots/add/"+e;return i.put("addAgentToContacts",t)}}}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(230),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return r.default("joinAgents-"+e,s,i.Configuration.AGENTS_HOST_URL+t,n)};t.getResponse=function(e,t){return a(e,t)},t.get=function(e,t){var n={method:"GET"};return function(e,t,n){return r.default("joinAgents-"+e,s,i.Configuration.AGENTS_HOST_URL+t,n).then(function(e){return e.json()})}(e,t,n)},t.put=function(e,t,n){return void 0===n&&(n=""),o.putHeaders().then(function(i){var r={method:"PUT"};return r.body=n,r.headers=i,a(e,t,r)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5);t.putHeaders=function(){var e=new Headers;return new Promise(function(t){i.ServicesManager.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),t(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(3),s=n(29),a={retryCount:3,timeout:12e4,policy:""},c=function(){function e(){}return e.prototype.auth=function(e){void 0===e&&(e="customer");var t={method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,lang:"en",greeniddc:"none"})};return r.default("join-auth",a,i.Configuration.WX_HOST_URL,t).then(function(e){return e.json()})},e.prototype.join=function(e,t){void 0===t&&(t="guest"),t=t||"guest",e=s.default.toFullIdentifier(e);var n=i.Configuration.INVITE_HOST_URL_INT+"users/guests/light",c={method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json",Accept:"application","Accept-Language":"en-US,en;"},body:JSON.stringify({name:t,threadId:e,longId:"swc",shortId:"swc",flowId:o.default.get.sessionId})};return r.default("join-join",a,n,c).then(function(e){return e.json()})},e}();t.WX=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t,!1,!0)||this;return n._isMePerson=!0,n}return r(t,e),Object.defineProperty(t.prototype,"msaId",{get:function(){return this._msaId},set:function(e){e&&(this._msaId=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"personalFileSite",{get:function(){return this._personalFileSite},set:function(e){e&&(this._personalFileSite=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._forcedDisplayName?this._forcedDisplayName:e.prototype.getDisplayName.call(this)},set:function(t){e.prototype.setDisplayName.call(this,t)},enumerable:!0,configurable:!0}),t.prototype.forceDisplayName=function(e){this._forcedDisplayName=e,this.publish("displayName",e)},t}(n(152).default);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(234),r=function(){function e(){}return e.prototype.fetchCommonEmails=function(e,t){void 0===e&&(e=10),void 0===t&&(t=0);var n="people/?$top="+e+"&$skip="+t+"&$Select=scoredEmailAddresses";return i.get("scoredMails",n).then(function(e){return e})},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(235),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return r.default("msGraph-"+e,s,i.Configuration.MS_GRAPH_URL+t,n)};t.postWithoutHeaders=function(e,t,n){var i={method:"GET",cache:"no-cache"};return n&&(i.headers=n),a(e,t,i).then(function(e){return e.json()})},t.get=function(e,t){return o.getHeaders().then(function(n){var i={method:"GET"};return i.headers=n,i.cache="no-cache",a(e,t,i).then(function(e){return e.json()})},function(e){})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(33),o=n(51),s=n(13),a=n(90),c=n(5),u={clientID:i.Configuration.MS_APP_CLIENT_ID,graphScopes:["People.Read","openid","profile"]},l=function(){return function(e,t,n){var i=JSON.parse(c.ServicesManager.sessionStorage.getItem(e)),r=Math.round((new Date).getTime()/1e3);if(i){if(i.expiresIn>r)return Promise.resolve(i.token);c.ServicesManager.sessionStorage.removeItem(e)}return new Promise(function(r,o){var s;i&&(s=i.token),n(s).then(function(n){var i={expiresIn:t(n),token:n};c.ServicesManager.sessionStorage.setItem(e,JSON.stringify(i)),r(n)}).catch(o)})}(r.SKYPE_GRAPH_ACCESS_TOKEN_KEY+a.hashCode(c.ServicesManager.signInManager.currentUserName),function(e){return Math.round((new Date).getTime()/1e3)+ +e.expires_in},function(){return new Promise(function(e,t){var n=c.ServicesManager.signInManager.currentUserName,r=s.guid.generate(),a=i.Configuration.MS_AUTHORIZE_URL,l=i.Configuration.MS_APP_REDIRECT_URL_DEMO;window.location.hostname.toLowerCase().indexOf("outlook")>=0&&(l=i.Configuration.MS_APP_REDIRECT_URL_OUTLOOK);var p={response_type:"token",scope:u.graphScopes.join(" "),client_id:u.clientID,username:n,nonce:r,redirect_uri:l},d=o.addGetParamsToUrl(a,p),f=function(n){if(n.data){window.removeEventListener("message",f);var i=n.data;if(-1!==i.indexOf("access_token")){var r={};i.split("&").forEach(function(e){var t=e.split("="),n=t[0],i=t[1];r[n]=decodeURIComponent(i)}),e(r)}t(i)}};window.addEventListener("message",f),window.open(d,"_blank",i.Configuration.LOGIN_POPUP_FEATURES)})})};t.getHeaders=function(){return new Promise(function(e,t){var n=new Headers;l().then(function(t){n.append("Authorization",[t.token_type,t.access_token].join(" ")),e(n)}).catch(function(e){t(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(30),o=n(0),s=n(5),a=n(97),c=36e5,u=function(){function e(){var e=this;this._hostName=i.Configuration.getPlatformName(),this._registered=!1,this._getStorageItem=function(e){var t=o.swc.services.sessionStorage.getItem(e);return t?JSON.parse(t):null},this._setStorageItem=function(e){e&&o.swc.services.sessionStorage.setItem(e.id,JSON.stringify(e))},this._checkIfValid=function(e){return e&&e.validUntil>Date.now()},this._getItem=function(e,t){return{id:e,value:t&&t.length?t:a.NOTIFICATION_DEFAULT,validUntil:Date.now()+c}},this.registerProxy=function(){e._registered||(o.swc.Eventing.registerEvent("proxy:settings:notification:readOption",function(t){t.name&&e.get(t.name).then(function(e){e.pairId=t.id,o.swc.Eventing.triggerEvent("proxy:settings:notification:readOption:response",e)})}),o.swc.Eventing.registerEvent("proxy:settings:notification:setOption",function(t){if(t.o){var n=Date.now();e.set(t.o).then(function(e){o.swc.Telemetry.sendEvent.userSettings(a.NotificationSettingSource.api,t.o.name,t.o.value,Date.now()-n,"200"),e.pairId=t.id,o.swc.Eventing.triggerEvent("proxy:settings:notification:setOption:response",e)},function(e){o.swc.Telemetry.sendEvent.userSettings(a.NotificationSettingSource.api,t.o.name,t.o.value,Date.now()-n,e)})}}),r.ProxyConnector.instance.connect("notificationSettings",{}),e._registered=!0)},this.readSettings=function(t){return new Promise(function(n,i){var r=[],o=[];t.forEach(function(t){var n=e._getStorageItem(t);e._checkIfValid(n)?r.push(n):o.push(t)});var s=e._getOptionsForHost(r);o.length?e.service.fetchUserOptionsBatch(o).then(function(t){var i=[];t&&t.options&&t.options.forEach(function(t){i.push(e._createItem(t.name,t.value))});var r=e._getOptionsForHost(i);n(s.concat(r))},function(e){i(e)}):n(s)})},this.service||(this.service=s.ServicesManager.userOptionsService)}return e.prototype._createItem=function(e,t){var n=this._getItem(e,t);return this._setStorageItem(n),n},e.prototype._resolveHeaderName=function(e){var t="";switch(e){case a.NotificationSettingType.NewMessage:t="notification_settings_header_new_message";break;case a.NotificationSettingType.IncomingCall:t="notification_settings_header_incoming_calls"}return t?o.swc.services.i18n.fetch(t):t},e.prototype._getOptionsForHost=function(e){var t=this,n=[];return e.forEach(function(e){n.push({name:t._resolveHeaderName(e.id),id:e.id,value:t._getValueForHost(e.value)})}),n},e.prototype._getValueForHost=function(e){var t=this,n=null;return e.forEach(function(e){e.host&&e.host.toLowerCase()===t._hostName&&(n=e.value)}),n||(n=a.NotificationAllowedValue.All),n},e.prototype._getOptionForHost=function(e,t){var n=this._createItem(e,t);return{name:e,value:this._getValueForHost(n.value)}},e.prototype.get=function(e){var t=this,n=this._getStorageItem(e);return new Promise(function(i,r){n&&t._checkIfValid(n)?i({name:n.id,value:t._getValueForHost(n.value)}):t.service.fetchUserOption(e).then(function(n){n&&i(t._getOptionForHost(e,n.value))},function(){i(t._getOptionForHost(e,null))})})},e.prototype.set=function(e){var t=this;return new Promise(function(n,i){var r=function(r){var s;if(!r||!r.value||!r.value.length){var c={name:e.name,value:a.NOTIFICATION_DEFAULT};r=c}if(r.value.forEach(function(n){n.host.toLocaleLowerCase()===t._hostName&&(n.value=e.value,s=!0)}),!s&&r.name===e.name){var u={host:t._hostName.toUpperCase(),value:e.value};r.value.push(u)}t.service.setUserOption(r).then(function(){var e=t._getOptionForHost(r.name,r.value);n(e),o.swc.Eventing.triggerEvent("notificationSettingsChange",e)},function(e){i(e)})};t.service.fetchUserOption(e.name).then(r,r)})},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(238);t.ping=function(){return i.sendRequest("ping","GET","/swc")},t.getExistingCompanies=function(){return i.sendRequest("getCompanies","GET","/companies")},t.createCompany=function(e,t){var n={businessName:e,description:t};return i.sendRequest("createCompany","POST","/swc",{body:JSON.stringify(n)})},t.setCompanyEnabledStatusTo=function(e){return i.sendPutRequest("enableCompany","/swc/status",{body:JSON.stringify({enabled:e})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(239),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return r.default("oa-"+e,s,i.Configuration.OA_URL+t,n)},c=function(e,t,n){e.append("Content-Type","application/json");var i=Object.assign({},n);return i.method=t,i.headers=e,i.cache="no-cache",i};t.sendRequest=function(e,t,n,i){return o.getHeaders().then(function(r){return a(e,n,c(r,t,i)).then(function(e){return e.json()})})},t.sendPutRequest=function(e,t,n){return o.getHeaders().then(function(i){return a(e,t,c(i,"PUT",n))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5);t.postHeaders=function(){return new Promise(function(e){i.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),e(n)},function(){})})},t.getHeaders=function(){return new Promise(function(e){i.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(112),r=n(0),o=n(241),s=n(242),a=n(245),c=n(246),u=function(){function e(){this._isInitialized=!1}return Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return i.shortcutIdMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emoticonMap",{get:function(){return i.idEmoticonMap},enumerable:!0,configurable:!0}),e.prototype.canRenderConfigItems=function(){return o.default.canRenderConfigItems()},e.prototype.refresh=function(){this.renderLoop&&this.renderLoop.updateEmoticonCanvases()},e.prototype.init=function(e){var t=this;return new Promise(function(n,i){a.default.init(e).then(function(e){t.renderLoop=new c.EmoticonsRenderLoop;var i=o.default.init(e);s.default.register(i),t.renderLoop.updateCache(i),i.items&&i.items.forEach(function(e){e.background=t.renderLoop.getUrlFromCache(e.id)}),n(i),t._isInitialized=!0,r.swc.Eventing.triggerEvent("pesConfigInitialized",null,!0),t.renderLoop.updateEmoticonCanvases()}).catch(function(){i()})})},e}();t.PesManager=u},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(112),o=n(21),s=n(40),a=n(113),c=function(){function e(){this._configuration={countryCode:"",tabsRoot:"",itemsRoot:"",emoticonsRoot:"",packsRoot:"",items:[],packs:[],tabs:[],emoticonPreviewItem:null}}return e.prototype.canRenderConfigItems=function(){return this._configuration.items.length>0},e.prototype.init=function(e){var t=this._processItems(e);t.forEach(function(e){r.idEmoticonMap[e.id]=e});var n=this._processPacks(e,t),o=e.tabs?this._resolveTabsFromSections(e,n):this._makeTabsFromPacks(n,e.packsRoot);return this._configuration=i({},e,{packs:n,tabs:o,items:t},{emoticonPreviewItem:t[0]}),this._configuration},e.prototype._processPacks=function(e,t){return e.packs.map(function(e){var n=[];return e.items.forEach(function(e){var i=t.find(function(t){return t.id===e});i&&n.push(i)}),i({},e,{items:n})})},e.prototype._resolveTabsFromSections=function(e,t){var n=this;return e.tabs.map(function(r){var o=[];return r.sections.forEach(function(e){var n=t.find(function(t){return t.id===e.pack});n&&n.items&&n.items.length&&o.push(n)}),i({},r,{packs:o,type:s.default.itemTypes.tab.id,thumbnailUrl:n._createThumbnailUrl(r.id,e.tabsRoot)})})},e.prototype._createThumbnailUrl=function(e,t){var n=(t||"#")+"/"+e+"/views/thumbnail";return n=a.rewriteUrls(n,s.default.pesCDNAuthentication.rewriteRules)},e.prototype._makeTabsFromPacks=function(e,t){var n=this,i=[];return e?(e.forEach(function(e){if(!n._isFeaturedPack(e)){var r=n._createTabFromPack(e,t);i.push(r)}}),e.forEach(function(e){if(n._isFeaturedPack(e)){var r=e.title.replace(s.default.FEATURED_IN_PREFIX,""),o=i.find(function(e){return e.title===r});o?(e.isHidden=!1,o.packs.unshift(e)):!1===e.isHidden&&(e.title=r,o=n._createTabFromPack(e,t),i.push(o))}}),i):i},e.prototype._createTabFromPack=function(e,t){var n=this._createThumbnailUrl(e.id,t),r=i({},e,{type:s.default.itemTypes.tab.id,thumbnailUrl:n,packs:[e],sections:[{pack:e.id}],glyphBgColor:"",isDiscoverable:!1,badgeETag:""});return delete r.isSponsored,delete r.items,r},e.prototype._isFeaturedPack=function(e){return 0===(e.title||"").indexOf(s.default.FEATURED_IN_PREFIX)},e.prototype._processItems=function(e){var t=this,n=e.countryCode;return e.items.filter(function(e){return e.type===s.default.itemTypes.emoticon.id&&(!(n&&e.excludedCountries&&e.excludedCountries.indexOf(n)>=0)&&!(n&&e.includedCountries&&e.includedCountries.length&&e.includedCountries.indexOf(n)<0))}).map(function(n){var r={staticHtmlClass:n.id,staticExtraLargeHtmlClass:n.id+" extraLarge",animatedExtraLargeHtmlClass:n.id+" extraLarge animated",background:""},o=e.emoticonsRoot+"/"+n.id+"/views/",s=t._getEmoticonURLs(o,n.etag),a=i({},n,r,s);return delete a.includedCountries,delete a.excludedCountries,a})},e.prototype._getEmoticonURLs=function(e,t){return e=a.rewriteUrls(e,s.default.pesCDNAuthentication.rewriteRules),{smallStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getSmall(),t),largeStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getLarge(),t),extraLargeStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getExtraLarge(),t),superLargeStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getSuperLarge(),t),smallUrl:this._buildUrl(e+s.default.profiles.emoticons.getSmallAnimated(),t),largeUrl:this._buildUrl(e+s.default.profiles.emoticons.getLargeAnimated(),t),extraLargeUrl:this._buildUrl(e+s.default.profiles.emoticons.getExtraLargeAnimated(),t),superLargeUrl:this._buildUrl(e+s.default.profiles.emoticons.getSuperLargeAnimated(),t)}},e.prototype._buildUrl=function(e,t){return o.UrlHelper.setQueryParameters(e,{etag:t})},e}();t.default=new c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(112),r=n(40),o=n(243),s=n(244),a=function(){function e(){}return e.prototype.register=function(e){var t=this._getArtifacts(e),n="";i.clearShortcutMap(),t.encodingMaps.forEach(function(e){switch(e.type){case r.default.itemTypes.emoticon.id:i.shortcutIdMap[e.shortcut]=e.id;break;case r.default.itemTypes.tab.id:case r.default.itemTypes.moji.id:case r.default.itemTypes.sticker.id:throw new Error("mapping.type not implemented yet:"+e.type);default:throw new Error("mapping.type not supported yet:"+e.type)}}),t.pesStyles.forEach(function(e){n+=e}),this._registerStyles(n)},e.prototype._getArtifacts=function(e){var t=[],n=[],i=[];return e.tabs&&e.tabs.forEach(function(e){var r=s.default.getResources(e);t.push(r.styleDef),n.unshift(r.prefetchUrls[0]),e.packs.forEach(function(e){e.items.forEach(function(e){var r=o.default.getResources(e);r&&(t.push(r.styleDef),i.push.apply(i,r.encoderMaps),n.push.apply(n,r.prefetchUrls))})})}),{pesStyles:t,prefetchUrls:n,encodingMaps:i}},e.prototype._registerStyles=function(e){var t,n,i=document.getElementById("pesStyles");return i||(n=document.head,(i=document.createElement("style")).id="pesStyles",i.type="text/css"),i.styleSheet?i.styleSheet.cssText=e:(t=document.createTextNode(e),i.firstChild&&i.removeChild(i.firstChild),i.appendChild(t)),n&&n.appendChild(i),e},e}();t.default=new a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(40),r=function(){function e(){}return e.prototype.getResources=function(e){if(e.type!==i.default.itemTypes.emoticon.id)return null;var t=e.shortcuts.map(function(t){return{shortcut:t,id:e.id,type:i.default.itemTypes.emoticon.id}});return{styleDef:"",prefetchUrls:[e.smallUrl,e.smallStaticUrl,e.largeUrl,e.largeStaticUrl,e.extraLargeUrl,e.extraLargeStaticUrl,e.superLargeUrl,e.superLargeStaticUrl],encoderMaps:t}},e}();t.default=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(40),r=function(){function e(){}return e.prototype.getResources=function(e){if(e.type!==i.default.itemTypes.tab.id)return null;var t="\n.swx .tab_id_"+e.id+"\n";return t+="{\n",t+=" -ms-high-contrast-adjust: none;\n",t+=" background-image: url('"+e.thumbnailUrl+"'); \n",{styleDef:t+="} \n",prefetchUrls:[e.thumbnailUrl]}},e}();t.default=new r},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(142),s=n(108),a=n(88),c=n(10),u=n(3),l=n(7),p=n(40),d=n(113),f={retryCount:3,timeout:12e4,policy:""},h=function(){function e(){}return e.prototype.init=function(e){var t=this;return this._initPromise?this._initPromise:(u.default.get.pesLanguageLocale=o.default.getPesLocale(u.default.get.getCurrentLocale()||r.Configuration.LOCALE),this._initPromise=a.configLoader("Skype",{id:e}).then(function(e){var n=e.SkypePersonalization?e.SkypePersonalization.pes_config:null,r=e.Headers?e.Headers.CountryCode:null;return n||t._throwUncaughtError("No config URL",e),t._fetchConfiguration(n).then(function(e){return i({},e,{countryCode:r})})}),this._initPromise)},e.prototype._throwUncaughtError=function(e,t){var n=t&&"string"==typeof t?t:JSON.stringify(t);l.default.throwError(10080,"[PES] configSync, url "+e+", error "+n)},e.prototype._fetchConfiguration=function(e){var t=this;return this._fetch(this._getLocalizedUrl(e)).catch(function(){return t._fetch(e)}).catch(function(n){return t._throwUncaughtError(e,n)})},e.prototype._fetch=function(e){var t=this;return e=d.rewriteUrls(e,p.default.pesCDNAuthentication.rewriteRules),Promise.resolve(c.default("pes-CDNTokenFromSkypeToken",f,e,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json, text/javascript"}}).then(function(e){return s.parseJson(e)}).catch(function(n){return t._throwUncaughtError(e,n)}))},e.prototype._getLocalizedUrl=function(e){var t=u.default.get.pesLanguageLocale||r.Configuration.PES_LOCALE;return e.replace("/default","/"+t)},e}();t.default=new h},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(28),s=n(55),a=n(40),c=n(247),u=n(154),l=["conversation","recentsList"],p={running:!1,active:!0,lastBoundsTimestamp:-1313,lastDrawTimestamp:-1313},d=function(){function e(){var e=this;if(this._pixelRatio=1,this._refreshTime=0,this._bounds={},this.BOUNDS_REFRESH_TIMEOUT=100,this._imageCache={},this.viewports={},this.updateViewport=function(t){e.viewports[t.id]?e.viewports[t.id].active=t.state.active:e.viewports[t.id]=i({},p,{active:t.state.active,window:t.window})},s.isInIframe()){var t=r.swc.services.viewports;t.byType(l).forEach(function(t){return e.updateViewport(t)}),t.onChange(this.updateViewport)}else this.viewports.default=i({},p,{window:o.default.getWindow()})}return e.prototype.updateCache=function(e){var t=this,n=0;e.items.forEach(function(i){if(!t._imageCache[i.id]&&i.type===a.default.itemTypes.emoticon.id){t._imageCache[i.id]=new c.default(e.emoticonsRoot,i);var r=i.media;r&&r.default&&r.default.fps>n&&(n=r.default.fps)}}),0!==n&&(this._refreshTime=Math.floor(1e3/n))},e.prototype.getUrlFromCache=function(e){var t="";for(var n in this._imageCache)if(this._imageCache[n].id===e){var i=this._imageCache[n].largeStatic;t=i?i.url:"";break}return t},e.prototype.updateEmoticonCanvases=function(){for(var e=0,t=Object.keys(this.viewports);e<t.length;e++){var n=t[e],i=this.viewports[n];i&&i.active&&(i.canvases=i.window.document.querySelectorAll(".swc span.emoticon canvas")),i.running=i.active&&i.canvases&&!!i.canvases.length,i.running&&this.start(i)}},e.prototype.start=function(e){var t=this,n=e.window;"devicePixelRatio"in n&&(this._pixelRatio=n.devicePixelRatio),e.lastDrawTimestamp=-1313,n.requestAnimationFrame(function(n){return t.draw(n,e)})},e.prototype.draw=function(e,t){var n=this;if(e-t.lastDrawTimestamp>=this._refreshTime){t.lastDrawTimestamp=e;var i=e-t.lastBoundsTimestamp>this.BOUNDS_REFRESH_TIMEOUT;i&&(t.lastBoundsTimestamp=e);var r=t.canvases;r&&Array.prototype.forEach.call(r,function(r){i&&delete n._bounds[r.id],n._bounds[r.id]||(n._bounds[r.id]=r.getBoundingClientRect());var s=n._bounds[r.id];if(!(s.width<=2)&&o.default.isInViewport(s,t.window)){i&&n.setDimensionsIfNeeded(r,s);var c="itemId",l="item-id",p="isAnimated",d="is-animated",f=o.default.readDataset(r,c,l),h=n._imageCache[f],g="true"===o.default.readDataset(r,p,d);try{h&&function(e,t,n,i,r){var o;o=n<=a.default.frameHeights.emoticons.SMALL?u.ITEM_SIZES.SMALL:n<=a.default.frameHeights.emoticons.LARGE?u.ITEM_SIZES.LARGE:n<=a.default.frameHeights.emoticons.EXTRA_LARGE?u.ITEM_SIZES.EXTRA_LARGE:u.ITEM_SIZES.SUPER_LARGE;t[o+(i?"Animated":"Static")].draw(e,r)}(r,h,s.width,g,e/1e3)}catch(e){}}})}t.running&&t.window.requestAnimationFrame(function(e){return n.draw(e,t)})},e.prototype.setDimensionsIfNeeded=function(e,t){var n=t.width*this._pixelRatio;e.width===n&&e.height===n||(e.width=n,e.height=n)},e}();t.EmoticonsRenderLoop=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(113),r=n(154),o=n(248),s=function(){return function(e,t){this.id=t.id,this.smallAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SMALL,!0),t.media.default),this.largeAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.LARGE,!0),t.media.default),this.extraLargeAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.EXTRA_LARGE,!0),t.media.default),this.superLargeAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SUPER_LARGE,!0),t.media.default),this.smallStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SMALL,!1),r.STATIC_MEDIA_INFO),this.largeStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.LARGE,!1),r.STATIC_MEDIA_INFO),this.extraLargeStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.EXTRA_LARGE,!1),r.STATIC_MEDIA_INFO),this.superLargeStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SUPER_LARGE,!1),r.STATIC_MEDIA_INFO)}}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.isLoaded=!1,this.isLoading=!1,this.url=e,this.mediaInfo=t}return e.prototype.draw=function(e,t){var n=this;if(!this.isLoading)if(this.isLoaded){var i=e.getContext("2d"),r=this.image.naturalWidth;i.clearRect(0,0,e.width,e.width);var o=void 0;o=1===this.mediaInfo.framesCount?0:Math.floor(t*this.mediaInfo.fps)%this.mediaInfo.framesCount,i.drawImage(this.image,0,r*o,r,r,0,0,e.width,e.width)}else this.image=new Image,this.isLoading=!0,this.image.onload=function(){n.isLoading=!1,n.isLoaded=!0,n.draw(e,t)},this.image.src=this.url},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(153),s=["smile","laugh","heart","kiss","sad","tongueout","wink","cry","inlove","hug","cwl","lips","blush","surprised","penguin","yes","like","cool","rofl","cat","monkey","hi","snowangel","flower","giggle","devil","party","worry","champagne","sun","star","polarbear","dull","speechless","wonder","angry","puke","facepalm","sweat","holidayspirit","sleepy","bow","makeup","cash","lipssealed","shivering","cake","headbang","dance","wasntme","hungover","yawn","gift","angel","xmastree","brokenheart","think","clap","punch","envy","handshake","nod","nerdy","emo","muscle","mmm","ok","highfive","turkey","call","movember","dog","coffee","poke","swear","donttalktome","fingerscrossed","rainbow","headphones","waiting","festiveparty","bandit","heidy","beer","doh","bomb","happy","ninja"],a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.init=function(){return new Promise(function(e,n){t.initSkype().then(function(n){t.config=t._filterConfiguration(n),e(t.config)})})},t.getConfiguration=function(){return new Promise(function(e,n){t.config?e(t.config):t.init().then(function(t){e(t)})})},t}return r(t,e),t.prototype._filterConfiguration=function(e){var t=function(e){return s.indexOf(e)>-1};return e.items=e.items.filter(function(e){return t(e.id)}),e.packs.forEach(function(e){e.items=e.items.filter(function(e){return t(e.id)})}),e},t}(o.default);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(251))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(13),o=n(58),s=n(49),a=n(252),c=n(253),u=function(){function e(){this._uploads={}}return e.prototype.checkAndUploadFile=function(e,t){var n,i=this;this._uploads[t]=o.DocumentStatus.InProgress;var r=this._getPersonalFileSite().then(function(e){return n=e,e}).then(function(){return i._checkFileCycle(n,e.name)}).then(function(t){return{fileCheckValue:t,uploadPromise:i.uploadFile(e,t,n)}});return r.catch(function(){i._uploads[t]=o.DocumentStatus.Failed}),r},e.prototype.uploadFile=function(e,t,n){var i=this,s=t.objectId,a=r.guid.generate(),u="_api/web/GetFolderByServerRelativeUrl(@folder)/Files/getByUrlOrAddStub(@file)/StartUpload(uploadId=guid'"+a+"')",l="@folder='"+t.siteInfo.relativeUrl+"'&@file='"+t.title+"'",p=""+n.personalSiteUrl+u+"?"+l,d=function(t){var r="_api/web/GetFolderByServerRelativeUrl(@folder)/Files/getByUrlOrAddStub(@file)/FinishUpload(uploadId=guid'"+a+"',fileOffset="+e.size+")",u=""+n.personalSiteUrl+r+"?"+l;return c.post(u,"").then(function(){i._uploads[s]=t?o.DocumentStatus.Failed:o.DocumentStatus.Success}).catch(function(){i._uploads[s]=o.DocumentStatus.Failed})};return this._uploads[s]=o.DocumentStatus.InProgress,c.post(p,e).then(function(){return d()}).catch(function(e){return d(e)})},e.prototype.shareFile=function(e,t){var n=i.Configuration.SHAREPOINT_URL+"_api/SP.Sharing.DocumentSharingManager.UpdateDocumentSharingInfo",r={additiveMode:!1,customMessage:"Shared a file",includeAnonymousLinksInNotification:!0,resourceAddress:e,sendServerManagedNotification:!1,userRoleAssignments:t.map(function(e){return{Role:2,UserId:e}}),validateExistingPermissions:!1};return c.postJson(n,JSON.stringify(r))},e.prototype._checkFileCycle=function(e,t,n,i){var r=this;return void 0===n&&(n=t),void 0===i&&(i=0),new Promise(function(o){r._checkFileOnce(e,n).then(function(e){return o(e.value)}).catch(function(){var n=function(e,t){var n="$1 ("+t+")$2";return e.replace(/^(.+)(\.[\w\d]+)$/g,n)}(t,++i);return r._checkFileCycle(e,t,n,i).then(o)})})},e.prototype._getPersonalFileSite=function(){var e=this;if(this._sharepointLocations)return Promise.resolve(this._sharepointLocations);var t=i.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/me/files/availability";return a.post("teams-mt-filesAvailability",t,"").then(function(t){if(t.errorCode)throw new Error(t.message);return e._sharepointLocations=t,t})},e.prototype._checkFileOnce=function(e,t){var n={parentServerRelativeUrl:e.personalRootFolderUrl.match(/^https?:\/\/[^\/]+(.*)\/?$/)[1]+"/Microsoft Teams Chat Files",itemName:t,createBlankFile:!1,overwrite:!1},r=i.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/me/files",o=s.addGetParamsToUrl(r,n);return a.post("teams-mt-fileCheck",o,"").then(function(e){return e.errorCode&&"FilenameCollision"===e.errorCode?Promise.reject(e):e})},e.prototype.downloadFile=function(e){var t="_api/web/GetFileByServerRelativeUrl('"+(e.fileInfo.serverRelativeUrl||function(e){var t="";if(e){var n=e.split("/").slice(3);n&&n.length&&(t="/"+n.join("/"))}return t}(e.objectUrl))+"')/GetPreAuthorizedAccessUrl(1)";return a.get("SharepointService.downloadFile",""+e.baseUrl+t).then(function(e){return e.value?a.getData("SharepointService.downloadFile",e.value):null})},e.prototype.getFileStatus=function(e){return this._uploads[e]},e}();t.SharepointService=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(108),o=n(32),s=n(5),a=n(10),c={retryCount:3,timeout:12e4,policy:""};t.post=function(e,n,i){return t.getHeaders().then(function(t){return function(e,t,n){return a.default("sharepoint-"+e,c,t,n)}(e,n,{method:"POST",cache:"no-cache",headers:t,body:i}).then(function(e){return e.json()})})},t.getHeaders=function(e){return void 0===e&&(e=o.AadAudience.SpacesApi),new Promise(function(t){Promise.all([s.ServicesManager.signInManager.aad(e),s.ServicesManager.signInManager.getSkypeToken()]).then(function(e){var n=e[0],r=e[1],o=new Headers({Authorization:n,"x-skypetoken":r,"x-skype-client":i.Configuration.getClientVersion(),Accept:"application/json","Content-Type":"application/json"});t(o)})})},t.get=function(e,n){var i=n.match(/^(https?:\/\/[^\/]+).*\/?$/)[1];return t.getHeaders(i).then(function(t){var i={method:"GET"};return i.headers=t,r.request(e,n,i).then(function(e){return e.json()})})},t.getData=function(e,t){var n=new Headers;n.append("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"),n.append("Accept-Encoding","gzip, deflate, sdch, br");var i={method:"GET"};return i.headers=n,r.request(e,t,i).then(function(e){return e.blob()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(32),o=n(5),s=n(10);function a(e){return new Promise(function(t){o.ServicesManager.signInManager.aad(r.AadAudience.Sharepoint).then(function(n){var r=new Headers;r.append("Authorization",n),r.append("x-skype-client",i.Configuration.getClientVersion()),r.append("Accept","application/json"),e&&r.append("content-type",e),t(r)})})}function c(e,t,n){return s.default("sharepoint-"+e,{retryCount:3,timeout:12e4,policy:""},t,n)}t.postJson=function(e,t){return a("application/json").then(function(n){return c("sharepoint",e,{method:"POST",cache:"no-cache",headers:n,body:t}).then(function(e){try{return e.json()}catch(t){return e}})})},t.post=function(e,t){return a().then(function(n){return c("sharepoint",e,{method:"POST",cache:"no-cache",headers:n,body:t}).then(function(e){try{return e.json()}catch(t){return e}})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(7),o=n(13),s=n(88),a=n(5),c=n(255),u=function(){function e(){this._profiles={}}return e.prototype.fetchProfiles=function(e){var t=this;return this.getEcsConfig().then(function(){var n="?requestid="+t.getAppDataParams()+"&locale="+i.Configuration.LOCALE+"&searchstring="+e;return c.get("namesearch",n).then(function(e){return e&&e.results.forEach(function(e){var t=a.ServicesManager.persons.getPerson(e.nodeProfileData.skypeId,!1,!1);t.displayName=e.nodeProfileData.name,t.avatarData=e.nodeProfileData.avatarUrl}),e})},this.searchV1.bind(this,e))},e.prototype.searchV1=function(e){var t="search/v1.1/namesearch/swx/?requestid="+this.getAppDataParams()+"&locale="+i.Configuration.LOCALE+"&searchstring="+e;return c.get("namesearch",t)},e.prototype.getAppDataParams=function(){return[i.Configuration.APPNAME,i.Configuration.ECS.version,o.guid.generate()].join("-")},e.prototype.getEcsConfig=function(){if(e.getEcsConfigPromise)return e.getEcsConfigPromise;var t={id:a.ServicesManager.signInManager.currentUserName};return e.getEcsConfigPromise=s.configLoader("Skype",t).then(function(e){i.Configuration.ECS_GRAPH_ETAG=e.Headers.ETag;var t=e.PeopleSearch?e.PeopleSearch:void 0;if(t&&t.v2Endpoint&&(i.Configuration.ECS_GRAPH_URL=t.v2Endpoint),t&&t.serviceSettings){var n=t.serviceSettings;i.Configuration.ECS_GRAPH_SERVICE_SETTINGS="experiment="+n.experiment+";geoProximity="+n.geoProximity}},function(e){throw r.default.throwError(12002,"Unable to get advanced search params",e),e}),e.getEcsConfigPromise},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(256),s={retryCount:3,timeout:12e4,policy:""};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,o.cache="no-cache",function(e,t,n){return r.default("skypegraph-"+e,s,i.Configuration.ECS_GRAPH_URL+t,n)}(e,t,o).then(function(e){return e.json()})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(5);t.getHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("x-skypetoken",t),n.append("x-skype-client",i.Configuration.getClientVersion()),i.Configuration.ECS_GRAPH_ETAG&&n.append("x-ecs-etag",i.Configuration.ECS_GRAPH_ETAG),i.Configuration.ECS_GRAPH_SERVICE_SETTINGS&&n.append("x-skypegraphservicesettings",i.Configuration.ECS_GRAPH_SERVICE_SETTINGS),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(258);t.getSessionStorage=i.getSessionStorage;var r=n(259);t.getLocalStorage=r.getLocalStorage},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(155);t.getSessionStorage=function(){if(i)return i;try{"object"==typeof sessionStorage&&(sessionStorage.setItem("ss","0"),sessionStorage.removeItem("ss"),i=window.sessionStorage)}catch(e){i=new r.MemoryStorage}return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(155);t.getLocalStorage=function(){if(i)return i;try{"object"==typeof localStorage&&(localStorage.setItem("ls","0"),localStorage.removeItem("ls"),i=window.localStorage)}catch(e){i=new r.MemoryStorage}return i}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(53),s=n(83),a=function(e){function t(t){var n=e.call(this)||this;return n.mePersonMri=t,n.unreadMap={},n.debouncedNotify=o(function(){n.notify(n.unreadCounter)}),n}return r(t,e),Object.defineProperty(t.prototype,"unreadCounter",{get:function(){return Object.keys(this.unreadMap).length},enumerable:!0,configurable:!0}),t.prototype.markAsUnread=function(e){this.unreadMap[e]=!0,this.debouncedNotify()},t.prototype.markAsRead=function(e){delete this.unreadMap[e],this.debouncedNotify()},t.prototype.update=function(e){var t=s.default.isUnread(this.mePersonMri,e.id,e.properties,e.lastMessage);!("false"===e.properties.alerts)&&t?this.markAsUnread(e.id):this.markAsRead(e.id)},t}(n(157).SubscribeableStore);t.UnreadCounterStore=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(262),o=function(){function e(){this.timeout=0,this.idInQueue=[]}return e.prototype.fetchMeProperties=function(){return r.get("fetchMeProfiles","users/self/profile")},e.prototype.fetchPerson=function(e){var t=this;return this.idInQueue.push(e),10!==this.idInQueue.length?this.idInQueue.length>1?this.idInQueuePromise:(this.idInQueuePromise=new Promise(function(e,n){t.lastCreatedRequest=function(){t.fetchPersons(t.idInQueue).then(e,n),t.idInQueue=[],clearTimeout(t.timeout)},t.timeout=setTimeout(t.lastCreatedRequest,2e3)}),this.idInQueuePromise):(this.lastCreatedRequest(),this.idInQueuePromise)},e.prototype.getAvatarUrl=function(e){return i.Configuration.STRATUS_DOMAIN_HOST_URL+"users/"+e+"/profile/avatar?cacheHeaders=1"},e.prototype.fetchPersons=function(e){var t={usernames:e};return r.post("fetchPersons","batch/profiles",JSON.stringify(t))},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(263),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return r.default("stratus-"+e,s,i.Configuration.STRATUS_DOMAIN_HOST_URL+t,n)};t.put=function(e,t,n){return o.putHeaders().then(function(i){var r={method:"PUT"};return r.body=n,r.headers=i,a(e,t,r)})},t.post=function(e,t,n){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var r={method:"POST"};return r.body=n,r.headers=i,a(e,t,r).then(function(e){return e.json()})})};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n,o){return r.default("stratus-"+e,s,(o||i.Configuration.STRATUS_DOMAIN_HOST_URL)+t,n).then(function(e){return e.json()})}(e,t,o)})},t.getData=function(e,t){return o.getDataHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n,o){return r.default("stratus-"+e,s,(o||i.Configuration.STRATUS_DOMAIN_HOST_URL)+t,n).then(function(e){return e.blob()})}(e,t,o)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(5);function o(e){var t=new Headers;return e&&t.append("X-Skypetoken",e),t.append("X-Stratus-Caller",i.Configuration.getUiVersion()),t}t.putHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=o(t);n.append("Content-Type","application/x-www-form-urlencoded"),e(n)},function(){})})},t.getHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=o(t);e(n)},function(){})})},t.getProxyHeaders=function(){return new Promise(function(e){var t=o();t.append("Accept","application/json, text/javascript"),e(t)})},t.getDataHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=o(t);n.append("Accept","image/webp,image/*,*/*;q=0.8"),n.append("Accept-Encoding","gzip, deflate, sdch"),e(n)},function(){})})},t.getDataProxyHeaders=function(){return new Promise(function(e){var t=o();t.append("Accept","image/webp,image/*,*/*;q=0.8"),t.append("Accept-Encoding","gzip, deflate, sdch"),e(t)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5);function r(e){return"8:"+e}var o=function(){function e(){}return e.prototype.fetchMeProperties=function(){return Promise.resolve()},e.prototype.fetchShortProfile=function(e){return i.ServicesManager.userService.then(function(t){return t.getUsers(function(e){return e.map(function(e){return function(e){return 0===e.indexOf("8:")}(e)?e:r(e)})}(e))})},e.prototype.fetchPerson=function(e){return i.ServicesManager.userService.then(function(t){return t.getUser(r(e)).then(function(e){return i.ServicesManager.avatarService.fetchAvatars(e.mri,e.displayName).then(function(t){return[{avatarUrl:"",username:e.mri,displayname:e.displayName,avatarData:t[0]}]})})})},e.prototype.getAvatarUrl=function(e){return""},e.prototype.fetchPersons=function(e){return Promise.resolve([])},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(266),o=function(){function e(){}return e.prototype.fetchProfiles=function(e){if(e.length>3){return new Promise(function(t){r.post("search","https://teams.microsoft.com/api/mt/amer/beta/users/search?includeDLs=true&includeBots=true&enableGuest=true&skypeTeamsInfo=true",e).then(function(e){e.value&&e.value.forEach(function(e){if(e.mri){var t=i.ServicesManager.persons.getPerson(e.mri,!1,!1);t.displayName=e.displayName,t.email=e.email,t.description=e.jobTitle,i.ServicesManager.avatarService.fetchAvatars(e.mri,e.displayName).then(function(e){e&&(t.avatarData=e)})}}),t(e.value)})})}return Promise.resolve([])},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(32),o=n(5),s=n(10),a={retryCount:3,timeout:12e4,policy:""};t.post=function(e,n,i){return t.getHeaders().then(function(t){return function(e,t,n){return s.default("teamsgraph-"+e,a,t,n)}(e,n,{method:"POST",cache:"no-cache",headers:t,body:i}).then(function(e){return e.json()})})},t.getHeaders=function(){return new Promise(function(e){Promise.all([o.ServicesManager.signInManager.aad(r.AadAudience.SpacesApi),o.ServicesManager.signInManager.getSkypeToken()]).then(function(t){var n=t[0],r=t[1],o=new Headers;o.append("Authorization",n),o.append("x-skypetoken",r),o.append("x-skype-client",i.Configuration.getClientVersion()),e(o)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(0),s=n(18);t.reportInappActivityStartEvent=function(e){var t=i.default.get.isTeams()?"AAD":"MSA";o.swc.services.signInManager.onceSignedIn().then(function(){return o.swc.Telemetry.sendEvent.inAppActivityStarted(e,o.swc.services.signInManager.currentUserName,r.Configuration.getUiVersion(),s.default.getOsVersion(),t)})}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=function(){function t(){}return t.translate=function(e,t,n){var i="https://dev.microsofttranslator.com/api/skype/translate?from="+e+"&to="+t+"&text="+n;return this._requestWithToken(i)},t.detect=function(t){var n="https://f3cc4fc2.ngrok.io/detect?text="+t;return new Promise(function(t,i){return e(encodeURI(n),{method:"GET"}).then(function(e){e.json().then(function(e){var n=e.string.$t.split("-")[0];t(n)}).catch(function(e){i(e)})},function(e){i(e)})})},t.getLanguages=function(){return this._requestWithToken("https://dev.microsofttranslator.com/api/languages")},t._requestWithToken=function(t){var n=new Headers,r={};return new Promise(function(o,s){i.ServicesManager.signInManager.getSkypeToken().then(function(i){return n.append("Content-Type","application/x-www-form-urlencoded"),n.append("X-Skypetoken",i),n.append("X-ScenarioId","FF63883DDDED40068EC45030A601460C"),r.method="GET",r.headers=n,e(encodeURI(t),r).then(function(e){e.json().then(function(e){o(e)}).catch(function(e){s(e)})},function(e){s(e)})})})},t}();t.default=r}).call(this,n(57))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(270),r=n(1),o=n(13),s=function(){return function(e){var t=this;this.logEvent=function(e){t._logger.debug(e)},this._logger=e}}(),a=function(){function e(){var e,t,n=this;this._platformName="chrome",this._stateCallback=function(e,t){e===i.TrouterState.Connected&&n.trouterUrl(t)},this._trouterUrlChangeListenerRegistry=(e=[],(t=function(t){e.push(t)}).off=function(t){var n=e.indexOf(t,0);n>-1&&e.splice(n,1)},t.notifyAll=function(t){e.forEach(function(e){e(t)})},t),this.trouterUrl=function(){var e=function(e){if(n._logger.info("trouterUrl change"),void 0===e)return n._trouterUrl;n._trouterUrl!==e&&(n._trouterUrl=e,n._trouterUrlChangeListenerRegistry.notifyAll(e))};return e.changed=n._trouterUrlChangeListenerRegistry,e}()}return e.prototype._getSettings=function(e,t){return{registrationId:o.guid.generate(),registrarServiceUrl:t.incomingCalls.registrarServiceUrl,registrarTtlInSeconds:t.incomingCalls.registrarTtlInSeconds,maxRegistrationTimeInMs:t.incomingCalls.maxRegistrationTimeInMs,registrarRefreshTimeoutInMs:t.incomingCalls.registrarRefreshTimeoutInMs,pnhAppId:t.incomingCalls.pnhAppId,pnhTemplate:t.incomingCalls.pnhTemplate,platform:e,platformUIVersion:"0.0.0",trouterServiceUrl:t.incomingCalls.trouterServiceUrl,version:t.version,trouterConnectTimeoutInMs:t.incomingCalls.trouterConnectTimeoutInMs,productName:t.productName,sessionId:t.sessionId,environment:"",incallModeTimeoutMs:0}},e.prototype._getTrouterSettings=function(){return{version:r.Configuration.getUiVersion(),productName:"swc",incomingCalls:{trouterServiceUrl:"https://go.trouter.skype.com/v4/a",registrarServiceUrl:"https://prod.registrar.skype.com/v2/registrations",registrarTtlInSeconds:360,registrarRefreshTimeoutInMs:35e4,trouterReadyTimeoutInMs:6e4,trouterConnectTimeoutInMs:2e4,maxRegistrationTimeInMs:864e5,pnhAppId:"skype",pnhTemplate:"SkypeWebNGC_1.7"},telemetry:{jSkypeTenantToken:"dummy-not-used",skypeConcoreToken:""}}},e.prototype._createTrouterTelemetryConfig=function(e){return{eventLogger:new s(e.createChild("TrouterTelemetry")),settings:{enabled:!0,logHealthCheckError:!0,trouter_js_client_connected:!0,trouter_js_client_disconnected:!0,trouter_js_client_error:!0,trouter_js_client_progress:!0,trouter_js_client_response:!0,numberOfStepsToMaintain:0,sendProgressTimeoutSecs:0}}},e.prototype._getTrouterConfig=function(e,t,n,i){return{trouterSettings:this._getSettings(t,n),skypeTokenProvider:i,telemetryConfig:this._createTrouterTelemetryConfig(e)}},e.prototype.init=function(e,t,n){var r=this._getTrouterSettings(),o={sessionId:n};return this._logger=e,this._logger.info("Trouterservice init"),this._trouterService?this._logger.warn("Trouterservice already initialized"):(this._options=this._getTrouterConfig(e,this._platformName,r,t),this._trouterService=i.createTrouterService(e.createChild("Trouter")),this.start(o)),this},e.prototype.start=function(e){this._logger.info("Trouterservice start"),this._trouterService?(e&&(this._options.trouterSettings.environment=e.environment,this._options.trouterSettings.sessionId=e.sessionId),this._trouterService.start(this._options),this._trouterService.onStateChanged(this._stateCallback)):this._logger.error("Trouterservice not initialized")},e.prototype.stop=function(){this._logger.info("Trouterservice stop"),this._trouterService?(this._trouterService.stop(),this._trouterService=void 0):this._logger.error("Trouterservice not inited")},e.prototype.registerMessageHandler=function(e){this._logger.info("Trouterservice registerMessageHandler"),this._trouterService&&this._trouterService.registerMessageHandler(e)},e.prototype.clearMessageHandlers=function(){this._trouterService&&this._trouterService.clearMessageHandlers()},e.prototype.checkConnection=function(){this._trouterService&&this._trouterService.checkConnection()},e.prototype.state=function(){return this._logger.info("Trouterservice state"),this._trouterService?this._trouterService.state():i.TrouterState.Unknown},e.prototype.onStateChanged=function(e){this._logger.info("Trouterservice onStateChanged"),this._trouterService&&this._trouterService.onStateChanged(e)},e.prototype.getTrouterUrlAsync=function(){return this._trouterService?(this._logger.info("getTrouterUrlAsync called"),this._trouterService.getTrouterUrlAsync()):Promise.reject("Trouterservice not started yet")},e}();t.Trouter=a},function(module,exports,__webpack_require__){(function(fetch){var e;e=function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=19)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.name=e,this.logger=t}return e.prototype.debug=function(e){this.logger.debug("["+this.name+"] "+e)},e.prototype.info=function(e){this.logger.info("["+this.name+"] "+e)},e.prototype.warn=function(e){this.logger.warn("["+this.name+"] "+e)},e.prototype.error=function(e){this.logger.error("["+this.name+"] "+e)},e}();t.Logger=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},t.CLIENT_VERSION="2019.19.01.1",t.HANDLED_MESSAGE_ACK=200,t.UNHANDLED_MESSAGE_ACK=404,t.FAILED_MESSAGE_ACK=500},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type "+typeof e}},t.calculateTtlInSec=function(e){var t=Math.round((new Date).getTime()/1e3);return void 0!==e&&e>t?e-t:0},t.calculateExpireTsInSec=function(e){return Math.round((new Date).getTime()/1e3)+e};var i=function(){function e(){this.start=Date.now()}return e.prototype.duration=function(){return Date.now()-this.start},e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){}}();t.HttpHeaders=i,function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(t.TrouterState||(t.TrouterState={}))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function e(e){this.logger=e,this.messageHandlers=[]}return e.prototype.register=function(e){if(this.messageHandlers.some(function(t){return t===e}))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(e)},e.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},e.prototype.active=function(){return this.messageHandlers.length>0},e.prototype.handleMessage=function(e){for(var t={resultCode:i.UNHANDLED_MESSAGE_ACK,isHandled:!1},n=0,r=this.messageHandlers;n<r.length;n++){var o=r[n],s=this.safeExecuteHandle(o,e);if(void 0!==s&&(void 0===s.isHandled||s.isHandled))return void 0===s.resultCode&&(s.resultCode=i.HANDLED_MESSAGE_ACK),s}return t},e.prototype.safeExecuteHandle=function(e,t){try{return e.handleMessage(t)}catch(e){return void this.logger.warn("A trouter message handler is throwing exceptions. exception: "+e)}},e}();t.MessageHandlerRegistry=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.addCacheAsBackupTo=function(e){var t,n=this;return function(o){return i(n,void 0,void 0,function(){return r(this,function(n){return o&&(t=void 0),[2,new Promise(function(n,i){e(o).then(function(e){t=e,n(e)}).catch(function(e){void 0!==t&&t.length>0&&n(t),i(e)})})]})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0),o=n(16),s=n(18),a=function(){function e(e,t,n,o){this.logFunc=e,this.options=t,this.tokenProvider=n,this.listener=o,this.logger=new r.Logger("Manager",e),this.logger.info("Created TrouterManager with options "+i.toJson(this.options)),this.fsm=new s.TrouterManagerFsm(e,this),this.baseEndpointUrl=""}return e.prototype.start=function(){this.fsm.start()},e.prototype.stop=function(){this.fsm.stop()},e.prototype.checkConnection=function(e){void 0!==this.firstConnection&&this.firstConnection.checkConnection(e),void 0!==this.secondConnection&&this.secondConnection.checkConnection(e)},e.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.startFirstConnection=function(){this.firstConnection=new o.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider),this.firstConnection.start()},e.prototype.startSecondConnection=function(){this.secondConnection=new o.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider),this.secondConnection.start()},e.prototype.stopFirstConnection=function(e){void 0!==this.firstConnection&&(this.firstConnection.stop(e),this.storedFirstConnection=this.firstConnection,this.firstConnection=void 0)},e.prototype.stopSecondConnection=function(e){void 0!==this.secondConnection&&(this.secondConnection.stop(e),this.secondConnection=void 0)},e.prototype.switchConnections=function(){var e=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=e},e.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},e.prototype.dispatchConnected=function(){if(void 0!==this.firstConnection){var e=this.firstConnection.getServerState(),t="/"===e.url.slice(-1)?e.url.slice(0,-1):e.url,n={baseEndpointUrl:t,newEndpointUrl:t!==this.baseEndpointUrl,clientId:e.connectedClientId,connectionId:e.connectionId,connectionTtlSec:e.getRemainingTtlInSec()};this.baseEndpointUrl=t,this.listener.onTrouterConnected(e.url,n)}},e.prototype.dispatchReconnecting=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchStopped=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.onDownstreamRequest=function(e,t,n){var i={id:t.id,method:t.method,path:"/"+t.shortUrl,body:t.body,headers:t.headers},r={id:t.id,status:0,headers:{},body:"",send:function(){return r.status<=100||r.status>=999?3:(n.writeHead(r.status,r.headers),n.end(r.body))}};this.listener.onTrouterRequest(i,r)},e.prototype.onConnected=function(e){this.fsm.onConnected(e===this.firstConnection)},e.prototype.onRegistered=function(e){this.fsm.onRegistered(e===this.firstConnection)},e.prototype.onReconnecting=function(e){this.fsm.onReconnecting(e===this.firstConnection)},e.prototype.onReconnectIsRequired=function(e){this.fsm.onReconnectionRequired(e===this.firstConnection)},e.prototype.onDisconnected=function(e){this.fsm.onDisconnected(e===this.storedFirstConnection)},e}();t.TrouterManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.logger=e}return e.prototype.getPromise=function(){var e=this;return void 0!==this.url?(this.logger.debug("[TrouterUrlPromise] returning previously resolved url: "+this.url),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("[TrouterUrlPromise] creating and returning promise"),this.pendingPromise=new Promise(function(t,n){e.pendingPromiseResolveRef=t,e.pendingPromiseRejectRef=n})):this.logger.debug("[TrouterUrlPromise] returning existing promise"),this.pendingPromise)},e.prototype.resolveUrl=function(e){this.url=e,this.logger.debug("[TrouterUrlPromise] got url: "+this.url);var t=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] resolving promise"),t(e))},e.prototype.rejectUrl=function(e){this.logger.debug("[TrouterUrlPromise] aborting");var t=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] rejecting promise"),t(e))},e.prototype.resetUrl=function(){this.logger.debug("[TrouterUrlPromise] resetting url"),this.url=void 0},e}();t.TrouterUrlPromise=i},function(module,exports,__webpack_require__){(function(global,module){var t,e,n;t=module.exports,e=void 0===global?window:global,n=t,n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(t,i){var r,o,s=n.util.parseUri(t);e&&e.location&&(s.protocol=s.protocol||e.location.protocol.slice(0,-1),s.host=s.host||(e.document?e.document.domain:e.location.hostname),s.port=s.port||e.location.port),r=n.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(a,i),!a["force new connection"]&&n.sockets[r]||(o=new n.Socket(a)),!a["force new connection"]&&o&&(n.sockets[r]=o),(o=o||n.sockets[r]).of(s.path.length>1?s.path:"")};var io=module.exports;!function(e,t){var n=e.util={},i=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=i.exec(e||""),n={},o=14;o--;)n[r[o]]=t[o]||"";return n},n.uniqueUri=function(e){var n=e.protocol,i=e.host,r=e.port;return"document"in t?(i=i||document.domain,r=r||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(i=i||"localhost",r||"https"!=n||(r=443)),(n||"http")+"://"+i+":"+(r||80)},n.query=function(e,t){var i=n.chunkQuery(e||""),r=[];for(var o in n.merge(i,n.chunkQuery(t||"")),i)i.hasOwnProperty(o)&&r.push(o+"="+i[o]);return r.length?"?"+r.join("&"):""},n.chunkQuery=function(e){for(var t,n={},i=e.split("&"),r=0,o=i.length;r<o;++r)(t=i[r].split("="))[0]&&(n[t[0]]=t[1]);return n};var o=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||o)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,i){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,i)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){o=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,i,r){var o,s=r||[],a=void 0===i?2:i;for(o in t)t.hasOwnProperty(o)&&n.indexOf(s,o)<0&&("object"==typeof e[o]&&a?n.merge(e[o],t[o],a-1,s):(e[o]=t[o],s.push(t[o])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var i=[],r=e.length>t.length?e:t,o=e.length>t.length?t:e,s=0,a=o.length;s<a;s++)~n.indexOf(r,o[s])&&i.push(o[s]);return i},n.indexOf=function(e,t,n){var i=e.length;for(n=n<0?n+i<0?0:n+i:n||0;n<i&&e[n]!==t;n++);return i<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,void 0===global?window:global),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){i.removeListener(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var i=this.$events[e];if(t.util.isArray(i)){for(var r=-1,o=0,s=i.length;o<s;o++)if(i[o]===n||i[o].listener&&i[o].listener===n){r=o;break}if(r<0)return this;i.splice(r,1),i.length||delete this.$events[e]}else(i===n||i.listener&&i.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var i=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,i);else{if(!t.util.isArray(n))return!1;for(var r=n.slice(),o=0,s=r.length;o<s;o++)r[o].apply(this,i)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,s,a=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;n<o;n+=1)s[n]=str(n,c)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;n<o;n+=1)"string"==typeof rep[n]&&((r=str(i=rep[n],c))&&s.push(quote(i)+(gap?": ":":")+r));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(r=str(i,c))&&s.push(quote(i)+(gap?": ":":")+r);return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(void 0!==(i=walk(r,n))?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},i=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],r=n.reasons=["transport not supported","client not handshaken","unauthorized"],o=n.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;n.encodePacket=function(e){var t=a(i,e.type),n=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var p=e.reason?a(r,e.reason):"",d=e.advice?a(o,e.advice):"";""===p&&""===d||(l=p+(""!==d?"+"+d:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var f={name:e.name};e.args&&e.args.length&&(f.args=e.args),l=s.stringify(f);break;case"json":l=s.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var h=[t,n+("data"==u?"+":""),c];return null!=l&&h.push(l),h.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,i=e.length;n<i;n++)t+=""+e[n].length+""+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){if(!(a=e.match(c)))return{};var t=a[2]||"",n=(e=a[5]||"",{type:i[a[1]],endpoint:a[4]||""});switch(t&&(n.id=t,a[3]?n.ack="data":n.ack=!0),n.type){case"error":var a=e.split("+");n.reason=r[a[0]]||"",n.advice=o[a[1]]||"";break;case"message":n.data=e||"";break;case"event":try{var u=s.parse(e);n.name=u.name,n.args=u.args}catch(e){}n.args=n.args||[];break;case"json":try{n.data=s.parse(e)}catch(e){}break;case"connect":n.qs=e||"";break;case"ack":if((a=e.match(/^([0-9]+)(\+)?(.*)/))&&(n.ackId=a[1],n.args=[],a[3]))try{n.args=a[3]?s.parse(a[3]):[]}catch(e){}}return n},n.decodePayload=function(e){if(""==e.charAt(0)){for(var t=[],i=1,r="";i<e.length;i++)""==e.charAt(i)?(t.push(n.decodePacket(e.substr(i+1).substr(0,r))),i+=Number(r)+1,r=""):r+=e.charAt(i);return t}return[n.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t,this.connectErrorCallback=void 0,this.isOpened=!1}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var i=0,r=n.length;i<r;i++)this.onPacket(n[i])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpened=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function i(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var i=this;t.util.on(n,"unload",function(){i.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function r(){}e.Socket=i,t.util.mixin(i,t.EventEmitter),i.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},i.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},i.prototype.handshake=function(e){function n(t){t instanceof Error?i.onError(t.message):e.apply(null,t.split(":"))}var i=this,o=this.options,s=["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push(function(e){n(e),c.parentNode.removeChild(c)})}else{var u=t.util.request();u.open("GET",s,!0),u.withCredentials=!0,u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=r,200==u.status?n(u.responseText):!i.reconnecting&&i.onError(u.responseText))},u.send(null)}},i.prototype.getTransport=function(e){for(var n,i=e||this.transports,r=0;n=i[r];r++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},i.prototype.connect=function(e){if(this.connecting)return this;var n=this;return this.handshake(function(i,r,o,s){function a(){if(!n.connected)if(n.connecting=!1,clearTimeout(n.connectTimeoutTimer),n.options["try multiple transports"]){for(;n.remainingTransports.length>0&&n.remainingTransports.splice(0,1)[0]!=n.transport.name;);n.remainingTransports.length?c(n.remainingTransports):n.publish("connect_failed")}else n.publish("connect_failed")}function c(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(a),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){a()},n.options["connect timeout"]))})}n.sessionid=i,n.closeTimeout=1e3*o+2e3,n.heartbeatTimeout=1e3*r+2e3,n.transports=s?t.util.intersect(s.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),n.remainingTransports=n.transports.slice(0),c(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},i.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},i.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},i.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},i.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},i.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},i.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},i.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},i.prototype.onOpen=function(){this.open=!0},i.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},i.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},i.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},i.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},i.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=r}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=i?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<o&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,i=this.options["max reconnection attempts"],r=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new i(this,"json"),this.ackPackets=0,this.acks={}}function i(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],i={type:"event",name:e};return"function"==typeof n&&(i.id=++this.ackPackets,i.ack="data",this.acks[i.id]=n,t=t.slice(0,t.length-1)),i.args=t,this.packet(i)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){i.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var i=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var r=["message",e.data];"data"==e.ack?r.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,r);break;case"event":r=[e.name].concat(e.args);"data"==e.ack&&r.push(n),this.$emit.apply(this,r);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},i.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},i.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function i(e){t.Transport.apply(this,arguments)}function r(){}e.websocket=i,t.util.inherit(i,t.Transport),i.prototype.name="websocket",i.prototype.open=function(e){var i,r=t.util.query(this.socket.options.query),o=this;return this.connectErrorCallback=e,i||(i=n.MozWebSocket||n.WebSocket),this.websocket=new i(this.prepareUrl()+r),this.websocket.onopen=function(){o.onOpen(),o.socket.setBuffer(!1)},this.websocket.onmessage=function(e){o.onData(e.data)},this.websocket.onclose=function(){o.onClose(),o.socket.setBuffer(!0)},this.websocket.onerror=function(e){o.onError(e)},this},i.prototype.send=function(e){return this.websocket.send(e),this},i.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},i.prototype.close=function(){return this.websocket.close(),this},i.prototype.onError=function(e){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(e)},i.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},i.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},i.xdomainCheck=function(){return!0},i.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=r),this},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function r(){}e.XHR=i,t.util.inherit(i,t.Transport),i.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},i.prototype.payload=function(e){for(var n=[],i=0,r=e.length;i<r;i++)n.push(t.parser.encodePacket(e[i]));this.send(t.parser.encodePayload(n))},i.prototype.send=function(e){return this.post(e),this},i.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=r,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=r,t.posting=!1,200==this.status?(t.socket.setBuffer(!1),clearTimeout(t.sendXHR.ackTimeoutTimer)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout(function(){t.onClose()},t.socket.options.ackTimeoutMs)},i.prototype.close=function(){return this.onClose(),this},i.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),i=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+i,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},i.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},i.check=function(e,i){try{var r=t.util.request(i),o=n.XDomainRequest&&r instanceof XDomainRequest,s=(e&&e.options&&e.options.secure?"https:":"http:")!=n.location.protocol;if(r&&(!o||!s))return!0}catch(e){}return!1},i.xdomainCheck=function(){return i.check(null,!0)},i.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=r),this}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(){t.Transport.XHR.apply(this,arguments)}function r(){}e["xhr-polling"]=i,t.util.inherit(i,t.Transport.XHR),t.util.merge(i,t.Transport.XHR),i.prototype.name="xhr-polling",i.prototype.open=function(e){return this.connectErrorCallback=e,t.Transport.XHR.prototype.open.call(this),!1},i.prototype.get=function(){if(this.isOpened){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){e.connectErrorCallback=void 0,this.onload=r,this.onerror=r,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=r,200==this.status?(e.connectErrorCallback=void 0,e.onData(this.responseText),e.get()):(e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)))},this.xhr.send(null)}},i.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(e){}this.xhr=null}},i.prototype.ready=function(e,n){var i=this;t.util.defer(function(){n.call(i)})},i.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r),this},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),exports.io=io}).call(exports,__webpack_require__(4),__webpack_require__(12)(module))},function(e,t,n){(function(t,i){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.0.5
 */
!function(t,n){e.exports=n()}(0,function(){"use strict";function e(e){return"function"==typeof e}function r(){var e=setTimeout;return function(){return e(o,1)}}function o(){for(var e=0;e<S;e+=2)(0,x[e])(x[e+1]),x[e]=void 0,x[e+1]=void 0;S=0}function s(e,t){var n=arguments,i=this,r=new this.constructor(c);void 0===r[L]&&_(r);var o=i._state;return o?function(){var e=n[o-1];P(function(){return y(o,r,e,i._result)})}():g(i,r,e,t),r}function a(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(c);return p(t,e),t}function c(){}function u(e){try{return e.then}catch(e){return F.error=e,F}}function l(t,n,i){n.constructor===t.constructor&&i===s&&n.constructor.resolve===a?function(e,t){t._state===D?f(e,t._result):t._state===U?h(e,t._result):g(t,void 0,function(t){return p(e,t)},function(t){return h(e,t)})}(t,n):i===F?h(t,F.error):void 0===i?f(t,n):e(i)?function(e,t,n){P(function(e){var i=!1,r=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,function(n){i||(i=!0,t!==n?p(e,n):f(e,n))},function(t){i||(i=!0,h(e,t))},e._label);!i&&r&&(i=!0,h(e,r))},e)}(t,n,i):f(t,n)}function p(e,t){e===t?h(e,new TypeError("You cannot resolve a promise with itself")):function(e){return"function"==typeof e||"object"==typeof e&&null!==e}(t)?l(e,t,u(t)):f(e,t)}function d(e){e._onerror&&e._onerror(e._result),m(e)}function f(e,t){e._state===R&&(e._result=t,e._state=D,0!==e._subscribers.length&&P(m,e))}function h(e,t){e._state===R&&(e._state=U,e._result=t,P(d,e))}function g(e,t,n,i){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+D]=n,r[o+U]=i,0===o&&e._state&&P(m,e)}function m(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,o=e._result,s=0;s<t.length;s+=3)i=t[s],r=t[s+n],i?y(n,i,r,o):r(o);e._subscribers.length=0}}function v(){this.error=null}function y(t,n,i,r){var o=e(i),s=void 0,a=void 0,c=void 0,u=void 0;if(o){if((s=function(e,t){try{return e(t)}catch(e){return j.error=e,j}}(i,r))===j?(u=!0,a=s.error,s=null):c=!0,n===s)return void h(n,new TypeError("A promises callback cannot return that same promise."))}else s=r,c=!0;n._state!==R||(o&&c?p(n,s):u?h(n,a):t===D?f(n,s):t===U&&h(n,s))}function _(e){e[L]=B++,e._state=void 0,e._result=void 0,e._subscribers=[]}function b(e,t){this._instanceConstructor=e,this.promise=new e(c),this.promise[L]||_(this.promise),C(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?f(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&f(this.promise,this._result))):h(this.promise,new Error("Array Methods must be provided an Array"))}function w(e){this[L]=B++,this._result=this._state=void 0,this._subscribers=[],c!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof w?function(e,t){try{t(function(t){p(e,t)},function(t){h(e,t)})}catch(t){h(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}var C=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},S=0,T=void 0,E=void 0,P=function(e,t){x[S]=e,x[S+1]=t,2===(S+=2)&&(E?E(o):N())},I="undefined"!=typeof window?window:void 0,k=I||{},M=k.MutationObserver||k.WebKitMutationObserver,O="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),A="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,x=new Array(1e3),N=void 0;N=O?function(){return t.nextTick(o)}:M?function(){var e=0,t=new M(o),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():A?function(){var e=new MessageChannel;return e.port1.onmessage=o,function(){return e.port2.postMessage(0)}}():void 0===I?function(){try{var e=n(20);return void 0!==(T=e.runOnLoop||e.runOnContext)?function(){T(o)}:r()}catch(e){return r()}}():r();var L=Math.random().toString(36).substring(16),R=void 0,D=1,U=2,F=new v,j=new v,B=0;return b.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===R&&n<e;n++)this._eachEntry(t[n],n)},b.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===a){var r=u(e);if(r===s&&e._state!==R)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===w){var o=new n(c);l(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},b.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===R&&(this._remaining--,e===U?h(i,n):this._result[t]=n),0===this._remaining&&f(i,this._result)},b.prototype._willSettleAt=function(e,t){var n=this;g(e,void 0,function(e){return n._settledAt(D,t,e)},function(e){return n._settledAt(U,t,e)})},w.all=function(e){return new b(this,e).promise},w.race=function(e){var t=this;return new t(C(e)?function(n,i){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},w.resolve=a,w.reject=function(e){var t=new this(c);return h(t,e),t},w._setScheduler=function(e){E=e},w._setAsap=function(e){P=e},w._asap=P,w.prototype={constructor:w,then:s,catch:function(e){return this.then(null,e)}},w.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=w},w.Promise=w,w})}).call(t,n(11),n(4))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(){h&&d&&(h=!1,d.length?f=d.concat(f):g=-1,f.length&&s())}function s(){if(!h){var e=r(o);h=!0;for(var t=f.length;t;){for(d=f,f=[];++g<t;)d&&d[g].run();g=-1,t=f.length}d=null,h=!1,function(e){if(l===clearTimeout)return clearTimeout(e);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}(e)}}function a(e,t){this.fun=e,this.array=t}function c(){}var u,l,p=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{l="function"==typeof clearTimeout?clearTimeout:i}catch(e){l=i}}();var d,f=[],h=!1,g=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new a(e,t)),1!==f.length||h||r(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(2),o=n(1),s=n(0),a=function(){return function(e){this.id=e,this.status=200,this.headers={},this.body=""}}();t.ResponseData=a,function(e){e.Connected="trouter_js_client_connected",e.Disconnected="trouter_js_client_disconnected",e.Error="trouter_js_client_error",e.Progress="trouter_js_client_progress",e.Response="trouter_js_client_response",e.Request="trouter_js_client_request",e.CheckConnection="trouter_js_client_check_connection",e.Registration="trouter_js_client_registration",e.Unregistration="trouter_js_client_unregistration"}(i=t.ClientEventName||(t.ClientEventName={}));var c=function(){return function(e,t,n,i,r){this.stepName=e,this.operation=t,this.delta=n,this.ts=i,this.error=r}}();t.TrackerStep=c;var u=function(){return function(){}}();t.Properties=u;var l=function(){return function(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0}}(),p=function(){return function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0}}(),d=function(){function e(e,t,n,i,o,a){this.clientId=t,this.clientInfo=n,this.getServerState=i,this.clientCorrelationID=o,this.environment=a,this.logger=new s.Logger("ConnectionTracker",e),this.clientCorrelationID=void 0!==o?o:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new r.Timespan,this.eventLogSettings=new p,this.connectedInfo=new l}return e.prototype.enable=function(e){this.eventLogSettings.enabled=!0,this.eventLogger=e},e.prototype.disable=function(){this.eventLogSettings.enabled=!1},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(i.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout(function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})},1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];t.hasOwnProperty(r)&&void 0!==t[r]&&(e[r.replace(/-/g,"_")]={value:t[r]})}},e.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[e]&&void 0!==this.eventLogger){var i=this.getServerState(),s={name:e,properties:{connectionAttempt:{value:this.connectionAttempt},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:r.toJson(n)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:o.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:i.connectionId},connectedClientId:{value:i.connectedClientId},domId:{value:i.domId},url:{value:i.unsecureUrl},surl:{value:i.url},ttlInSecs:{value:i.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(s.properties,t),this.eventLogger.logEvent(s)}}catch(t){this.logger.warn("error in sending event "+e+": "+r.toJson(t))}},e.prototype.createStep=function(e,t,n){return new c(e,t,this.beginTimestamp.duration(),Date.now(),n)},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var r=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(i.Progress,{reason:"flush"},r)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,r){void 0===r&&(r=!1),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===e&&!1===this.eventLogSettings.logSendPingError||(!0===r&&this.addStep(e,t,n),this.sendTelemetry(i.Error,{},[this.createStep(e,t,n)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),r=this.totalStepCount,o=this.beginTimestamp.duration();this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(i.Connected,{stepCount:n.length,totalStepCount:r,connectionEstablishmentMs_Total:o},n),this.cancelProgressTimer()},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=Date.now()-this.connectedInfo.connectedTimestamp,this.sendTelemetry(i.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n={};void 0!==t&&(n.hasError=!0,n.error=t);try{if(e){n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body.length,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS;for(var o=e.headers,s=0,a=Object.keys(o);s<a.length;s++){var c=a[s];o.hasOwnProperty(c)&&(n[c]=o[c])}}}catch(e){n.hasError=!0,n.error=n.error+" error creating request context "+r.toJson(e)}this.sendTelemetry(i.Request,n,[])},e.prototype.trackResponse=function(e,t,n,o){var s={};void 0!==o&&(s.hasError=!0,s.error=o);try{if(s.responseTimestamp=void 0!==n?n.sentTS:Date.now(),e){s.requestID=e.id,s.httpMethod=e.method,s.shortUrl=e.shortUrl;for(var a=e.headers,c=0,u=Object.keys(a);c<u.length;c++){var l=u[c];a.hasOwnProperty(l)&&(s[l]=a[l])}}n&&(s.latencyMS=t,s.responseCode=n.status,s.responseLength=n.body.length)}catch(e){s.hasError=!0,s.error=s.error+" error creating response context "+r.toJson(e)}this.sendTelemetry(i.Response,s,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,void 0,n,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==e.numberOfStepsToMaintain?e.numberOfStepsToMaintain:0)),this.eventLogSettings.sendProgressTimeoutSecs=Math.min(3600,Math.max(55,void 0!==e.sendProgressTimeoutSecs?e.sendProgressTimeoutSecs:0)),this.eventLogSettings.logHealthCheckError=e.logHealthCheckError,this.eventLogSettings.logSendPingError=e.logSendPingError;for(var t=0,n=Object.keys(i).map(function(e){return i[e]});t<n.length;t++){var r=n[t];e.hasOwnProperty(r)&&void 0!==e[r]&&(this.eventLogSettings[r]=e[r])}this.resetProgressSendTimer()}},e}();t.ConnectionTracker=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.logger=e,this.maxBackoffInMs=t,this.backoffId=0,this.backoffCount=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),i=1e3*Math.pow(2,e)*n;return i=Math.round(i),Math.min(t,i)},e.prototype.setMaxBackoffMs=function(e){this.maxBackoffInMs=e},e.prototype.backoff=function(t,n){var i=this;void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0);var r=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off "+t+" for "+r+" milliseconds with ID "+this.backoffId),this.timerHandle=setTimeout(function(){i.logger.info("Back off for "+t+" with ID "+i.backoffId+" complete, invoking handler"),i.timerHandle=void 0,n()},r)},e.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),this.backoffCount=0},e}();t.ExponentialBackoff=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(e,t,n,i,r,o){this.connectionId=e,this.connectedClientId=t,this.domId=n,this.unsecureUrl=i,this.url=r,this.expirationTsSec=o}return e.prototype.getRemainingTtlInSec=function(){return i.calculateTtlInSec(this.expirationTsSec)},e}();t.ServerState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),r=n(2),o=n(13),s=n(1),a=n(14),c=n(15),u=n(0),l=n(17),p=n(9),d=function(){return function(){this.cv=s.CLIENT_VERSION,this.ua="",this.hr="",this.v=""}}(),f=function(){return function(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3}}(),h=function(){function e(e){var t=JSON.parse(e);this.startTS=t.hasOwnProperty("startTS")?t.startTS:0,this.url=t.hasOwnProperty("url")?t.url:"",this.shortUrl=t.hasOwnProperty("shortUrl")?t.shortUrl:"",this.body=t.hasOwnProperty("body")?t.body:"",this.headers=t.hasOwnProperty("headers")?t.headers:{},this.id=t.hasOwnProperty("id")&&"number"==typeof t.id?t.id:-1,this.method=t.hasOwnProperty("method")?t.method:"",this.replied=!1,this.timedout=!1,this.timeoutTimerId=0}return e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e}(),g=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){return e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),m=function(){function e(e,t,n,i){var c=this;this.options=t,this.manager=n,this.tokenProvider=i,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.UNKNOWN_TRANSPORT="unknown_transport",this.logger=new u.Logger("Connection",e),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff=new a.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.tokenBackoff=new a.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),this.healthUrl=this.options.trouterUrl,"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.clientInfo=new d,this.clientInfo.cv=s.CLIENT_VERSION,this.clientInfo.ua="",this.options&&this.options.clientInfo&&(this.clientInfo.ua=this.safeString(this.options.clientInfo.ua),this.clientInfo.v=this.safeString(this.options.clientInfo.v)),this.connectionTracker=new o.ConnectionTracker(e,this.clientID,this.clientInfo,function(){return c.getServerState()},this.options.clientCorrelationID,this.options.environment);try{this.options.eventLogger&&"function"==typeof this.options.eventLogger.logEvent?(this.connectionTracker.mergeSettings(this.options.telemetrySettings),this.connectionTracker.enable(this.options.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.connectionTracker.disable(),this.logger.warn("Trouter client event logging disabled. error in initialization: "+r.toJson(e))}var p=this.options.incallModeTimeoutMs>0;this.fsm=new l.TrouterFsm(e,this,p)}return e.prototype.start=function(){this.logger.info("Starting"),this.fsm.start()},e.prototype.stop=function(e){this.logger.info("Stopping"),this.connectionTracker.close(),this.fsm.stop(e)},e.prototype.checkConnection=function(e){this.logger.info("checkConnection called with "+e),this.fsm.checkConnection(e),e&&this.connectionTracker.sendTelemetry(o.ClientEventName.CheckConnection,{disconnectDetected:e},[])},e.prototype.getServerState=function(){return new c.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.connectionExpireTimestampInSecs)},e.prototype.getToken=function(e,t){var n=this;this.logger.info("Getting token "+(t?"with backoff":"without backoff"));var i=function(){n.connectionTracker.trackStart("token"),n.tokenProvider(!e).then(function(e){n.logger.debug("token is received"),n.connectionTracker.trackEnd("token"),n.fsm.onTokenReceived(e)}).catch(function(t){var i=r.toJson(t);n.logger.error("Error getting token - retry after timeout: "+i),n.connectionTracker.trackError("token","error",i,!0),n.getToken(e,!0)})};t?this.tokenBackoff.backoff("getting token",i):(this.tokenBackoff.reset(),i())},e.prototype.startConnectionTimer=function(){var e=this;this.logger.debug("Starting connection timeout for "+this.timeoutOptions.connectionTimeoutMs+" ms"),this.connectionTimeoutId=setTimeout(function(){e.logger.info("Connection timeout is fired"),e.fsm.onConnectingTimeout()},this.timeoutOptions.connectionTimeoutMs)},e.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},e.prototype.startPingTimer=function(){var e=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for "+this.timeoutOptions.pingTimeoutMs+" ms"),this.pingTimerId=setInterval(function(){e.logger.info("Ping interval fired"),e.fsm.onPingInterval()},this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport "+this.transportTypeName)},e.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},e.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},e.prototype.hasCustomRegisterTtl=function(){return this.options.registration&&this.options.registration.registrarTtlSec},e.prototype.startRegisterTimer=function(){var e=this;if(void 0===this.registrationTimerId){var t=this.getRegistrationTtl()-30;this.logger.debug("Starting registration timeout for "+t+" sec"),this.registrationTimerId=setTimeout(function(){e.logger.info("Registration timeout is fired"),e.registrationTimerId=void 0,e.fsm.onRegistrationTimeout()},1e3*t)}else this.logger.error("Another registration timer is set - don't create another one")},e.prototype.stopRegisterTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},e.prototype.buildSocketIoUrlParams=function(){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");var e={};if(this.allocateResult.connectparams)for(var t=this.allocateResult.connectparams,n=0,i=Object.keys(t);n<i.length;n++){var o=i[n];t.hasOwnProperty(o)&&void 0!==t[o]&&(e[o]=t[o])}return e.v="v4",e.tc=encodeURI(r.toJson(this.clientInfo)),e.timeout=this.timeoutOptions.pingTimeoutMs/1e3,e.auth="true",this.appendConnectedClientIds(this.buildQuery(e),!0)},e.prototype.startSocketIo=function(){var e=this;if(this.logger.info("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var t=this.options.ioOptions||new f;if(t["force new connection"]=!0,t.reconnect=!1,t.query=this.buildSocketIoUrlParams(),this.logger.info("connecting to "+this.allocateResult.socketio+"?"+t.query),this.stopSocketIo(),this.socket=(this.options.io||p).connect(this.allocateResult.socketio,t),void 0===this.socket)throw new Error("Can't create Socket.io object");this.socket.on("connecting",function(t){e.onSocketConnecting(t)}),this.socket.on("connect",function(){e.onSocketConnect()}),this.socket.on("connect_failed",function(t){e.onSocketConnectFailed(t)}),this.socket.on("disconnect",function(){e.onSocketDisconnect()}),this.socket.on("reconnect",function(){e.onSocketReconnect()}),this.socket.on("reconnect_failed",function(t){e.onSocketReconnectFailed(t)}),this.socket.on("reconnecting",function(){e.onSocketReconnecting()}),this.socket.on("error",function(t){e.onSocketError(t)}),this.socket.on("message",function(t){e.onSocketMessage(t)}),this.socket.on("trouter.connected",function(t){e.onTrouterConnected(t)}),this.socket.on("trouter.reconnect",function(){e.onTrouterReconnect()})},e.prototype.stopSocketIo=function(){if(this.socket){this.logger.info("clearing socket.io");try{for(var e=0,t=["connecting","connect","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect"];e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(e){this.logger.error("exception in disconnecting previous socket: "+r.toJson(e.stack))}}},e.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},e.prototype.dispatchRegistered=function(){this.logger.info("dispatching connected"),this.manager.onRegistered(this)},e.prototype.dispatchDownstreamRequest=function(e){var t=this;this.logger.info("dispatching downstream request");try{var n=new g(e,new o.ResponseData(e.id),function(e,n){return t.logger.info("sending response to downstream"),t.sendResponse(e,n)});this.manager.onDownstreamRequest(this,e,n)}catch(e){this.logger.error("exception in socket.on message: "+r.toJson(e.stack))}},e.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},e.prototype.dispatchReconnectIsRequired=function(){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this)},e.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},e.prototype.resetAllocationConnectionParams=function(){this.allocateResult&&(this.logger.info("Resetting allocation connection parameters"),this.allocateResult.connectparams=void 0)},e.prototype.sendAllocateRequest=function(e){var t=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var n=this.appendCorrelationIds(this.options.trouterUrl,!1);this.allocateResult&&this.allocateResult.connectparams&&(n+="&"+this.buildQuery(this.allocateResult.connectparams),this.allocateResult.connectparams.v||(n+="&v=v4"));var i=new Request(n,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"Content-Type":"text/plain"})});this.logger.info("sendAllocateRequest: POST "+n),this.connectionTracker.trackStart("allocation"),this.fetchWithTimeout(i,this.timeoutOptions.fetchTimeoutMs).then(function(e){if(401===e.status)throw{message:e.statusText||"Request not authorized",status:401};if(200!==e.status)throw new Error("Response status "+e.status+" "+e.statusText);var n=e.headers.get("content-type");if(!n||"application/json"!==n&&"application/json;"!==n.substring(0,17))throw new Error("Content-type "+n+" is unexpected");return t.connectionTracker.trackEnd("allocation"),e.json()}).then(function(e){t.onAllocationResponse(e)}).catch(function(e){t.logger.error("Allocation request failed with "+e.message),t.connectionTracker.trackError("allocation","end",e.message,!0),t.fsm.onAllocationFailed(e.status&&401===e.status)})},e.prototype.sendPingRequest=function(){var e=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.info("emitting ping event"),this.socket.emit("ping",function(){e.onPingResponse()}),this.pingResponseTimerId=setTimeout(function(){e.logger.error("Ping response timeout is fired"),e.clearPingResponseTimer(),e.fsm.onPingResponseTimeout()},this.timeoutOptions.pongTimeoutMs)}catch(e){var t=r.toJson(e.stack);this.logger.error("unable to send ping, error: "+t),this.connectionTracker.trackError("ping","send",t)}},e.prototype.sendRegisterRequest=function(e){var t=this;this.logger.info("sending register request");var n=new r.Timespan;if(!this.options.registration)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");var i={clientDescription:{appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion},registrationId:this.options.registration.registrationId,nodeId:"",transports:{TROUTER:[{context:"",path:this.allocateResult.surl,ttl:this.getRegistrationTtl()}]}},s=new Request(this.options.registration.registrarUrl,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"content-type":"application/json",accept:"application/json, text/javascript"}),body:r.toJson(i)});this.connectionTracker.trackStart("registration"),this.fetchWithTimeout(s,this.timeoutOptions.fetchTimeoutMs).then(function(e){e.ok?(t.logger.info("onRegisterResponse: status "+e.status),t.connectionTracker.trackEnd("registration"),t.fsm.onRegistrationSucceed()):(t.logger.error("Error status in register response: "+e.status),t.connectionTracker.trackError("registration","registration",e.status.toString()),t.fsm.onRegistrationFailed(401===e.status)),t.connectionTracker.sendTelemetry(o.ClientEventName.Registration,{status:e.status,duration:n.duration()},[])}).catch(function(e){t.logger.error("Error while sending register request: "+e.message),t.fsm.onRegistrationFailed(!1),t.connectionTracker.sendTelemetry(o.ClientEventName.Registration,{status:-1,duration:n.duration()},[])})},e.prototype.sendUnregisterRequest=function(e){var t=this;this.logger.info("sending unregister request");var n=new r.Timespan;if(!this.options.registration)throw new Error("Internal error - options.registration is undefined");var i=new Request(this.options.registration.registrarUrl+"/"+this.options.registration.registrationId,{method:"DELETE",mode:"cors",headers:new Headers({"X-Skypetoken":e,accept:"application/json, text/javascript"})});this.connectionTracker.trackStart("unregistration"),this.fetchWithTimeout(i,this.timeoutOptions.fetchTimeoutMs).then(function(e){e.ok?(t.logger.info("onUnregisterResponse: status "+e.status),t.connectionTracker.trackEnd("unregistration"),t.fsm.onUnregistrationSucceed()):(t.logger.error("Error status in unregister response: "+e.status),t.connectionTracker.trackError("unregistration","unregistration",e.status.toString()),t.fsm.onUnregistrationFailed(401===e.status)),t.connectionTracker.sendTelemetry(o.ClientEventName.Unregistration,{status:e.status,duration:n.duration()},[])}).catch(function(e){t.logger.error("Error while sending unregister request: "+e.message),t.fsm.onUnregistrationFailed(!1),t.connectionTracker.sendTelemetry(o.ClientEventName.Unregistration,{status:-1,duration:n.duration()},[])})},e.prototype.fetchWithTimeout=function(e,t){return new i.Promise(function(n,i){fetch(e).then(n).catch(i),0!==t&&setTimeout(i,t,new Error("Fetch for '"+e.url+"' timed out"))})},e.prototype.sendHealthRequest=function(e){var t=this;this.logger.info("sending health request "+(e?"with backoff":"without backoff"));var n=new Request(this.healthUrl,{method:"POST",mode:"cors",headers:new Headers}),i=function(){t.logger.info("sendHealthRequest: POST "+n.url),t.connectionTracker.trackStart("health"),t.fetchWithTimeout(n,t.timeoutOptions.fetchTimeoutMs).then(function(e){if(!e.ok)throw new Error("Response status "+e.status+" "+e.statusText);t.connectionTracker.trackEnd("health"),t.logger.info("Health check request succeed"),t.fsm.onHealthSucceed()}).catch(function(e){t.logger.error("Health check request failed with "+e.message),t.connectionTracker.trackEnd("health"),t.connectionTracker.trackError("health","health error",e.message),t.fsm.onHealthFailed()})};e?this.healthBackoff.backoff("health request",i):(this.healthBackoff.reset(),i())},e.prototype.resetHealthBackoff=function(){this.healthBackoff.reset()},e.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},e.prototype.restartIncallModeTimer=function(){var e=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout(function(){e.logger.info("Call mode timer fired"),e.fsm.onIncallModeTimer()},this.options.incallModeTimeoutMs)},e.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},e.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},e.prototype.isIncallMode=function(){return this.inIncallMode},e.prototype.onSocketConnecting=function(e){this.logger.info("onSocketConnecting("+e+")"),this.transportTypeName=e,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},e.prototype.onSocketConnect=function(){this.logger.info("onSocketConnect")},e.prototype.onSocketConnectFailed=function(e){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT,e,!0),this.fsm.onConnectingFailed()},e.prototype.onSocketDisconnect=function(){this.logger.error("onSocketDisconnect"),this.connectionTracker.trackDisconnected({serverClosed:!this.fsm.isActive()}),this.connectionTracker.clearConnectedInfo(),this.fsm.onSocketError(void 0),this.connectionExpireTimestampInSecs=void 0},e.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},e.prototype.onSocketReconnectFailed=function(e){this.logger.error("onSocketReconnectFailed with '"+e+"'"),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},e.prototype.onSocketError=function(e){this.logger.error("onSocketError with '"+r.toJson(e)+"'"),this.connectionTracker.trackError("connectSocket","socketio.error",e,!0),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketMessage=function(e){var t,n=this;this.logger.info("onSocketMessage");try{var i=(t=new h(e)).headers&&t.headers["X-Microsoft-Skype-Chain-ID"],s=i?" Chain-Id "+i:"";this.logger.info("Received request N "+t.id+s+" to '"+t.url+"'"),t.startTS=Date.now(),t.url&&this.urlPath&&0===t.url.indexOf(this.urlPath)&&(t.shortUrl=t.url.substring(this.urlPath.length))}catch(e){var a=r.toJson(e.stack);return this.logger.error("unable to parse request, error: "+a),this.connectionTracker.trackRequest(void 0,a),void this.connectionTracker.sendResponseError("unable to parse request, error: "+e.message)}t.timeoutTimerId=setTimeout(function(){if(!t.replied){n.logger.error("Request "+t.id+" timed out");var e=new o.ResponseData(t.id);e.status=504,e.headers={"Trouter-Responder":"ClientLib"},n.sendResponse(t,e),t.timedout=!0}},this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(t),this.fsm.onDownstreamRequest(t)}catch(e){this.logger.error("exception in socket.on message: "+r.toJson(e.stack)),this.connectionTracker.sendResponseError(e.message,t,void 0)}},e.prototype.onTrouterConnected=function(e){if(this.allocateResult){this.logger.info("onTrouterConnected: "+this.allocateResult.url),this.socket&&this.socket.socket&&this.socket.socket.options&&this.socket.socket.options.query&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var t=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=r.calculateExpireTsInSec(e.ttl),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(t,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onTrouterConnected()}else this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set")},e.prototype.onTrouterReconnect=function(){this.logger.info("onTrouterReconnect"),this.fsm.onReconnectRequired()},e.prototype.onAllocationResponse=function(e){this.logger.info("Received allocation response"),this.allocateResult=e;var t=+e.ttl;this.connectionExpireTimestampInSecs=r.calculateExpireTsInSec(t),this.connectionId=this.allocateResult.id||"",this.allocateResult.healthUrl?this.healthUrl=this.allocateResult.healthUrl:(this.healthUrl=this.getHealthUrl(this.options.trouterUrl),this.logger.warn("No healthUrl property found when parsing allocation.")),this.connectedClientId=this.allocateResult.ccid,this.logger.info("connected client id set {connectedClientId:"+this.connectedClientId+"}"),this.healthUrl=this.appendConnectedClientIds(this.healthUrl,!1),this.fsm.onAllocationSucceed()},e.prototype.onPingResponse=function(){this.logger.info("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},e.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},e.prototype.buildQuery=function(e){for(var t=[],n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];e.hasOwnProperty(r)&&void 0!==e[r]&&t.push(r+"="+e[r])}return t.join("&")},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.indexOf("ccid=")<0&&(n="ccid="+this.connectedClientId+"&"),this.domId&&(n+="dom="+this.domId+"&"),n.length>0&&(n=n.slice(0,-1));var i=t||-1!==e.indexOf("?")?"&":"?";return this.appendCorrelationIds(e+i+n,t)},e.prototype.appendCorrelationIds=function(e,t){var n=t||-1!==e.indexOf("?")?"&":"?";return e.indexOf("cor_id")<0?""+e+n+"cor_id="+this.options.clientCorrelationID+"&con_num="+this.clientID+"_"+this.connectionAttempt:e},e.prototype.getHealthUrl=function(e){return e.substring(0,e.lastIndexOf("/a"))+"/h"},e.prototype.safeString=function(e){return"string"==typeof e?e:""},e.prototype.sendResponse=function(e,t){if(e.timedout)return this.logger.error("Request "+e.id+" already timed out"),1;if(e.replied)return this.logger.error("Response for request "+e.id+" already sent"),2;clearTimeout(e.timeoutTimerId),e.timeoutTimerId=0,e.replied=!0,this.logger.info("Sending response for request N "+e.id+" with status "+t.status),t.headers=t.headers||{},e.headers&&e.headers["trouter-request"]&&!t.headers["trouter-request"]&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var n=Date.now()-e.startTS;if(t.headers["trouter-client"]=r.toJson({cd:n}),this.logger.debug("response: "+r.toJson(t)),!this.socket)return this.connectionTracker.sendResponseError("no socket",e,t),4;try{return this.socket.send(r.toJson(t)),t.sentTS=Date.now(),this.connectionTracker.trackResponse(e,n,t),"websocket"===this.transportTypeName&&this.sendPingRequest(),0}catch(n){var i="unable to send data on response.end, err: "+r.toJson(n.stack);return this.connectionTracker.sendResponseError(i,e,t),this.logger.error(i),4}},e.prototype.getRegistrationTtl=function(){var e=r.calculateTtlInSec(this.connectionExpireTimestampInSecs);return this.logger.debug("Current connectionID will expire in "+e+" seconds"),this.options.registration&&this.options.registration.registrarTtlSec&&e>0?Math.min(this.options.registration.registrarTtlSec,e):this.options.registration&&this.options.registration.registrarTtlSec?this.options.registration.registrarTtlSec:e>0?e:3600},e.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},e}();t.TrouterConnection=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o=n(0);!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.Connected=5]="Connected",e[e.CheckingHealth=6]="CheckingHealth",e[e.UnregisteringRetrievingToken=7]="UnregisteringRetrievingToken",e[e.Unregistering=8]="Unregistering"}(i=t.State||(t.State={})),function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Registering=2]="Registering",e[e.Registered=3]="Registered",e[e.NotRegistered=4]="NotRegistered"}(r||(r={}));var s=function(){function e(e,t,n){this.worker=t,this.incallModeEnabled=n,this.state=i.Initial,this.isAllocateResultValid=!1,this.connectionErrors=0,this.logger=new o.Logger("ConnectionFsm",e),this.connectedSubstate=r.Initial}return e.prototype.getState=function(){return this.state},e.prototype.isActive=function(){return this.state===i.Allocating||this.state===i.CheckingHealth||this.state===i.Connected||this.state===i.Handshaking||this.state===i.Connecting||this.state===i.RetrievingToken},e.prototype.start=function(){return this.state===i.Initial?(this.setState(i.RetrievingToken),this.worker.getToken(!0,!1),!0):(this.showIgnored("start"),!1)},e.prototype.stop=function(e){e&&(this.connectedSubstate=r.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetHealthBackoff(),this.worker.resetTokenBackoff(),this.state!==i.Connecting&&this.state!==i.Handshaking&&this.state!==i.Connected&&this.state!==i.CheckingHealth||this.worker.stopSocketIo(),this.isRegistered()?(this.setState(i.UnregisteringRetrievingToken),this.worker.stopRegisterTimer(),this.worker.getToken(!0,!1)):(this.setState(i.Initial),this.worker.dispatchDisconnected())},e.prototype.onTokenReceived=function(e){this.state===i.RetrievingToken?(this.setState(i.Allocating),this.worker.sendAllocateRequest(e)):this.state===i.Connected&&this.connectedSubstate===r.RetrievingToken?(this.connectedSubstate=r.Registering,this.worker.sendRegisterRequest(e)):this.state===i.UnregisteringRetrievingToken?(this.setState(i.Unregistering),this.worker.sendUnregisterRequest(e)):this.showIgnored("onTokenReceived")},e.prototype.checkConnection=function(e){e?this.onPingInterval():this.onHealthSucceed()},e.prototype.onAllocationSucceed=function(){return this.state===i.Allocating?(this.isAllocateResultValid=!0,this.setState(i.Handshaking),this.connectedSubstate=r.Initial,this.worker.startSocketIo(),!0):this.state===i.CheckingHealth?(this.isAllocateResultValid=!0,this.setState(i.Handshaking),this.worker.startConnectionTimer(),this.connectedSubstate=r.Initial,this.worker.startSocketIo(),!0):(this.showIgnored("onAllocationSucceed"),!1)},e.prototype.onAllocationFailed=function(e){this.state===i.Allocating?(this.setState(i.RetrievingToken),this.worker.stopConnectionTimer(),this.worker.getToken(!e,!0)):this.showIgnored("onAllocationFailed")},e.prototype.onConnectingTimeout=function(){this.state===i.Allocating||this.state===i.Connecting||this.state===i.Handshaking?(this.setState(i.CheckingHealth),this.resetAllocationIfNecessary(void 0),this.worker.sendHealthRequest(!1)):this.showIgnored("onConnectingTimeout")},e.prototype.onConnecting=function(){this.state===i.Handshaking?this.setState(i.Connecting):this.showIgnored("onConnecting")},e.prototype.onConnectingFailed=function(){this.state===i.Connecting?this.onConnectingTimeout():this.state===i.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.showIgnored("onConnectingFailed")},e.prototype.onSocketError=function(e){this.state===i.Handshaking?(this.setState(i.CheckingHealth),this.worker.resetAllocationConnectionParams(),this.resetAllocationIfNecessary(e),this.worker.sendHealthRequest(!1)):this.state===i.Connected?(this.setState(i.CheckingHealth),this.worker.dispatchReconnecting(),this.resetAllocationIfNecessary(e),this.worker.sendHealthRequest(!1)):this.showIgnored("onSocketError")},e.prototype.onHealthSucceed=function(){this.state===i.CheckingHealth?(this.worker.stopSocketIo(),this.isAllocateResultValid?(this.logger.info("Allocation exists - connecting"),this.setState(i.Handshaking),this.worker.startConnectionTimer(),this.worker.startSocketIo()):(this.logger.info("Allocation doesn't exists - start with getting token"),this.setState(i.RetrievingToken),this.worker.getToken(!0,!0))):this.showIgnored("onHealthSucceed")},e.prototype.onHealthFailed=function(){this.state===i.CheckingHealth?this.worker.sendHealthRequest(!0):this.showIgnored("onHealthFailed")},e.prototype.onTrouterConnected=function(){this.state===i.Connecting||this.state===i.CheckingHealth?(this.setState(i.Connected),this.isAllocateResultValid=!0,this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.connectionErrors=0,this.worker.shouldSkipRegistration()?(this.connectedSubstate=r.NotRegistered,this.worker.dispatchRegistered()):(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!0,!1))):this.showIgnored("onTrouterConnected")},e.prototype.onReconnectRequired=function(){this.worker.dispatchReconnectIsRequired()},e.prototype.onDownstreamRequest=function(e){this.state===i.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.state===i.CheckingHealth?(this.setState(i.Connected),this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.showIgnored("onDownstreamRequest")},e.prototype.onPingInterval=function(){this.state===i.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},e.prototype.onPingResponseTimeout=function(){this.state===i.Connected?(this.setState(i.CheckingHealth),this.worker.dispatchReconnecting(),this.worker.sendHealthRequest(!1)):this.showIgnored("onPingResponseTimeout")},e.prototype.onPingResponse=function(){this.state===i.CheckingHealth?this.setState(i.Connected):this.state===i.Connected||this.showIgnored("onPingResponse")},e.prototype.onRegistrationFailed=function(e){this.state===i.Connected&&this.connectedSubstate===r.Registering?(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!e,!0)):this.showIgnored("onRegistrationFailed")},e.prototype.onRegistrationSucceed=function(){this.state===i.Connected?(this.connectedSubstate===r.Registering&&(this.connectedSubstate=r.Registered,this.worker.dispatchRegistered()),this.worker.hasCustomRegisterTtl()&&this.worker.startRegisterTimer()):this.showIgnored("onRegistrationSucceed")},e.prototype.onRegistrationTimeout=function(){this.state===i.Connected&&this.connectedSubstate!==r.NotRegistered?(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!0,!1)):this.showIgnored("onRegistrationTimeout")},e.prototype.onUnregistrationFailed=function(e){this.state===i.Unregistering?(this.setState(i.UnregisteringRetrievingToken),this.worker.getToken(!e,!e)):this.showIgnored("onUnregistrationFailed")},e.prototype.onUnregistrationSucceed=function(){this.state===i.Unregistering?(this.setState(i.Initial),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationSucceed")},e.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===i.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},e.prototype.showIgnored=function(e){this.logger.debug("Ignoring event '"+e+"' in state '"+i[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+i[this.state]+"' to state '"+i[e]+"'"),this.state!==e?(this.onStateExit(this.state),this.state=e,this.onStateEnter(this.state)):this.logger.error("Attempt to switching into the current state '"+i[e]+"'")},e.prototype.onStateExit=function(e){e===i.Connected&&this.worker.stopPingTimer()},e.prototype.onStateEnter=function(e){e===i.Connected?(this.worker.startPingTimer(),this.worker.dispatchConnected()):e===i.CheckingHealth?this.worker.stopConnectionTimer():e===i.Allocating&&this.worker.startConnectionTimer()},e.prototype.resetAllocationIfNecessary=function(e){this.connectionErrors++,this.connectionErrors>=2||void 0!==e&&/^4\d\d /.test(e)?(this.logger.error("Connection error count is "+this.connectionErrors+" - will reset allocation"),this.connectionErrors=0,this.isAllocateResultValid=!1):this.logger.info("Connection error count is "+this.connectionErrors+" - will NOT reset allocation")},e.prototype.isRegistered=function(){return this.connectedSubstate===r.Registered||this.connectedSubstate===r.Registering},e.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},e}();t.TrouterFsm=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(0),o=function(){function e(e,t){this.worker=t,this.state=i.TrouterState.Unknown,this.logger=new r.Logger("ManagerFsm",e)}return e.prototype.start=function(){this.state===i.TrouterState.Unknown?(this.setState(i.TrouterState.Disconnected),this.worker.startFirstConnection()):this.showIgnored("start")},e.prototype.stop=function(){this.state!==i.TrouterState.Unknown?(this.setState(i.TrouterState.Unknown),this.worker.stopFirstConnection(!1),this.worker.stopSecondConnection(!1)):this.showIgnored("stop")},e.prototype.getState=function(){return this.state},e.prototype.onConnected=function(e){this.state===i.TrouterState.Disconnected&&e?this.worker.doesSecondConnectionExist()?this.setState(i.TrouterState.Switching):(this.setState(i.TrouterState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected("+e+")")},e.prototype.onRegistered=function(e){this.state===i.TrouterState.Disconnected&&!e||this.state===i.TrouterState.Switching&&!e?(this.setState(i.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()):this.showIgnored("onRegistered("+e+")")},e.prototype.onReconnecting=function(e){this.state===i.TrouterState.Connected&&e?(this.setState(i.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.state===i.TrouterState.Switching&&e?(this.setState(i.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.showIgnored("onReconnecting("+e+")")},e.prototype.onReconnectionRequired=function(e){this.state===i.TrouterState.Connected&&e?(this.setState(i.TrouterState.Switching),this.worker.startSecondConnection()):this.state===i.TrouterState.Disconnected&&e?this.worker.startSecondConnection():this.showIgnored("onReconnectionRequired("+e+")")},e.prototype.onDisconnected=function(e){this.state===i.TrouterState.Unknown&&e?this.worker.dispatchStopped():this.showIgnored("onDisconnected("+e+")")},e.prototype.showIgnored=function(e){this.logger.info("Ignoring event '"+e+"' in state '"+i.TrouterState[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+i.TrouterState[this.state]+"' to state '"+i.TrouterState[e]+"'"),this.state!==e?this.state=e:this.logger.error("Attempt to switching into the current state '"+i.TrouterState[e]+"'")},e}();t.TrouterManagerFsm=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(3);t.TrouterState=r.TrouterState;var o=n(5),s=n(6),a=n(7),c=n(8),u=function(){function e(e){this.logger=e,this.stateChangedListeners=[],this.trouterUrlPromise=new c.TrouterUrlPromise(e),this.messageHandlers=new o.MessageHandlerRegistry(e),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version "+i.CLIENT_VERSION)}return e.prototype.start=function(e){if(this.logger.info("Start"),!e.trouterSettings.disableInternalSkypeTokenCache){var t=e.skypeTokenProvider;e.skypeTokenProvider=s.addCacheAsBackupTo(t)}void 0===this.trouterServer&&(this.trouterServer=new a.TrouterManager(this.logger,function(e){return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:e.telemetryConfig.settings,eventLogger:e.telemetryConfig.eventLogger,trouterUrl:e.trouterSettings.trouterServiceUrl,registration:e.trouterSettings.registrarServiceUrl?{registrarUrl:e.trouterSettings.registrarServiceUrl,registrationId:e.trouterSettings.registrationId||"",pnhAppId:e.trouterSettings.pnhAppId||"",platform:e.trouterSettings.platform||"",pnhTemplateKey:e.trouterSettings.pnhTemplate||"",platformUIVersion:e.trouterSettings.platformUIVersion||"",registrarTtlSec:(e.trouterSettings.maxRegistrationTimeInMs||0)/1e3}:void 0,timeoutOptions:e.trouterSettings.timeoutOptions||{connectionTimeoutMs:e.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:3e4,requestTimeoutMs:5e3},incallTimeoutOptions:e.trouterSettings.incallTimeoutOptions||{connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:1e4,requestTimeoutMs:5e3},incallModeTimeoutMs:e.trouterSettings.incallModeTimeoutMs||0}}(e),e.skypeTokenProvider,this)),this.trouterServer.start()},e.prototype.stop=function(){this.logger.log("[Trouter] close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterSerice is stopped")),void 0!==this.trouterServer&&this.trouterServer.stop()},e.prototype.checkConnection=function(e){void 0!==this.trouterServer&&this.trouterServer.checkConnection(e||!1)},e.prototype.registerListener=function(e,t){return""===t||"/"!==t[0]||t.indexOf("?")>=0||t.indexOf("#")>=0?(this.logger.error("Listener path '"+t+"' is not valid"),!1):this.listeners[t]?(this.logger.error("Another listener is already registered for path '"+t+"'"),!1):(this.listeners[t]=e,this.logger.debug("Listener for path '"+t+"' registered"),this.connectionInfo&&e.onTrouterConnected(this.connectionInfo.baseEndpointUrl+t,this.connectionInfo),!0)},e.prototype.unregisterListener=function(e){for(var t=[],n=0,i=Object.keys(this.listeners);n<i.length;n++){var r=i[n];this.listeners[r]===e&&t.push(r)}if(0===t.length)return!1;for(var o=0,s=t;o<s.length;o++){r=s[o];delete this.listeners[r]}return this.logger.debug("Listener for path(s) '"+t.join("', '")+"' unregistered"),!0},e.prototype.onTrouterConnected=function(e,t){this.logger.debug("Trouter is now connected");for(var n=0,i=Object.keys(this.listeners);n<i.length;n++){var o=i[n];try{this.listeners[o].onTrouterConnected(t.baseEndpointUrl+o,t)}catch(e){this.logger.error("Listener '"+o+"' threw an exception from onTrouterConnected(): "+e)}}this.connectionInfo=t,this.trouterUrlPromise.resolveUrl(e),this.notifyStateChanged(r.TrouterState.Connected,{url:e,getRemainingTtlInSec:function(){return t.connectionTtlSec}})},e.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var e=0,t=Object.keys(this.listeners);e<t.length;e++){var n=t[e],i=this.listeners[n].onTrouterDisconnected;if(i)try{i()}catch(e){this.logger.error("Listener '"+n+"' threw an exception from onTrouterDisconnected(): "+e)}}this.notifyStateChanged(r.TrouterState.Disconnected)},e.prototype.onTrouterRequest=function(e,t){for(var n="",i=0,r=Object.keys(this.listeners);i<r.length;i++){var o=r[i];e.path.substring(0,o.length)===o&&o.length>n.length&&(n=o)}if(""===n)this.tryMessageHandlers(e,t)||(t.status=404,t.headers={"Trouter-Responder":"ClientLib"},t.send());else try{this.listeners[n].onTrouterRequest(e,t)}catch(e){this.logger.error("Listener '"+n+"' threw an exception from onTrouterRequest(): "+e),t.status=500,t.headers={"Trouter-Responder":"ClientLib"},t.send()}},e.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():r.TrouterState.Unknown},e.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},e.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},e.prototype.onStateChanged=function(e){if(this.logger.info("onStateChanged called"),void 0===e)this.stateChangedListeners=this.stateChangedListeners.filter(function(e){return void 0===e.wrappedCallback});else{this.offStateChanged(e);var t=function(t,n){e(t,n?n.url:"")};t.wrappedCallback=e,this.stateChangedListeners.push(t)}},e.prototype.offStateChanged=function(e){this.logger.info("offStateChanged called");var t=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter(function(t){return t.wrappedCallback!==e}),t>this.stateChangedListeners.length},e.prototype.addCallback=function(e){this.logger.info("addListener called"),-1===this.stateChangedListeners.indexOf(e,0)&&void 0!==e&&this.stateChangedListeners.push(e)},e.prototype.removeCallback=function(e){this.logger.info("removeListener called");var t=this.stateChangedListeners.indexOf(e,0);return t>-1&&(this.stateChangedListeners.splice(t,1),!0)},e.prototype.registerMessageHandler=function(e){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},e.prototype.notifyStateChanged=function(e,t){var n=this;this.logger.info("notifyStateChanged called, will forward to "+this.stateChangedListeners.length+" listeners"),this.stateChangedListeners.forEach(function(i){try{i(e,t)}catch(e){n.logger.error("Error in callback "+e)}})},e.prototype.tryMessageHandlers=function(e,t){if(!this.messageHandlers.active())return!1;var n,i=null;try{i=(n=JSON.parse(e.body))&&(n.evt||n.eventId)||null}catch(e){}var r={eventId:i,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+e.path,body:n,rawBody:e.body,headers:e.headers},o=this.messageHandlers.handleMessage(r);return!!o.isHandled&&(t.status=o.resultCode,o.responseHeaders&&(t.headers=o.responseHeaders),o.responseBody&&(t.body=o.responseBody),t.send(),!0)},e}();t.TrouterService=u,t.createTrouterService=function(e){return new u(e)},t.getTrouterServiceVersion=function(){return i.CLIENT_VERSION}},function(e,t){}])},module.exports=e()}).call(this,__webpack_require__(57))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(272),o=i.Configuration.USER_OPTIONS_SERVICE.PROD+"options/v1/users/self/options",s=function(){function e(){}return e.prototype.fetchUserOption=function(e){var t=o+"/"+e;return new Promise(function(e,n){r.get("fetchUserOption",encodeURI(t)).then(function(t){t&&t.code?50300===t.code||50100===t.code||40100===t.code||n(t):e(t)},function(e){n(e)})})},e.prototype.fetchUserOptionsBatch=function(e){if(!e.length)return null;var t=o+"?names="+e.join(",");return new Promise(function(e,n){r.get("fetchUserOptionsBatch",encodeURI(t)).then(function(t){t&&t.code?50300===t.code||50100===t.code||40100===t.code||n(t):e(t)},function(e){n(e)})})},e.prototype.setUserOption=function(e){var t=o+"/"+e.name,n={value:e.value};return new Promise(function(e,i){r.putData("setUserOption",t,JSON.stringify(n)).then(function(t){t&&202===t.status?e(t):i(t)},function(e){i(e)})})},e.prototype.setUserOptionsBatch=function(e){var t={options:e};return r.post("setUserOptionsBatch",o,JSON.stringify(t)).then(function(e){},function(e){})},e}();t.UserOptionsService=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(13),o=n(5),s=n(10),a={retryCount:3,timeout:12e4,policy:""},c=function(e,t,n){return s.default("userOptions-"+e,a,t,n)},u=function(){return new Promise(function(e,t){return o.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers({"x-microsoft-skype-chain-id":i.default.get.correlationId,"x-microsoft-skype-message-id":r.guid.generate(),"x-skypetoken":t,Accept:"application/json","Content-Type":"application/json"});e(n)})})};t.post=function(e,t,n){return u().then(function(i){return c(e,t,{method:"POST",cache:"no-cache",headers:i,body:n}).then(function(e){return e.json()})})},t.putData=function(e,t,n){return u().then(function(i){var r={method:"PUT"};return r.body=n,r.headers=i,s.default("userOptions-"+e,a,t,r)})},t.get=function(e,t){return u().then(function(n){var i={method:"GET"};return i.headers=n,c(e,t,i).then(function(e){return e.json()})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(274),o=n(276),s=function(){function e(e,t){this.aadTokenProvider=e,this.cache=t,this._storedSettings={},this._defaultSettingsService=new r.DefaultUserPolicyService,this._requestPromises={}}return e.prototype.getMessagingPolicy=function(){return this._getSettings("messagingPolicy")},e.prototype.getCallingPolicy=function(){return this._getSettings("callingPolicy")},e.prototype.getUserPolicies=function(){return this._getSettings("policySettings")},e.prototype.getUpgradePolicy=function(){var e=this;if(this._storedUpgradePolicy)return Promise.resolve(this._storedUpgradePolicy);var t=this.cache.get("teamsUpgradePolicy");return t?(this._storedUpgradePolicy=t,Promise.resolve(t)):this._fetchTeamsUpgradePolicy().then(function(t){return e._storedUpgradePolicy=t,e.cache.set("teamsUpgradePolicy",t),t})},e.prototype._getSettings=function(e){var t=this,n=this._getStoredSettings(e);return n?Promise.resolve(n):this._fetchSettings(e).then(function(n){return n?(t._storeSettings(e,n),n):t._getDefaultSettings(e)})},e.prototype._getStoredSettings=function(e){if(!this._storedSettings[e]){var t=this.cache.get(e);t&&(this._storedSettings[e]=t)}return this._storedSettings[e]},e.prototype._storeSettings=function(e,t){this.cache.set(e,t),this._storedSettings[e]=t},e.prototype._fetchSettings=function(e){var t,n=this;if(!this._requestPromises[e]){var r=i.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/users/useraggregatesettings",s=((t={})[e]=!0,t);this._requestPromises[e]=o.post("useraggregatesettings",r,JSON.stringify(s),this.aadTokenProvider).then(function(t){var i=t[e];return delete n._requestPromises[e],i.value}).catch(function(){delete n._requestPromises[e]})}return this._requestPromises[e]},e.prototype._fetchTeamsUpgradePolicy=function(){var e=i.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/me/settings/teamsupgradev2";return o.get("useraggregatesettings",e,this.aadTokenProvider).then(function(e){return e.value})},e.prototype._getDefaultSettings=function(e){return this._defaultSettingsService.getDefaultPolicy(e)},e}();t.TeamsUserPolicyService=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(275),r=function(){function e(){this._defaultPolicy={messagingPolicy:{allowOwnerEditMessage:!1,allowOwnerDeleteMessage:!1,allowUserEditMessage:!1,allowUserDeleteMessage:!1,allowUserChat:!1,allowGiphy:!1,allowUserTranslation:!1,giphyRatingType:i.GiphyRatingType.Strict,allowMemes:!1,allowStickers:!1,readReceiptsEnabledType:i.ReadReceiptsEnabledType.None},callingPolicy:{allowPrivateCalling:!1,allowGroupCalling:!1,allowCallForwarding:!1,allowCallForwardingToPhone:!1,allowCallForwardingToUser:!1,allowCallGroups:!1,allowDelegation:!1,allowVoicemail:"AlwaysDisabled"}}}return e.prototype.getDefaultPolicy=function(e){return this._defaultPolicy[e]},e}();t.DefaultUserPolicyService=r},function(e,t,n){"use strict";var i,r,o,s,a,c,u,l,p,d,f,h;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Strict=0]="Strict",e[e.Moderate=1]="Moderate",e[e.NoRestriction=2]="NoRestriction"}(t.GiphyRatingType||(t.GiphyRatingType={})),function(e){e.Everyone="Everyone",e.None="None",e.UserPreference="UserPreference"}(t.ReadReceiptsEnabledType||(t.ReadReceiptsEnabledType={})),function(e){e[e.Success=0]="Success",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(i||(i={})),function(e){e[e.Unknown=0]="Unknown",e[e.InvalidArguments=1]="InvalidArguments",e[e.AccessDenied=2]="AccessDenied",e[e.BadRequest=3]="BadRequest",e[e.Forbidden=4]="Forbidden",e[e.GatewayTimeout=5]="GatewayTimeout",e[e.NotFound=6]="NotFound",e[e.SharepointSiteNotExists=7]="SharepointSiteNotExists",e[e.UserNotFound=8]="UserNotFound",e[e.UserNotFoundInSkypeTeam=9]="UserNotFoundInSkypeTeam",e[e.GroupExceededMaxSupportedNestedGroups=10]="GroupExceededMaxSupportedNestedGroups",e[e.GroupExceededMaxSupportedTeamMembers=11]="GroupExceededMaxSupportedTeamMembers",e[e.TeamNotFound=12]="TeamNotFound",e[e.ThreadNotFound=13]="ThreadNotFound",e[e.TeamOwnerNotFound=14]="TeamOwnerNotFound",e[e.TeamGroupIdMissing=15]="TeamGroupIdMissing",e[e.ChannelsRosterFailed=16]="ChannelsRosterFailed",e[e.MaxChannelLimitExceeded=17]="MaxChannelLimitExceeded",e[e.FileDoesNotExist=18]="FileDoesNotExist",e[e.FileLocked=19]="FileLocked",e[e.OneNoteNotAvailable=20]="OneNoteNotAvailable",e[e.GetPersonalSiteUrlError=21]="GetPersonalSiteUrlError",e[e.NotesSectionCreationError=22]="NotesSectionCreationError",e[e.GroupNotesStartedButNotFinishedYet=23]="GroupNotesStartedButNotFinishedYet",e[e.MissingTeamSmtpAddress=24]="MissingTeamSmtpAddress",e[e.UpdateTeamMembershipInExchangeFailed=25]="UpdateTeamMembershipInExchangeFailed",e[e.UpdateTeamMembershipInSkypeFailed=26]="UpdateTeamMembershipInSkypeFailed",e[e.UpdateBotTeamMembershipInSkypeFailed=27]="UpdateBotTeamMembershipInSkypeFailed",e[e.UpdateTeamMembershipFailed=28]="UpdateTeamMembershipFailed",e[e.ChannelThreadNotExist=29]="ChannelThreadNotExist",e[e.ChannelNameAlreadyExist=30]="ChannelNameAlreadyExist",e[e.MaxChannelNameCharacterLimitExceeded=31]="MaxChannelNameCharacterLimitExceeded",e[e.MaxChannelDescriptionCharacterLimitExceeded=32]="MaxChannelDescriptionCharacterLimitExceeded",e[e.MaxTeamNameCharacterLimitExceeded=33]="MaxTeamNameCharacterLimitExceeded",e[e.MaxTeamDescriptionCharacterLimitExceeded=34]="MaxTeamDescriptionCharacterLimitExceeded",e[e.InvalidTeamName=35]="InvalidTeamName",e[e.UserIsNotOwnerToPerformMigration=36]="UserIsNotOwnerToPerformMigration",e[e.GroupHasMoreMemberThanSkypeTeamsSupports=37]="GroupHasMoreMemberThanSkypeTeamsSupports",e[e.InvalidChannelName=38]="InvalidChannelName",e[e.UpdateChannelNameFailed=39]="UpdateChannelNameFailed",e[e.UpdateChannelDescriptionFailed=40]="UpdateChannelDescriptionFailed",e[e.ChannelNameUpdateToTeamThreadFailed=41]="ChannelNameUpdateToTeamThreadFailed",e[e.CreateChannelThreadFailed=42]="CreateChannelThreadFailed",e[e.CreateChatThreadFailed=43]="CreateChatThreadFailed",e[e.NotAbleToGetChannelThreadAfterCreating=44]="NotAbleToGetChannelThreadAfterCreating",e[e.DeleteChannelThreadFailed=45]="DeleteChannelThreadFailed",e[e.UnableToFetchTeamThread=46]="UnableToFetchTeamThread",e[e.GetUnifiedGroupMembersInExchangeFailed=47]="GetUnifiedGroupMembersInExchangeFailed",e[e.NotImplemented=48]="NotImplemented",e[e.CreateTeamInExchangeNotAuthorized=49]="CreateTeamInExchangeNotAuthorized",e[e.CreateTeamInSkypeFailed=50]="CreateTeamInSkypeFailed",e[e.CreateTeamInExchangeFailed=51]="CreateTeamInExchangeFailed",e[e.UnableToGenerateUniqueAlias=52]="UnableToGenerateUniqueAlias",e[e.TeamCreationInProgress=53]="TeamCreationInProgress",e[e.UpdateTeamInSkypeFailed=54]="UpdateTeamInSkypeFailed",e[e.UpdateTeamInExchangeFailed=55]="UpdateTeamInExchangeFailed",e[e.DeleteTeamNotAuthorized=56]="DeleteTeamNotAuthorized",e[e.DeleteTeamFailedChannelNotFound=57]="DeleteTeamFailedChannelNotFound",e[e.DeleteTeamFailedSettingTopicsProperty=58]="DeleteTeamFailedSettingTopicsProperty",e[e.DeleteTeamFailedRemovingInitiator=59]="DeleteTeamFailedRemovingInitiator",e[e.DeletingTeamInExchangeFailed=60]="DeletingTeamInExchangeFailed",e[e.DeletingTeamInSkypeFailed=61]="DeletingTeamInSkypeFailed",e[e.DeletingTeamSettingStatusPropertyFailed=62]="DeletingTeamSettingStatusPropertyFailed",e[e.AadGetUserCallFailed=63]="AadGetUserCallFailed",e[e.AadUserSearchCallFailed=64]="AadUserSearchCallFailed",e[e.AadGroupsSearchCallFailed=65]="AadGroupsSearchCallFailed",e[e.AadGroupMembersCallFailed=66]="AadGroupMembersCallFailed",e[e.AadGetProfilePictureCallFailed=67]="AadGetProfilePictureCallFailed",e[e.ChatProfilePictureCallFailed=68]="ChatProfilePictureCallFailed",e[e.ExchangeGetProfilePictureCallFailed=69]="ExchangeGetProfilePictureCallFailed",e[e.ExchangeSetProfilePictureCallFailed=70]="ExchangeSetProfilePictureCallFailed",e[e.ExchangeFindPeopleCallFailed=71]="ExchangeFindPeopleCallFailed",e[e.ExchangeInvalidLicense=72]="ExchangeInvalidLicense",e[e.ErrorNonExistentMailbox=73]="ErrorNonExistentMailbox",e[e.ExchangeAccessDenied=74]="ExchangeAccessDenied",e[e.ExchangeOrganizationAccessBlocked=75]="ExchangeOrganizationAccessBlocked",e[e.OrgChartGetManagerAadCallFailed=76]="OrgChartGetManagerAadCallFailed",e[e.JsonResponseParsingFailed=77]="JsonResponseParsingFailed",e[e.GetMyPropertiesFailed=78]="GetMyPropertiesFailed",e[e.GetUserPropertiesFailed=79]="GetUserPropertiesFailed",e[e.SetMyPropertyFailed=80]="SetMyPropertyFailed",e[e.ReconcileExchangeTeamStatusInvalid=81]="ReconcileExchangeTeamStatusInvalid",e[e.ReconcileExchangeTeamFailed=82]="ReconcileExchangeTeamFailed",e[e.MaximumTeamMembersLimitReached=83]="MaximumTeamMembersLimitReached",e[e.MaximumTeamOwnersLimitReached=84]="MaximumTeamOwnersLimitReached",e[e.MemberIsNotAdminToPerformOperation=85]="MemberIsNotAdminToPerformOperation",e[e.OperationDeniedAsMemberIsLastMemberInTeam=86]="OperationDeniedAsMemberIsLastMemberInTeam",e[e.OperationDeniedAsMemberIsLastAdminInTeam=87]="OperationDeniedAsMemberIsLastAdminInTeam",e[e.MSGraphRequestThrottled=88]="MSGraphRequestThrottled",e[e.MSGraphGetGroupWithFilterFailed=89]="MSGraphGetGroupWithFilterFailed",e[e.MSGraphGetGroupMembersFailed=90]="MSGraphGetGroupMembersFailed",e[e.MSGraphGetGroupOwnersFailed=91]="MSGraphGetGroupOwnersFailed",e[e.MSGraphAddGroupMemberFailed=92]="MSGraphAddGroupMemberFailed",e[e.MSGraphAddGroupOwnerFailed=93]="MSGraphAddGroupOwnerFailed",e[e.GroupOwnersLimitExceeded=94]="GroupOwnersLimitExceeded",e[e.MSGraphRemoveGroupMemberFailed=95]="MSGraphRemoveGroupMemberFailed",e[e.MSGraphRemoveGroupOwnerFailed=96]="MSGraphRemoveGroupOwnerFailed",e[e.MSGraphGetGroupUsersFailed=97]="MSGraphGetGroupUsersFailed",e[e.ExchangeTeamNotProvisionedGroupIdMissing=98]="ExchangeTeamNotProvisionedGroupIdMissing",e[e.ThreadIsNotSpaceOrTopic=99]="ThreadIsNotSpaceOrTopic",e[e.ThreadUpgradeForTopicThreadFailed=100]="ThreadUpgradeForTopicThreadFailed",e[e.ThreadUpgradeForSpaceThreadFailed=101]="ThreadUpgradeForSpaceThreadFailed",e[e.ThreadUpgradeFailedCalledOnWrongObject=102]="ThreadUpgradeFailedCalledOnWrongObject",e[e.ConversationUpgradeForSpaceThreadFailed=103]="ConversationUpgradeForSpaceThreadFailed",e[e.ConversationUpgradeFailedCalledOnWrongObject=104]="ConversationUpgradeFailedCalledOnWrongObject",e[e.ConversationUpgradeFailedToSetUserSubscriberState=105]="ConversationUpgradeFailedToSetUserSubscriberState",e[e.InvalidUserId=106]="InvalidUserId",e[e.AadGroupCreationLimitExceeded=107]="AadGroupCreationLimitExceeded",e[e.MsGraphReplicationUnavailable=108]="MsGraphReplicationUnavailable",e[e.SkypeTeamCreationFailed=109]="SkypeTeamCreationFailed",e[e.MigratingToSkypeTeamFailed=110]="MigratingToSkypeTeamFailed",e[e.AadGroupDeletionFailed=111]="AadGroupDeletionFailed",e[e.AadGetUserGroupsFailed=112]="AadGetUserGroupsFailed",e[e.AadGetUserGroupsFailedMailboxTemporaryUnavailable=113]="AadGetUserGroupsFailedMailboxTemporaryUnavailable",e[e.AadGetGroupMembersFailed=114]="AadGetGroupMembersFailed",e[e.AadGetGroupOwnersFailed=115]="AadGetGroupOwnersFailed",e[e.AadSmtpAddressMissing=116]="AadSmtpAddressMissing",e[e.GetTeamMembersFailed=117]="GetTeamMembersFailed",e[e.BotNotFound=118]="BotNotFound",e[e.BotsNotSupportedInChannels=119]="BotsNotSupportedInChannels",e[e.UpdateBotRoleNotSupported=120]="UpdateBotRoleNotSupported",e[e.GetPeopleFailed=121]="GetPeopleFailed",e[e.GetSuggestedGroupsFromExchangeFailed=122]="GetSuggestedGroupsFromExchangeFailed",e[e.GetAllGroupsFailed=123]="GetAllGroupsFailed",e[e.FindingGroupsFailed=124]="FindingGroupsFailed",e[e.FeatureDisabled=125]="FeatureDisabled",e[e.SkypeTeamsStoreAreSkypeTeamsFailed=126]="SkypeTeamsStoreAreSkypeTeamsFailed",e[e.ExchangeMailboxTemporaryUnavailable=127]="ExchangeMailboxTemporaryUnavailable",e[e.GetTenantSettingsFailed=128]="GetTenantSettingsFailed",e[e.SetTenantSettingsFailed=129]="SetTenantSettingsFailed",e[e.InvalidEndDateInRecurrence=130]="InvalidEndDateInRecurrence",e[e.InvalidPatternPropertiesInRecurrence=131]="InvalidPatternPropertiesInRecurrence",e[e.MissingCorrectRecurrencePatternObject=132]="MissingCorrectRecurrencePatternObject",e[e.CalendarEventCreationFailedInExchange=133]="CalendarEventCreationFailedInExchange",e[e.CalendarEventDeletionFailedInExchange=134]="CalendarEventDeletionFailedInExchange",e[e.CalendarEventCancellationFailedInExchange=135]="CalendarEventCancellationFailedInExchange",e[e.CalendarEventUpdateFailedInExchange=136]="CalendarEventUpdateFailedInExchange",e[e.InvalidCancelEventRequest=137]="InvalidCancelEventRequest",e[e.CalendarEventRespondFailure=138]="CalendarEventRespondFailure",e[e.SharepointResponseFailure=139]="SharepointResponseFailure",e[e.DeepLinkTypeNotSupported=140]="DeepLinkTypeNotSupported",e[e.DocumentLibraryNotFound=141]="DocumentLibraryNotFound",e[e.DocumentLibrarySettingsNotFound=142]="DocumentLibrarySettingsNotFound",e[e.UserMailboxDoesNotExist=143]="UserMailboxDoesNotExist",e[e.TaskCanceled=144]="TaskCanceled",e[e.CalendarEventNotFound=145]="CalendarEventNotFound",e[e.GetTeamOutgoingWebhooksFailed=146]="GetTeamOutgoingWebhooksFailed",e[e.SetTeamOutgoingWebhooksFailed=147]="SetTeamOutgoingWebhooksFailed",e[e.RemoveTeamOutgoingWebhookFailed=148]="RemoveTeamOutgoingWebhookFailed",e[e.GetOutgoingWebhookConfigurationFailed=149]="GetOutgoingWebhookConfigurationFailed",e[e.SetOutgoingWebhookConfigurationFailed=150]="SetOutgoingWebhookConfigurationFailed",e[e.GetEmailAddressDetailsFailed=151]="GetEmailAddressDetailsFailed",e[e.GetChannelSettingsFailed=152]="GetChannelSettingsFailed",e[e.ProvisionEmailAddressFailed=153]="ProvisionEmailAddressFailed",e[e.EmailAddressAlreadyProvisioned=154]="EmailAddressAlreadyProvisioned",e[e.TeamCachedPropertiesNotFound=155]="TeamCachedPropertiesNotFound",e[e.GetTeamAppEntitlementsFailed=156]="GetTeamAppEntitlementsFailed",e[e.SetTeamAppEntitlementFailed=157]="SetTeamAppEntitlementFailed",e[e.RemoveTeamAppEntitlementFailed=158]="RemoveTeamAppEntitlementFailed",e[e.GetUserAppEntitlementsFailed=159]="GetUserAppEntitlementsFailed",e[e.SetUserAppEntitlementFailed=160]="SetUserAppEntitlementFailed",e[e.RemoveUserAppEntitlementFailed=161]="RemoveUserAppEntitlementFailed",e[e.GetTeamAppDefinitionsFailed=162]="GetTeamAppDefinitionsFailed",e[e.SetTeamAppDefinitionFailed=163]="SetTeamAppDefinitionFailed",e[e.RemoveTeamAppDefinitionFailed=164]="RemoveTeamAppDefinitionFailed",e[e.GetUserAppDefinitionsFailed=165]="GetUserAppDefinitionsFailed",e[e.SetUserAppDefinitionFailed=166]="SetUserAppDefinitionFailed",e[e.RemoveUserAppDefinitionFailed=167]="RemoveUserAppDefinitionFailed",e[e.GetAppDefinitionFailed=168]="GetAppDefinitionFailed",e[e.UserAlreadyExists=169]="UserAlreadyExists",e[e.UserAlreadyExistsInTeam=170]="UserAlreadyExistsInTeam"}(r||(r={})),function(e){e[e.RequiredOutsideScheduleMeeting=0]="RequiredOutsideScheduleMeeting",e[e.NotRequired=1]="NotRequired",e[e.AlwaysRequired=2]="AlwaysRequired"}(o||(o={})),function(e){e[e.Immediate=0]="Immediate",e[e.Simultaneous=1]="Simultaneous"}(s||(s={})),function(e){e[e.Voicemail=0]="Voicemail",e[e.SingleTarget=1]="SingleTarget",e[e.MyDelegates=2]="MyDelegates"}(a||(a={})),function(e){e[e.Regular=0]="Regular",e[e.CallQueue=1]="CallQueue",e[e.CallGroup=2]="CallGroup",e[e.Delegate=3]="Delegate"}(c||(c={})),function(e){e[e.Ring=0]="Ring",e[e.Bop=1]="Bop",e[e.Bounce=2]="Bounce",e[e.Bubbles=3]="Bubbles",e[e.DripDrop=4]="DripDrop",e[e.Eureka=5]="Eureka",e[e.Flutter=6]="Flutter",e[e.HighScore=7]="HighScore",e[e.NextLevel=8]="NextLevel",e[e.Plink=9]="Plink",e[e.RingRing=10]="RingRing",e[e.Ripple=11]="Ripple",e[e.Spacetime=12]="Spacetime",e[e.WishGranted=13]="WishGranted",e[e.Wobble=14]="Wobble"}(u||(u={})),function(e){e[e.Unknown=0]="Unknown",e[e.Online=1]="Online",e[e.OnPrem=2]="OnPrem"}(l||(l={})),function(e){e[e.Unknown=0]="Unknown",e[e.Online=1]="Online",e[e.OnPrem=2]="OnPrem"}(p||(p={})),function(e){e[e.Default=0]="Default",e[e.Immediately=1]="Immediately",e[e.Every10Mins=2]="Every10Mins",e[e.Hourly=3]="Hourly",e[e.EveryEightHours=4]="EveryEightHours",e[e.Daily=5]="Daily",e[e.Never=6]="Never"}(d||(d={})),function(e){e[e.All=0]="All",e[e.CallMentionChats=1]="CallMentionChats",e[e.Off=2]="Off"}(f||(f={})),function(e){e[e.Unknown=0]="Unknown",e[e.Teacher=1]="Teacher",e[e.Student=2]="Student"}(h||(h={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(32),o=n(10),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return o.default("teamsmiddleware-"+e,s,t,n)};t.post=function(e,n,i,r){return t.getHeaders(r).then(function(t){return a(e,n,{method:"POST",cache:"no-cache",headers:t,body:i}).then(function(e){return e.json()})})},t.get=function(e,n,i){return t.getHeaders(i).then(function(t){return a(e,n,{method:"GET",cache:"no-cache",headers:t}).then(function(e){return e.json()})})},t.getHeaders=function(e){return e(r.AadAudience.SpacesApi).then(function(e){return e=0===e.toLowerCase().indexOf("bearer")?e:"Bearer "+e,new Headers({Authorization:e,"x-skype-client":i.Configuration.getClientVersion(),Accept:"application/json","Content-Type":"application/json"})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),r=n(278),o=function(){function e(e){var t=this;this.client=e,this._userProfiles={},this.resolve=function(e){var n=[];return e.forEach(function(e){t._userProfiles[e.mri].resolve(e),n.push(e)}),n},this._requestQueue=new r.BatchQueue(function(e){return t.getUsers(e)},{timeout:200})}return e.prototype.cleanUpUnresolved=function(e){var t=this;e.forEach(function(e){t._userProfiles[e]&&t._userProfiles[e].status!==i.PromiseStatus.Resolved&&(t._userProfiles[e].cancel(),delete t._userProfiles[e])})},e.prototype.getExisting=function(e){var t=this,n=[];return e.forEach(function(e){t._userProfiles[e]&&n.push(t._userProfiles[e].promise)}),Promise.all(n)},e.prototype.getUser=function(e){return this._userProfiles[e]||(this._userProfiles[e]=new i.CancelablePromise,this._requestQueue.push(e)),this._userProfiles[e].promise},e.prototype.getUsers=function(e){var t=this,n=e.filter(function(e){return!t._userProfiles[e]||t._userProfiles[e].status!==i.PromiseStatus.Resolved});return n.forEach(function(e){t._userProfiles[e]=t._userProfiles[e]||new i.CancelablePromise}),n.length>0?this.client.getUsers(n).then(this.resolve).then(function(){return t.cleanUpUnresolved(e)}).then(function(){return t.getExisting(e)}):Promise.resolve(this.getExisting(e))},e}();t.UserService=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(53),r=function(){function e(e,t){void 0===t&&(t={});var n=this;this.onFlush=e,this.options=t,this._items=[],this._flush=function(){n.onFlush(n._items),delete n._items,n._items=[]},this.flush=i(this._flush,this.options.timeout||500)}return e.prototype.push=function(e){this._items.push(e),this.flush()},e}();t.BatchQueue=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(20),r=n(11),o=n(0),s=n(13),a=function(){function e(e){this.viewports=[],this.requests={},this.callbacks=[],this.options=e||{}}return Object.defineProperty(e.prototype,"all",{get:function(){return this.viewports},enumerable:!0,configurable:!0}),e.prototype.byGroup=function(e,t){var n="string"==typeof e?[e]:e;return(t||this.viewports).filter(function(e){return 1!==n.indexOf(e.options.group)})},e.prototype.byType=function(e,t){var n="string"==typeof e?[e]:e;return(t||this.viewports).filter(function(e){return-1!==n.indexOf(e.options.type)})},e.prototype.byName=function(e,t){return(t||this.viewports).filter(function(t){return t.options.name===e})[0]},e.prototype.byChild=function(e){var t=function(t){return t&&16&t.compareDocumentPosition(e)};return this.viewports.filter(function(e){return t(e.document)||t(e.stash)})[0]},e.prototype.byId=function(e){return this.viewports.filter(function(t){return t.id===e})[0]},e.prototype.resolve=function(e){var t=this;if(function(e){return e&&e.viewport&&e.location.origin===o.swcWindow.location.origin}(e)){var n=e.viewport.id,i=this.byId(n);i&&(i.window=e,i.document=e.document),i.stash?setTimeout(function(){return t.restore(i)}):(i.state.connected=!0,this.requests[n].resolve(i),o.swc.Eventing.triggerEvent("viewport:ready",n,!0),this.notify(i))}},e.prototype.stash=function(e,t){var n=this.byId(e);n.stash=document.createDocumentFragment(),n.stash.appendChild(t),n.state.connected=!1,this.notify(n)},e.prototype.create=function(e,t){var n=this,i=s.guid.generate();return this.viewports.push({id:i,options:e||{},state:t||{}}),this.requests[i]=new r.CancelablePromise,o.swc.Eventing.triggerEvent("viewport:add",{id:i,options:e,state:t},!0),o.swc.Eventing.registerEvent("viewport:update:dir",function(e){if(i===e.id){var t=n.byId(e.id);t&&t.document&&t.document.dir!==e.direction&&(t.document.dir=e.direction||o.swc.Dir||"ltr")}}),this.requests[i].promise},e.prototype.update=function(e,t){e.state=t,o.swc.Eventing.triggerEvent("viewport:update",{id:e.id,state:t},!0),this.notify(e),e.document&&i.setupIFrame(e.document)},e.prototype.onChange=function(e){-1===this.callbacks.indexOf(e)&&this.callbacks.push(e)},e.prototype.notify=function(e){this.callbacks.forEach(function(t){return t(e)})},e.prototype.restore=function(e){var t=e.document;t&&(t.replaceChild(e.stash,t.lastChild),e.stash=null,e.state.connected=!0,this.update(e,e.state))},e}();t.ViewportManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(158),r=n(284),o=n(288),s=function(){function e(){}return e.prototype.get=function(e){switch(e){case o.DYNAMICS_ID:return new r.DynamicsCblBase;default:return new i.CblBase}},e}();t.CblManager=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.shouldDisableChatInputForCurrentUser=function(e){return!0}}}();t.DeleteMemberProcessorCblBase=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.setImDisplayName=function(e,t){}}}();t.MessagesCblBase=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.clearUserDataFromCache=function(){}}}();t.SkypeSignInManagerCblBase=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(158),s=n(285),a=n(286),c=n(287),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"messages",{get:function(){return new a.DynamicsMessagesCbl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skypeSignInManager",{get:function(){return new c.DynamicsSkypeSignInManagerCblBase},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deleteMemberProcessor",{get:function(){return new s.DynamicsDeleteMemberProcessorCblBase},enumerable:!0,configurable:!0}),t}(o.CblBase);t.DynamicsCblBase=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.shouldDisableChatInputForCurrentUser=function(e){return!e}}}();t.DynamicsDeleteMemberProcessorCblBase=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.setImDisplayName=function(e,t){}}}();t.DynamicsMessagesCbl=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),r=n(0),o=function(){return function(){this.clearUserDataFromCache=function(){r.swc.services.sessionStorage.removeItem(i.SKYPE_TOKEN_KEY),r.swc.services.sessionStorage.removeItem(i.SKYPE_REGTOKEN_KEY),r.swc.services.sessionStorage.removeItem(i.SKYPE_ENDPOINT_ID_KEY),r.swc.services.sessionStorage.removeItem(i.SKYPE_HAS_HISTORY_KEY)}}}();t.DynamicsSkypeSignInManagerCblBase=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DYNAMICS_ID=937},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(83),a=n(4),c=n(290),u=n(157),l=n(5),p=function(e){function t(){var t=e.call(this)||this;return t._conversations={},t._enterpriseFavourites={},t.updateConversation=function(e,n){if(a.ConversationType.UNDEFINED!==s.default.getType(e)){var i=t._conversations[e];t.initialiseFavouriteForEnterprise(i),i.update(n)}},l.ServicesManager.ready().then(function(e){e.signInManager.onceSignedIn().then(function(){e.signInManager.isAadSupported()&&e.mePersonManager.getMeProperties().then(function(e){t._enterpriseFavourites=e,Object.keys(e).forEach(function(e){t._conversations[e]&&(t._conversations[e].isFavorite=!0)})})})}),t}return r(t,e),t.prototype.get=function(e,t){return this._conversations.hasOwnProperty(e)||this.createConversationModel(e),t&&(this._conversations[e].definition=t),this._conversations[e]},t.prototype.getIfExist=function(e){return this._conversations.hasOwnProperty(e)?this._conversations[e]:null},t.prototype.getAll=function(){return this._conversations},t.prototype.deleteConversation=function(e){var t=this;return this._conversations[e]?this._conversations[e].deleteConversation().then(function(){t._conversations[e].dispose(),delete t._conversations[e]}):o.swc.services.webApi.deleteConversation(e)},t.prototype.initialiseFavouriteForEnterprise=function(e){this._enterpriseFavourites[e.id]&&(e.isFavorite=!0)},t.prototype.isLeftGroupConversation=function(e){var t=e.threadProperties?parseInt(e.threadProperties.lastleaveat,10):null,n=e.threadProperties?parseInt(e.threadProperties.lastjoinat,10):null;return!!t&&t>n},t.prototype.isRecentConversation=function(e){return!!e.lastMessage&&((!e.properties.conversationblocked||"true"!==e.properties.conversationblocked.toLocaleLowerCase())&&(!this._conversations[e.id]&&(!!e.lastMessage.originalarrivaltime&&!this.isLeftGroupConversation(e))))},t.prototype.createConversationModel=function(e,t){var n=this,i=this.getIfExist(e),r=!i;return r&&(i=new c.default(e,{})),this._conversations[e]=i,t?this.updateConversation(e,t):r&&o.swc.services.webApi.fetchConversation(e).then(function(t){n.updateConversation(e,t)}),r&&this.notify(this._conversations[e]),i},t.prototype.loadConversations=function(e,t){var n=this;return void 0===t&&(t=100),l.ServicesManager.webApi.fetchRecentConversations(e,t).then(function(e){var t={hasMoreConversations:!1,conversations:[]};return e.conversations.forEach(function(e){if(n.isRecentConversation(e)){var i=n.createConversationModel(e.id,e);t.conversations.push(i)}}),t.hasMoreConversations=e.hasMoreConversations,t})},t.prototype.loadAllConversations=function(){var e=this;if(this.conversationSyncPromise)return this.conversationSyncPromise;var t=function(n,i){return l.ServicesManager.webApi.fetchRecentConversations(0,100).then(function(r){return r.conversations.forEach(function(t){e.isRecentConversation(t)&&e.createConversationModel(t.id,t)}),r.hasMoreConversations?new Promise(function(e){setTimeout(function(){t(n,i).then(function(){return e()})},200)}):Promise.resolve()})};return this.conversationSyncPromise=t(0,100),this.conversationSyncPromise},t.prototype.prefetchRecents=function(e,t){var n=this;return void 0===e&&(e=0),void 0===t&&(t=100),l.ServicesManager.webApi.prefetchRecents(0,100).then(function(e){return e&&e.conversations&&e.conversations.forEach(function(e){n.isRecentConversation(e)?n.createConversationModel(e.id,e):n._conversations[e.id]&&n.updateConversation(e.id,e)}),e})},t.prototype.subscribeToNewConversations=function(e){return this.subscribe(e)},t}(u.SubscribeableStore);t.default=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(53),s=n(159),a=n(3),c=n(1),u=n(12),l=n(92),p=n(15),d=n(38),f=n(0),h=n(59),g=n(83),m=n(7),v=n(168),y=n(29),_=n(291),b=n(292),w=n(31),C=n(4),S=n(5),T=n(293),E=n(39),P=n(156),I=n(120),k=function(e){function t(t,n){var i=e.call(this)||this;i._definition=n,i.backend=p.MessagingBackend.UNDETERMINED,i._isSealed=!1,i.messagesReceived=0,i.messagesSent=0,i.sdkMode=d.SDKMode.UNDEFINED,i.isUnreadBookmark=!1,i._contextAad="",i._isChatEnabled=!0,i._topic="",i._alertsOff=!1,i._isFavorite=!1,i._hasOngoingGroupCall=!1,i.handleIsReadChange=function(e){i.debouncedPublishIsUnread();var t=!1,n=i.lastMessage||i.messages.length>0&&i.messages[i.messages.length-1];n&&(t=n.originalTimestamp.getTime()<Date.now()-2592e6);i.alertsOff||t||e?S.ServicesManager.unreadCounterStore.markAsRead(i.id):S.ServicesManager.unreadCounterStore.markAsUnread(i.id)},i.debouncedPublishIsUnread=o(function(){return i.publish("isUnread",i.isUnread)}),i.debouncedPublishIsRead=o(function(){return i.publish("isRead",i.isRead)}),i.sendLiveState=function(){return i._messagingService.sendLiveState()},i.download=function(e){return i.externalDownload&&f.swc.Eventing.triggerEvent("proxy:conversation:resDownload",{refId:i.refId,url:e})},i.setupProxy=function(){var e=function(e){return e===i.id};i._isOneOnOne||f.swc.Eventing.registerEvent("proxy:conversation:connected",function(t){e(t.id)&&i.heartBeat&&(t.connected?i.heartBeat.connect():i.heartBeat.disconnect())}),f.swc.Eventing.registerEvent("proxy:conversation:regMessageReceived",function(t){e(t.id)&&(i.refId=t.refId,i.messageReceivedProxied=!0)}),f.swc.Eventing.registerEvent("proxy:conversation:regDownload",function(t){e(t.id)&&(i.refId=t.refId,i.externalDownload=!0)})},i._id=t;var r,s=g.default.getType(t);return i.isAgent=s===C.ConversationType.AGENT,i.isPerson=s===C.ConversationType.PERSON,i.isGroup=s===C.ConversationType.GROUP,i.sdkMode=y.default.getSdkModeFromId(i._id),i.isSfB=a.default.get.isTeams()&&b.isSfB(t),i._messages=l.ObservableCollection.create(),i._allMessages=l.ObservableCollection.create(),i._participants=l.ObservableCollection.create(),i._messagingService=new T.default(i),i._isControlOpen=!1,i._consumptionHorizon=new P.ConsumptionHorizon,i._unreadMessagesCount=0,i.subscribe("isRead",i.handleIsReadChange),i.messages.subscribe(function(e){var t=i.lastMessage;t&&(i.publish("lastMessage",t),i.lastReceivedMessage&&i.publish("lastReceivedMessage",i.lastReceivedMessage));i.publish("lastReceivedMessage",i.lastReceivedMessage),i.isControlOpen||i.debouncedPublishIsRead();var n=function(e){e&&(i.debouncedPublishIsRead(),t.unsubscribe("isDeleted",n))};t.subscribe("isDeleted",n)}),i.subscribe("lastReceivedMessage",function(e){e&&e.direction===C.Direction.Incoming&&r!==e&&(S.ServicesManager.notificationsManager.registerUnreadMessage(i,e),r=e)}),i._consumptionHorizon.subscribe("value",function(e){i.debouncedPublishIsRead()}),S.ServicesManager.mePerson&&(i.selfParticipant=new I.default(S.ServicesManager.mePerson)),a.default.get.isTeams()?i._isOneOnOne=-1!==t.indexOf("@unq.gbl.spaces"):i._isOneOnOne=i.getConversationType()!==C.ConversationType.GROUP,i.isBRB=i._isBRBConversation(),i._isOneOnOne||(i.heartBeat=new _.HeartBeat(i.sendLiveState)),i.setupProxy(),i.members=[],i}return r(t,e),Object.defineProperty(t.prototype,"isSealed",{get:function(){return this._isSealed},set:function(e){this._isSealed!==e&&(this._isSealed=!!e,this.publish("isSealed",this._isSealed))},enumerable:!0,configurable:!0}),t.prototype._isBRBConversation=function(){if(a.default.get.isTeams()&&this.isOneOnOne){var e=c.Configuration.BRB_BOT_MRI_TEAMS.substring(3);return this.id.indexOf(e)>-1}return this.id===c.Configuration.BRB_BOT_MRI},Object.defineProperty(t.prototype,"isRead",{get:function(){if(this.isPstn)return!0;if(!this.isPerson&&!this.isGroup&&!this.isAgent)return!0;if(!this.properties)return!0;if(!this.properties.consumptionhorizon&&"AcceptPendingRecipient"===this.properties.conversationstatus)return!0;var e=this.lastReceivedMessage||this.lastMessage,t=this.selfParticipant&&this.selfParticipant.person||S.ServicesManager.mePerson;return!this.isUnreadBookmark&&!!(!e||!g.UNREAD_TYPES[e.rawMessageType]||e.sender&&t&&w.normalizePersonId(e.sender.mri)===w.normalizePersonId(t.mri)||!e.content||""===e.content||e.id===this.consumptionHorizon.lastReadMessageId||e.clientMessageId===this.consumptionHorizon.lastReadMessageId||e.skypeEditedId===this.consumptionHorizon.lastReadMessageId||e.timestamp.getTime()<=this.consumptionHorizon.lastReadMessageTimestamp||"CallEndMsg"===e.customType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnread",{get:function(){return!this.isRead},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFavorite",{get:function(){return this._isFavorite},set:function(e){this._isFavorite!==e&&(this._isFavorite=e,this.publish("isFavorite",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortedMessages",{get:function(){return this.messages.sort(function(e,t){return e.timestamp.getTime()-t.timestamp.getTime()})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastReceivedMessage",{get:function(){var e=this.messages.filter(function(e){return e.direction===C.Direction.Incoming});return v.getLastItemFromArray(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastMessage",{get:function(){return v.getLastItemFromArray(this.sortedMessages)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allMessages",{get:function(){return this._allMessages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatar",{get:function(){return this._avatar},set:function(e){((e=h.default.resolveConversationAvatar(this.isGroup,e))||e!==this._avatar)&&(this._avatar=e,this.publish("avatar",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"consumptionHorizon",{get:function(){return this._consumptionHorizon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contextAad",{get:function(){return this._contextAad},set:function(e){e=(e=E.default.dompurify.sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]})).replace(/["()\'\/+*`~!@#$%^\[\]:=]/g,""),this._contextAad=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e,this.publish("definition",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(e){e!==this._id&&(this._id=e,this.publish("id",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},set:function(e){var t=e&&e!==this._isActive;this._isActive=e,t&&this.markAsRead()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return this._isBlocked},set:function(e){e!==this._isBlocked&&(this._isBlocked=e,this.publish("isBlocked",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isChatEnabled",{get:function(){return this._isChatEnabled},set:function(e){e!==this._isChatEnabled&&(this._isChatEnabled=e,this.publish("isChatEnabled",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isControlOpen",{get:function(){return this._isControlOpen},set:function(e){this._isControlOpen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInRecent",{get:function(){return this._isInRecent},set:function(e){this._isInRecent=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this._isLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isNew",{get:function(){return this._isNew},set:function(e){e!==this._isNew&&(this._isNew=e,this.publish("isNew",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOneOnOne",{get:function(){return this._isOneOnOne},set:function(e){this._isOneOnOne!==e&&(this._isOneOnOne="true"===e,this.publish("isOneOnOne",this._isOneOnOne))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnderQuarantine",{get:function(){return this._isUnderQuarantine},set:function(e){e!==this._isUnderQuarantine&&(this._isUnderQuarantine=e,this.publish("isUnderQuarantine",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"members",{get:function(){return this._members},set:function(e){this._members=e,this.publish("members",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"messages",{get:function(){return this._messages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participants",{get:function(){return this._participants},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"theOtherParticipant",{get:function(){var e=this,t=this.participants.filter(function(t){return t.person.id!==e.selfParticipant.person.id});return 1===t.length?t.pop():void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selfParticipant",{get:function(){return this._selfParticipant},set:function(e){e!==this._selfParticipant&&(this._selfParticipant=e,this.publish("selfParticipant",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topic",{get:function(){return this._topic},set:function(e){e!==this._topic&&(this._topic=e,this.publish("topic",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unreadMessagesCount",{get:function(){return this._unreadMessagesCount},set:function(e){this._unreadMessagesCount!==e&&(this._unreadMessagesCount=e,this.publish("unreadMessagesCount",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alertsOff",{get:function(){return this._alertsOff},set:function(e){e!==this._alertsOff&&(this._alertsOff=e,this.publish("alertsOff",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasOngoingGroupCall",{get:function(){return this._hasOngoingGroupCall},set:function(e){this._hasOngoingGroupCall!==e&&(this._hasOngoingGroupCall=e,this.publish("hasOngoingGroupCall",e))},enumerable:!0,configurable:!0}),t.prototype.addBotToThread=function(e){this._messagingService.addBotToThread(e)},t.prototype.addParticipant=function(e){this._messagingService.addParticipantToThread(e)},t.prototype.deleteConversation=function(){return this._messagingService.deleteConversation(this.id)},t.prototype.deleteMessage=function(e){var t=this,n=this.lastMessage;return this._messagingService.deleteMessage(e).then(function(){e.content="",e.isDeleted=!0,e.isEdited=!0,e.id===n.id&&t.publish("lastMessage",n)})},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._contextAad="",this._messages&&(this._messages.forEach(function(e){e.dispose()}),this._messages.dispose(),this._messages.spliceObservable(0,this._messages.length)),this._participants.dispose(),this._isDisposed=!0,this._messagingService.dispose()},t.prototype.editMessage=function(e,t){return this._messagingService.editMessage(e,t)},t.prototype.getBackend=function(){return this.backend=g.default.getBackend(this.id,this.backend),this.backend},t.prototype.getConversationType=function(){return g.default.getType(this._id)},t.prototype.getReceviedMessagesCount=function(){return 0},t.prototype.getSentMessagesCount=function(){return 0},t.prototype.isSkypeBackend=function(){return this.getBackend()===p.MessagingBackend.SKYPE},t.prototype.isWithMe=function(){return f.swc.services.signInManager.currentUserName&&this.getConversationType()===C.ConversationType.PERSON&&y.default.isEqual(this.id,f.swc.services.signInManager.currentUserName)},t.prototype.loadMoreMessages=function(){return this._messagingService.loadMoreMessages(this)},t.prototype.markAsRead=function(){this._messagingService.markAsRead()},t.prototype.removeMessageProperty=function(e,t,n,i){return this._messagingService.removeMessageProperty(e,t,n,i)},t.prototype.removeParticipant=function(e){return this._messagingService.removeParticipantFromThread(e)},t.prototype.sendDataToBot=function(e){if(this.getConversationType()===C.ConversationType.GROUP){var t=this.participants.filter(function(e){return e.person.isAgent});if(t.length>0)return this._messagingService.sendDataToBot(y.default.toFullIdentifier(t[0].person.id),e)}return this.isAgent?this._messagingService.sendDataToBot(this.id,e):Promise.resolve()},t.prototype.sendFile=function(e){return f.swc.Eventing.triggerEvent("onMessageSent",{type:s.default.File}),this._messagingService.sendFile(e)},t.prototype.sendFilesAsProperties=function(e){return f.swc.Eventing.triggerEvent("onMessageSent",{type:s.default.Card}),this._messagingService.sendFilesAsProperties(e)},t.prototype.sendFilesAsAmsProperties=function(e){return f.swc.Eventing.triggerEvent("onMessageSent",{type:s.default.File}),this._messagingService.sendFilesAsAmsProperties(e)},t.prototype.sendMessage=function(e,t,n){this._messagingService.sendMessage(e,t,n),f.swc.Eventing.triggerEvent("onMessageSent",{type:s.default.Text})},t.prototype.sendSwift=function(e){return f.swc.Eventing.triggerEvent("onMessageSent",{type:s.default.Card}),this._messagingService.sendSwift(e)},t.prototype.setIsTyping=function(e){this._messagingService.setIsTyping(e)},t.prototype.setMessageProperty=function(e,t,n,i){return this._messagingService.setMessageProperty(e,t,n,i)},t.prototype.setParticipantTyping=function(e,t,n){var i=this._participants.filter(function(t){return t.person.id===e});i.length&&(f.swc.EcsConfig.showCustomTypingName&&n&&(i[0].person.imDisplayName=n),i[0].isTyping=t)},t.prototype.setTopic=function(e){this._messagingService.setConversationTopic(e)},t.prototype.start=function(){var e=this;return this._isDisposed=!1,this._messagingService.startConversation().then(function(){e._isLoaded=!0,e.publish("isLoaded",!0)},function(t){m.default.throwError(100001,"Unable to start conversation",t,e.id)})},t.prototype.update=function(e){var t=this;if(this._id===e.id){if(this.isTeamsOneOnOne=this.isTeamsOneOnOne||e.isOneOnOne,this.properties=e.properties||this.properties,this.threadProperties=e.threadProperties||this.threadProperties,this.hasOngoingGroupCall=e.threadProperties&&!!e.threadProperties.awareness_conversationLiveState,this.isBlocked=M(e.properties),this.properties.consumptionHorizonBookmark&&0!==this.properties.consumptionHorizonBookmark.indexOf("0")&&a.default.get.isTeams()?(this.isUnreadBookmark=!0,this.properties.consumptionHorizonBookmark=this._addMissingLastReadMessageId(this.properties.consumptionHorizonBookmark),this.updateConsumptionHorizon(this.properties.consumptionHorizonBookmark)):(this.isUnreadBookmark=!1,this.updateConsumptionHorizon(this.properties.consumptionhorizon)),this.alertsOff=O(e.properties),this.isFavorite=e.properties&&"true"===e.properties.favorite,e.members){this.members=e.members,this._participants.spliceObservable(0,this._participants.length);var n=S.ServicesManager.mePerson;this.members.forEach(function(e){var i=S.ServicesManager.persons.getPerson(e.id,!0);!i.displayName&&e.name&&(i.displayName=e.name),t._participants.pushObservable(new I.default(i,e)),n&&n.mri===e.id&&(t.selfParticipant=new I.default(n,e))})}if(e.threadProperties&&e.threadProperties.picture&&(this.avatar=e.threadProperties.picture),0===this.members.length&&e.threadProperties&&e.threadProperties.members)try{var i=JSON.parse(e.threadProperties.members);i.length>0&&(this._participants.spliceObservable(0,this._participants.length),i.forEach(function(e){var n=S.ServicesManager.persons.getPerson(e);n&&t._participants.pushObservable(new I.default(n))}))}catch(e){}this._updateTopic(e.threadProperties,e),e.lastMessage&&e.lastMessage.id&&this._messagingService.processNewMessage(this,e.lastMessage,void 0,void 0,!0)}},t.prototype.updateThread=function(e){this._id===e.id&&(this.members=e.members,e.properties&&(this._updateTopic(e.properties),e.properties.picture&&(this.avatar=e.properties.picture.replace("URL@","")||this.avatar),this.threadProperties=e.properties,this.hasOngoingGroupCall=!!e.properties.awareness_conversationLiveState))},t.prototype._updateTopic=function(e,t){var n=this,i=this.topic&&-1!==this.topic.indexOf("8:orgid");if(!this.topic||i){var r=S.ServicesManager.signInManager.isAadSupported(),o=e&&e.topic||t&&t.properties&&t.properties.topic||t&&t.lastMessage&&t.lastMessage.threadtopic||this.isOneOnOne&&!r&&this.id||null;if(!r&&this.isOneOnOne){var s=S.ServicesManager.persons.getPerson(this.id);s.displayName?o=s.displayName:s.subscribe("displayName",function(e){return n.topic=e})}else if(this.isPstn)o=this.id.replace("4:","");else{var a=this._messagingService.parseConversationTopic(o);1!==a.trim().length&&""!==a.trim().replace(",","")&&(o=a)}this.topic=o||""}},t.prototype._addMissingLastReadMessageId=function(e){var t=e.lastIndexOf(";");return e.indexOf("undefined",t)>-1&&(e=e.replace("undefined",this.lastMessage.id)),e},t.prototype.startGuestConversation=function(){return this.isAgent?this._messagingService.startGuestConversation():Promise.resolve()},t.prototype.updateConsumptionHorizon=function(e){e&&e!==this._consumptionHorizon.value&&this._consumptionHorizon.set(e,!0)},t.prototype.messageReceived=function(e,t){var n={type:e,messageType:t};f.swc.Eventing.triggerEvent("onMessageReceived",n),this.messageReceivedProxied&&f.swc.Eventing.triggerEvent("proxy:conversation:messageReceived",{refId:this.refId,message:n})},Object.defineProperty(t.prototype,"refId",{get:function(){return this._refId},set:function(e){this._refId=this._refId||e},enumerable:!0,configurable:!0}),t}(u.default);t.default=k;var M=function(e){return!!e.conversationblocked&&"true"===e.conversationblocked.toLocaleLowerCase()},O=function(e){return!!e.alerts&&/false/i.test(e.alerts)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.callback=e}return e.prototype.connect=function(){this.timer||(this.callback(),this.timer=setInterval(this.callback,3e4))},e.prototype.disconnect=function(){clearInterval(this.timer)},e}();t.HeartBeat=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(36),r="sip:",o="8:orgid:sfb:",s="@sfb.unq.gbl.spaces",a="19:sfb:";t.isSfB=function(e){return!!e&&(t=e,!!t&&i.startsWith(t,r)||function(e){return!!e&&i.startsWith(e,o)}(e)||function(e){return!!e&&(function(e){return i.startsWith(e,a)&&!i.endsWith(e,s)}(e)||function(e){return i.endsWith(e,s)}(e))}(e));var t}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(159),o=n(3),s=n(1),a=n(98),c=n(86),u=n(301),l=n(11),p=n(92),d=n(100),f=n(321),h=n(26),g=n(124),m=n(15),v=n(99),y=n(39),_=n(33),b=n(0),w=n(182),C=n(83),S=n(170),T=n(7),E=n(72),P=n(84),I=n(13),k=n(29),M=n(322),O=n(9),A=n(54),x=n(42),N=n(18),L=n(161),R=n(23),D=n(111),U=n(4),F=n(120),j=/(^|\s)(https?:\/\/[^\s]*\.(?:png\?\d+|png|jpg\?\d+|jpg|jpeg\?\d+|jpeg|gif))($|<|\s)/gim,B={ALLOWED_TAGS:["img","a"],ALLOWED_ATTR:["target","src","alt","class","href"]},H=/<a href="([^"]+)"( target="([^"]+)")?>([^<]+)<\/a>/g,G=730,z=5e3,W=3e3,V=!0,K=function(){function e(e){var t=this;this._encoder=new a.Encoder(null,null),this._isBackfillEnabled=!1,this._handleMessageResource=function(e,n){if(t._messageTypesHandler.isTypingIndicator(n)&&n.from){var i=x.default.normalizePersonId(O.MessageUtils.getSenderIdFromUrl(n.from));return b.swc.EcsConfig.showCustomTypingName&&n.imdisplayname?void e.setParticipantTyping(i,"Control/Typing"===n.messagetype,n.imdisplayname):void e.setParticipantTyping(i,"Control/Typing"===n.messagetype)}var o=n.contentOriginal&&0===n.contentOriginal.trim().length;if(n.content&&0!==n.content.trim().length||!o||n.skypeeditedid){t._setHistoryParamToCache(e.id);var s=t.processNewMessage(e,n,null,!1);if(s&&s.direction===U.Direction.Incoming){var a=O.MessageUtils.getSenderIdFromUrl(n.from);(i=x.default.normalizePersonId(a))&&e.setParticipantTyping(i,!1),e.messagesReceived++,t._updateUnreadMessageCounter(e,s),s.isDeleted||s.isEdited||"SystemMessage"===s.type||b.swc.Telemetry.sendEvent.messageReceived(e,s.type,e.sdkMode,e.topic,e.isControlOpen),e.messageReceived(r.default.getReceivedMessageType(s.type),s.type)}}},this._updateUnreadMessageCounter=function(e,n){if(e.isControlOpen)t.updateConsumptionHorizonToLastMessage(),e.unreadMessagesCount=0;else if(n.isDeleted){var i=n.originalTimestamp.getTime();!(e.consumptionHorizon.lastReadMessageTimestamp>=i)&&n.isEdited&&e.unreadMessagesCount>0&&e.unreadMessagesCount--}else n.isEdited||e.unreadMessagesCount++},this._isFetched=!1,this._isTeamsBackend=o.default.get.backend===m.MessagingBackend.TEAMS,this._isUseEditMessageClassic=function(){return V&&o.default.get.backend!==m.MessagingBackend.TEAMS},this._messageToBotWasSent=!1,this._pendingContactRequest=!1,this._quarantineCountDown=-1,this.checkConversationStatus=function(e){return t.isConversationNotFoundError(e)?Promise.resolve():b.swc.services.webApi.fetchConversation(t.conversation.id).then(function(e){if(!t.isConversationNotFoundError(e)){if(t.isConversationBlocked(e))return t.conversation.isBlocked=!0,void(t.conversation.isChatEnabled=!1);switch(e.properties.conversationstatus){case"Accepted":return t.conversation.isUnderQuarantine=!1,t.conversation.isChatEnabled=!0,void(t._quarantineCountDown=-1);case"AcceptPendingSender":break;case"AcceptPendingRecipient":return t._pendingContactRequest=!0,t.conversation.isUnderQuarantine=!1,void(t.conversation.isChatEnabled=!0);default:return}t.checkIfBuddy()}},function(e){t.isConversationNotFoundError(e)||T.default.throwError(105002,"Unable to check IConversation Status",e)})},this.checkIfBuddy=function(){t._checkContactTimeout||(t._checkContactTimeout=D.build(t.checkConversationStatus.bind(t),z)),t._checkContactTimeout.start()},this.fetchUserMessages=function(e){return new Promise(function(n,i){b.swc.services.webApi.fetchMessages(t.conversation.id).then(function(i){t._isBackfillEnabled=!0,t._messagesHandler(t.conversation,e,i),t._isFetched=!0,n(i)},function(e){t.onConversationLoadingFinished(),i(e)})})},this.isConversationBlocked=function(e){return!!e.properties.conversationblocked&&"true"===e.properties.conversationblocked.toLocaleLowerCase()},this.isConversationNotFoundError=function(e){return!(!e||e.errorCode!==G)&&(t.conversation.isChatEnabled=!0,t._quarantineCountDown=0,!0)},this.isOneToOneOrBot=function(){return t.conversation.isPerson||t.conversation.isAgent},this.startConversationWithBot=function(e){void 0===e&&(e=!0);var n=t.conversation.id,i=t.conversation.id.slice(3),r=t;if(0===t.conversation.participants.length){var o=new F.default(b.swc.services.persons.getPerson(t.conversation.id,!0));t.conversation.participants.pushObservable(o)}return t.executeWhenSignedIn(function(){b.swc.services.contactsManager.isPersonContact(n).then(function(n){n?(r.subscribeToConversation(),t.conversation.isChatEnabled=!0,b.swc.services.signInManager.userIdentityType===h.IdentityType.GUEST&&(t.conversation.isNew=!0,t.conversation.startGuestConversation()),t.conversation.definition.Payload&&t.conversation.sendDataToBot({payload:t.conversation.definition.Payload})):(t.conversation.isChatEnabled=!1,t.conversation.isNew=!0,e&&b.swc.services.agentsManager.addAgent(i),t._checkContactTimeout=D.build(function(){r.startConversationWithBot(!1)},W),t._checkContactTimeout.start()),t.fetchUserMessages(Date.now())},function(e){T.default.throwError(105001,"Unable to start conversation with bot",e,n)})})},this.startConversationWithPerson=function(){t.conversation.id.slice(2);if(0===t.conversation.participants.length){var e=new F.default(b.swc.services.persons.getPerson(t.conversation.id,!0));t.conversation.participants.pushObservable(e)}return t.executeWhenSignedIn(function(){return b.swc.services.contactsManager.isPersonContact(t.conversation.id).then(function(e){return e?(t.conversation.isNew=!1,b.swc.services.webApi.subscribeContactPresence(t.conversation.id),t.subscribeToConversation()):(t.conversation.isNew=!0,t.subscribeToConversation().then(t.checkConversationStatus.bind(t)))}).then(function(e){return t.fetchUserMessages(Date.now()),e})})},this.presubscribeConversation=function(e){if(void 0===e&&(e=!1),t._subscriptionPromise)return t._subscriptionPromise;var n=t.currentUserHasHistory(t._conversationId);return e=e&&b.swc.services.signInManager.userIdentityType===h.IdentityType.SKYPE||n,t._subscriptionPromise=b.swc.services.webApi.subscribeConversation(t._conversationId,t._eventHandler,function(){return t._backfilllingHandler(!0)}),t._subscriptionPromise},this.subscribeToConversation=function(){var e=t,n=t.currentUserHasHistory(e.conversation.id),i=b.swc.services.signInManager.userIdentityType===h.IdentityType.SKYPE||n;b.swc.Eventing.triggerEvent("onConversationReady",{id:t.conversation.id}),b.swc.Telemetry.sendEvent.conversationLoaded(t.conversation);var r=function(n){if(t.isConversationNotFoundError(n))return n;n&&n.properties&&n.properties.consumptionhorizon&&t.conversation.updateConsumptionHorizon(n.properties.consumptionhorizon),n&&n.threadProperties&&t.updateConversationProperties(n.threadProperties,!0);var i=t.isConversationBlocked(n);return t.conversation.isBlocked=i,t.conversation.isChatEnabled=!i,e.onConversationLoadingFinished(),n};return t.presubscribeConversation().then(function(){return i?b.swc.services.webApi.fetchConversation(t.conversation.id).then(r):Promise.reject("Do not fetch Properties (this is not and error)")}).catch(function(n){t._messageToBotWasSent?t.fetchUserMessages(Date.now()):e.onConversationLoadingFinished()})},this.sendSwift=function(e){return t.sendMessageToService(g.MessageType.SWIFT,t.createMessageData({content:e.title,properties:e.value||e,messagetype:R.MessagePayloadType.RichText,processedcontent:e.title}))},this.sendLiveState=function(){return t.sendMessageToService(g.MessageType.LIVE_STATE,t.createMessageData({content:"",messagetype:R.MessagePayloadType.ControlLiveState}))},this.setIsTyping=function(e){return t.sendMessageToService(g.MessageType.TYPING,t.createMessageData({content:"",messagetype:e?R.MessagePayloadType.ControlTyping:R.MessagePayloadType.ControlClearTyping}))},this.isMessageContentText=function(e){var t=!0,n=(new DOMParser).parseFromString(e,"text/html");return 0!==n.getElementsByTagName("parsererror").length||(t=n.body.innerHTML===n.body.innerText),t},this._getReportProblemContext=function(){var e=I.guid.generate().slice(0,5),t=o.default.get.isTeams()?"enterprise":"consumer",n="swc,feedback,"+s.Configuration.getPlatformName()+","+t;return o.default.get.isTeams()?"#bug | Platform: "+s.Configuration.getPlatformId()+" | App Version: "+s.Configuration.getVersion()+" | OS Version: "+N.default.getOsName()+" "+N.default.getOsName()+" | Device: "+N.default.getDeviceType()+" | Language: "+window.navigator.language+") | Tags: "+n+' | Network: WIFI<context feedbackId ="'+e+'"></context>':'<context PlatformID="'+s.Configuration.getPlatformId()+'" AppVersion="'+s.Configuration.getVersion()+'" OS="'+N.default.getOsName()+" "+N.default.getOsName()+'" Device="'+N.default.getDeviceType()+'" Language="'+window.navigator.language+'" BrbEnabled="true" Tags="'+n+'" feedbackId="'+e+'"></context>'},this._eventHandler=function(e,n){switch(e){case"NewMessage":case"MessageUpdate":t._handleMessageResource(t.conversation,n);break;case"ConversationUpdate":t._isFetched||t.fetchUserMessages(Date.now()),t.conversation.update(n)}},M.Masks.init(),e||T.default.throwError(10501,"conversation is missing"),this._conversationId=e.id,this._messageTypesHandler=new u.default,this._firstMessagePopulationPromise=new l.CancelablePromise,b.swc.services.mePersonManager.fetch(),this._backfilllingHandler=this.backFillLostMessges.bind(this),A.get().subscribe("isOnline",this._backfilllingHandler),this.presubscribeConversation()}return Object.defineProperty(e.prototype,"mePerson",{get:function(){return b.swc.services.mePersonManager.mePerson},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conversation",{get:function(){return b.swc.services.conversations.get(this._conversationId)},enumerable:!0,configurable:!0}),e.prototype.startGroupConversation=function(){var e=this,t=function(){return b.swc.services.webApi.fetchThread(e.conversation.id).then(function(t){if(t.properties){var n=t.properties;t.members&&(n.members=t.members),e.updateConversationProperties(n);var i=n.joiningenabled,r=n.capabilities,o=!r||0===r.length;if(e._isTeamsBackend){var s=n.fixedRoster&&n.uniquerosterthread;e.conversation.isOneOnOne=s}else e.conversation.isOneOnOne=-1===t.id.indexOf("19:");var a=e.isMember(b.swc.services.signInManager.currentUserName,t);!o||i||e._isTeamsBackend&&a?e.subscribeToConversation():T.default.throwError(10506,"Joining to a group conversation is disabled",{},e.conversation.id);var c=e.conversation.participants;c.spliceObservable(0,c.length),t.members.forEach(function(e){var t=b.swc.services.persons.getPerson(e.id,!0),n=new F.default(t,e);c.pushObservable(n),t.isAgent&&b.swc.Eventing.triggerEvent("botAddedToThread",t.id)}),b.swc.services.mePersonManager.fetch().then(function(t){c.forEach(function(n){t.id===n.person.id&&(e.conversation.selfParticipant=n)})})}else e.subscribeToConversation();return e.conversation.members=t.members,t},function(t){T.default.throwError(10509,"Unable to fetch a thread",t,e.conversation.id)})},n=function(t){return b.swc.services.webApi.addParticipant(e.conversation.id,t).then(null,function(t){T.default.throwError(10507,"Unable to join conversation",t,e.conversation.id)})};return this.executeWhenSignedIn(function(){var i="8:"+b.swc.services.signInManager.currentUserName;new Promise(function(t){0===e.conversation.id.indexOf("19:guest")&&-1===b.swc.services.signInManager.currentUserName.indexOf("guest")?n(i).then(function(){return t()}):t()}).then(function(){e.fetchUserMessages(Date.now()),t().then(function(r){e.isMember(b.swc.services.signInManager.currentUserName,r)||n(i).then(t),e.conversation.topic||(e.conversation.topic=e.parseConversationTopic(r.properties.topic||null))})})})},e.prototype.isMember=function(e,t){var n="8:"+e;return t&&t.members&&t.members.some(function(e){return e.id===n})},e.prototype.addBotToThread=function(e){b.swc.services.webApi.addParticipant(this.conversation.id,"28:"+e).then(function(e){},function(t){T.default.throwError(10510,"Unable to add bot to conversation",t,e)})},e.prototype.addParticipantToThread=function(e){b.swc.services.webApi.addParticipant(this.conversation.id,e).then(function(e){},function(t){T.default.throwError(10511,"Unable to add participant to conversation",t,e)})},e.prototype.createConversation=function(e){e&&b.swc.services.webApi.createThread([])},e.prototype.deleteConversation=function(e){return b.swc.services.webApi.deleteConversation(e)},e.prototype.deleteMessage=function(e){return this._isUseEditMessageClassic()?this.editMessageClassicWay(e):b.swc.services.webApi.deleteMessage(this.conversation.id,e.id)},e.prototype.dispose=function(){this._messageToBotWasSent=!1,this.stopListeningConversation(),this._checkContactTimeout&&(this._checkContactTimeout.reset(),this._checkContactTimeout=null),this._firstMessagePopulationPromise.status===l.PromiseStatus.Pending&&(this._firstMessagePopulationPromise.promise.then(null,function(){}),this._firstMessagePopulationPromise.cancel()),this._firstMessagePopulationPromise=new l.CancelablePromise,A.get().unsubscribe("isOnline",this._backfilllingHandler)},e.prototype.mask=function(e,t){var n=M.Masks.instance;return n&&n.shouldMask(e)&&(e=n.process(e),t&&(t.tags=t.tags||"",t.tags=S.default.add(t.tags,"masked",!0))),e},e.prototype.editMessage=function(e,t){t=this.mask(t);var n=this._encoder.encode(t,this.conversation,this.mePerson),i=v.default.parse(n);return this._isUseEditMessageClassic()?this.editMessageClassicWay(e,i):b.swc.services.webApi.editMessage(this.conversation.id,e.id,e.rawMessageType,i)},e.prototype.getUnreadMessagesCount=function(){return this.conversation.unreadMessagesCount},e.prototype.loadMoreMessages=function(e){return this._backwardLink?b.swc.services.webApi.fetchMessagesByLink(this._backwardLink).then(this._messagesHandler.bind(this,e,Date.now())):Promise.resolve()},e.prototype.markAsRead=function(){(b.swc.services.signInManager.userIdentityType===h.IdentityType.SKYPE||this.currentUserHasHistory(this.conversation.id))&&this.updateConsumptionHorizonToLastMessage()},e.prototype.removeMessageProperty=function(e,t,n,i){return b.swc.services.webApi.removeMessageProperty(e,t,n,i)},e.prototype.removeParticipantFromThread=function(e){return b.swc.services.webApi.removeParticipant(this.conversation.id,e).then(function(e){},function(t){T.default.throwError(10512,"Unable to remove participant from conversation",t,e)})},e.prototype.sendDataToBot=function(e,t){var n={name:"SWC",conversation:{id:this.conversation.isGroup?this.conversation.id:b.swc.services.signInManager.currentUserName},value:t};return this._messageToBotWasSent=!0,b.swc.services.webApi.sendDataToBot(e,n)},e.prototype.sendFile=function(e){var t=this,n=e.file,i=e.uploadPromise,r=e.registerPromise,o=e.clientMessageId,s=E.isDocumentTypeImage(n.type)?g.MessageType.IMAGE:g.MessageType.FILE,a=this.generateFileMessagePayload(n,o),c=this.pushMessageToConversation(s,a);return r.then(function(e){var r=e.documentId,a=t.generateFileMessagePayload(n,o,r);return t.sendMessageToService(s,a,null,i,c)}).catch(function(){c.status=U.DeliveryStatus.Failed})},e.prototype.generateFileMessagePayload=function(e,t,n){void 0===n&&(n=t);var i=E.isDocumentTypeImage(e.type),r={content:i?E.createImageMessage(e,n):E.createFileMessage(e,n),clientmessageid:t,messagetype:i?R.MessagePayloadType.RichTextUriObject:R.MessagePayloadType.RichTextMedia_GenericFile,properties:JSON.stringify(this.conversation.currentMessageProperties||{})};return this.createMessageData(r)},e.prototype.sendFilesAsProperties=function(e){var t=this,n=e.clientMessageId,r=this.createMessageData({content:"",messagetype:R.MessagePayloadType.RichTextHtml,clientmessageid:n,properties:JSON.stringify(i({},this.conversation.currentMessageProperties||{},{files:e.files}))}),o=this.pushMessageToConversation(g.MessageType.TEXT,r);return e.registerPromise.then(function(r){var s=t.createMessageData({content:"",messagetype:R.MessagePayloadType.RichTextHtml,clientmessageid:n,properties:JSON.stringify(i({},t.conversation.currentMessageProperties||{},{files:JSON.stringify(r.files)}))});return t.sendMessageToService(g.MessageType.TEXT,s,null,e.uploadPromise,o)}).catch(function(){o.status=U.DeliveryStatus.Failed})},e.prototype.sendFilesAsAmsProperties=function(e){var t=this,n=e.clientMessageId,r=this.createMessageData({content:"",messagetype:R.MessagePayloadType.RichTextHtml,clientmessageid:n,properties:JSON.stringify(i({},this.conversation.currentMessageProperties||{},{files:e.files}))}),o=this.pushMessageToConversation(g.MessageType.TEXT,r);return e.registerPromise.then(function(r){var s=t.createMessageData({content:"",messagetype:R.MessagePayloadType.Text,amsreferences:JSON.stringify([r.documentId]),clientmessageid:n,properties:JSON.stringify(i({},t.conversation.currentMessageProperties||{},{files:JSON.stringify(r.files),importance:"",subject:null}))});return t.sendMessageToService(g.MessageType.TEXT,s,null,e.uploadPromise,o)}).catch(function(){o.status=U.DeliveryStatus.Failed})},e.prototype.sendMessage=function(e,t,n){var r,o={messageLength:e.length,origin:t};if(n=i({},this.conversation.currentMessageProperties,n)||{},this.conversation.isBRB)r=e+this._getReportProblemContext();else{var s=this.mask(e,n);r=this._encoder.encode(s,this.conversation,this.mePerson)}var a=v.default.parse(r).replace(/<br\s*\/?>/g,"<br/>").replace(/<hr\s*\/?>/g,"<hr/>"),c=this.isMessageContentText(a)?R.MessagePayloadType.Text:R.MessagePayloadType.RichText,u=this.createMessageData({content:a,messagetype:c,"Has-Mentions":O.MessageUtils.containsMention(r).toString()});return Object.keys(n).length&&(u.properties=n),this.sendMessageToService(g.MessageType.TEXT,u,o)},e.prototype.setConversationTopic=function(e){b.swc.services.webApi.setConversationTopic(this.conversation.id,e)},e.prototype.setMessageProperty=function(e,t,n,i){return b.swc.services.webApi.setMessageProperty(e,t,n,i)},e.prototype.startConversation=function(){return this.isOneToOneOrBot()?this.conversation.isPerson?this.startConversationWithPerson():this.startConversationWithBot():this.startGroupConversation()},e.prototype.startGuestConversation=function(){var e={name:"startConversation",conversation:{id:k.default.toFullIdentifier(b.swc.services.signInManager.currentUserName)},value:{}};return b.swc.services.webApi.sendDataToBot(this.conversation.id,e)},e.prototype.stopListeningConversation=function(){b.swc.services.webApi.unsubscribeConversation(this.conversation.id)},e.prototype._messagesHandler=function(e,t,n){var i,r=this;if(e.messages)if(n){this._backwardLink=n._metadata.backwardLink;var o=p.ObservableCollection.create();n.messages.forEach(function(t){r.processNewMessage(e,t,o,!0)}),o.sortObservable(function(e,t){return e.timestamp.getTime()>t.timestamp.getTime()?1:-1}),b.swc.Telemetry.sendEvent.messagesFetched(this.conversation,Date.now()-t,200,n.messages.length),(i=e.messages).pushObservable.apply(i,o),this.onConversationLoadingFinished()}else this.onConversationLoadingFinished();else this.onConversationLoadingFinished()},e.prototype._setHistoryParamToCache=function(e){if(b.swc.services.signInManager.userIdentityType!==h.IdentityType.SKYPE&&!this.currentUserHasHistory(e)){var t=b.swc.services.sessionStorage.getItem(_.SKYPE_HAS_HISTORY_KEY)||"";t=""===t?e:t+";"+e,b.swc.services.sessionStorage.setItem(_.SKYPE_HAS_HISTORY_KEY,t)}},e.prototype._triggerCustomAction=function(e){var t=e.content;if(t){var n=/<swc-event>(?:<name>([\s\S]*)<\/name>)[\s]?(?:<action>([\s\S]*)<\/action>)[\s]?(?:<data>([\s\S]*)<\/data>)<\/swc-event>/i,i=t.match(n);if(i&&!(i.length<3)){var r=i[1],o=i[2],s=i[3];o&&o.toLowerCase()===f.default.DELIVERED.toLowerCase()&&(r&&b.swc.Eventing.triggerEvent(r,s),e.content=t.replace(n,""))}}},e.prototype.backFillLostMessges=function(e){var t=this;if((!this._backfilllingPromise||this._backfilllingPromise.status!==l.PromiseStatus.Pending)&&this._isBackfillEnabled){var n=this;this._backfilllingPromise=new l.CancelablePromise(b.swc.services.webApi.fetchMessages(this.conversation.id)),this._backfilllingPromise.promise.then(function(e){e.messages&&e.messages.sort(function(e,t){var n=new Date(e.originalarrivaltime),i=new Date(t.originalarrivaltime);return n>i?1:n<i?-1:0}),n._messagesHandler(t.conversation,Date.now(),e)},function(e){})}},e.prototype.currentUserHasHistory=function(e){return(b.swc.services.sessionStorage.getItem(_.SKYPE_HAS_HISTORY_KEY)||"").indexOf(e)>=0||P.getConversationType(e)===U.ConversationType.GROUP},e.prototype.editMessageClassicWay=function(e,t){void 0===t&&(t="");var n={messagetype:e.rawMessageType,content:t,skypeeditedid:e.clientMessageId?e.clientMessageId:e.key};return b.swc.services.webApi.sendMessage(this.conversation.id,n)},e.prototype.executeWhenSignedIn=function(e){return b.swc.services.signInManager.getSkypeToken().then(function(t){return e()})},e.prototype.filterMessagesByKey=function(e,t){return e.filter(function(e){return e.key===t})[0]},e.prototype.getExistingMessage=function(e,t,n){var i=n!==t,r=this.filterMessagesByKey(n,e.key);return r||(i&&(r=this.filterMessagesByKey(t,e.key)),r)},e.prototype.mapSuggestedActionsArray=function(e,t,n){e.forEach(function(e){t.suggestedActions.pushObservable(n(e))})},e.prototype.onConversationLoadingFinished=function(){this._firstMessagePopulationPromise.status===l.PromiseStatus.Pending&&(this._firstMessagePopulationPromise.resolve(),(b.swc.services.signInManager.userIdentityType===h.IdentityType.SKYPE||this.currentUserHasHistory(this.conversation.id))&&this.updateConsumptionHorizonToLastMessage())},e.prototype.processNewMessage=function(e,t,n,i,r){function o(t){return t.title&&(t.title=this._encoder.decode(this._encoder.encode(t.title))),new w.default(t,e,s.senderId)}this._triggerCustomAction(t),n=n||e.messages;var s=this._messageTypesHandler.handle(t,{conversation:this.conversation,isHistory:i});if("Control/LiveState"===t.messagetype)return null;if(!s)return null;L.default.parseMessageProperties(s,t),s.status=U.DeliveryStatus.Sent,t.suggestedActions&&t.suggestedActions.actions&&this.mapSuggestedActionsArray(t.suggestedActions.actions,s,o.bind(this)),t.properties&&t.properties.suggestedActions&&t.properties.suggestedActions.actions&&this.mapSuggestedActionsArray(t.properties.suggestedActions.actions,s,o.bind(this));var a,c,u=this.getExistingMessage(s,n,e.messages);if((a=s)&&"SystemMessage"===a.type)return u?(s.isEdited=!0,this._messageTypesHandler.updateExistingMessage(u,s,i),s.subscribe("content",function(e){return u.content=e}),s):(n.pushObservable(s),s);if(!this._isTeamsBackend&&!u&&s.skypeEditedId)return(c=this.filterMessagesByKey(e.allMessages,s.key))?this._messageTypesHandler.updateExistingMessage(c,s,i):(r&&s.skypeEditedId&&((u=this._messageTypesHandler.handle(t,{conversation:this.conversation,isHistory:i})).id=s.skypeEditedId,u.skypeEditedId=void 0,this._messageTypesHandler.updateExistingMessage(u,s,i),n.pushObservable(u)),e.allMessages.pushObservable(s)),s;if(!u&&!s.skypeEditedId&&(c=this.filterMessagesByKey(e.allMessages,s.key)))return this._messageTypesHandler.updateExistingMessage(c,s,i),n.pushObservable(c),c;if(j.test(s.content)&&(s.content=s.content.replace(j,"$1"+y.default.dompurify.sanitize('<a class="replacedImg" href="$2" target="_blank"><img src="$2" alt=""></a>',B)+"$3")),H.test(s.content)){var l=s.content.match(H);l&&!l[2]&&(s.content=s.content.replace(l[0],y.default.dompurify.sanitize(l[0],B)))}return u?this._messageTypesHandler.updateExistingMessage(u,s,i):n.pushObservable(s),s},e.prototype.createMessageData=function(e){var t={contenttype:"text",composetime:(new Date).toISOString(),clientmessageid:Date.now().toString()};return Object.assign(t,e||{})},e.prototype.pushMessageToConversation=function(e,t){var n;return g.MessageType.SWIFT!==e&&(n=this._messageTypesHandler.generateOutgoing(t)),n&&this.conversation.messages.pushObservable(n),n},e.prototype.prepareForSending=function(e){var t=this;return new Promise(function(n,i){t.conversation.isSealed&&i("Conversation is Sealed and cannot be used for sending messaged");var r=-1!==e.messagetype.indexOf("Control");t._quarantineCountDown>=0&&!r&&(t._quarantineCountDown++,t.conversation.isChatEnabled=t.conversation.isChatEnabled&&t._quarantineCountDown<10,t.checkIfBuddy()),t._pendingContactRequest&&!r&&(t._pendingContactRequest=!1,b.swc.services.webApi.acceptConversation(t.conversation.id));var o=t.mePerson;o&&o.displayName&&(e.imdisplayname=o.displayName);var s=Date.now(),a=t.conversation.isAgent&&"RichText"===e.messagetype&&A.get().isOnline;a&&t.conversation.participants.length&&(t.conversation.participants[0].isTyping=!0),t.conversation.contextAad&&(e.content+='<context reason="customAad">'+t.conversation.contextAad+"</context>"),n({startTime:s,showTypingInAdvance:a})})},e.prototype.sendMessageToService=function(e,t,n,i,r){var o=this;return this.prepareForSending(t).then(function(s){var a=s.startTime,c=s.showTypingInAdvance;r=r||o.pushMessageToConversation(e,t);var u=function(i){r&&(r.status=U.DeliveryStatus.Sent),n&&n.origin!==d.ActionTrigger.TYPING&&(o.conversation.messagesSent++,o.updateConsumptionHorizonToLastMessage()),b.swc.Telemetry.sendEvent.messageSent(o.conversation,e,Date.now()-a,200,t.content.length||0,o.conversation.messagesSent,null,null,null,O.MessageUtils.containsMention(t.content),O.MessageUtils.containsEmoticon(r&&r.content),O.MessageUtils.containsLargeEmoticon(r&&r.content))},l=function(n){r&&(r.status=U.DeliveryStatus.Failed),c&&o.conversation.participants.length&&(o.conversation.participants[0].isTyping=!1),b.swc.Telemetry.sendEvent.messageSent(o.conversation,e,Date.now()-a,n.status,t.content.length||0,o.conversation.messagesSent,void 0,n.errorCode,n.message,O.MessageUtils.containsMention(t.content),O.MessageUtils.containsEmoticon(r&&r.content),O.MessageUtils.containsLargeEmoticon(r&&r.content)),804===n.errorCode&&(o.conversation.isChatEnabled=!1,o.conversation.isUnderQuarantine=!0,o.checkIfBuddy()),403!==n.status&&404!==n.status||(o.conversation.isSealed=!0,o.conversation.isChatEnabled=!1)};return(i||Promise.resolve({})).then(function(){return b.swc.services.webApi.sendMessage(o.conversation.id,t).then(u,l)},l)})},e.prototype.updateConsumptionHorizonToLastMessage=function(){var e=this;if(0!==this.conversation.messages.length&&this.conversation.isActive&&c.default.instance.isFocused){var t=this.conversation.messages[this.conversation.messages.length-1];if(!(this.conversation.consumptionHorizon.lastReadMessageTimestamp>=t.timestamp.getTime())){var n="";o.default.get.isTeams()&&this.conversation.isUnreadBookmark?(n=this.getUpdatedConsumptionHorizon(0,(new Date).getTime(),"0"),b.swc.services.webApi.updateConsumptionHorizonBookmark(this.conversation.id,n).then(function(){e.conversation.updateConsumptionHorizon(n)})):(n=this.getUpdatedConsumptionHorizon(t.timestamp.getTime(),(new Date).getTime(),t.key),b.swc.services.webApi.updateConsumptionHorizon(this.conversation.id,n).then(function(){e.conversation.updateConsumptionHorizon(n)}))}}},e.prototype.getUpdatedConsumptionHorizon=function(e,t,n){return e+";"+t+";"+n},e.prototype.parseConversationTopic=function(e){var t=this,n={};return this.conversation.participants.forEach(function(e){if(e.person.displayName)n[e.person.mri]=e.person.displayName;else{n[e.person.mri]=e.person.mri;var i=function(r){n[e.person.mri]=r,t.conversation.topic=C.default.parseConversationTopic(t.conversation.topic,n,t.mePerson.mri),e.person.unsubscribe("displayName",i)};e.person.subscribe("displayName",i)}}),0===this.conversation.participants.length&&this.conversation.members&&this.conversation.members.forEach(function(e){e.name&&(n[e.id]=e.name)}),C.default.parseConversationTopic(e,n,this.mePerson.mri)},e.prototype.updateConversationProperties=function(e,t){var n=this;if(void 0===t&&(t=!1),e&&(e.topic&&(this.conversation.topic=this.parseConversationTopic(e.topic)),e.picture&&(this.conversation.avatar=e.picture.replace("URL@","")),this._isTeamsBackend&&e.members)){var i=[];if(e.members.forEach(function(e){if(!b.swc.services.mePersonManager.isMe(e.id)){var t=b.swc.services.persons.getPerson(e.id);t.displayName&&i.push({userId:e.id,displayName:t.displayName})}}),0===i.length)return;b.swc.services.signInManager.isAadSupported()&&b.swc.services.avatarService.fetchMergedAvatars(i).then(function(e){e&&(n.conversation.avatar=e)})}},e}();t.default=K},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prepare=function(e){return e=(e=e.replace(/&nbsp;/g," ").replace(/<div( itemprop="copy-paste-block")?>/g,"").replace(/<\/div>/g,"").trim()).replace(/<span[^>]*type="(\([a-z]+\))"[^>]*><img[^>]*itemid="(\w+)"[^>]*><\/span>/g,'<ss type="$2">$1</ss>')},e}();t.TeamsMessageUtil=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.addFormatting=function(t){return t=e.addFormattingTags(t,"s",/(\s|^|_|\*|i>|b>|s>)~((?!~\s).)*~(\s|$|_|\*|<)/gi,"~")},e.addFormattingTags=function(t,n,i,r){for(var o=t.match(i);o&&o.length>0&&2!==o[0].trim().length;)o.forEach(function(i){var o=i.trim(),s=(o=o.substring(o.indexOf(r),o.lastIndexOf(r)+1)).substr(1,o.length-2);s=e.createStartTag(n,r)+s+e.createEndTag(n),t=t.replace(o,s)}),o=t.match(i);return t},e.createStartTag=function(e,t){return"<"+e+' raw_pre="'+t+'" raw_post="'+t+'">'},e.createEndTag=function(e){return"</"+e+">"},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(0),c=n(135),u=n(85),l=/^\w$/,p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.fixInvalidHtml=function(e){return e.replace(/<canvas((?:\s?(?:data-[-a-z]*|height|width)="[a-z0-9]*")*)\s*\/>/g,"<canvas$1></canvas>")},t.prototype.createHtmlElement=function(e,t,n,i,r,a){var u={large:i,largeEmoticonClass:a,textContent:n,emoticonId:t,isAnimated:!r},l=s.createElement(c.SwcEmoticon,u),p=document.createDocumentFragment();return o.render(l,p),p},t.prototype.isElementAllowed=function(e){return"span"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("emoticon")},t.prototype.encodeTextNodeToXml=function(t,n,i,r){n.parentNode&&"a"!==n.parentNode.nodeName.toLowerCase()&&e.prototype.encodeTextNodeToXml.call(this,t,n,i,r)},t.prototype.wordRawToXml=function(e,t,n){var i=[],r=0,o=a.swc.services.pesManager.map;if(!a.swc.services.pesManager.canRenderConfigItems()||n&&n.isSfB)return i;for(var s=0;s<t.length;s++){for(var c="",u=-1,l=s+1;l<t.length+1;l++){var p=t.substring(s,l),d=o.hasOwnProperty(p)&&o[p];d&&!this.isWordChar(t[l])&&(c=d,u=l)}c&&(r!==s&&i.push(e.createTextNode(t.substring(r,s))),r=u,i.push(this.createXmlElement(e,c,t.substring(s,u))),s=u-1)}return 0!==r&&r<t.length&&i.push(e.createTextNode(t.substring(r))),i},t.prototype.createXmlElement=function(e,t,n){var i=e.createElement("ss");return i.setAttribute("type",t),i.innerText=n,i},t.prototype.isWordChar=function(e){return l.test(e)},t}(u.WordDomTransformer);t.default=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"i"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("mention")},t.prototype.xmlNodeToHtml=function(e,t){if("at"===t.nodeName.toLowerCase()&&t.attributes.getNamedItem("id")){var n=e.createElement("span");return n.setAttribute("data-mention-id",t.attributes.getNamedItem("id").value),n.setAttribute("class","mention"),n.setAttribute("title",t.attributes.getNamedItem("id").value),n.textContent="@"+t.textContent,[n]}return[]},t}(n(298).DomTransformerBase);t.MentionDomDecoder=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.transformRawToXml=function(e,t,n,i){var r=[];for(r.push(t);0!==r.length;){var o=r.pop();this.encodeTextNodeToXml(e,o,n,i)&&o.nodeType!==Node.TEXT_NODE&&this.isElementAllowed(o)&&this.pushChildNodes(r,o)}},e.prototype.encodeTextNodeToXml=function(e,t,n,i){var r=t.parentNode,o=this.xmlNodeToHtml(e,t,n,i);if(!o||!o.length)return!0;for(var s=0;s<o.length;s++)r.insertBefore(o[s],t);return r.removeChild(t),!1},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e}();t.DomTransformerBase=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"pre"!==e.nodeName.toLowerCase()},t.prototype.wordRawToXml=function(e,t){return[s(e)]},t.prototype.getAllWords=function(e){for(var t,n=/\r?\n/g,i=new Array;null!==(t=n.exec(e));)i.push(t);return i},t}(n(85).WordDomTransformer);function s(e){return e.createElement("br")}t.NewLineDomTransformer=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"a"!==e.nodeName.toLowerCase()},t.prototype.wordRawToXml=function(e,t){var n,i=t.match(/^(?:https?:\/\/|mailto:)(.+)$/i),r=i&&i[0],o=r;return r||(r=(i=t.match(/^[^@]+@(?:\w+(?:\.\w+)+)$/i))&&"mailto:"+i[0],o=i&&i[0]),r||(i=t.match(/^(?:www(?:\.\w+){1,}\.(?:com|org|net|edu|gov|mil|aero|arpa|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|pro|tel|travel|[a-z]{2,3}))$/i))&&i[0]&&(n=i.input?i.input.split("?")[1]:"",r="https://"+i[0],o=r=n?r+"?"+n:r),r?[s(e,r,o)]:[]},t.prototype.wordMatcher=function(){return/\S+/g},t}(n(85).WordDomTransformer);function s(e,t,n){var i=e.createElement("a");return i.setAttribute("href",t),i.setAttribute("title",t),i.setAttribute("target","_blank"),i.setAttribute("tabindex","-1"),i.innerText=n,i}t.URLDomTransformer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(161),s=n(4),a=n(9),c=n(302),u=n(303),l=n(304),p=n(308),d=n(309),f=n(310),h=n(311),g=n(312),m=n(313),v=n(314),y=n(315),_=n(316),b=n(317),w=n(318),C=n(319),S=n(320),T=function(){function e(){this._processors=[],this._xmmFallbackProcessor=new S.default,this._processors.push(new w.default),this._processors.push(new c.default),this._processors.push(new p.default),this._processors.push(new _.default),this._processors.push(new C.default),this._processors.push(new y.default),this._processors.push(new h.default),this._processors.push(new m.default),this._processors.push(new b.default),this._processors.push(new l.default),this._processors.push(new g.default),this._processors.push(new f.FileMessageProcessor),this._processors.push(new v.default),this._processors.push(new d.default),this._processors.push(new u.default)}return e.prototype.handle=function(e,t){var n,i=0;for(e.contentOriginal&&e.contentOriginal!==e.content?e.content=e.contentOriginal:e.contentOriginal=e.contentOriginal||e.content;!n&&i<this._processors.length;)n=this._processors[i].process(e,t),i++;return n||(n=this._xmmFallbackProcessor.process(e)),n},e.prototype.generateOutgoing=function(e){for(var t,n=0;!t&&n<this._processors.length;)t=this._processors[n].generate(e),n++;return t},e.prototype.updateExistingMessage=function(e,t,n){if(!t||e.senderId!==t.senderId&&e.customType!==s.CustomMessageType.Call)return e;var c=0===t.content.indexOf(r.Configuration.MSG_DELETED_CLASSIC_SKYPE),u=0===e.content.indexOf(r.Configuration.MSG_DELETED_CLASSIC_SKYPE),l=t.skypeEditedId&&c,p=t.version>e.version,d=t.originalTimestamp>e.originalTimestamp,f=p||d;return d&&n&&(e.content=l?a.MessageUtils.extractMsgContent(t.content):t.content,e.timestamp=t.timestamp,e.originalTimestamp=t.originalTimestamp),e.type!==s.MessageType.LwcFile&&e.type!==s.MessageType.LwcImage||(e.content=t.content),e.status=t.status,t.skypeEditedId?t.editedTimestamp&&o.default.updateMessageProperties(e,t):o.default.updateMessageProperties(e,t),t.isEdited&&(e.isEdited=!0,u&&(e.content=a.MessageUtils.extractMsgContent(e.content)),(t.editedTimestamp>e.timestamp||f)&&(e.content=t.content)),e.isEdited&&!d&&n&&(e.timestamp=t.timestamp),t.isDeleted&&(e.isDeleted=!0),i.default.get.isTeams()&&(e.isDeleted=t.isDeleted,e.files=t.files,e.id===t.clientMessageId&&(e.id=t.id)),e},e.prototype.isTypingIndicator=function(e){return"Control/Typing"===e.messagetype||"Control/ClearTyping"===e.messagetype},e}();t.default=T},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(120),s=n(0),a=n(17),c=n(46),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/AddMember"!==e.messagetype)return null;var n=new c.default(this._createMessageModel.bind(this),this._generateContent,e);n.subscribeOnceToPersonsName(n._initiator),n._targets.forEach(n.subscribeOnceToPersonsName);var i=this.parseContentFor(e.content,"target"),r=s.swc.services.persons.getPerson(i),a=t.conversation.participants;if(!t.isHistory&&i&&a&&!a.some(function(e){return e.person.id===r.id})){var u=new o.default(r);a.pushObservable(u),r.isAgent&&s.swc.Eventing.triggerEvent("botAddedToThread",r.id)}return t.conversation.isOneOnOne&&(n._messageModel.content=""),n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id,n=document.createElement("p");return n.innerText=t,e.isSelfAction()?s.swc.services.i18n.fetch("joinedConversation",{participant:"<b>"+n.innerHTML+"</b>"}):s.swc.services.i18n.fetch("wasAdded",{participant:"<b>"+n.innerHTML+"</b>",contact:"<b>"+e._targets.filter(function(t){return t.id!==e._initiator.id}).map(function(e){var t=e.displayName||e.id,n=document.createElement("p");return n.innerText=t,n.innerHTML}).join("</b>, <b>")+"</b>"})},t}(a.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(9),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if("RichText/Media_CallRecording"!==e.messagetype)return null;var t=this._parseRawMessage(e.content);if(!t)return null;if(!this._isValidCallRecordingMessage(t))return null;var n=this._createMessageModel(e);return n.type=o.MessageType.LwcCallRecording,n.content=this._createMessageContent(t),n},t.prototype._parseRawMessage=function(e){if(!e)return null;var t=e.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),i=e.match(/<URIObject[^>]*?\surl_thumbnail=\"([^"]+?)\"/i),r=e.match(/<originalname[^>]*?\sv=\"([^"]+?)\"/i);return t?{filename:r?r[1]:null,uri:s.MessageUtils.normalizeUrl(t[1]),xmmType:n?n[1].split(".")[0]:null,thumbnail:i?i[1]:null}:null},t.prototype._isValidCallRecordingMessage=function(e){return e&&e.uri&&"Video"===e.xmmType},t.prototype._createMessageContent=function(e){return["<LwcCallRecording",'url="'+e.uri+'"','thumbnail="'+e.thumbnail+'"','filename="'+e.filename+'"></LwcCallRecording>'].join(" ")},t}(n(17).default);t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=n(305),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){return(o.Configuration.ECS.showEngagementCampaings&&"PopCard"===e.messagetype||"Notice"===e.messagetype)&&s.default.instance.register(e,t),null},t}(n(17).default);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0),o=n(306),s=12096e5,a=function(){function e(){var e=this;this.register=function(t,n){var i,s;if(e._isSupported(n.conversation)&&e._isWithinTwoWeeks(t)){try{s=JSON.parse(t.content)}catch(e){}if(s&&s.length){switch(t.messagetype){case"Notice":i=new o.default(s[0],t.messagetype)}e._isInValid(i.validUntilTimestamp)||i&&r.swc.Eventing.triggerEvent("campaign:show",i)}}},this._isSupported=function(t){return t.isAgent&&e._isConversationWithConciergeBot(t.id)},this._isInValid=function(e){return Date.now()>e.getTime()},this._isWithinTwoWeeks=function(e){var t=Date.now()-s;return new Date(e.originalarrivaltime).getTime()>t},this._isConversationWithConciergeBot=function(e){return e===i.Configuration.CONCIERGE_BOT_MRI||e===i.Configuration.CONCIERGE_BOT_DF_MRI}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e}();t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.campaignId=t.campaignId,i.schemaVersion=t.schemaVersion,i.attachment=t.attachments&&t.attachments.length?t.attachments[0]:null,i}return r(t,e),t}(n(307).default);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(13);t.NOTICE_CONTENT_TYPE={GENERIC:"application/vnd.microsoft.notice",USER:"application/vnd.microsoft.notice.avatar"};var r=function(){return function(e,t){this.id=e.campaignGuid||e.campaignId||i.guid.generate(),this.type=t,this.language=e.language,this.clientVersion=e.clientVersion,this.platformList=e.platformList,this.userTagging=e.userTagging,this.validUntilTimestamp=e.validUntilTimestamp?new Date(e.validUntilTimestamp):null,this.experimentName=e.experimentName,this.contentCategory=e.contentCategory,this.telemetry=e.telemetry}}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),s=n(0),a=n(17),c=n(46),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/DeleteMember"!==e.messagetype)return null;var n=new c.default(this._createMessageModel.bind(this),this._generateContent,e);if(n.subscribeOnceToPersonsName(n._initiator),n._targets.forEach(function(e){n.subscribeOnceToPersonsName(e),t.conversation&&e===s.swc.services.mePersonManager.mePerson&&o.ServicesManager.cbl.deleteMemberProcessor.shouldDisableChatInputForCurrentUser(t.isHistory)&&(t.conversation.isChatEnabled=!1)}),!1===t.isHistory)for(var i=this.parseContentFor(e.content,"target"),r=s.swc.services.persons.getPerson(i),a=0;a<t.conversation.participants.length;a++){if(t.conversation.participants[a].person.id===r.id){t.conversation.participants.spliceObservable(a,1);break}}return n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id,n=document.createElement("p");return n.innerText=t,e.isSelfAction()?s.swc.services.i18n.fetch("hasLeftConversation",{participant:"<b>"+n.innerHTML+"</b>"}):s.swc.services.i18n.fetch("wasRemoved",{participant:"<b>"+n.innerHTML+"</b>",removedParticipant:"<b>"+e._targets.map(function(e){var t=e.displayName||e.id,n=document.createElement("p");return n.innerText=t,n.innerHTML}).join("</b>, <b>")+"</b>"})},t}(a.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(0),a=n(96),c=n(9),u=n(17),l=function(e,t){return s.swc.services.i18n.fetch(e,t)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getMissedCallMessage=function(e,t){var n=s.swc.services.persons.getPerson(e),i=l("message_text_missedCallFrom",{fromParticipant:n.displayName||n.id});return n.displayName||n.fetchDisplayNameAndAvatar().then(function(){var n=s.swc.services.persons.getPerson(e),i=l("message_text_missedCallFrom",{fromParticipant:n.displayName});t.content=c.MessageUtils.getMessageSanitizedContent(i)}),i},t._getParticipantIds=function(e){for(var t=[],n=/<part identity="(.*?)">/g,i=n.exec(e);null!==i;)t.push(i[1]),i=n.exec(e);return t},t._getDurationMessage=function(e){var t="",n=Math.floor(e/3600);n>0&&(t+=n+l("message_text_hours")+" ");e%=3600;var i=Math.floor(e/60);i>0&&(t+=i+l("message_text_minutes")+" ");var r=e%60;r>0&&(t+=r+l("message_text_seconds"));return t.trim()},t}return r(t,e),t.prototype.process=function(e,t){var n=this;if("Event/Call"!==e.messagetype&&"Signal/Flamingo"!==e.messagetype)return null;var i=this._createMessageModel(e,"",!0),r=e.conversationId||e.conversationid||"",u=t&&t.conversation&&t.conversation.isGroup||a.default.detectConversationType(r)===o.ConversationType.GROUP,p=e.content.replace(/\r?\n/g,""),d=o.CustomMessageType.Call,f=function(){var t=null;if(p.indexOf("<partlist")>-1){var r=/(<partlist alt ?= ?"">\s*<\/partlist>)|(<partlist type="started")/.test(p),a=/(^<ended)|(<partlist type="ended")/.test(p),f=/<partlist type="missed"/.test(p),h=new RegExp("<duration>([\\d|\\.]+)</duration>"),g=p.match(h.source),m=n._getParticipantIds(p),v=1===m.length,y=g?parseInt(g[1],10):0,_=c.MessageUtils.getSenderIdFromUrl(e.from),b=u?"GroupCall":"Call";if(r)t=l("message_text_startedCall"),d=o.CustomMessageType.Call;else if(a&&!v){var w=y?"<span>"+n._getDurationMessage(y)+"</span>":"";t=y?l("message_text_ended"+b)+" "+w:l("message_text_noAnswer"+b),d=o.CustomMessageType.CallEnd}else if(f||a&&v){var C=s.swc.services.mePersonManager.isMe(_);t=l("message_text_missed"+b),f&&!C&&(t=n._getMissedCallMessage(_,i)),C=m&&s.swc.services.mePersonManager.isMe(m[0]),a&&v&&!C&&(t=n._getMissedCallMessage(m[0],i)),d=u?o.CustomMessageType.MissedGroupCall:o.CustomMessageType.MissedCall}}i.content=c.MessageUtils.getMessageSanitizedContent(t)};return f(),s.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",f),i.senderId=c.MessageUtils.getSenderIdFromUrl(e.from),i.sender=s.swc.services.persons.getPerson(i.senderId),i.isDeleted=!1,i.isEdited=!1,i.customType=d,i.content?i:null},t}(u.default);t.default=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(9),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parseRawMessage=function(e){if(!e)return null;var t=e.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),i=e.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i);return t?{uri:t[1],uriObjectType:i?i[1]:null,xmmType:n?n[1].split(".")[0]:null,size:null,originalName:null}:null},t.isValidFileMessage=function(e){return null===e||null===e.uri||"File"!==e.xmmType},t.createFileContent=function(e){return'<LwcFile url="'+e.uri+'" size="'+e.size+'" originalName="'+e.originalName+'"></LwcFile>'},t}return r(t,e),t.prototype.process=function(e){if(-1===["RichText/UriObject","RichText/Media_GenericFile","RichText/Media_Video","RichText/Media_AudioMsg","RichText/Media_Card"].indexOf(e.messagetype))return null;var t=e.content,n=this.parseRawMessage(t);if(!n)return e.content=s.MessageUtils.getMessageSanitizedContent(e.content),this._createMessageModel(e);if(this.isValidFileMessage(n))return null;var i=t.match(/<FileSize[\s]+[^<]*v=\"([\d]*?)\"[^<]/i),r=t.match(/<OriginalName[\s]+[^<]*v=\"([\s\S]*?)\"[^<]/);n.size=i?i[1]:"0",n.originalName=r?r[1]:null;var a=this._createMessageModel(e);return a.type=o.MessageType.LwcFile,a.content=this.createFileContent(n),a},t.prototype.generate=function(e){if("RichText/Media_GenericFile"!==e.messagetype)return null;var t=e.content,n=this.parseRawMessage(t);if(this.isValidFileMessage(n))return null;var i=t.match(/<FileSize[\s]+[^<]*v=\"([\d]*?)\"[^<]/i),r=t.match(/<OriginalName[\s]+[^<]*v=\"([\s\S]*?)\"[^<]/);n.size=i?i[1]:"0",n.originalName=r?r[1]:null;var s=this._generateOutgoingModel(e);return s.type=o.MessageType.LwcFile,s.content=this.createFileContent(n),s},t}(n(17).default);t.FileMessageProcessor=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(17),a=n(46),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if("ThreadActivity/HistoryDisclosedUpdate"!==e.messagetype)return null;var t=new a.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return t.subscribeOnceToPersonsName(t._initiator),t._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id,i=document.createElement("p");return i.innerText=n,"false"===this._getUpdateValue(e)?o.swc.services.i18n.fetch("historyDisclosed",{participant:"<b>"+i.innerHTML+"</b>"}):o.swc.services.i18n.fetch("historyClosed",{participant:"<b>"+i.innerHTML+"</b>"})},t.prototype._getUpdateValue=function(e){var t=e.match(/<value>(.+)<\/value>/i);return t?t[1]:""},t}(s.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(9),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parseRawMessage=function(e){if(!e)return null;var t=e.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),i=e.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i),r=e.match(/<originalname[^>]*?\sv=\"([^"]+?)\"/i);if(!t)return null;var o=new c;return o.filename=r?r[1]:null,o.uri=s.MessageUtils.normalizeUrl(t[1]),o.uriObjectType=i?i[1]:null,o.xmmType=n?n[1].split(".")[0]:null,o},t.isValidImageMessage=function(e){return null===e||null===e.uri||!("Picture"===e.xmmType||"photo"===e.uriObjectType)},t.createImageContent=function(e){return'<LwcImage url="'+e.uri+'" filename="'+e.filename+'" ></LwcImage>'},t}return r(t,e),t.prototype.process=function(e){if("RichText/UriObject"!==e.messagetype)return null;var t=this.parseRawMessage(e.content);if(!t&&e.skypeeditedid)return this._createMessageModel(e);if(t&&""===t.uri)return e.content=null,this._createMessageModel(e);if(this.isValidImageMessage(t))return null;var n=this._createMessageModel(e);return n.type=o.MessageType.LwcImage,n.content=this.createImageContent(t),n},t.prototype.generate=function(e){if("RichText/UriObject"!==e.messagetype)return null;var t=this.parseRawMessage(e.content);if(this.isValidImageMessage(t))return null;var n=this._generateOutgoingModel(e);return n.type=o.MessageType.LwcImage,n.content=this.createImageContent(t),n},t}(n(17).default);t.default=a;var c=function(){return function(){}}()},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(17),a=n(46),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if("ThreadActivity/JoiningEnabledUpdate"!==e.messagetype)return null;var t=new a.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return t.subscribeOnceToPersonsName(t._initiator),t._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id,i=document.createElement("p");return i.innerText=n,"true"===this._getUpdateValue(e)?o.swc.services.i18n.fetch("joiningEnabled",{participant:"<b>"+i.innerHTML+"</b>"}):o.swc.services.i18n.fetch("joiningDisabled",{participant:"<b>"+i.innerHTML+"</b>"})},t.prototype._getUpdateValue=function(e){var t=e.match(/<value>(.+)<\/value>/i);return t?t[1]:""},t}(s.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(9),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if(e.messagetype!==o.MessageType.SystemMessage)return null;var t=s.MessageUtils.getMessageSanitizedContent(e.content);return this._createMessageModel(e,t,!0)},t}(n(17).default);t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(17),a=n(46),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/PictureUpdate"!==e.messagetype)return null;var n=new a.default(this._createMessageModel.bind(this),this._generateContent,e);if((n.subscribeOnceToPersonsName(n._initiator),t.conversation&&t.conversation.messages&&t.conversation.messages.length)&&t.conversation.messages[t.conversation.messages.length-1].timestamp<n._messageModel.timestamp){var i=this.getNewPicture(e.content);t.conversation.avatar=i||t.conversation.avatar}return n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id,n=document.createElement("p");return n.innerText=t,o.swc.services.i18n.fetch("threadPictureUpdated",{participant:"<b>"+n.innerHTML+"</b>"})},t.prototype.getNewPicture=function(e){var t=e.match(/URL@([^<]+)(?=<\/value>)/g);return t?t[0].replace("URL@",""):null},t}(s.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(0),a=n(17),c=n(46),u={admin:o.ParticipantRole.Admin,user:o.ParticipantRole.User},l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._updateParticipantRoles=function(e,t,n){var i=u[n.toLowerCase()];t.forEach(function(t){e.participants.forEach(function(e){var n=e.person.id;t.id===n&&(e.role=i)})})},t}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/RoleUpdate"!==e.messagetype)return null;var n=this._getRole(e.content),i=new c.default(this._createMessageModel.bind(this),this._generateContent.bind(this,n),e);return i.subscribeOnceToPersonsName(i._initiator),i._targets.forEach(i.subscribeOnceToPersonsName),t.conversation&&t.conversation.participants&&this._updateParticipantRoles(t.conversation,i._targets,n),i._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id,i=document.createElement("p");i.innerText=n;var r=t._targets[0].displayName||t._targets[0].id,o=document.createElement("p");return o.innerText=r,s.swc.services.i18n.fetch("roleUpdated",{who:"<b>"+i.innerHTML+"</b>",whom:"<b>"+o.innerHTML+"</b>",role:"<b>"+e+"</b>"})},t.prototype._getRole=function(e){var t=e.match(/<role>(.+)<\/role>/i);return t?t[1]:""},t}(a.default);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(39),a=n(0),c=n(9),u=n(36),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getTitle=function(e){var t=e.content.match(/<Title>(.*)<\/Title>/i);return t?t[1]:a.swc.services.i18n.fetch("s_title",{mesageType:e.messagetype})},t}return r(t,e),t.prototype.process=function(e){if("RichText/Media_Card"!==e.messagetype)return null;var t=this._getTitle(e),n=e.content.match(/<Swift b64="([^"]+)"\s*\/>/i);try{var i=u.b64DecodeUnicode(n[1]);i=c.MessageUtils.getMessageSanitizedContent(i),i=encodeURIComponent(i),e.content='<SwiftCard Swift="'+i+'">'+s.default.dompurify.sanitize(t,{ALLOWED_TAGS:[]})+"</SwiftCard>"}catch(e){return null}var r=this._createMessageModel(e);r.type=o.MessageType.SwiftCard;try{r.content=decodeURIComponent(e.content)}catch(e){return null}return r},t}(n(17).default);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(99),s=n(9),a=n(17),c=/<context reason=\"customAad\">.*<\/context>/g,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("RichText"!==e.messagetype&&"Text"!==e.messagetype&&"InviteFreeRelationshipChanged/Initialized"!==e.messagetype&&"RichText/Html"!==e.messagetype)return null;e.content||(e.content="");var n=e.content,i=n.match(c);i&&i[0]&&(n=n.replace(i[0],"")),e.content=n;var r=this._createMessageModel(e);return r.content=o.default.parse(r.content),r.content=s.MessageUtils.getMessageSanitizedContent(r.content,t),r},t.prototype.generate=function(e){return"RichText"!==e.messagetype&&"RichText/Html"!==e.messagetype?null:this._generateOutgoingModel(e)},t}(a.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(9),a=n(17),c=n(46),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/TopicUpdate"!==e.messagetype)return null;e.threadtopic&&t.conversation&&(t.conversation.topic=s.MessageUtils.parseTopic(e.threadtopic));var n=new c.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return n.subscribeOnceToPersonsName(n._initiator),n._messageModel},t.prototype._generateContent=function(e,t){var n=this.parseContentFor(e,"value");n=(n=n?s.MessageUtils.unescape(n):"")?s.MessageUtils.parseTopic(n):"";var i=t._initiator.displayName||t._initiator.id,r=document.createElement("p");r.innerText=i;var a=document.createElement("p");return a.innerText=n,o.swc.services.i18n.fetch("topicUpdated",{participant:"<b>"+r.innerHTML+"</b>",topic:"<i>"+a.innerHTML+"</i>"})},t}(a.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),s=n(4),a=n(0),c=n(17),u=["RichText/UriObject","RichText/Media_GenericFile","RichText/Media_Video","RichText/Media_FlikMsg","RichText/Media_Card","RichText/Contacts","RichText/Location","RichText/Files","RichText/Sms","Event/SkypeVideoMessage","Event/SkypeAudioMessage"],l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if(u.indexOf(e.messagetype)<0)return null;var t=e.content.match(/^<uriobject[^>]*?>(.*?)<\/uriobject>$/i);if(!t){var n=this._createMessageModel(e,a.swc.services.i18n.fetch("m_unsupported"));return n.type=s.MessageType.Unsupported,a.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",function(){n.content=a.swc.services.i18n.fetch("m_unsupported")}),n}var i=o.MessageUtils.getMessageSanitizedContent(t[1]);return this._createMessageModel(e,i)},t}(c.default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.DELIVERED="delivered",e.CLICK="click",e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(30),o=n(0);!function(e){e[e.replace=1]="replace"}(i=t.Rule||(t.Rule={}));var s=function(){function e(e,t,n){var i=this;this.pattern=e,this.rule=t,this.replace=function(e){return e.replace(i.pattern,i.replacer)},this.replacer=function(e){for(var t=e.length,n="",r=i.replacement;t--;)n+=r;return n},this.replacement=n}return Object.defineProperty(e.prototype,"replacement",{get:function(){return this.char?String.fromCharCode(this.char):void 0},set:function(e){this.char=e?e.charCodeAt(0):this.char},enumerable:!0,configurable:!0}),e}(),a=function(){function e(){var e=this;this.masks=[],this.setupProxy=function(){o.swc.Eventing.registerEvent("registerMask",function(t){e.register(t,i.replace,"#")}),o.swc.Eventing.registerEvent("unregisterMask",function(t){e.unregister(t)})},r.ProxyConnector.instance.connect("messageMasking",null,this.setupProxy)}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},Object.defineProperty(e.prototype,"empty",{get:function(){return!this.masks.length},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t,n){var i=this.masks.find(function(n){return n.pattern===e&&n.rule===t});i?i.replacement!==n&&(i.replacement=n):this.masks.push(new s(e,t,n))},e.prototype.unregister=function(e,t){this.masks.forEach(function(n,i,r){n.pattern!==e||t&&n.rule!==t||r.splice(i,1)})},e.prototype.shouldMask=function(e){if(this.empty)return!1;for(var t,n=0,i=this.masks;n<i.length;n++){var r=i[n];if(t=e.search(r.pattern)>-1)break}return t},e.prototype.process=function(e){return this.masks.forEach(function(t){return e=t.replace(e)}),e},e}();t.Masks=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(42),r=n(23),o=n(152),s=n(5),a=function(){function e(){var e=this;this.persons={},this.subscribedPresenceStatus={},this.subscribeToUserStatus=function(t,n){if(!t||!n)return Promise.resolve(!1);if(e.subscribedPresenceStatus[t])return Promise.resolve(!0);var i=function(){return delete e.subscribedPresenceStatus[t],Promise.resolve(!1)},o=n.bind(null,t);return e.subscribedPresenceStatus[t]=o,s.ServicesManager.initPromise.then(function(){return s.ServicesManager.signInManager.onceSignedIn().then(function(){var n=s.ServicesManager.signInManager.currentUserName,a=e.getMri(t);return s.ServicesManager.contactsService.getContact(n,a).then(function(t){if(!t)return!1;var n=e.getPerson(a);return n.subscribe("presenceStatus",o),s.ServicesManager.webApi.subscribeContactPresence(a),n.presenceStatus&&n.presenceStatus!==r.PresenceStatus.Undefined&&o(n.presenceStatus),!0},i)},i)},i)}}return e.prototype.getPerson=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=this.persons[e];if(!r){var a=i.default.normalizePersonId(e);r=this.persons[a]}var c=s.ServicesManager.mePerson,u=c&&(e===c.mri||e===c.id||e.indexOf(c.msaId)>-1);return!r&&c&&u&&(r=this.persons[c.mri],e=c.mri,u=!0,r||(r=c)),r||(r=this.persons[e]=new o.default(e,n,t)),r.isFilled||!t||u||r.fetchDisplayNameAndAvatar(),r},e.prototype.dispose=function(){var e=this;Object.getOwnPropertyNames(this.persons).forEach(function(t){e.persons[t].dispose()}),this.persons={},this.subscribedPresenceStatus={}},e.prototype.createEmptyPerson=function(e){var t=new o.default(e,!1,!1);return this.persons[t.id]=t,t},e.prototype.handlePresenceData=function(e,t){var n=this.getPerson(e),i=t.status;n.presenceStatus=i},e.prototype.unsubscribeFromUserStatus=function(e){if(!e||!this.subscribedPresenceStatus[e])return!1;var t=this.getMri(e);return this.getPerson(t).unsubscribe("presenceStatus",this.subscribedPresenceStatus[e]),delete this.subscribedPresenceStatus[e],!0},e.prototype.getUserStatus=function(e){var t=this;if(!e)return Promise.resolve(null);var n=function(){return Promise.resolve(null)};return s.ServicesManager.initPromise.then(function(){return s.ServicesManager.signInManager.onceSignedIn().then(function(){var i=s.ServicesManager.signInManager.currentUserName,o=t.getMri(e);return s.ServicesManager.contactsService.getContact(i,o).then(function(e){if(!e)return null;var n=t.getPerson(o);return n.presenceStatus&&n.presenceStatus!==r.PresenceStatus.Undefined?n.presenceStatus:s.ServicesManager.webApi.getUsersPresence([o]).then(function(e){var t=e[0];return t.Payload&&t.Payload.status})},n)},n)},n)},e.prototype.subscribeToMyStatus=function(e){var t=this;return s.ServicesManager.initPromise.then(function(){return s.ServicesManager.signInManager.onceSignedIn().then(function(){var n=s.ServicesManager.mePerson;return n.subscribe("presenceStatus",e),s.ServicesManager.webApi.subscribeContactPresence(n.mri),t.subscribedPresenceStatus[n.id]=e,!0},function(e){return Promise.resolve(!1)})},function(e){return Promise.resolve(!1)})},e.prototype.getMyStatus=function(){return s.ServicesManager.mePerson.presenceStatus},e.prototype.setMyStatus=function(e){return s.ServicesManager.webApi.setMyPresence(e).then(function(e){return e.ok?Promise.resolve(!0):Promise.resolve(!1)},function(e){return Promise.resolve(!1)})},e.prototype.getMri=function(e){return-1===e.indexOf("8:")?"8:"+e:e},e}();t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(1),a=n(325),c=n(326),u=n(19),l=n(11),p=n(12),d=n(26),f=n(15),h=n(38),g=n(327),m=n(33),v=n(0),y=n(55),_=n(183),b=n(21),w=n(111),C=n(131),S=n(328),T=n(32),E=n(5),P=n(329);n(330);var I="Please disable your popup blocker as it affects sign in/out process. Repeat the operation again after disabling the blocker.",k=2e4,M=function(){function e(e,t){var n=this;this.tokenProvider=e,this.regionGtmsProvider=t,this.tokenProviderCallback=function(){return Promise.all([n.tokenProvider(),n.regionGtmsProvider()]).then(function(e){var t=e[0],i=e[1];return{tokens:{skypeToken:t,expiresIn:n.getExiresIn(t)},regionGtms:i}})}}return e.prototype.getExiresIn=function(e){return(new _.TokenParser).getTokenData(e).exp-Math.floor(Date.now()/1e3)},e}(),O=function(e){function t(n,i,r,p,g){var m=e.call(this)||this;m.outerTokenProvider=n,m.tokenType=p,m._signOutContext=new P.default,m._reloginContext=new a.default(!1),m._tokenParser=new _.TokenParser,m._userIdentityType=d.IdentityType.UNDETERMINED,m._failedSilentLoginCount=0,m.isSilentLoginEnabled=!0,m.login=function(e){if(m._externalLogin&&"function"==typeof m._externalLogin)return m._externalLogin(),void m.sendSignedInTelemetry("","externalLogin");var t=s.Configuration.LOGIN_PAGE_URL;if(t+="?client_id="+s.Configuration.LOGIN_CLIENT_ID,t+="&redirect_uri="+encodeURI(b.UrlHelper.getConnectPagePath(v.swc.EcsConfig)),t+="&lang="+s.Configuration.LOCALE,t+="&response_type=token",m._getTokenPromise&&m._getTokenPromise.status===l.PromiseStatus.Pending){var n=m.showLoginPopup.bind(m,t,e);m._getTokenPromise.promise.then(null,n)}else m.showLoginPopup(t,e)},m.logout=function(e){if(m.outerTokenProvider)return Promise.resolve();if(m._signOutContext.signoutPromise)return m._signOutContext.signoutPromise;if(m.state===u.SigninState.SigningOut)return Promise.resolve();if(m.prelogoutActions.length>0){var t=m._logout.bind(m,e);return m._signOutContext.signoutPromise=m.execPrelogoutAction(m.prelogoutActions.pop()).then(t,t),m._signOutContext.signoutPromise}return m._signOutContext.signoutPromise=m._logout(e),m._signOutContext.signoutPromise},m._logout=function(e){if(m.state===u.SigninState.SigningOut)return Promise.resolve();var t=Date.now();m._reloginContext.canRelogin||m._reloginContext.setContext(m.activeConversationSdkMode===h.SDKMode.BOT,function(){return m.getGuestToken()});var n=s.Configuration.LOGOUT_PAGE_URL;n+="?",n+="&client_id="+s.Configuration.LOGIN_CLIENT_ID,n+="&redirect_uri="+b.UrlHelper.getConnectPagePath(v.swc.EcsConfig),n+="&redirect=true",n+="&response_type=token";var i=window.open(n,"_blank",s.Configuration.LOGOUT_POPUP_FEATURES),r=null==i;return r&&m._userIdentityType===d.IdentityType.SKYPE?(m.sendSignedOutTelemetry(e,t,!0),alert(I),Promise.resolve()):(!r&&window.focus&&i.focus(),m.state=u.SigninState.SigningOut,m.state=u.SigninState.SignedOut,m.reset(),m.sendSignedOutTelemetry(e,t),m._lastAuthSource=c.AuthSource.UserLogout,o.default.get.meId="",Promise.resolve())},m.execPrelogoutAction=function(e){var t=function(){if(m.prelogoutActions.length>0){var e=m.prelogoutActions.pop();return m.execPrelogoutAction(e)}return Promise.resolve()};e&&"function"==typeof e||t();var n=e();return n&&"function"==typeof n.then?n.then(t.bind(m),t.bind(m)):t()},m.getGuestToken=function(){if(m._guestUserPromise)return m._guestUserPromise;var e=Date.now();return m._guestUserPromise=S.getGuestToken("Guest").then(function(t){return m._userIdentityType=d.IdentityType.GUEST,m.setTokenDataToCache(t.SkypeToken,86400,!0),m.sendSignedInTelemetry(t.SkypeToken,"guest",e),m._signOutContext.reset(),t},function(t){m.sendSignedInTelemetry(void 0,"guest",e,t.message),m.clearUserDataFromCache(),m._guestUserPromise=null}),m._guestUserPromise},m.showLoginPopup=function(e,t){var n,i,r=Date.now(),o=m.state===u.SigninState.SignedOut,a=function(e){var s=/(?:access_token=)([\S]*)(?:&)(?:expires_in=)([\d*]*)/g.exec(e.data);if(s&&(n=s[1],i=s[2]),s||(n=e.data.token,i=Date.now()+864e5+""),!n)return m.state=u.SigninState.SignedOut,void window.removeEventListener("message",a);m._failedSilentLoginCount=0,o&&(m.currentUsername=n?m._tokenParser.retrieveMeName(n):"",m.setTokenDataToCache(n,parseInt(i,10),!1),m.publish("resurrect",!0),m._signOutContext.reset()),o?t&&t(n):(m._reloginContext.setContext(!0,function(){return m._userIdentityType=d.IdentityType.SKYPE,m.setTokenDataToCache(n,parseInt(i,10),!1),m.sendSignedInTelemetry(n,"popup",r),t&&t(n),Promise.resolve()}),m._signOutContext.reset(),m._signOutContext.isRelogin=!0,m.logout()),m._lastAuthSource=c.AuthSource.Popup,window.removeEventListener("message",a)};window.addEventListener("message",a,!1);var l=window.open(e,"_blank",s.Configuration.LOGIN_POPUP_FEATURES);l&&window.focus&&l.focus()},m.aadTokens={},m.aad=function(e){if(!m.outerTokenProvider)return Promise.reject("outerTokenProvider is not defined");e||(e=T.AadAudience.SpacesApi);var t=function(e){return m.outerTokenProvider(e).then(function(e){return-1===e.indexOf("Bearer")?"Bearer "+e:e})};return m.aadTokens[e]||(m.aadTokens[e]=t(e)),m.aadTokens[e].then(function(n){return function(e){var t=m._tokenParser.getTokenData(e),n=Date.now()+1e4;return t&&1e3*t.exp>n}(n)?n:(m.aadTokens[e]=t(e),m.aadTokens[e])})};var y=!o.default.get.frameless&&window!==window.top&&!!window.parent,w=!p||p!==C.TokenType.Aad,k=!w&&y;return m.isSilentLoginEnabled=w,m._onceSingedInPromise=new l.CancelablePromise,m._state=u.SigninState.SignedOut,k||(m.getSkypeToken=n||m._getSkypeToken),m._externalLogin=r,o.default.get.backend=p&&"aad"===p?f.MessagingBackend.TEAMS:f.MessagingBackend.SKYPE,k&&g&&(E.ServicesManager.cbl.skypeSignInManager.clearUserDataFromCache(),m.teamsRemoteTokenExchange=new M(g.skypetokenProvider,g.regionGtmsProvider),m.getSkypeToken=function(){return m._getSkypeTokenFromAad()}),m.outerTokenProvider?w?(m.clearUserDataFromCache(),m._getInfoFromExternalToken()):m._getSkypeTokenFromAad():i&&(m.clearUserDataFromCache(),m.setTokenDataToCache(i.skypeToken,i.expiresAt,i.isGuest),w?(m._userIdentityType=t._getUserIdentityType(i),m._lastAuthSource=c.AuthSource.WX):(m.teamsTokenPromise=Promise.resolve(i.skypeToken),m.currentUsername=m._tokenParser.retrieveMeName(i.skypeToken),m.state=u.SigninState.SignedIn,m._lastAuthSource=c.AuthSource.AAD,m._userIdentityType=d.IdentityType.SKYPE)),m.prelogoutActions=[],m}return r(t,e),t._getUserIdentityType=function(e){return e.isGuest?d.IdentityType.GUEST:"aad"===e.tokenType?d.IdentityType.TEAMS:d.IdentityType.SKYPE},t.prototype._getInfoFromExternalToken=function(){var e=this;o.default.get.backend=f.MessagingBackend.SKYPE,this.outerTokenProvider().then(function(t){e.currentUsername=t?e._tokenParser.retrieveMeName(t):"";var n=e._userId.indexOf("guest:")>-1;e.state=t?u.SigninState.SignedIn:u.SigninState.SignedOut,e._lastAuthSource=n?c.AuthSource.Guest:c.AuthSource.External,e._userIdentityType=n?d.IdentityType.GUEST:d.IdentityType.SKYPE,e.sendSignedInTelemetry(t,"external",Date.now())},function(){e.state=u.SigninState.SignedOut,e._lastAuthSource=c.AuthSource.External,e.sendSignedInTelemetry(null,"external",Date.now())})},t.prototype._getSkypeToken=function(){var e=this;if(o.default.get.backend=f.MessagingBackend.SKYPE,this._getTokenPromise&&this._getTokenPromise.status===l.PromiseStatus.Pending)return this._getTokenPromise.promise;this._lastAuthSource=c.AuthSource.UNDEFINED;var t=this.getTokenDataFromCache();if(t&&t.isGuest&&o.default.get.isSkypeOnly&&(t=null),o.default.get.isGuestOnlyMode&&t&&!t.isGuest&&(this.clearUserDataFromCache(),t=null),this._signedIn||!t||t.isGuest||(t=null),t)return this.currentUsername=this._tokenParser.retrieveMeName(t.token),this._userIdentityType=t.isGuest?d.IdentityType.GUEST:d.IdentityType.SKYPE,void 0===this._signedIn&&(this.sendSignedInTelemetry(t.token,"cache",Date.now()),this.callExternalHandler(this.externalSuccessCallback)),this._lastAuthSource=c.AuthSource.Cache,this.state=u.SigninState.SignedIn,Promise.resolve(t.token);this.state=u.SigninState.SigningIn,this.clearUserDataFromCache();var n=new Promise(function(t,n){var i=e;function r(e){i.activeConversationSdkMode===h.SDKMode.BOT?(i.state!==u.SigninState.SignedIn&&(i.state=u.SigninState.SigningIn),i.getGuestToken().then(function(e){i.currentUsername=i._tokenParser.retrieveMeName(e.SkypeToken),i.state=u.SigninState.SignedIn,t(e.SkypeToken),i.callExternalHandler(i.externalSuccessCallback),i._lastAuthSource=c.AuthSource.Guest}).catch(function(e){i.clearUserDataFromCache(),i.callExternalHandler(i.externalFailureCallback,i.formatError(e)),i._guestTokenRetryInterval||(i._guestTokenRetryInterval=new w.FixedTimeout(r.bind(i),k)),i._guestTokenRetryInterval.start()})):(i.state=u.SigninState.SignedOut,n(),i.callExternalHandler(i.externalFailureCallback,i.formatError(e)))}e.state!==u.SigninState.SignedIn&&(e.state=u.SigninState.SigningIn),o.default.get.isGuestOnlyMode?r():e.silentLogin().then(function(e){this.state=u.SigninState.SignedIn,this.currentUsername=this._tokenParser.retrieveMeName(e),t(e),this.callExternalHandler(this.externalSuccessCallback),this._lastAuthSource=c.AuthSource.SilentLogin}.bind(e),function(e){return o.default.get.isSkypeOnly?(i.state=u.SigninState.SignedOut,i.callExternalHandler(i.externalFailureCallback),n()):r(e)}.bind(e))});return this._getTokenPromise=new l.CancelablePromise(n),this._getTokenPromise.promise},t.prototype.onceSignedIn=function(){return this.getSkypeToken().then(null,function(){}),this._onceSingedInPromise.promise},t.prototype.getLastAuthSource=function(){return this._lastAuthSource},Object.defineProperty(t.prototype,"lastAuthSource",{get:function(){return this._lastAuthSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTrusted",{get:function(){return this._signedIn&&!y.isInIframe()||!!this.outerTokenProvider||s.Configuration.ECS.enableExtendedFrameApiOn.indexOf(document.referrer)>-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){if(e===u.SigninState.SignedIn&&(this._lastSignedInTimestamp=Date.now()),e!==this._state){this._state=e,this._signedIn=this._state===u.SigninState.SignedIn,this.publish("state",e),this.publish("isSignedIn",this._signedIn);var t=this._onceSingedInPromise.status===l.PromiseStatus.Pending;this._signedIn&&t?this._onceSingedInPromise.resolve():this._state!==u.SigninState.SignedOut||t||(this._onceSingedInPromise=new l.CancelablePromise)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userIdentityType",{get:function(){return this._userIdentityType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentUsername",{set:function(e){this._userId=e,o.default.get.meId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentUserName",{get:function(){return this._userId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSignedIn",{get:function(){return this._signedIn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reloginContext",{get:function(){return this._reloginContext},enumerable:!0,configurable:!0}),t.prototype.checkAuthFailuresCount=function(e){e>=3&&this.clearUserDataFromCache()},t.prototype.setExternalCallbacks=function(e,t){this.externalSuccessCallback=e,this.externalFailureCallback=t,this._state===u.SigninState.SignedIn&&this.callExternalHandler(this.externalSuccessCallback)},t.prototype.getTokenExpirationTime=function(){var e=this.getTokenDataFromCache();return e&&e.expiresAt},t.prototype.sendSignedInTelemetry=function(e,t,n,i){this.currentUsername=e?this._tokenParser.retrieveMeName(e):"",v.swc.Telemetry.sendEvent.signIn(e?200:500,t,n?Date.now()-n:-1,i)},t.prototype.sendSignedOutTelemetry=function(e,t,n){v.swc.Telemetry.sendEvent.signOut(n?500:200,e,t?Date.now()-t:-1,n?"Popup is blocked":void 0)},t.prototype.getRegistrationToken=function(){var e,t=v.swc.services.sessionStorage.getItem(m.SKYPE_REGTOKEN_KEY);if(t)try{e=JSON.parse(t)}catch(e){}return e},t.prototype.getTokenDataFromCache=function(){if(!this._tokenData)try{this._tokenData=JSON.parse(v.swc.services.sessionStorage.getItem(m.SKYPE_TOKEN_KEY))}catch(e){return this.clearUserDataFromCache(),null}return this._tokenData&&(this._tokenData=this.isTokenValid(this._tokenData)?this._tokenData:null),this._tokenData},t.prototype.isTokenValid=function(e){var t=this.getRegistrationToken();return!(t&&!t.value&&t.failureCount>=3)&&(!(e.expiresAt<Date.now())&&(this._userIdentityType===d.IdentityType.SKYPE&&this.activeConversationSdkMode===h.SDKMode.PERSON&&e.isGuest?(this._tokenData=null,this.clearUserDataFromCache(),!1):!(this._userIdentityType===d.IdentityType.GUEST&&this.activeConversationSdkMode===h.SDKMode.BOT&&!e.isGuest)||(this._tokenData=null,this.clearUserDataFromCache(),!1)))},t.prototype.setTokenDataToCache=function(e,t,n){var i=this,r=0;t&&(r=Date.now()+1e3*t,this._tokenRenovationTimeout&&this._tokenRenovationTimeout.reset(),this._tokenRenovationTimeout=new w.FixedTimeout(function(){o.default.get.backend===f.MessagingBackend.TEAMS?(i.teamsTokenPromise=null,i._getSkypeTokenFromAad()):n?i.getGuestToken():i.silentLogin()},1e3*Math.abs(t-60)),this._tokenRenovationTimeout.start()),v.swc.services.sessionStorage.setItem(m.SKYPE_TOKEN_KEY,JSON.stringify({token:e,expiresAt:r,isGuest:n}))},t.prototype.clearUserDataFromCache=function(){this._tokenData=null,v.swc.services.sessionStorage.removeItem(m.SKYPE_TOKEN_KEY),v.swc.services.sessionStorage.removeItem(m.SKYPE_REGTOKEN_KEY),v.swc.services.sessionStorage.removeItem(m.SKYPE_ENDPOINT_ID_KEY),v.swc.services.sessionStorage.removeItem(m.SKYPE_HAS_HISTORY_KEY)},t.prototype.silentLogin=function(){var e=this;if(!this.isSilentLoginEnabled)return Promise.reject("Silent login is disabled");if(this._silentLoginPromise)return this._silentLoginPromise;var t=Date.now();return this._silentLoginPromise=new Promise(function(n,i){var r={client_id:s.Configuration.LOGIN_CLIENT_ID,env:"live",callback:function(r){var o,s=function(i){e.sendSignedInTelemetry(i,"silent",t),e._silentLoginPromise=null,n(i)};try{o=JSON.parse(r.data)}catch(e){o=r.data?r.data:r}o.error?(o.error,"invalid_grant"===o.error&&e.clearUserDataFromCache(),e._failedSilentLoginCount<1&&e.sendSignedInTelemetry(void 0,"silent",t,o.error),e._failedSilentLoginCount++,e._silentLoginPromise=null,i(o.error)):o.token?(e.setTokenDataToCache(o.token,o.expires_in,!1),s(o.token)):o.skypetoken&&(e.setTokenDataToCache(o.skypetoken,o.expires_in,!1),s(o.skypetoken)),i(new Error("Neither token nor skypeToken in the response"))}};v.SKYPE.login.Silent.init(r).load()}),this._silentLoginPromise},t.prototype.callExternalHandler=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e&&"function"==typeof e)try{e.apply(null,[].slice.call(arguments,1))}catch(e){}},t.prototype.formatError=function(e){var t;return e instanceof Error?t=Object.create(e):"string"==typeof e?t=new Error(e):(t=new Error("Unknown: please check *data* property for more info")).data=e,t.name="SWCApi:signin:"+t.name,t},t.prototype.reset=function(){this.clearUserDataFromCache(),this._signOutContext.reset(),this._guestUserPromise=null,this._silentLoginPromise=null,this._signedIn=!1,this._tokenData=null,this.currentUsername="",this._getTokenPromise&&this._getTokenPromise.status===l.PromiseStatus.Pending&&this._getTokenPromise.cancel(),this._getTokenPromise=null,this._aad=null,this._tokenRenovationTimeout&&(this._tokenRenovationTimeout.reset(),this._tokenRenovationTimeout=null)},t.prototype.isAadSupported=function(){return!!this.outerTokenProvider&&this.tokenType===C.TokenType.Aad},t.prototype.setTeamsUrls=function(e){e&&(s.Configuration.CHAT_HOST_URL=e.chatService+"/v1/",s.Configuration.CHAT_GUEST_HOST_URL=e.chatService+"/v1/",s.Configuration.AMS_HOST_URL=e.ams+"/v1/",s.Configuration.AVATAR_SERVICE_URL=e.mtImageService,s.Configuration.TEAMS_MIDDLE_TIER_URL=e.middleTier)},t.prototype._signInWithAadSkypetokens=function(e,t){void 0===t&&(t=!1),this.setTeamsUrls(e.regionGtms),o.default.get.backend=f.MessagingBackend.TEAMS,this.setTokenDataToCache(e.tokens.skypeToken,e.tokens.expiresIn,t),this.currentUsername=this._tokenParser.retrieveMeName(e.tokens.skypeToken),this.state=e.tokens.skypeToken?u.SigninState.SignedIn:u.SigninState.SignedOut,this._lastAuthSource=c.AuthSource.AAD,this._userIdentityType=d.IdentityType.SKYPE,this.sendSignedInTelemetry(e.tokens.skypeToken,"aad",Date.now())},t.prototype._getSkypeTokenFromAad=function(){var e=this;return this.teamsTokenPromise?this.teamsTokenPromise:this.teamsRemoteTokenExchange?(this.teamsTokenPromise=this.teamsRemoteTokenExchange.tokenProviderCallback().then(function(t){return e._signInWithAadSkypetokens(t),t.tokens.skypeToken}),this.teamsTokenPromise):(this.teamsTokenPromise=new Promise(function(t,n){var i=function(t){e.clearUserDataFromCache(),e.state=u.SigninState.SignedOut,e.sendSignedInTelemetry(null,"aad",Date.now()),n()};e.outerTokenProvider(T.AadAudience.SpacesApi).then(function(n){-1===n.indexOf("Bearer")&&(n="Bearer "+n),g.default.exchangeForSkypeToken(n).then(function(n){n.json?n.json().then(function(n){n.tokens?(e.setTeamsUrls(n.regionGtms),e.setTokenDataToCache(n.tokens.skypeToken,n.tokens.expiresIn,!1),e.currentUsername=e._tokenParser.retrieveMeName(n.tokens.skypeToken),e.state=n.tokens.skypeToken?u.SigninState.SignedIn:u.SigninState.SignedOut,e._lastAuthSource=c.AuthSource.AAD,e._userIdentityType=d.IdentityType.SKYPE,e.sendSignedInTelemetry(n.tokens.skypeToken,"aad",Date.now()),t(n.tokens.skypeToken)):i()},i):i()},i)},function(e){})}),this.getSkypeToken=this._skypeTokenBasedOnAad.bind(this),this.teamsTokenPromise)},t.prototype._skypeTokenBasedOnAad=function(){var e=this;return this.teamsTokenPromise.then(function(t){var n=Date.now()+6e4;return e.getTokenExpirationTime()<=n?(e.teamsTokenPromise=void 0,e._getSkypeTokenFromAad()):t})},t}(p.default);t.default=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=this;this.execCallback=function(){if(n._callback){var e=n.reset.bind(n);return n._callback().then(e,e)}return n.reset(),Promise.resolve()},this.reset=function(){n._callback=null,n._toRelogin=!1},this.setContext(e,t)}return e.prototype.setContext=function(e,t){this._toRelogin=e,this._callback=t},Object.defineProperty(e.prototype,"canRelogin",{get:function(){return this._toRelogin},enumerable:!0,configurable:!0}),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.Cache=10]="Cache",e[e.SilentLogin=20]="SilentLogin",e[e.Popup=30]="Popup",e[e.Guest=40]="Guest",e[e.UserLogout=50]="UserLogout",e[e.External=60]="External",e[e.WX=70]="WX",e[e.AAD=80]="AAD"}(t.AuthSource||(t.AuthSource={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o={retryCount:3,timeout:12e4,policy:""},s=function(){function e(){}return e.exchangeForSkypeToken=function(e){var t={method:"post",headers:{Authorization:e,"x-ms-client-type":"web","x-ms-user-type":"user"}};return r.default("teams-exchange",o,i.Configuration.TEAMS_AUTH_URL+"/authz",t)},e.fetchGuestTokenForTenant=function(e){var t={method:"post",body:JSON.stringify({tenantId:e})};return r.default("teams-anonymout",o,i.Configuration.TEAMS_AUTH_URL+"/authz/visitor",t)},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o={retryCount:3,timeout:12e4,policy:""};t.getGuestToken=function(e){var t={name:e};return new Promise(function(e,n){(function(e,t,n){var s={};s.method=e,s.body=JSON.stringify(n);var a=new Headers;return a.append("Content-Type","application/json"),a.append("X-Skype-Caller",i.Configuration.getUiVersion()),s.headers=a,r.default("scom-invite",o,i.Configuration.INVITE_HOST_URL+t,s)})("POST","users/guests/lwc",t).then(function(t){t.json().then(function(t){e(t)}).catch(function(e){n(e)})},function(e){n(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.isRelogin=!1}return e.prototype.reset=function(){this.isRelogin=!1,this.signoutPromise=null},e}();t.default=i},function(e,t){!function(){"use strict";var e,t,n,i,r,o,s,a,c,u,l,p,d,f,h,g,m,v,y;void 0===window.SKYPE&&(window.SKYPE={}),window.SKYPE.login=window.SKYPE.login||{},window.SKYPE.login.Silent=(n={qa:"https://a.qa.lw.skype.net",live:"https://a.lw.skype.com"},i=null,r={},o=null,s=null,a="",c=!1,u=!1,l=null,p={env:"live",client_id:null,redirect_uri:null},d=function(e,t){if(null===l&&(l=window.location.host.match(/^(pre|dev|qa).*\.net$/)||document.cookie.indexOf("debug")>-1||window.location.search.indexOf("debug")>-1),l)try{if("object"==typeof t){var n=[];for(var i in t)"skypetoken"===i?n.push(i+": <HIDDEN>"):n.push(i+": "+JSON.stringify(t[i]));e+=" - "+n.join(", ")}else"string"==typeof t&&(e+=" - "+t);e="[silentlogin.js] - "+e}catch(e){}},f=function(e){if(d("Received message from "+e.origin),s&&e.origin===s){var t=e.data;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(e){}d("Message data",t);var n=t.state||null;if(a===n){for(var i in window.clearTimeout(o),r={},t)t.hasOwnProperty(i)&&(r[i]=t[i]);g()}else d("State "+n+" doesn't match the last submitted state "+a)}},h=function(){i&&(e.removeChild(i),i=null)},g=function(){d("Calling callback function",r),u=!1,"function"==typeof t&&t(r)},m=function(){h(),(r={}).error="timeout",g()},v=function(){var e=(new Date).getTime(),t=n;a="silentloginsdk_"+e;var i={response_type:"postmessage",client_id:p.client_id,partner:"999",redirect_uri:p.redirect_uri,state:a,_accept:"1.0",_nc:e};return(s=t[p.env]||t.live)+"/login/silent?"+function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(i)},{init:function(e){if("object"==typeof e)for(var t in(e=e||{}).hasOwnProperty("callback")&&y(e.callback),p)e.hasOwnProperty(t)&&(p[t]=e[t]);return c||(c=!0,window.addEventListener?window.addEventListener("message",f,!1):window.attachEvent("onmessage",f)),this},setCallback:y=function(e){return"function"==typeof e&&(t=e),this},load:function(){if(!u){if(function(){if(!p.client_id)throw"[silentlogin.js] client_id not initialized. Call init() first.";p.redirect_uri||(p.redirect_uri=window.location.protocol+"//"+window.location.host+window.location.pathname)}(),u=!0,!("postMessage"in window&&"object"==typeof JSON&&JSON.parse))return r={error:"unsupported_browser"},void g();var t;window.clearTimeout(o),o=window.setTimeout(m,2e4),t=v(),h(),void 0===e&&(e=document.body||document.head||document.getElementsByTagName("head")[0]),(i=document.createElement("iframe")).frameBorder=0,i.width="1px",i.height="1px",i.style.display="none",i.style.visibility="hidden",i.id="silentLoginFrame"+Math.floor(10*Math.random()+1),i.setAttribute("src",t),e.appendChild(i),d("Created iFrame: "+t)}},getSkypetoken:function(){return r.skypetoken||null},getFullResponse:function(){return r}})}()},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(47),o=n(0),s=n(56),a=n(102),c=n(87),u=function(){function e(e){this._callInfo=e}return Object.defineProperty(e.prototype,"callId",{get:function(){return this._callInfo.callId},enumerable:!0,configurable:!0}),e.prototype.getNotification=function(){var t=new c.Notification("Calling");return t.title=this._callInfo.displayName||"",t.description="Incoming call",t.avatarUrl=this._callInfo.avatar,t.callInfo=this._callInfo,t.actionsInformation=e.getActionsInformation(),t},e.getActionsInformation=function(){return{accept:{title:o.swc.services.i18n.fetch("open"),description:o.swc.services.i18n.fetch("accept_descr")},ignore:{title:o.swc.services.i18n.fetch("ignore"),description:o.swc.services.i18n.fetch("ignore_descr")}}},e.getActions=function(e,t){return[{type:"Accept",title:e.actionsInformation.accept.title,description:e.actionsInformation.accept.description,action:function(){var n=e.callInfo.mri;(a.isEnterpriseUserMri(n)?a.generateOneToOneConversationId(n):Promise.resolve(n)).then(function(a){var c=i({},t,{ConversationId:a||""}),u={id:e.callInfo.callId,accept:!0,callerMri:n||""};s.default.startChat(a,c,!1,r.OpenChatOrigin.NOTIFICATION,u),o.swc.Telemetry.sendEvent.notificationAction("Calling","Accept")})}},{type:"Ignore",title:e.actionsInformation.ignore.title,description:e.actionsInformation.ignore.description,action:function(){var t={id:e.callInfo.callId,reject:!0,callerMri:e.callInfo.callerMri||""};o.swc.Eventing.triggerEvent("rejectCall",t),o.swc.Telemetry.sendEvent.notificationAction("Calling","Ignore")}}]},e}();t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=n(0),a=n(90),c=n(5),u=n(87),l=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/,p=function(e){function t(n){var i=e.call(this,"Summary")||this;return i.description=s.swc.services.i18n.fetch("notification_summary",{count:n.length}),i.avatarUrl=i.getSummaryAvatar(n)||o.Configuration.DEFAULT_AVATAR_URI,t.isEnabled=!1,t.setIgnoreToStorage(),i.actionsInformation=t.getActionsInformation(),i}return r(t,e),t.prototype.getSummaryAvatar=function(e){var t=e.filter(function(e){return!e.isGroup}),n=t.length>0?t[0]:e[0];if(n.avatar&&n.avatar.match(l))return n.avatar;var i=n.isGroup?void 0:n.id.replace(/^\d+:/,""),r=i?encodeURIComponent(i):"thread",o="https://avatar.skype.com/v1/"+"avatars/${contactId}/public?returnDefaultImage=false&cacheHeaders=true".replace("${contactId}",r);return o=o.replace("returnDefaultImage=false","returnDefaultImage=true")},t.getActionsInformation=function(){return{accept:{title:s.swc.services.i18n.fetch("open"),description:s.swc.services.i18n.fetch("open_client_descr")},ignore:{title:s.swc.services.i18n.fetch("ignore"),description:s.swc.services.i18n.fetch("ignore_summary_notificaton_descr")}}},t.getActions=function(e){return[{type:"Accept",title:e.actionsInformation.accept.title,description:e.actionsInformation.accept.description,action:function(){s.swc.Eventing.triggerEvent("openRecentList"),s.swc.Telemetry.sendEvent.notificationAction("Summary","Accept")}},{type:"Ignore",title:e.actionsInformation.ignore.title,description:"",action:function(){s.swc.Telemetry.sendEvent.notificationAction("Summary","Ignore")}}]},t.setIgnoreToStorage=function(){try{var e=60*(o.Configuration.ECS.sumToastDelayMin||0)*1e3,t={ignoreUntil:Date.now()+(0===e?864e5:e),id:a.hashCode(c.ServicesManager.signInManager.currentUserName)};c.ServicesManager.localStorage.setItem("swc|notificationIgnore",JSON.stringify(t))}catch(e){}},t.isIgnored=function(){try{var e=c.ServicesManager.localStorage.getItem("swc|notificationIgnore"),t=a.hashCode(c.ServicesManager.signInManager.currentUserName);if(e){var n=JSON.parse(e);if(!n.id||n.id!==t)return c.ServicesManager.localStorage.removeItem("swc|notificationIgnore"),!1;if(!n.ignoreUntil||isNaN(n.ignoreUntil))return!1;if(n.ignoreUntil>Date.now())return!0}return!1}catch(e){return!1}},t.isEnabled=!0,t}(u.Notification);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(162),o=n(163),s=function(){function e(){this.freshUnreadConversations={}}return e.prototype.getNotification=function(e,t){if(!this.canShow(e,t))return null;if(!this.isAllowedByUnread(e)){if(3===this.freshUnreadConversations[e.id]){var n=Object.getOwnPropertyNames(this.freshUnreadConversations).map(function(e){return i.ServicesManager.conversations.get(e)});return new r.default(n,e)}return null}var s=new o.UnreadMessageNotification(e,t);return s&&s.description?s:null},e.prototype.canShow=function(e,t){return!e.isBlocked&&(e.isUnread&&!e.alertsOff)},e.prototype.isAllowedByUnread=function(e){var t=this;if(!this.freshUnreadConversations.hasOwnProperty(e.id)){var n=function(i){i||(delete t.freshUnreadConversations[e.id],e.unsubscribe("isUnread",n))};return e.subscribe("isUnread",n),this.freshUnreadConversations[e.id]=0,!0}return this.freshUnreadConversations[e.id]++,this.freshUnreadConversations[e.id]<3},e}();t.default=s},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function e(t){var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(t[i]);this.soundsArr=n.map(e.loadSound)}return e.loadSound=function(t){var n=new Audio(e.getSoundPath(t));return n.preload="auto",{fileName:t,audioObject:n}},e.getSoundPath=function(e){return i.Configuration.ECS.domain+"/assets/sounds/"+e},e.prototype.getSound=function(e){for(var t=0,n=this.soundsArr;t<n.length;t++){var i=n[t];if(i.fileName===e)return i.audioObject}return null},e.prototype.play=function(e,t){var n=this;return void 0===t&&(t=!0),new Promise(function(i){var r=n.getSound(e);null!==r&&(r.loop=t,r.onended=function(){return i()},r.play())})},e.prototype.playOnce=function(e){return this.play(e,!1)},e.prototype.stop=function(e){var t=this.getSound(e);null!==t&&(t.pause(),t.currentTime=0)},e.prototype.stopAll=function(){var e=this;this.soundsArr.forEach(function(t){return e.stop(t.fileName)})},e}();t.SoundPlayer=r},,,,,,,,,,,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(43),c=n(25),u=n(104),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onFadeElementChange=function(e){return t._fadeElement=e},t._onConfirmClick=function(e){t.confirmAction()},t._onCancelClick=function(e){t.props.dialogContent.cancel.action()},t._onFadeClick=function(e){e.target===t._fadeElement&&t._onCancelClick(e)},t._onKeyDown=function(e){a.default.getKeyCode(e)===c.default.ESCAPE&&t._onCancelClick(e)},t}return r(t,e),t.prototype.confirmAction=function(){this.props.dialogContent.confirm.action()},t.prototype.render=function(){var e=this.props.dialogContent.cancel.title,t=this.props.dialogContent.confirm.title,n=this.props.dialogContent.title;return s.createElement("div",{className:"swcDialog__backdrop",ref:this._onFadeElementChange,onClick:this._onFadeClick,onKeyDown:this._onKeyDown},s.createElement(u.Modality,{id:"dialog",accessibilityLabel:n},s.createElement("div",{className:"swcDialog",role:"dialog","data-test-id":"swcDialog__test"},s.createElement("div",{className:"swcDialog__contentContainer"},s.createElement("h1",{className:"swcDialog__title"},n),this.getContentElement()),s.createElement("div",{className:"swcDialog__buttons"},s.createElement("button",{className:"swcDialog__actionButton swcDialog__actionButton_confirm",title:t,onClick:this._onConfirmClick},t),s.createElement("button",{className:"swcDialog__actionButton swcDialog__actionButton_cancel",title:e,onClick:this._onCancelClick},e)))))},t}(o.Component);t.SwcDialog=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),a=n(2),c=n(103),u=n(79),l=n(0),p=n(60),d=n(439),f=n(139),h=n(128),g=n(41),m=n(14),v=n(440),y=n(442),_=function(e,t){return l.swc.services.i18n.fetch(e,t)},b=function(e){function t(t){var n=e.call(this,t)||this;return n._trackedItemFields=["isUnread","alertsOff","isBlocked","lastMessage","hasOngoingGroupCall","topic"],n.updateItemState=function(e,t){switch(e){case"isUnread":n.setState(function(e){return{classNamesMap:o({},e.classNamesMap,{unread:t})}}),n.props.onRecentItemChange(n.props.item);break;case"alertsOff":n.setState(function(e){return{classNamesMap:o({},e.classNamesMap,{muted:t})}});break;case"isBlocked":n.setState(function(e){return{classNamesMap:o({},e.classNamesMap,{blocked:t})}}),n.props.onBlockedItemChange(n.props.item,t);break;case"lastMessage":n.props.item.lastMessageChanged&&(n.subscribeToLatestMessageContent(t),n.props.onRecentItemChange(n.props.item),n.updateItemState("updateCallButtons"));break;case"updateCallButtons":case"hasOngoingGroupCall":n.setState({showCallBackBtn:n._shouldShowCallBackButton(),showJoinBtn:n._shouldShowJoinCallButton()});break;case"topic":n.props.onRecentItemChange(n.props.item)}},n.initTrackedFieldsSubscriptions=function(){n._trackedItemFields.forEach(function(e){return n.props.item.subscribe(e,function(t){return n.updateItemState(e,t)})}),n.props.item.lastMessage&&n.subscribeToLatestMessageContent(n.props.item.lastMessage),n.props.item.isPerson&&(l.swc.services.signInManager.isAadSupported()?l.swc.services.webApi.subscribeContactPresence(n.props.item.withPerson.mri):l.swc.services.webApi.subscribeContactPresence(n.props.item.id))},n.subscribeToLatestMessageContent=function(e){e.subscribe("content",function(){return n.props.onRecentItemChange(n.props.item)}),e.subscribe("isDeleted",function(){return n.props.onRecentItemChange(n.props.item)})},n.openContextMenu=function(e){if(!e.target)return null;var t=f.default.createMenuList(n.props.menuGroup(n.props.item),"recentItemActionsMenuList");e.preventDefault(),e.stopPropagation(),h.default.add(e,n.props.parentElement,t,h.BubbleType.List,h.BubblePosition.onContextMenu)},n._shouldShowCallBackButton=function(){var e=n.props.item.lastMessage,t=(new Date).getTime()-e.originalTimestamp.getTime()>864e5;return!l.swc.services.mePersonManager.isMe(e.senderId)&&!n.props.item.isPstn&&n.props.isCallingReady&&"SystemMessage"===e.type&&"MissedCallMsg"===e.customType&&!t},n._shouldShowJoinCallButton=function(){return!n.props.item.isPstn&&n.props.item.isGroup&&n.props.item.hasOngoingGroupCall&&!n.props.isInCall},n._onItemClick=function(e){e.stopPropagation(),e.preventDefault(),n.props.onClick&&n.props.onClick(),n.props.item.action&&n.props.item.action(n.props.item)},n._onCallBackBtnClick=function(e){n.props.item.startAudioCall(),l.swc.Telemetry.sendEvent.userAction(u.UserActionType.CallBack),e.preventDefault()},n._onJoinBtnClick=function(e){n.props.item.joinGroupAudioCall(),e.preventDefault()},n.state={showCallBackBtn:!1,showJoinBtn:!1,classNamesMap:{item:!0,unread:t.item.isUnread,muted:t.item.alertsOff,blocked:t.item.isBlocked}},n}return r(t,e),t.prototype.componentDidMount=function(){var e=this;this._lowPriorityTimeout=setTimeout(function(){e.updateItemState("updateCallButtons"),e.initTrackedFieldsSubscriptions()},0)},t.prototype.componentDidUpdate=function(e){e.isInCall===this.props.isInCall&&e.isCallingReady===this.props.isCallingReady||this.setState({showCallBackBtn:this._shouldShowCallBackButton(),showJoinBtn:this._shouldShowJoinCallButton()})},t.prototype.componentWillUnmount=function(){var e=this;clearTimeout(this._lowPriorityTimeout),this._trackedItemFields.forEach(function(t){return e.props.item.unsubscribe(t,e.updateItemState)}),this.props.item.isPerson&&(l.swc.services.signInManager.isAadSupported()?l.swc.services.webApi.unsubscribeContactPresence(this.props.item.withPerson.mri):l.swc.services.webApi.unsubscribeContactPresence(this.props.item.id))},t.prototype.render=function(){var e=this.props.item,t=e.lastMessage,n=t.isDeleted?null:t.timestamp,i=!(!this.state.showCallBackBtn&&!this.state.showJoinBtn);return a.createElement(p.AccessibleListItem,null,a.createElement(c.I18nContextComponent,null,a.createElement("div",{style:this.props.style,onClick:this._onItemClick,onContextMenu:this.openContextMenu,className:d.getClassNameFromMap(this.state.classNamesMap),tabIndex:0,role:i?"group":"button"},a.createElement(g.SwcRecentAvatar,{item:e}),a.createElement("div",{role:"none",className:"swcRecentItem__contentContainer"},a.createElement("p",{role:i?"button":void 0,className:"swcRecentItem__title"},e.topic),a.createElement(v.SwcMessagePreview,{className:"swcRecentItem__messagePreview",message:t})),this.state.showCallBackBtn&&a.createElement("div",{role:"none",className:"swcRecentItem__callButtonWrapper"},a.createElement("button",{className:"swcRecentItem__callButton swcRecentItem__callButton--callBack",onClick:this._onCallBackBtnClick},_("button_call_back"))),this.state.showJoinBtn&&a.createElement("div",{role:"none",className:"swcRecentItem__callButtonWrapper"},a.createElement("button",{className:"swcRecentItem__callButton swcRecentItem__callButton--join",onClick:this._onJoinBtnClick},_("button_join"))),a.createElement("div",{role:"none",className:"swcRecentItem__infoContainer"},a.createElement(y.SwcTimestamp,{className:"swcRecentItem__timestamp",date:n}),a.createElement("div",{role:"none",className:"swcRecentItem__icons"},e.alertsOff&&a.createElement(m.SwcIcon,{className:"swcRecentItem__icon swcRecentItem__icon_muted",type:m.SwcIconType.NotificationOff,dataTestId:"swcRecentItem__icon_muted_test"}),e.isSfB&&a.createElement(m.SwcIcon,{className:"swcRecentItem__icon swcRecentItem__icon_sfb",type:m.SwcIconType.IconSkypeForBusiness,dataTestId:"swcRecentItem__icon_sfb_test"}))))))},t}(s.Component);t.default=b},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.NONE="none",e.UIONLY="uionly",e.FULL="full",e.HIDDEN="hidden",e}();t.PreloadType=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.findRecentConversationIdForMembers=function(e){return new Promise(function(t,n){return function(e,t,n){i.swc.services.webApi.fetchRecentConversations().then(function(i){var r;i.conversations.sort(function(e,t){return e.id.localeCompare(t.id)}).some(function(t){var n=2===e.length&&t.isOneOnOne,i=e.length>2&&!t.isOneOnOne;if(t.members&&t.members.length===e.length&&(n||i)){var o=!0;if(e.forEach(function(e){var n;o=o&&(n=e.id,1===t.members.filter(function(e){return e.id===n}).length)}),o)return r=t.id,!0}return!1}),r?t(r):n()})}(e,t,n)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(185);t.createConfirmationDialog=function(e,t,n,r){return{title:e,text:t,confirm:{title:n.title,action:function(e){n.action&&n.action(e),i.ConfirmationDialog.remove()}},cancel:{title:r.title,action:function(){r.action&&r.action(),i.ConfirmationDialog.remove()}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(21),o=function(){function e(){}return e.isDomainIn=function(e){var t=window.swc.EcsConfig[e];if(!t)return!1;var n=this.getHost();return Array.isArray(t)?t.some(function(e){return e.toLowerCase()===n.toLowerCase()}):"true"===t.toLowerCase},e.getHost=function(){return i.default.get.host?i.default.get.host:r.UrlHelper.getHost()},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(347);t.SwcDialog=i.SwcDialog;var r=n(432);t.SwcBlockDialog=r.SwcBlockDialog;var o=n(435);t.SwcTextDialog=o.SwcTextDialog},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(443),o=function(){function e(){}return e.isToday=function(e){var t=r.getCurrentDate();return t.setHours(0,0,0,0),e.getTime()>t.getTime()},e.isWithinSevenDays=function(e){var t=e.getTime(),n=r.getCurrentDate().getTime();return t>=new Date(n-6048e5).getTime()},e.getDifferenceForLastHour=function(e){var t=Math.round((Date.now()-e.getTime())/60/1e3);return t<0?0:t},e.minutesUntilMidnight=function(){var e=r.getCurrentDate();return e.setHours(24,0,0,0),Math.floor((e.getTime()-r.getCurrentDate().getTime())/1e3/60)},e.toStringMessageDate=function(e,t){if(!e)return"";var n=i.default.get.getCurrentLocale().split("?",1)[0];if(this.isToday(e))return e.toLocaleTimeString(n,{hour:"2-digit",minute:"2-digit"});var o=!!t&&t.dateWithTime;if(this.isWithinSevenDays(e))return o?e.toLocaleTimeString(n,{weekday:"short",hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString(n,{weekday:"short"});var s=r.getCurrentDate().getFullYear()>e.getFullYear(),a=s?{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}:{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},c=s?{year:"numeric",month:"short",day:"numeric"}:{month:"short",day:"numeric"};return e.toLocaleDateString(n,o?a:c)},e}();t.default=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(0),a=n(8),c=function(e){return s.swc.services.i18n.fetch(e)},u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcSpinner",t}return r(t,e),t.prototype.getComposedBlockClassName=function(){var t=e.prototype.getComposedBlockClassName.call(this);return this.props.size&&(t+=" "+this.props.size),t},t.prototype.render=function(){return o.createElement("div",{className:"swcSpinner__container"},o.createElement("div",{role:"status","aria-label":c("recentlistChats_loading"),"aria-live":"off",className:this.getComposedBlockClassName()}),o.createElement("div",{className:"swcSpinner__text"},c("typingIndicatorOnLoad")))},t.defaultProps={size:"swcSpinner_medium"},t}(a.SwcBaseComponent);t.SwcSpinner=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(4),o=n(0),s=n(7),a=n(448),c=n(136),u=n(101),l=function(){return function(e,t,n,l){var p=this;this.url=ko.observable(),this.destinationSize={narrow:{},default:{},carouselDefault:{},carouselNarrow:{}},this.trustedDomains=[i.Configuration.AMS_HOST_URL,i.Configuration.CDN_SERVICE_HOST],this.shouldProcessThroughAMS=function(e){return p._conversation.isSkypeBackend()&&!p.isTrustedUrl(e)},this.processImage=function(e){p.shouldProcessThroughAMS(e)?p.processViaAMS(e).then(function(e){var t=e.url||e.thumbnail,n=e.thumbnail_meta?e.thumbnail_meta:null;n?(p.url(t),p.naturalSize({height:n.height,width:n.width})):p.loadImageSize(u.default.normalizeUrl(t))},function(e){}):p.loadImageSize(p._conversation.isSkypeBackend()?u.default.normalizeUrl(e):e)},this.hasProcessedUrl=function(){return!!p.url()},this.isTrustedUrl=function(e){var t=!1;return p.trustedDomains.forEach(function(n){t=e.indexOf(n)>-1}),t},this.processViaAMS=function(e){var t=i.Configuration.URLP_SERVICE_URL+"/v1/url/info?url=",n=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),r=new RegExp(n,"g"),s=e.indexOf(t)>0?e.replace(r,""):e;return new Promise(function(e){return o.swc.services.amsManager.getPictureThumbnail(t+encodeURIComponent(s)).then(e)})},this.loadImageSize=function(e){var t=new Image;t.onload=function(){p.url(e),p.naturalSize({height:t.naturalHeight,width:t.naturalWidth})},t.onerror=function(e){s.default.throwError(10110,"Unable to load an image",e)},t.src=e},this.getUiSize=function(){var e=a.default.instance.CurrentStyle,t=p.getDestinationSize(p.contentType,e,p.isImageInCarousel()),n=p.naturalSize(),i={height:0,width:0};if(0===n.height||0===n.width||0===t.height)return i;var o=t.width/t.height,s=n.width/n.height;switch(p.contentType){case r.SwiftCardContentType.hero:s<o?(i.width=t.width,i.height=n.height*t.width/n.width,p.bottomAlignment((i.height-t.height)/2)):(i.height=t.height,i.width=n.width*t.height/n.height),p.leftAlignment(i.width/-2);break;case r.SwiftCardContentType.animation:case r.SwiftCardContentType.audio:s<o?(i.width=n.width*t.height/n.height,i.height=n.height*t.height/n.height):(i.height=t.height,i.width=n.width*t.height/n.height);break;case r.SwiftCardContentType.thumb:case r.SwiftCardContentType.actionImage:s<o?(i.height=t.height,i.width=i.height*s):s===o?(i.height=t.height,i.width=n.width*t.height/n.height):(i.width=t.width,i.height=i.width/s),p.bottomAlignment((i.height-t.height)/2),p.leftAlignment(i.width/-2);break;case r.SwiftCardContentType.receipt:s<o?(i.height=t.height,i.width=i.height*s):s===o?(i.height=t.height,i.width=n.width*t.height/n.height):(i.width=t.width,i.height=i.width/s,p.bottomAlignment((i.height-t.height)/2)),p.leftAlignment(i.width/-2);break;case r.SwiftCardContentType.flex:s<=o?(1===s?(i.height=t.height,i.width=t.height):(i.width=n.width*t.height/n.height,i.height=t.height),p.leftAlignment((i.width-t.width)/-2)):(i.height=t.height,i.width=n.width*t.height/n.height,p.leftAlignment((i.width-t.width)/-2))}return i},this.getTitleByType=function(){switch(p.tap.type){case r.SwiftCardActionType.call:case r.SwiftCardActionType.imBack:return p.createImageTitle();case r.SwiftCardActionType.openUrl:return p.createImageTitle()+"\n\n"+p.tap.value;case r.SwiftCardActionType.showImage:return(p.alt?p.alt+" ":"")+p.lowerFirstLetter(p.tap.title)}return""},this.createImageTitle=function(){var e=p.tap.title||"",t=o.swc.services.i18n.fetch("accessibility_swift_action_prefix",{swiftAction:p.lowerFirstLetter(e)});return(p.alt?p.alt+" ":"")+t},this.lowerFirstLetter=function(e){return e?e[0].toLowerCase()+e.substring(1):""},this.getDestinationSize=function(e,t,n){return(t===a.StyleModes.NORMAL?n?p.destinationSize.carouselDefault:p.destinationSize.default:n?p.destinationSize.carouselNarrow:p.destinationSize.narrow)[e]},this._conversation=t,this.destinationSize.narrow[r.SwiftCardContentType.hero]={height:105,width:188},this.destinationSize.default[r.SwiftCardContentType.hero]={height:153,width:272},this.destinationSize.carouselDefault[r.SwiftCardContentType.hero]={height:145,width:270},this.destinationSize.carouselNarrow[r.SwiftCardContentType.hero]={height:105,width:188},this.destinationSize.narrow[r.SwiftCardContentType.thumb]={height:76,width:76},this.destinationSize.default[r.SwiftCardContentType.thumb]={height:112,width:112},this.destinationSize.carouselDefault[r.SwiftCardContentType.thumb]={height:112,width:112},this.destinationSize.carouselNarrow[r.SwiftCardContentType.thumb]={height:76,width:76},this.destinationSize.narrow[r.SwiftCardContentType.receipt]={height:76,width:76},this.destinationSize.default[r.SwiftCardContentType.receipt]={height:112,width:112},this.destinationSize.narrow[r.SwiftCardContentType.animation]={height:105,width:172},this.destinationSize.default[r.SwiftCardContentType.animation]={height:153,width:256},this.destinationSize.carouselDefault[r.SwiftCardContentType.animation]={height:145,width:256},this.destinationSize.carouselNarrow[r.SwiftCardContentType.animation]={height:105,width:172},this.destinationSize.narrow[r.SwiftCardContentType.audio]={height:105,width:172},this.destinationSize.default[r.SwiftCardContentType.audio]={height:145,width:256},this.destinationSize.carouselDefault[r.SwiftCardContentType.audio]={height:145,width:256},this.destinationSize.carouselNarrow[r.SwiftCardContentType.audio]={height:105,width:172},this.destinationSize.default[r.SwiftCardContentType.actionImage]={height:20,width:20},this.destinationSize.narrow[r.SwiftCardContentType.actionImage]={height:16,width:16},this.destinationSize.narrow[r.SwiftCardContentType.flex]={height:105,width:188},this.destinationSize.default[r.SwiftCardContentType.flex]={height:153,width:272},this.destinationSize.carouselDefault[r.SwiftCardContentType.flex]={height:145,width:256},this.destinationSize.carouselNarrow[r.SwiftCardContentType.flex]={height:105,width:188},this.contentType=l,this.alt=u.default.normalizeRichText(e.alt),e.url&&this.processImage(e.url),this.tap=null,e.tap&&(this.tap=u.default.getItemIfNotDisabled(new c.default(e.tap,t,n)),this.tap&&this.tap.type===r.SwiftCardActionType.showImage&&!this.tap.value&&(this.tap.value=this.url())),this.naturalSize=ko.observable({height:0,width:0}),this.uiSize=ko.pureComputed(this.getUiSize.bind(this)),this.isValid=ko.pureComputed(this.hasProcessedUrl),this.bottomAlignment=ko.observable(),this.leftAlignment=ko.observable(),this.isImageInCarousel=ko.observable(!1)}}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o=n(20),s=n(0),a=n(43),c=n(25);function u(){s.swc.Eventing.triggerLocalEvent("hideBubbleWindow")}!function(e){e.Info="info",e.List="list",e.ReactionPreview="reactionPreview",e.ReactionPane="reactionPane"}(i=t.BubbleType||(t.BubbleType={})),function(e){e.nextToElement="nextToElement",e.onContextMenu="onContextMenu"}(r=t.BubblePosition||(t.BubblePosition={}));var l=function(){function e(){}return e.add=function(t,n,a,c,l){void 0===l&&(l=r.nextToElement),e._clearTimeouts();for(var p=e.build(),d=c===i.Info,f=p.content;f.firstChild;)f.removeChild(f.firstChild);if(f.appendChild(a),p.container.className="swc-bubble "+c,p.arrow.style.display=d?"block":"none",l===r.nextToElement){var h,g=t.getBoundingClientRect(),m=n.getBoundingClientRect(),v=g.top-m.top,y=m.bottom-g.bottom,_=g.left-m.left,b=m.right-g.right,w=d?10:0,C=void 0,S=g.width/2;if(_<b)p.container.style.right="",(h=(C=g.left-m.left+S)-90)<0?(p.container.style.left=C-90-h+S+"px",p.arrow.style.left=90-S+h-8+"px"):(p.container.style.left=C-90+S+"px",p.arrow.style.left="82px");else p.container.style.left="",(h=(C=m.right-g.right+S)-90)<0?(p.container.style.right=C-90+S-h+"px",p.arrow.style.left=90+S-h-8+"px"):(p.container.style.right=C-90+S+"px",p.arrow.style.left="82px");v>y?(p.container.style.top="",p.container.style.bottom=m.bottom-g.top+w+"px",p.arrow.style.top="",p.arrow.style.bottom="-10px",p.arrow.style.borderBottom="",p.arrow.style.borderTop="10px solid #d8d8d8",p.arrowInner.style.bottom="2px",p.arrowInner.style.borderBottom="",p.arrowInner.style.borderTop="9px solid #fdc856"):(p.container.style.bottom="",p.container.style.top=g.bottom-m.top+w+"px",p.arrow.style.bottom="",p.arrow.style.top="-10px",p.arrow.style.borderTop="",p.arrow.style.borderBottom="10px solid #d8d8d8",p.arrow.style.top="-10px",p.arrowInner.style.top="2px",p.arrowInner.style.borderTop="",p.arrowInner.style.borderBottom="9px solid #fdc856"),n.appendChild(p.container)}else{var T=t,E=T.target,P={x:T.clientX,y:T.clientY},I=n.getBoundingClientRect(),k=n.parentElement?n.parentElement.getBoundingClientRect():null;if(!t||!E)return;var M=P.y-k.top,O=k.bottom-P.y,A=P.x-I.left,x=I.right-P.x;p.container.style.display="none",n.appendChild(p.container),e._positionTimer=window.setTimeout(function(){e._positionTimer=void 0,p.container.style.display="";var t=p.container.offsetWidth,n=p.container.offsetHeight,i=x>t?A:A-t,r=O>n?M+k.top-I.top:M+k.top-I.top-n;p.container.style.left=i+"px",p.container.style.right="",p.container.style.top=r+"px",p.container.style.bottom=""},0)}e._focusTimer=window.setTimeout(function(){var t;e._focusTimer=void 0,p.container&&p.container.parentElement&&(o.AbilityHelpers.modalityLayer.addLayer(p.container,"bubble",{accessibilityLabel:(t="context_menu",s.swc.services.i18n.fetch(t)),othersAccessible:!0,onFocusOut:function(){return u(),!0}}),o.AbilityHelpers.modalityLayer.focusLayer(p.container))},0),p.container.addEventListener("keydown",e._onKeyDown),n.addEventListener("click",u),s.swc.Eventing.registerEvent("hideBubbleWindow",e.remove)},e.remove=function(){if(e.instance&&e.instance.container){e._clearTimeouts();var t=e.instance.container.parentElement;t&&(o.AbilityHelpers.modalityLayer.removeLayer(e.instance.container),t.removeEventListener("click",u),e.instance.container.removeEventListener("keydown",e._onKeyDown),s.swc.Eventing.unregisterEvent("hideBubbleWindow",e.remove),t.removeChild(e.instance.container))}},e.build=function(){if(!e.instance){var t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div");n.className="swc-content",i.className="swc-arrow",r.className="swc-arrow-inner",i.appendChild(r),t.appendChild(i),t.appendChild(n),e.instance={container:t,content:n,arrow:i,arrowInner:r}}return e.instance},e._clearTimeouts=function(){e._positionTimer&&(window.clearTimeout(e._positionTimer),e._positionTimer=void 0),e._focusTimer&&(window.clearTimeout(e._focusTimer),e._focusTimer=void 0)},e._onKeyDown=function(e){e.stopPropagation(),a.default.getKeyCode(e)===c.default.ESCAPE&&u()},e}();t.default=l},,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(19),o=n(4),s=n(0),a=n(7),c=n(29),u=function(){function e(t){var n=this;this._element=t,this.init=function(e){void 0===e&&(e=!0),e&&(s.swc.services.signInManager.unsubscribe("isSignedIn",n.init),s.swc.services.mePersonManager.fetch().then(function(e){return s.swc.Calling.init(n._element,e.id,null,null,{onCallStatusChange:n._onCallStatusChange,onRegistryUpdate:n._onRegistryUpdate},i.default,null,null,i.default.get.selectedDevices||null)}).then(function(){var e;i.default.get.callingReady=!0,e=!i.default.get.standaloneCalling||!s.swc.CallingControl||{threadId:s.swc.CallingControl.threadId},s.swc.Eventing.triggerEvent("callingReady",e,!0),s.swc.Eventing.registerEvent("startCall",n._startCall),s.swc.Eventing.registerEvent("acceptCall",n._acceptCall),s.swc.Eventing.registerEvent("rejectCall",n._rejectCall),s.swc.Eventing.registerEvent("updateCallingScreen",n._showCalling),s.swc.Eventing.registerEvent("onCallEnd",n._hideCalling),s.swc.Eventing.registerEvent("callingLayoutChanged",n._onCallingLayoutChange),n._ready=!0}).catch(function(e){s.swc.Eventing.triggerEvent("callingReady",!1,!0)}))},this._onCallStatusChange=function(e){n._callState=e},this._onRegistryUpdate=function(e){return n._disableTransition()},this._disableTransition=function(){n._element.parentElement&&n._element.parentElement.classList.add("no-transition")},this._onCallingLayoutChange=function(t){if(n._activeCallMri&&t.mri===n._activeCallMri){var i=e._getChat();i&&i.getConversationTuple(n._activeCallMri).then(function(n){e._toggleActiveCallClass(n,"maximize"===t.action||"undock"===t.action)})}},this._hideCalling=function(){var t=e._getChat();t&&n._activeCallMri&&t.getConversationTuple(n._activeCallMri).then(function(t){t.alwaysOnStage=!1,t.container.removeChild(n._element),e._toggleActiveCallClass(t,!1)}).catch(function(e){a.default.throwError(10902,"Unable to hide calling screen - no such conversation",e,n._activeCallMri)})},this._showCalling=function(t){n._activeCallMri=t.mri;var i=e._getChat();i&&i.getConversationTuple(t.mri).then(function(i){i.alwaysOnStage=!0,i.container.contains(n._element)||i.container.appendChild(n._element),e._toggleActiveCallClass(i,t.fullyCover),n._disableTransition()}).catch(function(e){a.default.throwError(10901,"Unable to update calling screen - no such conversation",e,t.mri)})},this._startCall=function(e){if(n._ready){n._showCalling({mri:e.calleeId,fullyCover:!1});var t=function(){s.swc.Calling.startCall(e.calleeId,e.withVideo,{avatarURI:e.avatarUrl,displayName:e.displayName},e.isGroup,!0)};n._callState&&7!==n._callState||(e.isGroup||c.default.detectConversationType(e.calleeId)===o.ConversationType.AGENT?t():s.swc.services.webApi.getUsersPresence([e.calleeId]).then(function(n){var i=n[0];"Online"!==(i&&i.Payload&&i.Payload.availability)&&s.swc.Eventing.triggerEvent("calleeUnavailable",{mri:e.calleeId,withVideo:e.withVideo}),t()}))}},this._rejectCall=function(e){n._ready&&s.swc.Calling.rejectCallById(e.id)},this._acceptCall=function(e){n._ready&&(e.threadId?n._joinGroupCall(e):(n._showCalling({mri:e.callerMri,fullyCover:!1}),s.swc.Calling.acceptCallById(e.id)))},this._element.innerHTML="";var u=s.swc.services.signInManager;u.state===r.SigninState.SignedIn?this.init():u.subscribe("isSignedIn",this.init)}return e._getChat=function(){return!i.default.get.standaloneCalling&&s.swc.ChatContent},e._toggleActiveCallClass=function(e,t){t?e.view.classList.add("onactivecall"):e.view.classList.remove("onactivecall")},e.prototype._joinGroupCall=function(e){this._showCalling({mri:e.threadId,fullyCover:!1}),s.swc.Calling.acceptCallByThreadId(e.threadId)||s.swc.Calling.startCall(e.threadId,e.withVideo,{avatarURI:e.avatarUrl,displayName:e.displayName},e.isGroup,!0)},e}();t.CallingView=u},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.reportUserActivityStart=function(){i.swc.services.signInManager.onceSignedIn().then(function(){return i.swc.Telemetry.sendEvent.userActivityStart()})}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(0),c=n(433),u=function(e){function t(t){var n=e.call(this,t)||this;return n._onReasonChange=function(e){n.setState({value:e.target.value})},n._onCheckChange=function(e){n.setState({reportAbuseCheckBox:e.target.checked})},n.state={reportAbuseCheckBox:!1,value:c.AbuseTypes.Spam},n}return r(t,e),t.prototype.getContentElement=function(){var e={confirm_dialog_report_abuse_spam_reason_text:a.swc.services.i18n.fetch("confirm_dialog_report_abuse_spam_reason_text"),confirm_dialog_report_abuse_pornography_reason_text:a.swc.services.i18n.fetch("confirm_dialog_report_abuse_pornography_reason_text"),confirm_dialog_report_abuse_child_exploitation_reason_text:a.swc.services.i18n.fetch("confirm_dialog_report_abuse_child_exploitation_reason_text"),confirm_dialog_report_abuse_harassment_reason_text:a.swc.services.i18n.fetch("confirm_dialog_report_abuse_harassment_reason_text"),confirm_dialog_block_report_abuse_checkbox:a.swc.services.i18n.fetch("confirm_dialog_block_report_abuse_checkbox")};return s.createElement(o.Fragment,null,s.createElement("label",{className:"swcDialog__blockLabel"},s.createElement("input",{className:"swcDialog__blockCheckbox",type:"checkbox",onChange:this._onCheckChange,checked:this.state.reportAbuseCheckBox}),s.createElement("p",{className:"swcDialog__blockText"},e.confirm_dialog_block_report_abuse_checkbox)),this.state.reportAbuseCheckBox&&s.createElement("select",{value:this.state.value,onChange:this._onReasonChange,className:"swcDialog__abuseOptions"},s.createElement("option",{selected:this.state.value===c.AbuseTypes.Spam,value:c.AbuseTypes.Spam},e.confirm_dialog_report_abuse_spam_reason_text),s.createElement("option",{selected:this.state.value===c.AbuseTypes.Pornography,value:c.AbuseTypes.Pornography},e.confirm_dialog_report_abuse_pornography_reason_text),s.createElement("option",{selected:this.state.value===c.AbuseTypes.ChildExploitation,value:c.AbuseTypes.ChildExploitation},e.confirm_dialog_report_abuse_child_exploitation_reason_text),s.createElement("option",{selected:this.state.value===c.AbuseTypes.Harassment,value:c.AbuseTypes.Harassment},e.confirm_dialog_report_abuse_harassment_reason_text)))},t.prototype.confirmAction=function(){var e={isReportAbuse:this.state.reportAbuseCheckBox,reason:this.state.value};this.props.dialogContent.confirm.action(e)},t}(n(434).SwcDialog);t.SwcBlockDialog=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Spam="spam",e.Pornography="pornography",e.ChildExploitation="child-exploitation",e.Harassment="harassment"}(t.AbuseTypes||(t.AbuseTypes={}))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(43),c=n(25),u=n(104),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onFadeElementChange=function(e){return t._fadeElement=e},t._onConfirmClick=function(e){t.confirmAction()},t._onCancelClick=function(e){t.props.dialogContent.cancel.action()},t._onFadeClick=function(e){e.target===t._fadeElement&&t._onCancelClick(e)},t._onKeyDown=function(e){a.default.getKeyCode(e)===c.default.ESCAPE&&t._onCancelClick(e)},t}return r(t,e),t.prototype.confirmAction=function(){this.props.dialogContent.confirm.action()},t.prototype.render=function(){var e=this.props.dialogContent.cancel.title,t=this.props.dialogContent.confirm.title,n=this.props.dialogContent.title;return s.createElement("div",{className:"swcDialog__backdrop",ref:this._onFadeElementChange,onClick:this._onFadeClick,onKeyDown:this._onKeyDown},s.createElement(u.Modality,{id:"dialog",accessibilityLabel:n},s.createElement("div",{className:"swcDialog",role:"dialog","data-test-id":"swcDialog__test"},s.createElement("div",{className:"swcDialog__contentContainer"},s.createElement("h1",{className:"swcDialog__title"},n),this.getContentElement()),s.createElement("div",{className:"swcDialog__buttons"},s.createElement("button",{className:"swcDialog__actionButton swcDialog__actionButton_confirm",title:t,onClick:this._onConfirmClick},t),s.createElement("button",{className:"swcDialog__actionButton swcDialog__actionButton_cancel",title:e,onClick:this._onCancelClick},e)))))},t}(o.Component);t.SwcDialog=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getContentElement=function(){return o.createElement("p",{className:"swcDialog__textContent"},this.props.dialogContent.text)},t}(n(347).SwcDialog);t.SwcTextDialog=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(0),a=n(25),c=n(8),u=n(14),l=n(53),p=function(e){return s.swc.services.i18n.fetch(e)},d=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="swcSearchInput",n.handleChange=function(e){e.stopPropagation();var t=e.target.value;if(n.setState({value:t}),!t.trim())return n.debounceSearch.cancel(),void n.props.onDebounce("");n.debounceSearch(t)},n.clearSearchInput=function(){""!==n.state.value&&(n.debounceSearch.cancel(),n.searchInputRef.focus(),n.props.onDebounce(""),n.setState({value:""}))},n.onKeyDown=function(e){return e.keyCode===a.default.ESCAPE?(n.state.value&&(n.clearSearchInput(),e.preventDefault(),e.stopPropagation()),!1):e.keyCode!==a.default.ENTER},n._setInputRef=function(e){n.searchInputRef=e,n.props.innerRef&&n.props.innerRef(e)},n.state={value:""},n.debounceSearch=l(function(e){n.props.onDebounce(e)},n.props.debounceDelay||400,{leading:!1}),n}return r(t,e),t.prototype.componentDidUpdate=function(){this.state.value&&this.props.shouldForceClear&&this.setState({value:""})},t.prototype.render=function(){var e=this.props.inputClassName,t=p("sign_in_cancel");return o.createElement("div",{className:this.getComposedBlockClassName(),role:"search","aria-label":p("search_label"),"data-test-id":this.props.dataTestId},o.createElement("h3",{className:"sr-only"},p("search_label")),this.props.showSearchIcon&&o.createElement(u.SwcIcon,{size:u.SwcIconSize.Medium,type:u.SwcIconType.Search,className:"swcSearchInput__searchIcon"}),o.createElement("input",{ref:this._setInputRef,value:this.state.value,onInput:this.handleChange,onKeyDown:this.onKeyDown,placeholder:this.props.hasPlaceholder?p("search"):"",type:"text","data-test-id":"searchContactsInput",className:"swcSearchInput__input "+(e||"")}),this.props.showClearButton&&!!this.state.value&&o.createElement("button",{title:t,onClick:this.clearSearchInput,"aria-label":t,className:"swcSearchInput__clearButton","data-test-id":"swcSearchInput__closeButton_test"},o.createElement(u.SwcIcon,{size:u.SwcIconSize.Medium,type:u.SwcIconType.Cancel})))},t.defaultProps={hasPlaceholder:!0,showSearchIcon:!0,showClearButton:!0},t}(c.SwcBaseComponent);t.SwcSearchInput=d},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},s=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),c=n(59),u=n(96),l=n(36),p=n(8),d={favoriteList:[],recentList:[],peopleList:[],botList:[],contactList:[],initialContactList:[],fetchedContacts:[],asyncCallsCount:0,trackQuery:""},f=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="",n._search=function(e){if(n.setState({asyncCallsCount:0,trackQuery:e}),e.trim()){var t=e.toLowerCase();if(n._searchPeople(t).then(function(e){n.setState(function(t){var n=t.asyncCallsCount,i=s(t,["asyncCallsCount"]);return o({},i,{peopleList:e||[],asyncCallsCount:n++})})}).catch(function(){n.setState(function(e){var t=e.asyncCallsCount,n=s(e,["asyncCallsCount"]);return o({},n,{asyncCallsCount:t++})})}),n._searchBots(t).then(function(e){n.setState(function(t){var n=t.asyncCallsCount,i=s(t,["asyncCallsCount"]);return o({},i,{botList:e,asyncCallsCount:n++})})}).catch(function(){n.setState(function(e){var t=e.asyncCallsCount,n=s(e,["asyncCallsCount"]);return o({},n,{asyncCallsCount:t++})})}),n.props.recents){var i=n._searchRecents(t,n.props.recents);n.setState(o({},i))}var r=n._searchContacts(t,n.state.fetchedContacts);n.setState(function(e){var t=e.asyncCallsCount;return{contactList:r,asyncCallsCount:t++}}),a.swc.Telemetry.sendEvent.contactsSearch(e)}else n._resetWithFetchedState()},n._resetWithFetchedState=function(){n.setState(function(){return o({},d,{fetchedContacts:n.state.fetchedContacts,contactList:n.state.fetchedContacts.reduce(n._searchResultReducer,[]),initialContactList:n.state.initialContactList})},function(){return a.swc.services.pesManager.refresh()})},n._getResultCount=function(){return n.state.contactList.length+n.state.botList.length+n.state.peopleList.length+n.state.recentList.length+n.state.favoriteList.length},n._isAsyncCallsDone=function(){return 3===n.state.asyncCallsCount},n._searchResultReducer=function(e,t){var i=a.swc.services.persons.getPerson(t.skypeid);return n.props.recents&&n.props.recents.length>0&&n._isInRecent(n.props.recents,i.mri.toLowerCase())?e:n.props.ignoreItemIds&&n.props.ignoreItemIds.some(function(e){return e===u.default.toFullIdentifier(i.id)})?e:(e.push({person:i,rawPerson:t}),e)},n.state=d,n}return r(t,e),t.prototype.componentDidMount=function(){var e=this;this._fetchMyContacts().then(function(t){var n=t&&t.contacts?t.contacts:null,i=n?n.reduce(e._searchResultReducer,[]).sort(c.default.sortByName):[];e.setState(function(e){return o({},e,{fetchedContacts:t.contacts,contactList:i,initialContactList:i})},function(){return e._search(e.props.searchQuery)})})},t.prototype.componentDidUpdate=function(e,t){var n=this;this.props.ignoreItemIds&&this.props.ignoreItemIds!==e.ignoreItemIds&&""===this.props.searchQuery&&this._resetWithFetchedState(),this.props.searchQuery!==e.searchQuery&&this._search(this.props.searchQuery),this.state.contactList!==t.contactList&&this.setState(function(e){return o({},e,{contactList:n.state.contactList.sort(c.default.sortByName)})})},t.prototype.render=function(){return this.props.children({botList:this.state.botList,contactList:this.state.contactList,peopleList:this.state.peopleList,recentList:this.state.recentList,favoriteList:this.state.favoriteList,count:this._getResultCount(),isLoading:this._isAsyncCallsDone()})},t.prototype._searchRecents=function(e,t,n){void 0===n&&(n=!1);var i=t.reduce(function(t,i){return(i.topic&&l.normalizeString(i.topic)).indexOf(e)>-1||i.id.indexOf(e)>-1?(n&&i.isFavorite?t.favoriteList.push(i):t.recentList.push(i),t):t},{recentList:[],favoriteList:[]});return o({},i)},t.prototype._fetchMyContacts=function(){return a.swc.services.signInManager.onceSignedIn().then(function(){return a.swc.services.contactsManager.fetchMyContacts().then(function(e){return e},function(){})})},t.prototype._searchContacts=function(e,t){return t.filter(function(t){var n=l.normalizeString(t.name),i=t.skypeid.toLowerCase();return n.indexOf(e)>-1||i.indexOf(e)>-1}).reduce(this._searchResultReducer,[]).sort(c.default.sortByName)},t.prototype._searchPeople=function(e){var t=this;return a.swc.services.searchManager.searchSkypeDirectory(e).then(function(e){var n=c.default.mapSearchProfileInfo(e).reduce(t._searchResultReducer,[]);return c.default.getSortedByRelevance(n)||[]},function(){})},t.prototype._searchBots=function(e){var t=this;return a.swc.services.searchManager.searchAgents(e).then(function(e){return e.reduce(t._searchResultReducer,[]).sort(c.default.sortByName)||[]},function(){})},t.prototype._isInRecent=function(e,t){return e.some(function(e){return e.id===t})},t}(p.SwcBaseComponent);t.SwcSearchContainer=f},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(3),c=n(105),u=n(0),l=n(60),p=n(139),d=n(128),f=n(348),h=n(8),g=n(444),m=function(e,t){return u.swc.services.i18n.fetch(e,t)},v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcSearchResults",t._setScrollViewport=function(e){t._scrollViewport=e},t._setScrollWrapper=function(e){t._scrollWrapper=e},t._handleListItemContextMenu=function(e){if(!event.target)return null;if(event.preventDefault(),event.stopPropagation(),t.props.listItemMenuGroup){var n=p.default.createMenuList(t.props.listItemMenuGroup(e),"listItemActionsMenuList");d.default.add(event,t.props.parentElement,n,d.BubbleType.List,d.BubblePosition.onContextMenu)}},t}return r(t,e),t.prototype.getComposedBlockClassName=function(){var t=e.prototype.getComposedBlockClassName.call(this);return t+=" swc-scroll-wrapper",this.props.compactMode&&(t+=" compactMode"),t},t.prototype.componentDidMount=function(){this._scrollViewport&&this._scrollWrapper&&(this._customScrollbar=new c.default(this._scrollWrapper,this._scrollViewport))},t.prototype.componentDidUpdate=function(e){var t=e.recents&&e.recents.length!==this.props.recents.length,n=e.contacts&&e.contacts.length!==this.props.contacts.length,i=e.people&&e.people.length!==this.props.people.length,r=e.bots&&e.bots.length!==this.props.bots.length;this._customScrollbar&&this._scrollViewport&&(t||n||i||r)&&(this._scrollViewport.scrollTop=0,this._customScrollbar.recount())},t.prototype.render=function(){var e=this.props,t=e.contacts,n=void 0===t?[]:t,i=e.recents,r=void 0===i?[]:i,a=e.people,c=void 0===a?[]:a,u=e.bots,p=void 0===u?[]:u,d=e.headerClassName;return s.createElement(l.AccessibleList,null,s.createElement("div",{className:this.getComposedBlockClassName(),ref:this._setScrollWrapper},s.createElement("div",{className:"swcSearchResults contactList",ref:this._setScrollViewport,"data-test-id":"chatResultsWrapper"},r.length>0&&s.createElement(o.Fragment,null,s.createElement(y,{headerClassName:d,title:m("text_chats")}),s.createElement(_,{title:m("text_chats"),items:r,isRecentItem:!0,dataTestId:"swcSearchResults__recents",onItemClick:this.props.onRecentsClick,recentsMenuGroup:this.props.recentsItemMenuGroup,parentElement:this.props.parentElement,onRecentItemChange:this.props.onRecentItemChange,isInCall:this.props.isInCall,isCallingReady:this.props.isCallingReady})),n.length>0&&s.createElement(o.Fragment,null,s.createElement(y,{headerClassName:d,title:m("text_contacts")}),s.createElement(_,{title:m("text_contacts"),items:n,isContact:!0,dataTestId:"swcSearchResults__contacts",onItemClick:this.props.onItemClick,onListItemContextMenu:this._handleListItemContextMenu})),this.props.showCounter&&this.props.resultsCount>0&&s.createElement(y,{headerClassName:d,title:m("search_results",{resultscount:this.props.resultsCount})}),c.length>0&&s.createElement(o.Fragment,null,s.createElement(y,{headerClassName:d,title:m("text_people")}),s.createElement(_,{title:m("text_people"),isPeople:!0,dataTestId:"swcSearchResults__people",items:this.props.people,onItemClick:this.props.onItemClick,onListItemContextMenu:this._handleListItemContextMenu})),p.length>0&&s.createElement(o.Fragment,null,s.createElement(y,{headerClassName:d,title:m("text_bots")}),s.createElement(_,{title:m("text_bots"),dataTestId:"swcSearchResults__bots",items:p,isBot:!0,onItemClick:this.props.onItemClick,onListItemContextMenu:this._handleListItemContextMenu})))))},t}(h.SwcBaseComponent);function y(e){return s.createElement("div",{role:"none",className:"swcSearchResults__header "+(e.headerClassName?e.headerClassName:"")},s.createElement("h3",{className:"swcSearchResults__heading"},e.title))}function _(e){return s.createElement("div",{role:"list","aria-label":e.title,className:"swcSearchResults__list","data-test-id":e.dataTestId},function(e){if(e.isRecentItem)return e.items.map(function(t){return s.createElement(f.default,{key:t.id,item:t,menuGroup:e.recentsMenuGroup,onClick:e.onRecentsClick,parentElement:e.parentElement,onRecentItemChange:e.onRecentItemChange,isInCall:e.isInCall,isCallingReady:e.isCallingReady})});if(e.isBot)return e.items.map(function(t){return s.createElement(g.SwcListItem,{key:t.person.id,person:t.person,displayName:t.person.displayName,contactId:t.person.id,onClick:o.linkEvent(t,e.onItemClick),onContextMenu:o.linkEvent(t,e.onListItemContextMenu)})});if(e.isContact||e.isPeople)return e.items.map(function(t){return s.createElement(g.SwcListItem,{key:t.person.id,person:t.person,displayName:t.person.displayName,mutualFriendCount:a.default.get.isTeams()?null:t.rawPerson.mutualFriendCount,showPersonId:!e.isContact&&!a.default.get.isTeams(),jobTitle:t.rawPerson.jobTitle,contactId:t.person.id,onClick:o.linkEvent(t,e.onItemClick),onContextMenu:o.linkEvent(t,e.onListItemContextMenu)})});return null}(e))}t.SwcSearchResults=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getClassNameFromMap=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&e[n]&&t.push(n);return t.join(" ")}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(4),a=n(0),c=n(72),u=n(9),l=n(8),p=n(14),d=n(441),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcMessagePreview",t}return r(t,e),t.prototype.render=function(){var e,n,i=this.props.message;if(!i||i.isDeleted)n=null,e="";else switch(i.type){case s.MessageType.UserMessage:if(t._isCallMessage(i.customType))n=p.SwcIconType.CallEnd,e=i.content;else if(i.imageContent)n=p.SwcIconType.Picture,e=a.swc.services.i18n.fetch("message_text_photo");else if(""===i.content&&i.files&&i.files.length>0){var r=c.isDocumentTypeImage(i.files[0].type);n=r?p.SwcIconType.Picture:p.SwcIconType.File,e=r?a.swc.services.i18n.fetch("message_text_photo"):i.files[0].fileName}else{var l=document.createElement("p");l.innerText=i.content,e=u.MessageUtils.unescape(l.innerHTML)}break;case s.MessageType.LwcImage:n=p.SwcIconType.Picture,e=a.swc.services.i18n.fetch("message_text_photo");break;case s.MessageType.LwcFile:n=p.SwcIconType.File;var f=document.createElement("p");f.innerText=i.processedContent?i.processedContent:i.content,e=f.innerHTML;break;default:e=i.content}e=d(e,1400,{breakWords:!0}),e=u.MessageUtils.getMessagePreviewContent(e);var h=this._getMessageClassName(i&&i.type||s.MessageType.UserMessage);return o.createElement("div",{role:"status","aria-live":"off","aria-label":a.swcWindow.DOMPurify.sanitize(e,{ALLOWED_TAGS:[]}),className:this.getComposedBlockClassName()},!!n&&o.createElement(p.SwcIcon,{className:"swcMessagePreview__icon",type:n}),o.createElement("p",{"aria-hidden":"true",className:h,dangerouslySetInnerHTML:{__html:u.MessageUtils.sanitizeTopic(e)}}))},t._isCallMessage=function(e){return[s.CustomMessageType.CallEnd,s.CustomMessageType.MissedCall,s.CustomMessageType.MissedGroupCall].indexOf(e)>-1},t.prototype._getMessageClassName=function(e){var t="swcMessagePreview__message";return e===s.MessageType.SystemMessage&&(t+=" system"),t},t}(l.SwcBaseComponent);t.SwcMessagePreview=f},function(e,t,n){"use strict";var i=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],r=["address","article","aside","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","section","table","tfoot","ul","video"],o=10,s=34,a=38,c=39,u=47,l=59,p=60,d=61,f=62,h=/[<&\n\ud800-\udbff]/,g=/\s+$/;function m(e,t){for(var n=e.length,i=t;i<n;i++)if(y(e.charCodeAt(i)))return i;return n}function v(e,t){var n=e.charCodeAt(t);if(n===o)return!0;if(n===p){var i="("+r.join("|")+"|br)";return new RegExp("<"+i+"[\t\n\f\r ]*/?>","i").test(e.slice(t))}return!1}function y(e){return 9===e||10===e||12===e||13===e||32===e}function _(e,t){var n=e.charCodeAt(t);if(55296==(64512&n)){var i=e.charCodeAt(t+1);if(56320==(64512&i))return String.fromCharCode(n,i)}return String.fromCharCode(n)}e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e?(e=e.toString(),void 0===n.indicator&&(n.indicator=""),n.html?function(e,t,n){for(var b=n.imageWeight,w=void 0===b?2:b,C=n.maxLines,S=1,T=1,E=0,P=!1,I=[],k=e.length;E<k;E++){var M=E?e.slice(E):e,O=M.search(h),A=O>-1?O:M.length;if(E+=A,!P&&(S+=A)>t){E-=S-t;break}if(-1===O)break;var x=e.charCodeAt(E);if(x===p)if("!--"===e.substr(E+1,3)){var N=e.indexOf("--\x3e",E+4)+3;E=N-1}else if("![CDATA["===e.substr(E+1,8)){var L=e.indexOf("]]>",E+9)+3;E=L-1}else{if(S===t&&e.charCodeAt(E+1)!==u){S++;break}for(var R=0,D=E,U=!1;;){if(++D>=k)throw new Error("Invalid HTML: "+e);var F=e.charCodeAt(D);if(U)R?F===R&&(U=!1):y(F)?U=!1:F===f&&(U=!1,D--);else if(F===d){for(;y(e.charCodeAt(D+1));)D++;U=!0;var j=e.charCodeAt(D+1);j===s||j===c?(R=j,D++):R=0}else if(F===f){var B=e.charCodeAt(E+1)===u,H=E+(B?2:1),G=Math.min(m(e,H),D),z=e.slice(H,G).toLowerCase();if(z.charCodeAt(z.length-1)===u&&(z=z.slice(0,z.length-1)),B){var W=I.pop();if(W!==z)throw new Error("Invalid HTML: "+e);if(("math"===z||"svg"===z)&&!(P=-1!==I.indexOf("math")||-1!==I.indexOf("svg"))&&(S+=w)>t)break;if(-1!==r.indexOf(z)&&!P&&++T>C){I.push(z);break}}else if(-1!==i.indexOf(z)||e.charCodeAt(D-1)===u){if("br"===z){if(++T>C)break}else if("img"===z&&(S+=w)>t)break}else I.push(z),"math"!==z&&"svg"!==z||(P=!0);E=D;break}}if(S>t||T>C)break}else if(x===a){for(var V=E+1;e.charCodeAt(V)!==l;)if(++V>=k)throw new Error("Invalid HTML: "+e);if(!P&&++S>t)break;E=V}else if(x===o){if(!P){if(++S>t)break;if(++T>C)break}}else{if(!P&&++S>t)break;var K=e.charCodeAt(E+1);56320==(64512&K)&&E++}}if(S>t){for(var q=_(e,E),J=E+q.length;e.charCodeAt(J)===p&&e.charCodeAt(J+1)===u;){var Y=e.indexOf(">",J+2)+1;if(!Y)break;J=Y}if(J&&(J===e.length||v(e,J))){if("<"===q||"&"===q)throw new Error("Invalid HTML: "+e);E+=q.length,q=e.charAt(E)}for(;"<"===q&&e.charCodeAt(E+1)===u;){var $=I.pop(),X=$?e.indexOf(">",E+2):-1;if(-1===X||e.replace(g,"").slice(E+2,X)!==$)throw new Error("Invalid HTML: "+e);E=X+1,q=e.charAt(E)}if(E<e.length){if(!n.breakWords)for(var Q=E-1;Q>=0;Q--){var Z=e.charCodeAt(Q);if(Z===f||Z===l)break;if(Z===o||Z===p){E=Q;break}if(y(Z)){E=Q+1;break}}for(var ee=e.slice(0,E)+(v(e,E)?"":n.indicator);I.length;){var te=I.pop();ee+="</"+te+">"}return ee}}else if(T>C){for(var ne=e.slice(0,E);I.length;){var ie=I.pop();ne+="</"+ie+">"}return ne}return e}(e,t,n):function(e,t,n){for(var i=n.maxLines,r=1,s=1,a=0,c=e.length;a<c&&!(++r>t);a++){var u=e.charCodeAt(a);if(u===o){if(++s>i)break}else if(55296==(64512&u)){var l=e.charCodeAt(a+1);56320==(64512&l)&&a++}}if(r>t){var p=_(e,a),d=a+p.length;if(d===e.length)return e;if(e.charCodeAt(d)===o)return e.slice(0,a+p.length);if(!n.breakWords)for(var f=a-1;f>=0;f--){var h=e.charCodeAt(f);if(h===o){a=f,p="\n";break}if(y(h)){a=f+1;break}}return e.slice(0,a)+("\n"===p?"":n.indicator)}if(s>i)return e.slice(0,a);return e}(e,t,n)):""}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(3),a=n(356),c=n(8),u=function(e){function t(t,n){var i=e.call(this,t)||this;return i.blockClassName="swcTimestamp",i.state={timestamp:"",currentLocale:s.default.get.getCurrentLocale()},i}return r(t,e),t.prototype.componentDidMount=function(){var e=this;this._lowPriorityTimeout=setTimeout(function(){e.props.date&&(e._tick(),(a.default.isToday(e.props.date)||a.default.minutesUntilMidnight()<30)&&e._startInterval())},0)},t.prototype.componentWillUpdate=function(e,t,n){this.state.currentLocale!==n.locale&&this.setState({timestamp:this.getLocalizedState(),currentLocale:n.locale})},t.prototype.componentWillUnmount=function(){clearInterval(this._timerID),clearTimeout(this._lowPriorityTimeout)},t.prototype.render=function(){return o.createElement("time",{role:"status","aria-live":"off","aria-label":this.state.timestamp,dateTime:this.props.date&&this.props.date.toISOString(),className:this.getComposedBlockClassName(),"data-test-id":"swcTimestamp__time_test"},o.createElement("span",{"aria-hidden":"true"},this.state.timestamp))},t.prototype._startInterval=function(){var e=this;this._timerID=setInterval(function(){return e._tick()},6e5)},t.prototype.getLocalizedState=function(){return a.default.toStringMessageDate(this.props.date)},t.prototype._tick=function(){this.setState({timestamp:this.getLocalizedState()})},t}(c.SwcBaseComponent);t.SwcTimestamp=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentDate=function(){return new Date}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(0),c=n(60),u=n(41),l=n(14),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcListItem",t}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.contactId,n=e.jobTitle,i=e.showPersonId,r=e.mutualFriendCount,a=e.displayName;return s.createElement(c.AccessibleListItem,null,s.createElement("div",{role:"button",tabIndex:0,className:this.getComposedBlockClassName(),onClick:this.props.onClick,onContextMenu:this.props.onContextMenu},s.createElement(u.SwcPersonAvatar,{person:this.props.person,isPstn:t.indexOf("4:")>-1,size:u.SwcAvatarSize.Medium,accessible:!1,className:"swcListItem__avatar"}),s.createElement("div",{role:"none",className:"swcListItem__contentContainer"},s.createElement("p",{role:"none",className:"swcListItem__displayName"},a),(i||n)&&s.createElement(o.Fragment,null,i?s.createElement(f,null,t):s.createElement(h,null,n))),r&&s.createElement(d,{count:r})))},t}(n(8).SwcBaseComponent);function d(e){var t=e.count;return s.createElement("div",{role:"none",className:"swcListItem__mutualFriendCountWrapper"},s.createElement(l.SwcIcon,{type:l.SwcIconType.ContactGroupPair}),s.createElement("p",{role:"none",className:"swcListItem__mutualFriendCountText","aria-label":a.swc.services.i18n.fetch("mutual_friends",{count:t})},t))}function f(e){return s.createElement("div",{className:"swcListItem__idWrapper"},s.createElement(l.SwcIcon,{className:"swcListItem__idIcon",type:l.SwcIconType.Skype}),s.createElement("p",{role:"none",className:"swcListItem__id","data-test-id":"contact__id_test"},e.children))}function h(e){return s.createElement("p",{role:"none","data-test-id":"contact__jobTitle_test"},e.children)}t.SwcListItem=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),a=n(2),c=n(3),u=n(1),l=n(86),p=n(71),d=n(26),f=n(0),h=n(52),g=n(14),m=function(e){return f.swc.services.i18n.fetch(e)},v="https://go.skype.com/signup?client_id=578134&redirect_uri=https%3A%2F%2Fweb.skype.com",y=function(e){var t=e.componentConfig,n=e.guestOnly,i=e.isTeams,r=e.signinEnabled,o=e.signIn,s=e.close;return a.createElement("div",{className:"swcSignIn"},a.createElement("div",{className:"swcSignIn__row swcSignIn__row_close"},t.CanClose&&a.createElement("button",{className:"swcSignIn__cancelButton",onClick:s},a.createElement("span",{class:"swcIcon swcIcon_cancel","aria-hidden":"true"}))),a.createElement("div",{className:"swcSignIn__content"},i?a.createElement("div",{className:"icon-chats",dangerouslySetInnerHTML:{__html:f.swc.Assets.SVG.iconChats}}):a.createElement("div",{className:"skype-logo",dangerouslySetInnerHTML:{__html:f.swc.Assets.SVG.skypeLogo}}),a.createElement("div",null,m(n?"you_cannot_sign_in_when_guest_only_mode_enabled":"sign_in_welcome")),r&&!n&&a.createElement("button",{className:"swcSignIn__button",onClick:o},m("sign_in"))),a.createElement("footer",{className:"swcSignIn__row swcSignIn__row_signUp"},a.createElement("p",null,m("do_not_have_account")),a.createElement("a",{className:"swcSignIn__signUpLink",href:v,target:"_blank",rel:"noreferrer noopener"},m("sign_up"))))},_=function(e){var t=e.icon,n=e.text;return a.createElement("li",{className:"swcSignIn__listItem"},a.createElement("div",{class:"icon"},a.createElement(g.SwcIcon,{type:t})),a.createElement("div",{className:"swcSignIn__text"},n))},b=function(e){var t=e.signIn;return a.createElement("div",{className:"swcSignIn"},a.createElement("section",{className:"swcSignIn__topSection"},a.createElement("h2",{className:"swcSignIn__topTitle"},m("msn_signin_screen_title")),a.createElement("ul",{className:"swcSignIn__list"},a.createElement(_,{icon:g.SwcIconType.Contact,text:m("msn_signin_screen_contacts")}),a.createElement(_,{icon:g.SwcIconType.Ok,text:m("msn_signin_screen_recents")}),a.createElement(_,{icon:g.SwcIconType.CallStart,text:m("msn_signin_screen_calling_messaging")}))),a.createElement("section",{className:"swcSignIn__bottomSection"},a.createElement("h2",{className:"swcSignIn__bottomTitle"},m("msn_signin_screen_connect")),a.createElement("div",{className:"swcSignIn__microsoftContent"},a.createElement(g.SwcIcon,{type:g.SwcIconType.LogoMicrosoft}),a.createElement("p",{className:"swcSignIn__text"},m("msn_signin_screen_connect_description"))),a.createElement("footer",{className:"swcSignIn__footer"},a.createElement("div",{className:"swcSignIn__signInContainer"},a.createElement("p",{className:"swcSignIn__text"},m("msn_signin_screen_sign_in_has_account")),a.createElement("button",{className:"swcSignIn__button",onClick:t},m("msn_signin_screen_sign_in_button"))),a.createElement("div",{className:"swcSignIn__signUpContainer"},a.createElement("p",{className:"swcSignIn__text"},m("msn_signin_screen_sign_in_no_account")),a.createElement("a",{className:"swcSignIn__button",href:v,target:"_blank",rel:"noreferrer noopener"},m("msn_signin_screen_create_account_button"))))))},w=function(e){function t(t){var n=e.call(this,t)||this;return n.signIn=function(){return f.swc.services.signInManager.login(function(e){return n.props.params.isSignedIn=!!e})},n.signinEnabled=function(){return n.setState({signinEnabled:l.default.instance.isCleared||n.props.params.explicitSignInRequired||n.props.params.isConversationWithPerson&&f.swc.services.signInManager.userIdentityType===d.IdentityType.GUEST})},n.state={signinEnabled:!1},n}return r(t,e),t.prototype.close=function(){c.default.get.frameless?f.swc.SDK.Chat.resolveMessage({origin:u.Configuration.ORIGIN,action:p.ActionNames.HideChatWindow}):parent&&h.swcPostMessage(parent,{origin:u.Configuration.ORIGIN,action:p.ActionNames.HideChatWindow},document.referrer),f.swc.Telemetry.sendEvent.visibilityChangeQos(!1)},t.prototype.componentWillMount=function(){this.signinEnabled(),l.default.instance.subscribe("isCleared",this.signinEnabled),f.swc.Telemetry.sendEvent.authPageLanding(f.swc.services.signInManager.lastAuthSource)},t.prototype.render=function(){var e={componentConfig:this.props.componentConfig,signinEnabled:this.state.signinEnabled,guestOnly:c.default.get.isGuestOnlyMode,isTeams:c.default.get.isTeams(),signIn:this.signIn,close:this.close};return"msn"===this.props.componentConfig.Style?a.createElement(b,{signIn:this.signIn}):a.createElement(y,o({},e))},t}(s.Component);t.SignIn=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);!function(e){e.OK="ok",e.CANCEL="cancel"}(t.NewChatAction||(t.NewChatAction={})),t.sendChatComposerActionEvent=function(e,t,n,r){var o={name:"chat_composer_action",properties:{action:{value:e},participants:{value:t},isTopicSet:{value:n},ttc:{value:r}}};i.swc.Telemetry.getLogger().logEvent(o)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(530),r="no-transition",o=function(){function e(){var e=this;this.players=function(){return e._players},this.terminatedMedia=function(){return e._terminatedMedia},this.pauseAll=function(){e.players().forEach(function(e){e.pause(),e.mute&&e.mute(!0)})},this.registerPlayer=function(e){var t={id:e.id,isInFullscreen:e.isInFullscreen,pause:e.pause,play:e.play,mute:e.mute?e.mute:null,type:e.mediaType,isPlaying:e.isPlaying,autoplay:e.autoplay,isQueuedForPlaying:e.isQueuedForPlaying,triggeredByUser:e.triggeredByUser};this.players().push(t)},this.removePlayer=function(t){var n=e.getPlayerById(t);n&&e.players().splice(e.players().indexOf(n),1)},this.getPlayerById=function(t){var n;return e.players().forEach(function(e){e.id===t&&(n=e)}),n},this.getPlayingMedia=function(){var t;return e.players().forEach(function(e){(e.isPlaying()||e.isQueuedForPlaying())&&(t=e)}),t},this.onEnteringFullscreen=function(t){e.mainComponentElement&&e.mainComponentElement.classList.add(r),e.playerInFullscreen=t},this.onLeavingFullscreen=function(){e.mainComponentElement&&e.mainComponentElement.classList.remove(r),e.playerInFullscreen=null},this.onFullScreenChanged=function(t){if(!(t.target&&(t.target.id&&"yt_msg_"===t.target.id.substring(0,7)||t.target.activeElement&&t.target.activeElement.id&&"yt_msg_"===t.target.activeElement.id.substring(0,7)))){var n=document,i=!!(n.fullscreenElement||n.mozFullScreenElement||n.webkitFullscreenElement||n.msFullscreenElement);e.playerInFullscreen&&e.playerInFullscreen.isInFullscreen(i),i||e.onLeavingFullscreen()}},this.onClientBlurred=function(){var t=e.getPlayingMedia();t&&!t.triggeredByUser()&&(t.pause(),e.terminatedMedia=t)},this.onClientFocused=function(){e.terminatedMedia&&e.terminatedMedia().play&&(e.terminatedMedia().play(),e.terminatedMedia=null)},this.dispose=function(){document.removeEventListener("webkitfullscreenchange",e.onFullScreenChanged),document.removeEventListener("mozfullscreenchange",e.onFullScreenChanged),document.removeEventListener("MSFullscreenChange",e.onFullScreenChanged),document.removeEventListener("fullscreenchange",e.onFullScreenChanged),document.removeEventListener(i.default.events.browser.BLUR,e.onClientBlurred),document.removeEventListener(i.default.events.browser.FOCUS,e.onClientFocused)}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e,e._instance.init()),e._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this._players=[],this._terminatedMedia=null,this.mainComponentElement=document.querySelector(".swc.main-component"),document.addEventListener("webkitfullscreenchange",this.onFullScreenChanged),document.addEventListener("mozfullscreenchange",this.onFullScreenChanged),document.addEventListener("MSFullscreenChange",this.onFullScreenChanged),document.addEventListener("fullscreenchange",this.onFullScreenChanged),document.addEventListener(i.default.events.browser.BLUR,this.onClientBlurred),document.addEventListener(i.default.events.browser.FOCUS,this.onClientFocused)},Object.defineProperty(e.prototype,"playerInFullscreen",{get:function(){return this._playerInFullscreen},set:function(e){e!==this._playerInFullscreen&&(this._playerInFullscreen=e)},enumerable:!0,configurable:!0}),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(53),o=n(28),s=function(){function e(){var e=this;this.handlers=[],this.dispose=function(){o.default.getWindow().removeEventListener("resize",e.windowResizeHandler)},this.getCurrentStyle=function(){return(e.forcedWidth||o.default.getWindow().innerWidth)<356?i.NARROW:i.NORMAL},this.onResize=function(){e._currentStyle=e.getCurrentStyle();for(var t=0,n=e.handlers;t<n.length;t++){var i=n[t];try{i()}catch(e){}}};this.windowResizeHandler=r(this.onResize,500),o.default.getWindow().addEventListener("resize",this.windowResizeHandler)}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CurrentStyle",{get:function(){return this._currentStyle},enumerable:!0,configurable:!0}),e.prototype.forceWidth=function(e){this.forcedWidth=e,this._currentStyle=this.getCurrentStyle()},e.prototype.addResizeHandler=function(e){-1===this.handlers.indexOf(e)&&this.handlers.push(e)},e.prototype.removeResizeHandler=function(e){var t=this.handlers.indexOf(e);-1!==t&&this.handlers.splice(t,1)},e}();t.default=s,function(e){e[e.NARROW=0]="NARROW",e[e.NORMAL=1]="NORMAL"}(i=t.StyleModes||(t.StyleModes={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(36),r=function(){function e(e){this.text=e}return e.prototype.applySuggestion=function(){var e=this.text.value,t=i.wordBoundariesAt(e,this.text.selectionStart),n=this.getReplacer(),r=e.slice(t.end);return""===r&&(n+=" "),{value:e=e.slice(0,t.start)+n+r,selectionStart:this.text.selectionStart,selectionEnd:t.start+n.length}},e}();t.Suggestion=r},,,,,,,,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(28),a=n(447),c=n(458),u=s.default.getDocument(),l=60,p=".timeline",d=function(e){function t(t,n){var i=e.call(this,t)||this;return i.isInFullscreen=ko.observable(!1),i.play=function(){i.queuedForPlaying=!i.isLoaded,i.isLoaded?(i.player.play(),i.isPlaying(!0),i.onLoadedActionHandler=null):i.onLoadedActionHandler=i.play},i.pause=function(){i.queuedForPlaying=!1,i.touchedByUser=!1,i.isLoaded?(i.player.pause(),i.isPlaying(!1),i.onLoadedActionHandler=null):i.onLoadedActionHandler=i.pause},i.togglePlay=function(){i.player.paused||i.player.ended?(a.default.instance.pauseAll(),i.play(),i.mute(!1),i.touchedByUser=!0):i.pause()},i.getCurrentTime=function(){return i.formatTime(i.currentTimeUnformatted())},i.getTotalTime=function(){return i.formatTime(i.totalTimeUnformatted())},i.getPlayButtonText=function(){var e=i.isPlaying()?"mediaPlayer_pause":"mediaPlayer_play";return o.swc.services.i18n.fetch(e)},i.formatTime=function(e){var t=Math.round(e),n=0;return t>=l&&(t-=(n=parseInt((t/l).toString(),10))*l),i.addLeadingZero(n)+":"+i.addLeadingZero(t)},i.onTimeUpdated=function(){i.currentTimeUnformatted(i.player.currentTime),i.setProgress(i.currentTimeUnformatted()/i.totalTimeUnformatted()*100)},i.isQueuedForPlaying=function(){return i.queuedForPlaying},i.triggeredByUser=function(){return i.touchedByUser},i.dispose=function(){i.currentTime.dispose(),i.totalTime.dispose(),i.playButtonText.dispose(),a.default.instance.removePlayer(i.id)},i.isPlaying=ko.observable(!1),i.currentProgress=ko.observable("0"),i.progressBar=t.querySelector(p),i.currentTime=ko.computed(i.getCurrentTime),i.totalTime=ko.computed(i.getTotalTime),i.playButtonText=ko.computed(i.getPlayButtonText),i.mediaType=n,i}return r(t,e),t.prototype.mute=function(e){this.player&&this.isMuted&&(this.player.muted=e,this.isMuted(e))},t.prototype.addLeadingZero=function(e){return 1===e.toString().length?"0"+e:e},t.prototype.setProgress=function(e){this.currentProgress("width: "+e+"%")},t.prototype.updateRange=function(e){var t=this.progressBar.offsetWidth,n=this.progressBar.getBoundingClientRect().left,i=e.pageX-n;this.player.currentTime=this.player.duration*(i/t),this.setProgress(i/t*100)},t.prototype.onTimelineClick=function(e,t){this.updateRange(t)},t.prototype.onHandleStartDrag=function(e,t){this.updateRange(t),u.addEventListener("mousemove",this.updateRange),u.addEventListener("mouseup",function(){u.removeEventListener("mousemove",this.updateRange),u.removeEventListener("mouseup",this.onMouseUp)})},t}(c.MediaLoader);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=".player",r=function(){function e(e){var t=this;this.element=e,this.canPlay=ko.observable(),this.isLoading=ko.observable(),this.failed=ko.observable(),this.onMetadataLoaded=function(){t.isLoaded=!0,t.onLoadedActionHandler&&t.onLoadedActionHandler(),t.currentTimeUnformatted(t.player.currentTime),t.totalTimeUnformatted(t.player.duration)},this.canPlay=ko.observable(!1),this.isLoading=ko.observable(!0),this.failed=ko.observable(!1),this.isLoaded=!1,this.currentTimeUnformatted=ko.observable(0),this.totalTimeUnformatted=ko.observable(0),this.player=this.element.querySelector(i)}return e.prototype.onError=function(){this.canPlay(!1),this.isLoading(!1),this.failed(!0)},e.prototype.onReady=function(){this.canPlay(!0),this.isLoading(!1),this.failed(!1)},e}();t.MediaLoader=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(14);t.getFileIconTypeByExtension=function(e){switch(e){case"xls":case"xlsx":return i.SwcIconType.MsExcel;case"doc":case"docx":return i.SwcIconType.MsWord;case"ppt":case"pptx":return i.SwcIconType.MsPowerPoint;case"one":return i.SwcIconType.MsOneNote;case"pdf":return i.SwcIconType.Pdf;case"vdx":case"vsd":case"vsdx":return i.SwcIconType.MsVisio;default:return i.SwcIconType.File}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(58),a=n(0),c=n(8),u=n(14),l=n(357),p=function(e){return a.swc.services.i18n.fetch(e)},d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcFileStatus",t}return r(t,e),t.prototype.render=function(){var e=this.props.status,t=!1,n=!1,i=!1;switch(e){case s.DocumentStatus.Success:t=!0;break;case s.DocumentStatus.InProgress:case s.DocumentStatus.ScanInProgress:i=!0;break;case s.DocumentStatus.Failed:case s.DocumentStatus.Malware:n=!0}var r=function(e){var t="";switch(e){case s.DocumentStatus.Failed:t=p("message_text_upload_failed");break;case s.DocumentStatus.ScanInProgress:t=p("message_text_scanning");break;case s.DocumentStatus.InProgress:t=p("message_text_uploading");break;case s.DocumentStatus.Malware:t=p("message_text_malware");break;case s.DocumentStatus.Success:t=p("message_text_upload_complete")}return t}(e);return o.createElement("div",{className:this.getComposedBlockClassName(),title:r},i&&o.createElement(l.SwcSpinner,{className:"swcFileStatus__icon"}),t&&o.createElement(u.SwcIcon,{className:"swcFileStatus__icon",type:u.SwcIconType.Ok}),n&&o.createElement(u.SwcIcon,{className:"swcFileStatus__icon",type:u.SwcIconType.Error}))},t}(c.SwcBaseComponent);t.SwcFileStatus=d},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(165),s=n(58),a=n(0),c=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="",n.state={status:null},n}return r(t,e),t.prototype.checkFileStatus=function(e,t){var n=this,i=!!t&&o.isImage(e);a.swc.services.amsManager.getFileStatus(e.id,i).then(function(i){n.setState({status:i.uploadStatus}),i.uploadStatus!==s.DocumentStatus.InProgress&&i.uploadStatus!==s.DocumentStatus.ScanInProgress||(n._timeoutId=setTimeout(function(){n.checkFileStatus(e,t)},500))})},t.prototype.componentWillUnmount=function(){this._timeoutId&&clearTimeout(this._timeoutId)},t}(n(8).SwcBaseComponent);t.SwcEnterpriseItemBase=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(0),a=n(136),c=n(541),u=n(358),l=n(463),p=n(542),d=n(543),f=n(101),h="9:16",g="portrait",m="landscape",v=function(){return function(){this.unsupportedText=s.swc.services.i18n.fetch("s_unsupported"),this.vatText=s.swc.services.i18n.fetch("s_vat"),this.taxText=s.swc.services.i18n.fetch("s_tax"),this.totalPriceText=s.swc.services.i18n.fetch("s_totalPrice"),this.areButtonsMultiLine=!1,this.mainSection=null}}();t.BaseContent=v;var y=function(e){function t(n,i,r,s){var c=e.call(this)||this;c.computeButtonsLimit=function(){if(c.type===o.SwiftCardContentType.thumb)return 3;var e=3;return 0===c.mainSection.images.length&&(e+=2),c.mainSection.text||(e++,c.mainSection.title||e++,c.mainSection.subtitle||e++),Math.min(e,6)},c.isValid=function(){return 0!==c.buttons.length?c.buttons.every(function(e){return e.isValid()}):c.mainSection.isValid()},c.isSupported=function(){var e=c.buttons.every(function(e){return e.isSupported()});return c.isValid()&&e},c.type=s,c.buttons=f.default.filterOutDisabledItems(n.buttons,function(e){return new a.default(e,i,r)}),c.tap=n.tap?f.default.getItemIfNotDisabled(new a.default(n.tap,i,r)):null,c.mainSection=new d.default(n,i,r,s);var u=c.computeButtonsLimit();return c.buttons.length>u&&(c.buttons=c.buttons.slice(0,u)),c.areButtonsMultiLine=t.areButtonsMultiLine(c.buttons),c}return r(t,e),t.areButtonsMultiLine=function(e){switch(e.length){case 2:return!e.every(function(e){return e.title.length<=11});case 3:return!e.every(function(e){return e.title.length<=5})}return!0},t}(v);t.default=y;var _=function(e){function t(t,n,i){var r=e.call(this)||this;r.isValid=function(){return 0!==r.buttons.length&&!!r.text},r.isSupported=function(){return r.isValid()},r.find=function(e,t){var n;for(n=0;n<e.length;++n)if(t(e[n],n,e))return e[n]},r._conversation=n,r.type=o.SwiftCardContentType.signin,r.buttons=f.default.filterOutDisabledItems(t.buttons,function(e){return new a.default(e,n,i)});var s=r.find(r.buttons,function(e){return e.type===o.SwiftCardActionType.signin});return r.buttons=s?[s]:[],r.text=f.default.normalizeRichText(t.text),r}return r(t,e),t}(v);t.SignInContent=_;var b=function(e){function t(t,n,i,r){var o=e.call(this)||this;return o.hasUrl=function(){return!!o.image&&!!o.image.url},o.hasTitle=function(){return!!o.title||!!o.subtitle},o.isValid=function(){return!!o.media&&!!o.media.isValid()},o.isSupported=function(){return o.isValid()},o.type=r,o.autoloop=t.autoloop,o.autostart=t.autostart,o.shareable=t.shareable,o.subtitle=t.subtitle?f.default.normalizeRichText(t.subtitle):null,o.title=t.title?f.default.normalizeRichText(t.title):null,o.image=new u.default(t.image||{},n,i,r),o.aspect=t.aspect&&t.aspect===h?g:m,o.hasThumbnail=ko.computed(o.hasUrl),o.hasTextInfo=ko.computed(o.hasTitle),o.media=t.media&&t.media.length?new p.default(t.media[0],n,i,r):null,o.buttons=f.default.filterOutDisabledItems(t.buttons,function(e){return new a.default(e,n,i)}),o.buttons.length>3&&(o.buttons=o.buttons.slice(0,3)),o.areButtonsMultiLine=y.areButtonsMultiLine(o.buttons),o}return r(t,e),t}(v);t.MediaContent=b;var w=function(e){function t(n,i,r){var u=e.call(this)||this;return u.itemsForInitialDisplay=[],u.triggerFoldAction=function(){u.isCollapsed(!u.isCollapsed()),u.isCollapsed()?u.collapseItems():(u.displayedItems(u.items),u.foldButtonText(s.swc.services.i18n.fetch("s_showLess")))},u.isValid=function(){var e=u.buttons.every(function(e){return e.isValid()});return!!u.total&&e},u.isSupported=function(){var e=u.buttons.every(function(e){return e.isSupported()});return u.isValid()&&e},u.collapseItems=function(){u.displayedItems(u.itemsForInitialDisplay),u.foldButtonText(s.swc.services.i18n.fetch("s_showAll"))},u.getItemsForInitialDisplay=function(){for(var e=0,n=0;n<u.items.length;n++){if(e>=t.MAX_ITEMS_NUMBER_TO_DISPLAY)return;u.itemsForInitialDisplay.push(u.items[n]),u.items[n].images.length>0?e+=t.IMAGE_ITEM_COUNTER:e++}u.itemsForInitialDisplay=[]},u._conversation=i,u.type=o.SwiftCardContentType.receipt,u.buttons=f.default.filterOutDisabledItems(n.buttons,function(e){return new a.default(e,i,r)}),u.buttons.length>3&&(u.buttons=u.buttons.slice(0,3)),u.areButtonsMultiLine=y.areButtonsMultiLine(u.buttons),u.tap=n.tap?new a.default(n.tap,i,r):null,u.title=f.default.normalizeRichText(n.title),u.total=f.default.normalizeText(n.total),u.tax=f.default.normalizeText(n.tax),u.vat=f.default.normalizeText(n.vat),u.facts=f.default.filterOutNotValidItems(n.facts,function(e){return new c.default(e)}),u.items=f.default.filterOutNotValidItems(n.items,function(e){return new d.default(e,i,r,o.SwiftCardContentType.thumb)}),u.displayedItems=ko.observableArray(),u.showFoldButton=ko.observable(!1),u.isCollapsed=ko.observable(!1),u.foldButtonText=ko.observable(),u.getItemsForInitialDisplay(),u.itemsForInitialDisplay.length>0?(u.showFoldButton(!0),u.isCollapsed(!0),u.collapseItems()):u.displayedItems(u.items),u}return r(t,e),t.MAX_ITEMS_NUMBER_TO_DISPLAY=5,t.IMAGE_ITEM_COUNTER=3,t}(v);t.ReceiptContent=w;var C=function(e){function t(t,n,i,r){var s=e.call(this)||this;s.expandedText=function(){return s.title&&s.subtitle?"":s.title||s.subtitle?"expandedTextOnce":"expandedTextTwice"},s.isValid=function(){return!!s.title||!!s.subtitle||!!s.text||0!==s.images.length},s.isSupported=function(){return s.isValid()},s.computeButtonsLimit=function(){if(s.type===o.SwiftCardContentType.thumb)return 3;var e=3;return 0===s.images.length&&(e+=2),s.text||(e++,s.title||e++,s.subtitle||e++),Math.min(e,6)},s._conversation=n,s.type=r,s.buttons=f.default.filterOutDisabledItems(t.buttons,function(e){return new a.default(e,n,i)}),s.title=t.title?f.default.normalizeRichText(t.title):null,s.subtitle=t.subtitle?f.default.normalizeRichText(t.subtitle):null,s.text=t.text?f.default.normalizeRichText(t.text):null,s.tap=t.tap?f.default.getItemIfNotDisabled(new a.default(t.tap,n,i)):null,s.images=t.images?l.default.mapImages(t.images,n,i,s.type):[];var c=s.computeButtonsLimit();return s.buttons.length>c&&(s.buttons=s.buttons.slice(0,c)),s.areButtonsMultiLine=y.areButtonsMultiLine(s.buttons),s}return r(t,e),t}(v);t.FlexContent=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(358),r=function(){function e(){}return e.mapImages=function(e,t,n,r){var o=[];return e.forEach(function(e){e.url&&o.push(new i.default(e,t,n,r))}),o},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(20),s=n(3),a=n(1),c=n(47),u=n(105),l=n(352),p=n(4),d=n(5),f=n(39),h=n(79),g=n(0),m=n(56),v=n(170),y=n(356),_=n(353),b=n(354),w=n(43),C=n(25),S=n(139),T=n(42),E=n(359),P=n(41),I=n(355),k=n(185),M=n(135),O={FILE:"filemessage",IMAGE:"imagemessage",SWIFT:"swiftContainer",WELCOME:"welcome"},A={ME:"me",OTHER:"other",NEW:"new",FIRST:"isFirst",GROUP:"group",LESS:"less"},x={USER:"UserMessage",SWIFT:"SwiftCard",SYSTEM:"SystemMessage",WELCOME:"Welcome",TRANSLATE:"Translate",IMAGE:"LwcImage",FILE:"LwcFile"},N=", ",L="tag-",R=function(e,t){return g.swc.services.i18n.fetch(e,t)},D=function(){function e(e,t,n,D){var U=this;if(this.message=e,this.conversation=t,this._conversationElement=n,this.timestamp=ko.observable(""),this.messageFromMe=!1,this.author=ko.observable(),this.showAuthor=ko.observable(!1),this.isGroup=!1,this.statusClassName=ko.observable(""),this.status=ko.observable(),this.isNew=ko.observable(!0),this.type=p.MessageType.UserMessage,this.showMessageInfo=ko.observable(!1),this.showTimestamp=ko.observable(!1),this.showEditedIcon=ko.observable(!1),this.isDeletedMessage=ko.observable(!1),this.textOpenMenu=ko.observable(""),this.textDeleteMessage=ko.observable(""),this.textDeleteMessageHeader=ko.observable(""),this.textOpenReactionsPane=ko.observable(""),this.textEditMessageTitle=ko.observable(""),this.textEditedMessage=ko.observable(""),this.textUnreadFromHere=ko.observable(""),this.textCopyMessage=ko.observable(""),this.textDownload=ko.observable(""),this.textUploadFailed=ko.observable(""),this.textMessageError=ko.observable(""),this.textMessageScanning=ko.observable(""),this.textMessageUploading=ko.observable(""),this.textMessageMalware=ko.observable(""),this.textMessageUploadComplete=ko.observable(""),this.textMessageRetry=ko.observable(""),this.showMessageActions=ko.observable(!1),this._reactionItems={},this.hasReactions=ko.observable(!1),this.reactionsPaneEnabled=!1,this.reactionsPaneItems=[],this._userCanDeleteMessages=!1,this._userCanEditMessages=!1,this.isContentExpanded=ko.observable(),this.contentLimitValue=ko.observable(""),this.localizeResources=function(){U.timestamp(y.default.toStringMessageDate(U.message.timestamp,{dateWithTime:!0})),U.textOpenMenu(R("open_menu_dialog_text")),U.textEditMessageTitle(R("confirm_dialog_edit_msg_header")),U.textEditedMessage(R("icon_text_message_was_edited")),U.textDeleteMessageHeader(R("confirm_dialog_delete_msg_header")),U.textDeleteMessage(R("confirm_dialog_delete_msg_text")),U.textOpenReactionsPane(R("reactions_react_to_message")),U.textUnreadFromHere(R("unread_from_here")),U.textCopyMessage(R("copy_message")),U.textDownload(R("message_text_download")),U.textUploadFailed(R("message_text_upload_failed")),U.textMessageError(R("message_text_error")),U.textMessageScanning(R("message_text_scanning")),U.textMessageUploading(R("message_text_uploading")),U.textMessageMalware(R("message_text_malware")),U.textMessageUploadComplete(R("message_text_upload_complete")),U.textMessageRetry(R("message_text_retry"))},this._updateItems=function(e,t){e.forEach(function(e){for(var n=0;n<U.reactionsPaneItems.length;n++){var i=U.reactionsPaneItems[n];if(s.default.get.isTeams()&&"like"===e.key&&(e.key="yes"),e.key===i.id)for(var r=0;r<e.users.length;r++)if(g.swc.services.mePersonManager.isMe(e.users[r].mri)){i.selected=t,t?U._reactionItems[i.id].classList.add("selected"):U._reactionItems[i.id].classList.remove("selected");break}}})},this._addReactionsToFragment=function(){if(!(U._mapReactionPaneItems.length<1)){U._reactionElement=document.createElement("div"),U._reactionElement.className="swc-scroll-wrapper";var e=document.createElement("div");e.className="swc-scroll-viewport",o.AbilityHelpers.list.add(e);var t=document.createElement("div");t.className="reactionsPane",t.setAttribute("role","list");for(var n=document.createDocumentFragment(),s=function(e){var t=U.reactionsPaneItems[e],s=document.createElement("div");o.AbilityHelpers.list.addItem(s),s.className="reaction",s.setAttribute("role","listitem"),s.setAttribute("tabindex","0"),t.selected&&s.classList.add("selected");var a={callback:function(){}},c={large:!0,largeEmoticonClass:"large",emoticonId:t.id,title:t.title,isAnimated:t.selected,setUpdateCallback:function(e){a.callback=e}},u=r.createElement(M.SwcEmoticon,c),l=document.createDocumentFragment();i.render(u,l);var p=function(){a.callback({isAnimated:!0})},d=function(){a.callback({isAnimated:!1})};s.addEventListener("mouseover",p),s.addEventListener("mouseout",d),s.addEventListener("focus",p),s.addEventListener("blur",d),s.appendChild(l);var f=document.createElement("span");f.className="selectedPoint",s.appendChild(f);s.addEventListener("click",function(e){t.selected?(U._removeReactionOnMessage(t,e),s.classList.remove("selected")):(U._setReactionOnMessage(t,e),s.classList.add("selected")),a.callback({isAnimated:!t.selected})}),s.addEventListener("keydown",function(e){e.stopPropagation();var t=w.default.getKeyCode(e);t!==C.default.ENTER&&t!==C.default.SPACE||s.click(),t===C.default.ESCAPE&&g.swc.Eventing.triggerLocalEvent("hideBubbleWindow")}),n.appendChild(s),U._reactionItems[t.id]=s},a=0;a<U.reactionsPaneItems.length;a++)s(a);t.appendChild(n),e.appendChild(t),U._reactionElement.appendChild(e),U.reactionScrollBar=new u.default(U._reactionElement,U._reactionElement.firstChild)}},this._mapReactionPaneItems=function(e){for(var t=[],n=0;n<U.ecsReactionsPack.length;n++){var i=e[U.ecsReactionsPack[n]];i&&t.push({id:i.id,title:i.description||i.id,selected:!1})}return t},this._setReactionSelectedState=function(e){for(var t=function(t){for(var n=e[t],i=!1,r=0;r<n.users.length;r++)if(n.users[r].person.id===U._mePersonId){i=!0;break}i&&U.reactionsPaneItems.forEach(function(e){s.default.get.isTeams()&&"like"===n.key&&(n.key="yes"),n.key===e.id&&(e.selected=!0)})},n=0;n<e.length;n++)t(n)},this._isUserMessage=function(){return"UserMessage"===U.message.type},this.triggerEditMessageAction=function(){g.swc.Eventing.triggerEvent("requestEditingMessage",{convId:U.conversation.id,message:U.message})},this.copyMessageAction=function(e,t){var n=f.default.dompurify.sanitize(U.message.content,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]}),i=t.currentTarget,r=i&&i.ownerDocument?i.ownerDocument:document,o=r.createElement("textarea");o.value=n,r.body.appendChild(o),o.select(),r.execCommand("Copy"),r.body.removeChild(o)},this.openDeleteMsgConfirmationDialog=function(){var e=function(){g.swc.Telemetry.sendEvent.userAction(h.UserActionType.DeleteMessage),U.conversation.deleteMessage(U.message)};k.ConfirmationDialog.add(U._conversationElement,function(){return _.createConfirmationDialog(U.textDeleteMessageHeader(),U.textDeleteMessage(),{title:R("btn_confirm_removal"),action:e},{title:R("sign_in_cancel")})},I.SwcTextDialog)},this.triggerUnreadFromHere=function(){var e=U._getPreviousMessage(),t=e.getKey(),n=e.timestamp.getTime()+";"+(new Date).getTime()+";"+t;s.default.get.isTeams()?g.swc.services.webApi.updateConsumptionHorizonBookmark(U.conversation.id,n).then(function(){U.conversation.updateConsumptionHorizon(n),U.conversation.isUnreadBookmark=!0}):g.swc.services.webApi.updateConsumptionHorizon(U.conversation.id,n).then(function(){U.conversation.updateConsumptionHorizon(n)}),g.swc.Telemetry.sendEvent.userAction(h.UserActionType.MarkMessageUnread)},this._setReactionOnMessage=function(e,t){e.id&&(t.preventDefault(),U.conversation.setMessageProperty(U.conversation.id,U.message.id,a.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS,{key:e.id}).then(function(){e.selected=!0,g.swc.Telemetry.sendEvent.reactionSet(e.id)}))},this._removeReactionOnMessage=function(e,t){e.id&&U.conversation.removeMessageProperty(U.conversation.id,U.message.id,a.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS,{key:e.id}).then(function(){e.selected=!1})},this.openReactionsPane=function(e,t){if(U._reactionElement&&U.reactionsPaneItems.length){t.preventDefault(),t.stopPropagation();var n=t.target,i={target:t.target,clientX:t.clientX||n.getBoundingClientRect().right,clientY:t.clientY||n.getBoundingClientRect().top};E.default.add(i,U.messageListElement,U._reactionElement,E.BubbleType.ReactionPane,E.BubblePosition.onContextMenu),U.reactionScrollBar&&(U.reactionScrollBar.recount(),g.swc.services.pesManager.refresh()),g.swc.Telemetry.sendEvent.userAction(h.UserActionType.ReactionPicker)}},this.openMessageActions=function(e,t){if(t.target&&U.message.type!==p.MessageType.SystemMessage){var n=U.getMessageActions();if(n.length){var i=S.default.createMenuList(n,"msgActionsMenuList");t.preventDefault(),t.stopPropagation(),E.default.add(t,U.messageListElement,i,E.BubbleType.List,E.BubblePosition.onContextMenu)}}},this._setAvatarVM=function(e,t){if(!g.swc.services.mePersonManager.isMe(U.message.senderId)){var n=e?e.nextElementSibling:null;if(U._avatarContainer=n?n.querySelector(".headerAvatar"):null,U._avatarContainer){var o={person:t,size:P.SwcAvatarSize.Medium},s=r.createElement(P.SwcPersonAvatar,o);i.render(s,U._avatarContainer)}}},this._showAuthor=function(){return!U.messageFromMe&&"Welcome"!==U.message.type},this.mapMessageTypeClassName=function(){switch(U.type){case x.FILE:return O.FILE;case x.WELCOME:return O.WELCOME;case x.IMAGE:return O.IMAGE;case x.SWIFT:return O.SWIFT;default:return""}},this.setClassNames=function(){var e=[];return e.push(U.messageTypeClassName),e.push(U.messageFromMe?A.ME:A.OTHER),U.isNew()&&e.push(A.NEW),U.showAuthor()&&e.push(A.FIRST),U.isGroup&&e.push(A.GROUP),U.isContentExpanded()&&e.push(A.LESS),U.message.senderId&&0===U.message.senderId.indexOf("28:")&&e.push("bot"),U.tags&&v.default.explode(U.tags).forEach(function(t){return e.push(L+t)}),e.join(" ")},this._startChatFromContactTeams=function(e,t){var n=[{role:"Admin",id:g.swc.services.mePersonManager.mePerson.mri},{role:"Admin",id:e}],i=function(e){var n=e.headers.get("location").match(/threads\/(19:.*)$/)[1];m.default.startChat(n,U.conversation.definition,!1,t)},r=function(e){};l.findRecentConversationIdForMembers(n).then(function(e){m.default.startChat(e,U.conversation.definition,!1,t)}).catch(function(e){g.swc.services.webApi.createThread(n).then(i,r)})},this.navigateToChat=function(e){s.default.get.disableAvatarClickAction||(s.default.get.isTeams()?U._startChatFromContactTeams(e,c.OpenChatOrigin.AVATAR):m.default.startChat(e,U.conversation.definition,!1,c.OpenChatOrigin.AVATAR))},this.onAvatarKeyDown=function(e,t){var n=w.default.getKeyCode(t);n!==C.default.ENTER&&n!==C.default.SPACE||t.target.click()},this.dispose=function(){U.message.senderId&&U.updateDisplayName&&g.swc.services.persons.getPerson(U.message.senderId).unsubscribe("displayName",U.updateDisplayName);U.message.unsubscribe("isFirst",U.updateMessageInfo),U.message.unsubscribe("status",U.subscribeToDeliveryStatus),U._avatarContainer&&i.render(null,U._avatarContainer),g.swc.Eventing.unregisterEvent("proxy:configuration:setLanguage:response",U.localizeResources)},this.updateDisplayName=function(){var e=g.swc.services.persons.getPerson(U.message.senderId);e.displayName&&U.author(e.displayName+N)},this.updateMessageInfo=function(e){U.showAuthor(U._showAuthor()&&e),U.showTimestamp(e),U.showMessageInfo((U.showAuthor()||U.showTimestamp())&&U.conversation.isSkypeBackend()&&"SystemMessage"!==U.message.type&&"UnreadSplitter"!==U.message.type&&"SkypeLogo"!==U.message.type&&"Welcome"!==U.message.type)},s.default.get.isTeams()?this.ecsReactionsPack=["yes"]:this.ecsReactionsPack=a.Configuration.ECS.reactionPacks||[],this.reactionsPaneEnabled=!b.default.isDomainIn("disableSendingReactions")&&"SystemMessage"!==e.type&&"UnreadSplitter"!==e.type&&!!this.ecsReactionsPack.length,this.isContentExpanded(!1),this.messageListElement=D.parentNode,this._mePersonId=g.swc.services.mePersonManager.mePerson.id,this.localizeResources(),t.definition.MessageContentLimit=t.definition.MessageContentLimit?"130px":"",this.reactionsPaneItems=this._mapReactionPaneItems(g.swc.services.pesManager.emoticonMap),this._setReactionSelectedState(e.emotions),this._addReactionsToFragment(),this.type=e.type,this.senderId=e.senderId,this.messageTypeClassName=this.mapMessageTypeClassName(),"SystemMessage"!==e.type&&"UnreadSplitter"!==e.type){if(e.subscribe("isFirst",this.updateMessageInfo),this.message.senderId){var F=g.swc.services.persons.getPerson(this.message.senderId,!0),j=this.message.senderId;e.imdisplayname?(j=e.imdisplayname,d.ServicesManager.cbl.messages.setImDisplayName(F,e.imdisplayname),F&&(F.imDisplayName=e.imdisplayname)):(F.imDisplayName="",F.subscribe("displayName",function(e){e&&U.author(e+N)}),j=F.displayName),this._setAvatarVM(D,F),j&&this.author(j+N);var B=g.swc.services.mePersonManager.isMe(T.default.normalizePersonId(e.senderId));this.messageFromMe=!!e.senderId&&B}else this.messageFromMe=e.direction===p.Direction.Outgoing;this.showAuthor(this._showAuthor())}g.swc.services.capabilitiesService.getCapabilitiesForConversation(this.conversation).then(function(e){U.showMessageActions(U.messageFromMe&&!t.definition.HideMessageActionsMenu&&e.allowDeleteMessage),U._userCanDeleteMessages=e.allowDeleteMessage,U._userCanEditMessages=e.allowEditMessage}),this.isGroup=t.isGroup,this.subscribeToDeliveryStatus(e),e.isEdited&&e.type!==p.MessageType.SystemMessage&&this.showEditedIcon(this._isUserMessage()),e.subscribe("isEdited",function(t){e.type!==p.MessageType.SystemMessage&&U.showEditedIcon(t)}),this.isDeletedMessage(e.isDeleted),e.subscribe("isDeleted",function(e){U.isDeletedMessage(e)}),e.subscribe("content",function(e){""!==e&&setTimeout(function(){g.swc.services.pesManager.refresh()})}),this.classNames=ko.pureComputed(this.setClassNames),this.hasReactions(!!e.emotions&&!!e.emotions.length),e.emotions&&e.emotions.subscribe(function(e,t){t.newItems&&t.newItems.length>0?U._updateItems(t.newItems,!0):t.oldItems&&t.oldItems.length>0&&U._updateItems(t.oldItems,!1),U.hasReactions(!!e.length)}),g.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",this.localizeResources)}return Object.defineProperty(e.prototype,"properties",{get:function(){var e,t=this.message.properties;if(t)if("string"==typeof t)try{e=JSON.parse(t)}catch(e){}else"object"==typeof t&&(e=t);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tags",{get:function(){return this.properties?this.properties.tags:null},enumerable:!0,configurable:!0}),e.prototype._getPreviousMessage=function(){for(var e=this.conversation.messages,t=this.message.getKey(),n=e[0],i=e.length-1;i>0;i--)if(e[i].getKey()===t){n=e[i-1];break}return n},e.prototype.getMessageActions=function(){var e=this.message.type===x.USER&&this._userCanEditMessages,t=this._userCanDeleteMessages,n=[{items:[],id:"messageOptions"}];return this.message.type!==p.MessageType.LwcImage&&this.message.type!==p.MessageType.LwcFile&&n[0].items.push({title:this.textCopyMessage(),group:1,action:this.copyMessageAction}),this.messageFromMe?(e&&n[0].items.push({title:this.textEditMessageTitle(),group:1,action:this.triggerEditMessageAction}),t&&n[0].items.push({title:this.textDeleteMessageHeader(),group:1,action:this.openDeleteMsgConfirmationDialog})):this.message.type!==p.MessageType.SystemMessage&&n[0].items.push({title:this.textUnreadFromHere(),group:1,action:this.triggerUnreadFromHere}),n},e.prototype.seeMore=function(){this.isContentExpanded(!0),this.contentLimitValue("inherit"),g.swc.Eventing.triggerEvent("onMessageExpand")},e.prototype.seeLess=function(){this.isContentExpanded(!1),this.contentLimitValue(this.conversation.definition.MessageContentLimit),g.swc.Eventing.triggerEvent("onMessageCollapse")},e.prototype.subscribeToDeliveryStatus=function(e){var t=this;if("SystemMessage"!==this.message.type&&"UnreadSplitter"!==this.message.type){var n=function(){switch(e.status){case 0:t.status(R("sending")),t.statusClassName("sending");break;case 1:t.status(R("sent")),t.statusClassName("");break;case 2:t.status(R("failed")),t.statusClassName("failed");break;default:t.status(""),t.statusClassName("")}};e.subscribe("status",n),n()}},e}();t.BaseMessage=D},function(e,t){e.exports='<div class="lwx-message">\r\n    \x3c!-- ko if: !imageContent()  --\x3e\r\n        <div class="content" data-bind="style:{\r\n                backgroundColor: messageColor,\r\n                background: messageColor\r\n            },\r\n            css: { sticker: isExtraLargeEmoticon, bot: isAgent, withReactions: $parent.hasReactions,\r\n                system: isSystemMsg()}">\r\n            \x3c!-- ko if: content --\x3e\r\n                <span class="text" data-bind="html: content, click: clickHandler"></span>\r\n            \x3c!-- /ko --\x3e\r\n\r\n            \x3c!-- ko if: $parent.reactionsPaneEnabled && !$parent.messageFromMe --\x3e\r\n            <button class="reactionsBtn" data-bind="click: $parent.openReactionsPane,\r\n            attr: {title: $parent.textOpenReactionsPane}">\r\n                <span class="swcIcon swcIcon_emoticonStroke" aria-hidden="true"></span>\r\n            </button>\r\n            \x3c!-- /ko --\x3e\r\n            <reactions-bar class="reactionsBar" params="message: message, messageListElement: messageList"></reactions-bar>\r\n\r\n            <div class="filesContainer"></div>\r\n        </div>\r\n\r\n        \x3c!-- ko if: isTranslated --\x3e\r\n            <div class="translation-globe">\r\n                <span class="swcIcon swcIcon_globe" aria-hidden="true"></span>\r\n            </div>\r\n        \x3c!-- /ko --\x3e\r\n    \x3c!-- /ko --\x3e\r\n    \x3c!-- ko if: imageContent() --\x3e\r\n        <div class="content image" data-bind="html: imageContent,\r\n        style:{backgroundColor: messageColor}"></div>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    \x3c!-- ko if: $parent.showEditedIcon --\x3e\r\n    <span class="messageBtn edit" data-bind="attr:{\'aria-label\': $parent.textEditedMessage, title: $parent.textEditedMessage}">\r\n        <span class="swcIcon swcIcon_topic" aria-hidden="true"></span>\r\n    </span>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    \x3c!-- ko if: $parent.showMessageActions() --\x3e\r\n    <div class="actionsContainer">\r\n        <button class="messageBtn deleteAction" data-bind="click: $parent.openDeleteMsgConfirmationDialog,\r\n        attr: {title: $parent.textDeleteMessageHeader}">\r\n            <span class="swcIcon swcIcon_delete" aria-hidden="true"></span>\r\n        </button>\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n</div>\r\n'},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(105),c=n(4),u=n(79),l=n(0),p=n(60),d=n(96),f=n(467),h=n(8),g=n(14),m=n(437),v=n(436),y=n(438),_=function(e,t){return l.swc.services.i18n.fetch(e,t)},b=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="swcAddParticipants",n._onParticipantClick=function(e){var t=e.person.id;t&&!l.swc.services.mePersonManager.isMe(t)&&(n.state.selectedParticipants.some(function(t){return t.person.id===e.person.id})||(n.setState(function(t){return{selectedParticipants:t.selectedParticipants.concat([e]),shouldForceClearInput:!0}},n._resetState),n._searchInputRef.focus()))},n._onRemoveSelectedParticipant=function(e){var t=n.state.selectedParticipants.filter(function(t){return t.person.id!==e.person.id});n.setState({selectedParticipants:t,shouldForceClearInput:!0},n._resetState)},n._onConfirm=function(){var e=n.props.onConfirm,t=n.state.selectedParticipants.map(function(e){return{id:d.default.toFullIdentifier(e.person.id),role:c.ParticipantRole.User}});n.props.isNewChatControl?e(t,n.state.groupName):e(t)},n._onCancel=function(){var e=n.props,t=e.isNewChatControl,i=e.onCancel;t?i(n.state.selectedParticipants.length,n.state.groupName):i()},n._resetState=function(){n.setState({shouldForceClearInput:!1,searchQuery:""}),n._customScrollbar.recount()},n._onSearch=function(e){n.setState({searchQuery:e})},n.getHeaderTitle=function(e){return void 0===e&&(e=""),e=n.props.isNewChatControl?n.state.selectedParticipants.length>1?_("new_chat_enter_group_name"):_("add_to_new_group_header"):_("conversation_add_people_to_chat")},n.getIgnoredParticipants=function(){var e=n.state.selectedParticipants.map(function(e){return d.default.toFullIdentifier(e.person.id)});return n.props.isNewChatControl?e:e.concat(n.props.conversation.members.map(function(e){return e.id}))},n._onGroupNameChange=function(e){n.setState({groupName:e.target.value})},n._setScrollViewport=function(e){n._scrollViewport=e},n._setScrollWrapper=function(e){n._scrollWrapper=e},n._setSearchInputRef=function(e){n._searchInputRef=e},n.state={selectedParticipants:[],searchQuery:"",shouldForceClearInput:!1,groupName:""},n}return r(t,e),t.prototype.componentDidMount=function(){this._scrollViewport&&this._scrollWrapper&&(this._customScrollbar=new a.default(this._scrollWrapper,this._scrollViewport)),this._searchInputRef&&this._searchInputRef.focus(),l.swc.Telemetry.sendEvent.userAction(u.UserActionType.Participants)},t.prototype.render=function(){var e=this,t=this.props.isNewChatControl,n=this.state.selectedParticipants,i=_(t?"button_create_new_chat":"button_add_participants"),r=0===n.length?{display:"none"}:{},a=this.props.isNewChatControl&&this.state.selectedParticipants.length>1;return s.createElement("div",{className:this.getComposedBlockClassName()},s.createElement("header",{className:"swcAddParticipants__header"},a?s.createElement("input",{className:"swcAddParticipants__groupNameInput",type:"text",placeholder:this.getHeaderTitle(),value:this.state.groupName,onInput:this._onGroupNameChange}):s.createElement("h3",{className:"swcAddParticipants__title"},this.getHeaderTitle()),s.createElement("button",{title:_("sign_in_cancel"),"aria-label":_("sign_in_cancel"),type:"button",className:"swcAddParticipants__closeButton",tabIndex:0,onClick:this._onCancel},s.createElement(g.SwcIcon,{type:g.SwcIconType.Cancel,size:g.SwcIconSize.Medium}))),s.createElement("div",{className:"swcAddParticipants__selectedParticipantsWrapper swc-scroll-wrapper",ref:this._setScrollWrapper,role:"none"},s.createElement(p.AccessibleList,null,s.createElement("ul",{style:r,className:"swcAddParticipants__selectedList swc-scroll-viewport",ref:this._setScrollViewport},n.map(function(t){return s.createElement(f.Participant,{key:t.person.id,person:t.person,action:o.linkEvent(t,e._onRemoveSelectedParticipant),canBeRemoved:!0,removeParticipantText:_("remove_participant_by_name",{participantName:t.person.displayName}),selectedForRemoval:!1})})))),s.createElement(v.SwcSearchInput,{innerRef:this._setSearchInputRef,className:"swcAddParticipants__searchInputWrapper",inputClassName:"swcAddParticipants__searchInput",showSearchIcon:!1,showClearButton:!1,shouldForceClear:this.state.shouldForceClearInput,onDebounce:this._onSearch}),s.createElement(m.SwcSearchContainer,{searchQuery:this.state.searchQuery,ignoreItemIds:this.getIgnoredParticipants()},function(t){return t.isLoading?null:s.createElement(y.SwcSearchResults,{className:"swcAddParticipants__searchResults searchResultsWrapper",contacts:t.contactList,people:t.peopleList,bots:t.botList,onItemClick:e._onParticipantClick,showCounter:""!==e.state.searchQuery,resultsCount:t.count})}),this.state.selectedParticipants.length>0&&s.createElement("footer",{className:"swcAddParticipants__footer"},s.createElement("button",{type:"button",className:"swcAddParticipants__confirmButton",title:i,onClick:this._onConfirm},i)))},t}(h.SwcBaseComponent);t.SwcAddParticipants=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(41),o=n(14);t.Participant=function(e){var t=["actionItem"];return e.canBeRemoved&&t.push("canRemove"),e.selectedForRemoval&&t.push("selected"),i.createElement("li",{className:t.join(" "),onclick:e.action||void 0,"aria-label":e.canBeRemoved?e.removeParticipantText:void 0,"aria-selected":e.selectedForRemoval,title:e.canBeRemoved?e.removeParticipantText:void 0,"data-id":e.person.id},i.createElement(r.SwcPersonAvatar,{size:r.SwcAvatarSize.Small,person:e.person}),i.createElement("p",{className:"title"},e.person.displayName),e.canBeRemoved&&i.createElement("button",{className:"cancel",title:e.removeParticipantText,"aria-label":e.removeParticipantText},i.createElement(o.SwcIcon,{type:o.SwcIconType.Cancel})))}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(0),a=n(8),c=n(14),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcChatWarning",t}return r(t,e),t.prototype.render=function(){return o.createElement("li",{role:"alertdialog",className:this.getComposedBlockClassName()},o.createElement(c.SwcIcon,{className:"swcChatWarning__icon",type:this.props.icon,size:c.SwcIconSize.Medium}),o.createElement("p",{className:"swcChatWarning__text"},this.props.text),o.createElement("button",{className:"swcChatWarning__closeButton",onClick:this.props.onClose,title:(e="chat_warning_dismiss",s.swc.services.i18n.fetch(e))},o.createElement(c.SwcIcon,{type:c.SwcIconType.Cancel,size:c.SwcIconSize.Medium})));var e},t}(a.SwcBaseComponent);t.SwcChatWarning=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(30),o=n(0);!function(e){e[e.submit=0]="submit",e[e.change=1]="change"}(i=t.CommandMode||(t.CommandMode={}));var s=function(){function e(){var e=this;this.commands=[],this.mode=i.change,this.setupProxy=function(){o.swc.Eventing.registerEvent("cmd:register",function(t){return e.register(t)}),o.swc.Eventing.registerEvent("cmd:unregister",function(t){return e.unregister(t)})},r.ProxyConnector.instance.connect("commands",null,this.setupProxy)}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},e.prototype.register=function(e){e&&-1===this.commands.indexOf(e)&&this.commands.push(e)},e.prototype.unregister=function(e){var t=this.commands.indexOf(e);-1!==t&&this.commands.splice(t,1)},e.prototype.isValidCommand=function(e){if("/"!==e.charAt(0)||!this.commands.length)return!1;var t=e.substr(1).split(" ")[0];return-1!==this.commands.indexOf(t)},e.prototype.evaluate=function(e,t,n){var i,r,s;if("/"!==e.charAt(0)&&void 0===n||!this.commands.length)return i;n&&n.keyCode?(r="keydown",s=JSON.stringify({keyCode:n.keyCode,shiftKey:n.shiftKey})):(r=e.substr(1).split(" ")[0],s=e.substr(r.length+2));return"/"===e&&(r=s="/"),(i=-1!==this.commands.indexOf(r))&&o.swc.Eventing.triggerEvent("cmd:execute",{command:r,conversationId:t,data:s}),i},e}();t.Commands=s},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(527);t.default=i.swc.ChatContent=new r.default},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(2),s=n(20),a=n(3),c=n(184),u=n(1),l=n(86),p=n(19),d=n(11),f=n(71),h=n(100),g=n(26),m=n(47),v=n(48),y=n(351),_=n(38),b=n(30),w=n(31),C=n(103),S=n(4),T=n(446),E=n(33),P=n(0),I=n(528),k=n(568),M=n(570),O=n(56),A=n(102),x=n(7),N=n(13),L=n(29),R=n(469),D=n(55),U=n(9),F=n(140),j=n(52),B=n(18),H=n(21),G=n(374),z=n(466),W=n(602),V=n(603),K=n(125),q=function(){function e(t){var n=this;if(this.element=t,this._chatInstances={},this._stylesReady=!1,this._callingInitialized=!1,this._initializing=!1,this.isInitialized=!1,this._loadConversation=function(e,t,i){e&&(n._createConversationID(e),n._topic=t,n._avatar=i)},this._hideConversation=function(e){var t=e===u.Configuration.NEW_CHAT_COMPOSER_ID?e:L.default.toFullIdentifier(e),i=n._chatInstances[t];n._setActive(i,!1),n._triggerChatVisibilityChange(!1,t),i&&(i.view.parentElement.style.display="none")},this._updateConversation=function(e,t){for(var i in n._chatInstances){if(i===(e.chatConfig.ConversationId===u.Configuration.NEW_CHAT_COMPOSER_ID?u.Configuration.NEW_CHAT_COMPOSER_ID:L.default.toFullIdentifier(e.chatConfig.ConversationId))){var r=n._chatInstances[i];r.model.definition=e.chatConfig,t&&n.setContainerByMri(i,t),n._setActive(r,!0),n._triggerChatVisibilityChange(!0,i),n._chatDataConfig.ExecuteCall&&n._executeCall(n._chatDataConfig.ExecuteCall)}else if(!a.default.get.isParallelView){var o=!!n._chatInstances[i].model.isActive;n._setActive(n._chatInstances[i],!1),o&&n._triggerChatVisibilityChange(!1,i)}}},this._setupNewChatWindow=function(e){var t=n._chatInstances[u.Configuration.NEW_CHAT_COMPOSER_ID];if(!t){var i=n._getNewChatContainer();e.appendChild(i),n._newChatRoot=i,t=n._chatInstances[u.Configuration.NEW_CHAT_COMPOSER_ID]={view:i,model:{},container:e},a.default.get.isParallelView&&(n._CM.add(u.Configuration.NEW_CHAT_COMPOSER_ID,{alwaysOnStage:!0,view:i,model:{}}),n.createContainer(u.Configuration.NEW_CHAT_COMPOSER_ID))}n._setActive(t,!0),n._openChatWindow(),n.renderNewChat()},this.renderNewChat=function(){if(n._newChatRoot){var e=o.createElement(C.I18nContextComponent,{},o.createElement(z.SwcAddParticipants,{isNewChatControl:!0,onCancel:n._closeNewChatWindow,onConfirm:n._onConfirmNewChat}));n._timeStartedNewChat=Date.now(),r.render(e,n._newChatRoot)}},this._closeNewChatWindow=function(e,t){r.render(null,n._newChatRoot),n._hideConversation(u.Configuration.NEW_CHAT_COMPOSER_ID),P.swc.Telemetry.sendEvent.chatComposerAction(T.NewChatAction.CANCEL,e,!!t,Date.now()-n._timeStartedNewChat)},this._onConfirmNewChat=function(e,t){1===e.length?(P.swc.Telemetry.sendEvent.chatComposerAction(T.NewChatAction.OK,e.length,!!t,Date.now()-n._timeStartedNewChat),O.default.startChat(e[0].id,n._chatDataConfig,!1,m.OpenChatOrigin.NEWCHAT)):n._createConversation(e,t),r.render(null,n._newChatRoot),n._hideConversation(u.Configuration.NEW_CHAT_COMPOSER_ID)},this._runChat=function(t){n.setCmBaseParent(t),n._stylesReady||(n._CM.baseParent.style.display="none");var i=t.element||n._CM.baseParent;t.id&&e._getConversationIdAsync(t.id).then(function(e){(A.isEnterpriseObjectId(n._conversationId)||A.isEnterpriseObjectId(w.normalizePersonId(n._conversationId)))&&(n._conversationId=e);var r,o=!1;for(var s in n._chatInstances){var c=n._chatInstances[s];e===s?(o=!0,r=c.model):!a.default.get.isParallelView&&c.model.isActive&&n._triggerChatVisibilityChange(!1,s),n._setActive(c,e===s)}if(t.data&&t.data.chatConfig&&t.data.chatConfig.NewChatFlag)n._setupNewChatWindow(i);else{if(o)r.isDisposed&&r.start(),r.markAsRead();else{var u=t.data&&t.data.chatConfig?t.data.chatConfig.RefId:null;n._setupConversation(i,u)}!!t.element&&!a.default.get.isParallelView||!n._stylesReady&&!n._isModule||n._openChatWindow();var l=n._chatDataConfig.ExecuteCall;l&&n._executeCall(l)}})},this._forceExpandChat=function(e){return P.swc.Eventing.triggerLocalEvent("forceExpandChat",e)},this._openChatWindow=function(){P.swc.Eventing.triggerEvent(f.ActionNames.ShowChatWindow),a.default.get.frameless?P.swc.SDK.Chat.resolveMessage({origin:u.Configuration.ORIGIN,action:f.ActionNames.ShowChatWindow}):parent&&j.swcPostMessage(parent,{origin:u.Configuration.ORIGIN,action:f.ActionNames.ShowChatWindow}),n._triggerChatVisibilityChange(!0,n._conversationId)},this.signinStateChangedHandler=function(e){switch(e){case p.SigninState.SignedOut:n.disposeConversationsOnSkypeLogout(),n.resetSkypeBackend();break;case p.SigninState.SigningIn:n.disposeConversationsOnSkypeLogout();break;case p.SigninState.SignedIn:a.default.get.isTeams()&&D.isInIframe()&&(P.swc.secured=!0,P.swc.Eventing.secure()),a.default.get.callingReady&&n._callingInitialized||n.setupCalling(),P.swc.services.amsManager.authenticate();break;case p.SigninState.SigningOut:}},this.resetSkypeBackend=function(){return l.default.instance.isCleared=!1,P.swc.services.webApi.reset().then(function(){if(l.default.instance.dispose(),P.swc.services.signInManager.reloginContext.canRelogin){var e=function(){P.swc.services.mePersonManager.fetch(),l.default.instance.restoreLastConversation()};P.swc.services.signInManager.reloginContext.execCallback().then(e,e)}else l.default.instance.isCleared=!0})},this.restoreLastConversation=function(){if(n._conversationId){var e=n._chatInstances[n._conversationId];e&&(e.model.start(),n.isClientVisible()&&P.swc.services.webApi.startEndpointActivation())}},this.setup=function(e){window.onbeforeunload=function(){P.swc.services.webApi.reset(),n.disposeConversations()},n._loadCss(),I.default.register(n._chatDataConfig),M.default.register(n._chatDataConfig);var t=L.default.getSdkModeFromId(n._chatDataConfig.ConversationId);P.swc.services.signInManager.activeConversationSdkMode=t,e.data&&n._chatDataConfig&&n._chatDataConfig.EnableCalling&&B.default.testSupporedList(u.Configuration.ECS.callingSupportedBrowsers)&&P.swc.services.mePersonManager.fetch();var i=L.default.detectConversationType(n._chatDataConfig.ConversationId),r=function(){var t=n._chatDataConfig.Title?U.MessageUtils.parseTopic(n._chatDataConfig.Title):"";e.id&&n._loadConversation(K(e.id),t,K(n._chatDataConfig.Avatar)),n.enable()&&n._runChat(e)};n.setCmBaseParent(e),i===S.ConversationType.PHONE?n._callingInitialized&&P.swc.Eventing.triggerEvent("startCall",{calleeId:"4:"+e.id,withVideo:!1,avatarUrl:null,displayName:e.id}):n._chatDataConfig.ConversationId&&(e.data&&e.data.switchConversation||n.isInitialized?r():P.swc.services.initPromise.then(r))},this._getCSSUris=function(e){var t=[],i=e.Style&&/https:\/\/[\S]+.css/g.test(e.Style),r=v.PackageName.STYLE_CHAT_SKYPE;return e.Style&&!i&&(r="swc-chat-"+e.Style),t.push(H.UrlHelper.getAbsoluteUrl(r,"css",P.swc.EcsConfig)),i&&t.push(e.Style),e.Theme&&(t.push(H.UrlHelper.getAbsoluteUrl("swc-"+n._chatDataConfig.Theme,"css",P.swc.EcsConfig)),n._CM.baseParent.classList.add(n._chatDataConfig.Theme)),e.CssUrl&&t.push(e.CssUrl),t},this._loadCss=function(){if(!n._isModule){var e=[];n._getCSSUris(n._chatDataConfig).forEach(function(t){return e.push(F.StyleLoader.addStyle(t))}),Promise.all(e).then(function(){n._stylesReady||(n._openChatWindow(),n._stylesReady=!0,n._CM.baseParent&&(n._CM.baseParent.style.display=""))})}},this._onMessageReceived=function(e){e.origin===u.Configuration.ORIGIN&&/^(bs:[soh]Chat.*)|(swc:chat:)|(swc:calling:)/.test(e.action)&&n.resolveMessage(e)},this.openChatLocal=function(e){var t=e.ConversationId,r=n._chatInstances[t]?f.ActionNames.UpdateConversation:f.ActionNames.ShowChatWindow,o={chatConfig:i({},n._chatDataConfig,{ConversationId:t})};n.resolveMessage({action:r,id:t,data:o})},this.signIn=function(e,t,i){n._applicationInitialized.promise.then(function(){P.swc.services.signInManager.setExternalCallbacks(e,t),P.swc.services.signInManager.getSkypeToken()})},this.signOut=function(){return n._applicationInitialized.promise.then(function(){return P.swc.services.signInManager.logout("external")})},this.setAad=function(e){var t=n._chatInstances[n._conversationId];t.model.contextAad=e},this.getTokenExpirationTime=function(){return P.swc.services.signInManager.getTokenExpirationTime()},this.onOpenedChatWindow=function(){if(n.isClientVisible()){var e=n._chatInstances[n._conversationId];e&&e.model&&e.model.markAsRead&&e.model.markAsRead(),n.sendChatVisibilityChangeTelemetry()}},this.sendChatVisibilityChangeTelemetry=function(){var e=0;n._CM.forEach(function(t){t.onStage&&e++}),P.swc.Telemetry.sendEvent.visibilityChangeQos(!0,e)},this.onClientFocused=function(){l.default.instance.isFocused=!0,n.isClientVisible()&&(P.swc.Eventing.triggerEvent("onFocused",!0),n.sendInappActivityStart("Foregrounded")),n._CM&&n._CM.forEach(function(e){e.onStage&&e.model&&e.model.markAsRead&&e.model.markAsRead()})},this.onClientBlurred=function(){l.default.instance.isFocused=!1,P.swc.Eventing.triggerEvent("onFocused",!1)},this.bindTheme=function(){a.default.get.subscribe("theme",function(e){for(var t in n._chatInstances){var i=n._chatInstances[t].container.classList;n._theme&&i.remove(n._theme),e&&i.add(e)}n._theme=e})},this.setupMessagingProxy=function(){var e=function(e){return P.swc.Eventing.triggerEvent("proxy:messaging:disconnected",e)};P.swc.Eventing.registerEvent("proxy:messaging:disconnect",function(){return P.swc.services.webApi.reset().then(function(){return e(!0)},function(){return e(!1)})})},this._applicationInitialized=new d.CancelablePromise,P.swc.Eventing.registerEvent("compatEvent",this._onMessageReceived),P.swc.Eventing.registerEvent("openChatLocal",this.openChatLocal),D.isInIframe()){var s=this.element||document.querySelector("#main.swc"),h=P.swc.options[c.ModuleType.Messaging];if(h&&h.chatConfig){var g=h.chatConfig,y=g&&g.ParallelView?4:1;this._CM=this._CM||new k.default({container:s,minWidth:400}),this._CM.createViewports(y,this._getCSSUris(h.chatConfig),g).then(function(){return P.swc.Eventing.triggerEvent("messaging:ready")})}}else P.swc.Eventing.triggerEvent("messaging:ready")}return e.prototype.init=function(e){var t=this;if(!this._initializing&&!this.isInitialized){var n;if(this._initializing=!0,e.data&&e.data.chatConfig&&(a.default.get.getCurrentLocale(e.data.chatConfig.Locale),n=e.data.chatConfig.ChatMinWidth),l.default.initServices({skypeTokenProvider:e.tokenProvider,initialSkypeTokenData:e.initialSkypeTokenData,tokenType:e.tokenType,fileSharing:e.data.fileSharing,userSettings:e.data.userSettings}),P.swc.services.initPesManager(),P.swc.Eventing.registerEvent("onControlClose",function(e){return t._hideConversation(e.id)}),!D.isInIframe()){var i=this.element||document.querySelector("#main.swc");this._CM=this._CM||new k.default({container:i,minWidth:n})}P.swc.services.signInManager.subscribe("state",this.signinStateChangedHandler),l.default.instance.setRestoreOfLastConversation(this.restoreLastConversation),this._applicationInitialized.resolve(),P.swc.services.signInManager.state===p.SigninState.SignedIn&&this.signinStateChangedHandler(P.swc.services.signInManager.state),P.swc.Eventing.registerEvent("invoke:sendMessageToBot",function(e){return t.sendMessageToBot(e.content,e.botId,e.botMessageId)}),P.swc.Eventing.registerEvent("invoke:signOut",function(e){return t.signOut()}),P.swc.Eventing.registerEvent("invoke:setAad",function(e){return t.setAad(e.aad)}),P.swc.Eventing.registerEvent("closeAllChats",function(){return t.closeAllChats()}),R.Commands.init(),this.bindTheme(),u.Configuration.ECS.notificationRenderingEnabled&&this._initNotifications()}},e.prototype.dispose=function(){P.swc.services.signInManager.unsubscribe("state",this.signinStateChangedHandler),this.enable(!1),ko.cleanNode(this._CM.baseParent),this.disposeConversations(),P.swc.services.signInManager.state=p.SigninState.SignedOut,this._CM.baseParent=null},e.prototype.disposeConversations=function(){for(var e in this._chatInstances){var t=this._chatInstances[e].model;t&&t.dispose&&t.dispose(),delete this._chatInstances[e]}},e.prototype._initNotifications=function(){var e=o.createElement(V.NotificationList,{chatDefinition:this._chatDataConfig}),t=document.createDocumentFragment();r.render(e,t),parent.document.body.appendChild(t)},e.prototype._createConversationID=function(e){this._conversationId=e===u.Configuration.NEW_CHAT_COMPOSER_ID?u.Configuration.NEW_CHAT_COMPOSER_ID:L.default.toFullIdentifier(e)},e.prototype._setActive=function(e,t){if(e){var n=e.view.classList;t?n.add("conversation-active"):n.remove("conversation-active"),e.model.isActive=t}t&&this._CM.baseParent&&this._stylesReady&&(this._CM.baseParent.style.display="")},e.prototype.createContainer=function(e){var t=document.createElement("div");s.AbilityHelpers.modalityLayer.addRoot(t),t.className="swc chat "+a.default.get.getCurrentLocale(),this.setContainer(e,t),a.default.get.theme&&(this._theme=a.default.get.theme,t.classList.add(this._theme))},e.prototype.setContainerByMri=function(e,t){this._chatInstances[e]&&(this._CM.setContainer(e,t),t.appendChild(this._chatInstances[e].view),this._chatInstances[e].container=t)},e.prototype.isOnStage=function(e){var t=this._CM.get(e);return t&&t.onStage},e.prototype.setContainer=function(e,t){e===u.Configuration.NEW_CHAT_COMPOSER_ID?this.setContainerByMri(e,t):this.setContainerByMri(L.default.toFullIdentifier(e),t)},e.prototype.getContainer=function(e){return e===u.Configuration.NEW_CHAT_COMPOSER_ID?this.getContainerByMri(e):this.getContainerByMri(L.default.toFullIdentifier(e))},e.prototype.getConversationTuple=function(t){var n=this;return e._getConversationIdAsync(t).then(function(e){return n._CM.getAsync(e)})},e.prototype.getContainerByMri=function(e){var t;return this._chatInstances[e]&&(t=a.default.get.isParallelView?this._chatInstances[e].view:this._chatInstances[e].container),t||this._CM.baseParent},e.prototype._getNewChatContainer=function(){var e=document.createElement("div");return e.innerHTML='<div\n            role="region"\n            aria-label="'+P.swc.services.i18n.fetch("add_to_new_group_header")+'"\n            class="swc conversation skype-conversation swc-focus-outline-area"></div>',e.firstElementChild.cloneNode(!0)},e.prototype._createConversation=function(e,t){var n=this,i=P.swc.services.mePersonManager.mePerson.id,r={id:L.default.toFullIdentifier(i),role:S.ParticipantRole.Admin},o=t?t.trim():"";o=U.MessageUtils.sanitizeTopic(o);0===e.filter(function(e){return e.id===r.id}).length&&e.push(r),P.swc.services.webApi.createThread(e).then(function(t){var i=t.headers.get("location").match(/threads\/(19:.*)$/)[1];o&&(n._chatDataConfig.Title=o,n._chatDataConfig.SetConversationTopic=!0),P.swc.Telemetry.sendEvent.chatComposerAction(T.NewChatAction.OK,e.length,!!o,Date.now()-n._timeStartedNewChat),P.swc.Telemetry.sendEvent.chatComposerQos(e.length,!!o,Date.now()-n._timeStartedNewChat),O.default.startChat(i,n._chatDataConfig,!1,m.OpenChatOrigin.NEWCHAT)},function(e){})},e.prototype.setCmBaseParent=function(e){this._CM.baseParent||(this._CM.baseParent=e.data&&e.data.placeholder?e.data.placeholder:e.element)},e._getConversationIdAsync=function(e){if(A.isEnterpriseObjectId(e))return A.generateOneToOneConversationId(e);var t=L.default.toFullIdentifier(e);return A.isEnterpriseUserMri(t)?A.generateOneToOneConversationId(t):Promise.resolve(t)},e.prototype._executeCall=function(e){a.default.get.callingReady?e.accept?P.swc.Eventing.triggerEvent("acceptCall",e):P.swc.Eventing.triggerEvent("startCall",e):e.accept?P.swc.Eventing.registerEvent("callingReady",function(){return P.swc.Eventing.triggerEvent("acceptCall",e)}):P.swc.Eventing.registerEvent("callingReady",function(){return P.swc.Eventing.triggerEvent("startCall",e)}),this._chatDataConfig.ExecuteCall=null},e.prototype._setupConversation=function(e,t){var n=this,i=P.swc.services.conversations.get(this._conversationId,this._chatDataConfig);i.refId=t,"null"!==this._topic&&""!==this._topic&&(i.topic=this._topic),i.avatar=this._avatar?this._avatar:i.avatar;var r=W.default.getView("skype");e.appendChild(r),this._chatInstances[this._conversationId]={view:r,model:i,container:e},this.enable(!0),ko.applyBindings({conversation:i,enable:this.enable},r),i.start(),this._chatDataConfig.SetConversationTopic&&i.isGroup&&i.topic&&i.setTopic(i.topic),this._setActive(this._chatInstances[this._conversationId],!0),this._chatDataConfig.WelcomeMessage&&P.swc.services.mePersonManager.fetch().then(function(){P.swc.services.mePersonManager.mePerson.fetchDisplayNameAndAvatar().then(function(){return i.sendMessage(n._chatDataConfig.WelcomeMessage,h.ActionTrigger.WELCOME_MESSAGE)},function(e){})},function(e){}),this._CM.add(this._conversationId,{view:r,model:i,container:e,displayedAt:Date.now(),onStage:!1,vm:ko.dataFor(r.firstChild)}),a.default.get.isParallelView&&this.createContainer(this._conversationId),this._chatDataConfig.GroupWith&&"none"!==this._chatDataConfig.GroupWith&&i.addBotToThread(this._chatDataConfig.GroupWith)},e.prototype._triggerChatVisibilityChange=function(e,t){var n=this,i={type:e?"show":"hide",container:null,isVisible:e,conversationId:L.default.getSdkModeFromId(t)===_.SDKMode.BOT?t:"n/a",key:t};a.default.get.frameless&&(i.container=this.getContainerByMri(t)),P.swc.Eventing.triggerEvent("onVisibilityChange",i),e&&t&&P.swc.services.signInManager.getSkypeToken().then(function(){n.sendInappActivityStart("Opened")},function(){}).catch(function(){})},e.prototype.disposeConversationsOnSkypeLogout=function(){for(var e in this._CM.dispose(),this._chatInstances){var t=this._chatInstances[e].model;t.dispose&&t.dispose()}P.swc.services.webApi.stopEndpointActivation()},e.prototype.setupCalling=function(){var e=this;P.swc.services.capabilitiesService.getCommonCapabilities(this._chatDataConfig).then(function(t){if(t.allowCalling){if(e._callingInitialized=!0,!e._isModule){var n=H.UrlHelper.getAbsoluteUrl(v.PackageName.STYLE_CALLING,"css",P.swc.EcsConfig);if(D.isInIframe())P.swc.services.viewports.byType("conversation").forEach(function(e){return F.StyleLoader.addStyle(n,e.document)});else F.StyleLoader.addStyle(n)}P.swc.Eventing.registerEvent("calling:ready",function(){var t=document.createElement("div");t.style.display="none",e._callingComponent=new G.CallingView(t)});var i=H.UrlHelper.getAbsoluteUrl(v.PackageName.CALLING,"js",P.swc.EcsConfig);P.swc.scriptLoader.addScript(i,function(){P.swc.Eventing.registerEvent("callingReady",function(){L.default.detectConversationType(e._chatDataConfig.ConversationId)===S.ConversationType.PHONE&&setTimeout(function(){return P.swc.Eventing.triggerEvent("startCall",{calleeId:"4:"+e._chatDataConfig.ConversationId,withVideo:!1,avatarUrl:null,displayName:e._chatDataConfig.ConversationId.substr(2)})},1e3)})})}})},e.prototype._setupChatConfig=function(e){if(e.data&&e.data.chatConfig){var t=e.data;this._chatDataConfig=t.chatConfig||this._chatDataConfig,a.default.get.inputPlaceholderOverride=a.default.get.inputPlaceholderOverride||this._chatDataConfig.InputPlaceholder,this._chatDataConfig.Style?a.default.get.style||(a.default.get.style=this._chatDataConfig.Style):this._chatDataConfig.Style=a.default.get.style,a.default.get.suppressBackgroundRinging=a.default.get.suppressBackgroundRinging||this._chatDataConfig.SuppressBackgroundRinging||"outlook"===a.default.get.style,a.default.get.isParallelView=a.default.get.isParallelView||this._chatDataConfig.ParallelView,a.default.get.isGuestOnlyMode=!!t.chatConfig.GuestOnly,a.default.get.sessionId=t.chatConfig.SessionId||a.default.get.sessionId||N.guid.generate(),a.default.get.parentProtocol=t.chatConfig.Protocol||e.data.chatConfig.Protocol||a.default.get.parentProtocol,a.default.get.correlationId=e.correlationId,a.default.get.isSkypeOnly=!!t.chatConfig.SkypeOnly,a.default.get.disableAvatarClickAction=t.chatConfig.DisableAvatarClickAction,t.chatConfig.ForceAuthentication&&this._clearSessionData()}},e.prototype._clearSessionData=function(){P.swc.services.sessionStorage.removeItem(E.SKYPE_TOKEN_KEY),P.swc.services.sessionStorage.removeItem(E.SKYPE_REGTOKEN_KEY),P.swc.services.sessionStorage.removeItem(E.SKYPE_ENDPOINT_ID_KEY),P.swc.services.sessionStorage.removeItem(E.SKYPE_HAS_HISTORY_KEY)},e.prototype._initChat=function(e){this.init(e||{}),a.default.get.host=e.host||a.default.get.host||"n/a",this._isModule=e.isModule;var t=window.location.hostname.replace("www.","");a.default.get.frameless=this._isModule||!D.isInIframe()&&t&&u.Configuration.ECS.frameless.indexOf(t)>-1,a.default.get.callStartMode=this._chatDataConfig.CallStartMode,a.default.get.displayDeviceGuide=this._chatDataConfig.DisplayDeviceGuide,a.default.get.translatorEnabled=this._chatDataConfig.EnableTranslator,P.swc.Telemetry.Context.SDK.setCorrelationId(a.default.get.correlationId),this.enable(this._chatDataConfig.Preload!==y.PreloadType.UIONLY),this.setup(e),this.isInitialized||(this.isInitialized=!0,P.swc.Eventing.triggerEvent("ready",!0))},e.prototype.createGuestInChat=function(e){var t=this;P.swc.services.wx.join(e.data.id,"").then(function(n){n?(e.initialSkypeTokenData={skypeToken:n.skypetoken,isGuest:!0,expiresAt:828e5},t._initChat(e)):x.default.throwError(10504,"Unable to create group conversation with a guest")},function(e){x.default.throwError(10504,"Unable to create group conversation with a guest",e)})},e.prototype.createGroupChatWithGuest=function(e){var t=this;P.swc.services.wx.auth().then(function(n){n?(e.id=n.ThreadId,e.initialSkypeTokenData={skypeToken:n.SkypeToken,isGuest:!0,expiresAt:828e5},t._initChat(e)):x.default.throwError(10504,"Unable to create group conversation with a guest")},function(e){x.default.throwError(10504,"Unable to create group conversation with a guest",e)})},e.prototype.createGroupChat=function(e){var t=this;this.init(e),P.swc.services.signInManager.getSkypeToken().then(function(){var n;n=new Array,e.data.chatConfig.GroupWith.split(",").forEach(function(e){n.push({role:S.ParticipantRole.User,id:L.default.toFullIdentifier(e)})}),0!==n.length&&(n.push({role:S.ParticipantRole.Admin,id:L.default.toFullIdentifier(P.swc.services.signInManager.currentUserName)}),P.swc.services.webApi.createThread(n).then(function(n){var i=n.headers.get("location").match(/threads\/(19:.*)$/)[1];e.id=i,P.swc.services.webApi.enableJoining(i),P.swc.services.webApi.discloseHistory(i),t._initChat(e)},function(){}))})},e.prototype.resolveMessage=function(e){var t=this;switch(e.action){case f.ActionNames.StartActivation:this.onClientFocused();break;case f.ActionNames.StopActivation:this.onClientBlurred();break;case f.ActionNames.ExpandChatWindow:break;case f.ActionNames.UpdateConversation:this._setupChatConfig(e),this._updateConversation(e.data,e.element);break;case f.ActionNames.LoadChatData:this.enable()||this._runChat(e),this._stylesReady&&(this._CM.baseParent.style.display="");break;case f.ActionNames.ShowChatWindow:if(this._setupChatConfig(e),!e.data||!e.data.chatConfig)break;e.tokenString&&(e.tokenProvider=function(){return Promise.resolve(e.tokenString)});var n=function(){t.enable=ko.observable();var n=L.default.getSdkModeFromId(e.data.id),r=e.data.chatConfig.ConversationId,o=L.default.detectConversationType(r);if(e.data.id&&n===_.SDKMode.THREAD&&e.data.chatConfig.GuestOnly)t.createGuestInChat(e);else if(e.data.chatConfig.GroupWith.length>0&&e.data.chatConfig.GuestOnly)t.createGroupChatWithGuest(e);else if(e.data.chatConfig.GroupWith.length>0&&e.data.chatConfig.SkypeOnly)t.createGroupChat(e);else if(!r||S.ConversationType.PERSON!==o&&S.ConversationType.AGENT!==o||!A.isEnterpriseUserMri(r)&&!A.isEnterpriseObjectId(r))t._initChat(e);else try{P.swc.services.signInManager.onceSignedIn().then(function(){P.swc.services.signInManager.userIdentityType===g.IdentityType.TEAMS&&A.generateOneToOneConversationId(e.data.chatConfig.ConversationId).then(function(n){var r=i({},e);r.id=n,r.data.id=n,r.data.chatConfig.ConversationId=n,t._initChat(r)})})}catch(e){}};b.ProxyConnector.instance.connect("messaging",null,this.setupMessagingProxy);var r=H.UrlHelper.getVendorPath(P.swc.EcsConfig)+"/knockout-latest.js";P.swcWindow.ko?n():P.swc.scriptLoader.addScript(r,function(){return n()});break;case f.ActionNames.OpenChatWindow:this._forceExpandChat(this._conversationId),this.onOpenedChatWindow(),window.setTimeout(function(){return P.swc.Eventing.triggerEvent("chat-open",!0)},5);break;case f.ActionNames.HideChatWindow:P.swc.Eventing.triggerEvent("hideChat",{origin:c.ModuleType.Messaging})}},e.prototype.sendMessageToBot=function(e,t,n){if(t&&0!==t.length){var i=L.default.toFullIdentifier(t),r=this._chatInstances[i];if(r&&r.model)return r.model.sendDataToBot({payload:e}).then(function(e){return P.swc.Eventing.triggerEvent("invoke:sendMessageToBot:response",{success:!0,botMessageId:n})},function(e){return P.swc.Eventing.triggerEvent("invoke:sendMessageToBot:response",{success:!1,botMessageId:n})});var o="Unable to send message the bot - wrong chat id";return x.default.throwError(10508,o),Promise.reject(o)}},e.prototype.closeAllChats=function(){var e=this._chatInstances[this._conversationId];e&&(e.view.parentElement.style.display="none"),this.disposeConversations(),this._CM.dispose(),this._conversationId=""},e.prototype.isClientVisible=function(){if(!this._conversationId)return!1;var e=this._chatInstances[this._conversationId];return!!e&&e.model.isActive},e.prototype.sendInappActivityStart=function(e){P.swc.services.signInManager.currentUserName&&P.swc.Eventing.triggerEvent("inappActivityStarted",e)},e}();t.default=q},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(20),r=n(0),o=n(529),s=n(531),a=n(532),c=n(533),u=n(538),l=n(544),p=n(545),d=n(546),f=n(547),h=n(548),g=n(549),m=n(550),v=n(552),y=function(){function e(){}return e.register=function(e){if(!this.isInitialized){ko.components.isRegistered("conversations-list")||ko.components.register("conversations-list",{viewModel:{createViewModel:function(e,t){return new f.ConversationsListVM(e.conversations)}},template:n(553),synchronous:!0}),ko.components.register("messageitem",{viewModel:{createViewModel:function(e,t){return m.getMessageViewModel(e.message,e.conversation,e.conversationContainer,t.element)}},template:n(554),synchronous:!0}),ko.components.register("usermessage",{viewModel:{createViewModel:function(t,n){return new c.default(t.message,t.conversation,t.messageListElement,n.element,e)}},template:n(465),synchronous:!0}),ko.components.register("systemmessage",{viewModel:{createViewModel:function(e,t){return new c.default(e.message,e.conversation,e.messageListElement,t.element)}},template:n(465),synchronous:!0}),ko.components.register("swiftcard",{viewModel:{createViewModel:function(e,t){return new u.default(e,t.element)}},template:n(555),synchronous:!0}),ko.components.register("adaptivecard",{viewModel:{createViewModel:function(e,t){return new l.default(e.content,e.conversation,t.element)}},template:n(556),synchronous:!0}),ko.components.register("lwcimage",{viewModel:{createViewModel:function(e,t){return new g.ImageMessageVM(e.message,e.conversation,e.messageListElement,t.element)}},template:n(557),synchronous:!0}),ko.components.register("lwcfile",{template:n(558),synchronous:!0}),ko.components.register("lwccallrecording",{viewModel:{createViewModel:function(e,t){return new h.CallRecordingVM(e.message)}},template:n(559),synchronous:!0}),ko.components.register("welcome",{viewModel:{createViewModel:function(e){return new d.default(e.message,e.conversation)}},template:n(560),synchronous:!0}),ko.components.register("skypelogo",{template:n(561),synchronous:!0}),ko.components.register("unreadsplitter",{viewModel:{createViewModel:function(e){return new v.default(e.message,e.conversation)}},template:n(562),synchronous:!0}),ko.components.register("unsupported",{viewModel:{createViewModel:function(t,n){return new c.default(t.message,t.conversation,t.messageListElement,n.element,e)}},template:n(563),synchronous:!0}),ko.components.register("translate",{viewModel:{createViewModel:function(e){return new p.default(e.message,e.conversation)}},template:n(564),synchronous:!0}),ko.components.register("audioplayer",{viewModel:{createViewModel:function(e,t){return new o.default(e,t.element)}},template:n(565),synchronous:!0}),ko.components.register("videoplayer",{viewModel:{createViewModel:function(e,t){return new a.default(e,t.element)}},template:n(566),synchronous:!0}),ko.components.register("gifplayer",{viewModel:{createViewModel:function(e,t){return new s.default(e,t.element)}},template:n(567),synchronous:!0});var t=r.swc.Assets.SVG;ko.components.register("skype-logo",{template:t.skypeLogo}),ko.components.register("icon-chats",{template:t.iconChats}),ko.bindingHandlers.list={init:function(e,t){var n=ko.unwrap(t());n&&i.AbilityHelpers.list.add(e,n)}},ko.bindingHandlers.listItem={init:function(e,t){ko.unwrap(t())&&i.AbilityHelpers.list.addItem(e)}},ko.bindingHandlers.listActionable={init:function(e,t){ko.unwrap(t())&&i.AbilityHelpers.list.setActionable(e)}},this.isInitialized=!0}},e.unregister=function(){for(var e=0,t=["contactrequest","usermessage","systemmessage","swiftcard","adaptivecard","lwcimage","lwcfile","audioplayer","videoplayer","gifplayer","skype-logo"];e<t.length;e++){var n=t[e];ko.components.unregister(n)}this.isInitialized=!1},e.isInitialized=!1,e}();t.default=y},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(457),a=n(447),c=function(e){function t(t,n){var i=e.call(this,n,o.SwiftCardContentType.audio)||this;return i._params=t,i.shouldShowCover=function(){return!(!i.coverImage||!i.coverImage.url)},i.onAudioEnded=function(){i.isPlaying(!1)},i.dispose=function(){i.showCoverImage.dispose()},i.coverImage=i._params.coverImage,i.media=i._params.media,i.autoloop=i._params.autoloop,i.id=i._params.messageId,i.showLoadingInfo=i._params.showLoadingInfo||!0,i.showCoverImage=ko.computed(i.shouldShowCover),a.default.instance.registerPlayer(i),i}return r(t,e),t}(s.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={events:{browser:{FOCUS:"focus",BLUR:"blur",KEYDOWN:"keydown",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup"}}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){var i=e.call(this,n)||this;return i._params=t,i.shouldShowCover=function(){return!(!i.coverImage||!i.coverImage.url||i.canPlay())},i.dispose=function(){i.showCoverImage.dispose()},i.media=i._params.media,i.coverImage=i._params.coverImage,i.showCoverImage=ko.computed(i.shouldShowCover),i.showLoadingInfo=i._params.showLoadingInfo||!0,i}return r(t,e),t}(n(458).MediaLoader);t.default=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(0),a=n(457),c=n(447),u=".videoPlayer",l=function(e){function t(t,n){var i=e.call(this,n,o.SwiftCardContentType.video)||this;return i._params=t,i.thumbnail=ko.observable(),i.toggleMuteText=function(){var e=i.isMuted()?"videoPlayer_button_unmute":"videoPlayer_button_mute";return s.swc.services.i18n.fetch(e)},i.onVideoEnded=function(){i.touchedByUser=!1,i.isPlaying(!1)},i.getFullscreenButtonText=function(){var e=i.isInFullscreen()?"videoPlayer_exitFullscreen":"videoPlayer_fullscreen";return s.swc.services.i18n.fetch(e)},i.enterFullscreen=function(){i.playerHolder.requestFullscreen?i.playerHolder.requestFullscreen():i.playerHolder.mozRequestFullScreen?i.playerHolder.mozRequestFullScreen():i.playerHolder.webkitRequestFullScreen?i.playerHolder.webkitRequestFullScreen():i.playerHolder.msRequestFullscreen&&i.playerHolder.msRequestFullscreen()},i.onProgress=function(e){},i.exitFullscreen=function(){var e=document;e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.msExitFullscreen&&e.msExitFullscreen()},i.toggleFullscreen=function(){i.touchedByUser=i.isPlaying(),i.isInFullscreen()?i.exitFullscreen():(i.enterFullscreen(),c.default.instance.onEnteringFullscreen(i),i.trackFullscreenAction())},i.trackFullscreenAction=function(){i.wasInFullscreen||(i.wasInFullscreen=!0)},i.dispose=function(){i.fullscreenButtonText.dispose()},i.thumbnail=i._params.thumbnail?t.thumbnail.url:ko.observable(),i.media=i._params.media,i.autoplay=i._params.autoplay,i.autoloop=i._params.autoloop,i.id=i._params.messageId,i.showLoadingInfo=i._params.showLoadingInfo||!0,i.title=i._params.title,i.subtitle=i._params.subtitle,i.displayCurrentTime=i._params.displayCurrentTime,i.displayTotalTime=i._params.displayTotalTime,i.displayMuteButton=i._params.displayMuteButton,i.isMuted=ko.observable(i._params.muted),i.playerHolder=n.querySelector(u),i.isFullscreenSupported=!!(i.playerHolder.requestFullscreen||i.playerHolder.mozRequestFullScreen||i.playerHolder.webkitRequestFullScreen||i.playerHolder.msRequestFullscreen),i.fullscreenButtonText=ko.computed(i.getFullscreenButtonText),i.player&&(i.player.muted=i._params.muted),i._params.autoplay&&(c.default.instance.pauseAll(),i.play()),c.default.instance.registerPlayer(i),i}return r(t,e),t.prototype.toggleMute=function(){this.touchedByUser=!0,this.isMuted()?this.mute(!1):this.mute(!0)},t}(a.default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(3),s=n(1),a=n(47),c=n(4),u=n(0),l=n(56),p=n(29),d=n(9),f=n(534),h=function(){function e(e,t,n,r,f){var h=this;if(this.message=e,this.conversation=t,this.element=r,this.content=ko.observable(),this.imageContent=ko.observable(),this.isAgent=ko.observable(),this.isSystemMsg=ko.observable(),this.messageColor=ko.observable(),this.isTranslated=ko.observable(),this.isExtraLargeEmoticon=ko.observable(),this._onMessageFilesUpdate=function(e){var t=function(){h.message.files===e?h._updateFilesList(e,h.message.amsreferences):e.unsubscribe(t)};h._updateFilesList(e,h.message.amsreferences),e.subscribe(t)},this._onFileDownload=function(e){u.swc.services.amsManager.downloadRawFile(e).then(function(t){if(t){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,e.fileName);else{var n=window.URL||u.swcWindow.webkitURL,i=n.createObjectURL(t),r=document.createElement("a");document.body.appendChild(r),r.href=i,r.setAttribute("download",e.fileName),r.click(),n.revokeObjectURL(i)}u.swc.Telemetry.sendEvent.fileAction("DownloadClick",e.fileName,h.message.clientMessageId,h.message.rawMessageType,h.conversation.id,h.conversation.selfParticipant.person.id,h.message.senderId,!h.conversation.isOneOnOne,h.conversation.members.length||h.conversation.participants.length||0)}})},this.clickHandler=function(e,t){var n=t.target;if(!n.hasAttribute("data-mention-id")||"*"===n.getAttribute("data-mention-id"))return!0;var i=n.getAttribute("data-mention-id");return p.default.getNormalizeId(i)===u.swc.services.mePersonManager.mePerson.id||(l.default.startChat(i,h.chatDefinition,!1,a.OpenChatOrigin.CONVERSATION_ROSTER),!1)},this.dispose=function(){h.message.unsubscribe("content",h.content),h.message.unsubscribe("imageContent",h.imageContent),h.message.unsubscribe("files",h._onMessageFilesUpdate);var e=h.element.querySelector(".filesContainer");e&&i.render(null,e)},this.messageList=n,this.chatDefinition=f,"waiting_for_replay"===e.content){var g=d.MessageUtils.sanitizeTopic(t.topic);this.content(u.swc.services.i18n.fetch("waitingForReply",{user_name:g}))}else{var m=d.MessageUtils.sanitizeTopic(e.content);o.default.get.isTeams()&&this.conversation.isBRB&&(m=function(e){var t,n=e.indexOf("#bug | Platform: "+s.Configuration.getPlatformId()+" |");(t=n>-1?e.substring(0,n):e)||(t=s.Configuration.BRB_START_MESSAGE);return t}(m)),this.content(m)}var v=d.MessageUtils.sanitizeTopic(e.imageContent);this.imageContent(v),e.subscribe("imageContent",function(e){return h.imageContent(e)}),this.isTranslated(e.isTranslated),e.isTranslated||e.subscribe("content",function(e){var t=d.MessageUtils.sanitizeTopic(e);h.content(t)}),e.subscribe("isTranslated",function(e){h.isTranslated(e),e&&h.message.unsubscribe("content",h.content)}),this.isAgent(this.conversation.isAgent),this.isSystemMsg(this.message.type===c.MessageType.SystemMessage),f&&f.ColorMessage&&e.direction===c.Direction.Incoming&&this.messageColor(f.ColorMessage),this.isExtraLargeEmoticon(d.MessageUtils.containsLargeEmoticon(this.content())),this._updateFilesList(e.files,e.amsreferences),e.subscribe("files",this._onMessageFilesUpdate)}return e.prototype._updateFilesList=function(e,t){if(e&&e.length){var n=this.element.querySelector(".filesContainer"),o=u.swc.services.amsManager.isEnterpriseAmsUsed();o&&t&&(e[0].id=t[0]);var s={files:e,onDownload:this._onFileDownload,isBackendAms:o},a=r.createElement(f.SwcEnterpriseFilesList,s);i.render(a,n)}},e}();t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(535);t.SwcEnterpriseFilesList=i.SwcEnterpriseFilesList},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(165),a=n(8),c=n(536),u=n(537),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcEnterpriseFilesList",t}return r(t,e),t.prototype.render=function(){return this.props.isBackendAms?this.renderAmsBackendFiles():this.renderSharepointFiles()},t.prototype.renderAmsBackendFiles=function(){var e=this;return o.createElement("ul",{className:this.getComposedBlockClassName()},this.props.files.map(function(t){return o.createElement(c.SwcEnterpriseFile,{key:t.id,className:"swcEnterpriseFilesList__item swcEnterpriseFilesList__item_file",file:t,onDownload:e.props.onDownload,isBackendAms:e.props.isBackendAms})}))},t.prototype.renderSharepointFiles=function(){var e=this;return o.createElement("ul",{className:this.getComposedBlockClassName()},this.props.files.map(function(t){var n=function(e){var t;e.fileInfo&&(t=e.fileInfo.fileUrl);return t}(t),i=function(e,t){var n="";if(!s.isImage(e))return n;n=e.filePreview&&e.filePreview.previewUrl?e.filePreview.previewUrl:t;return n}(t,n);return i?o.createElement(u.SwcEnterpriseImage,{key:t.id,className:"swcEnterpriseFilesList__item swcEnterpriseFilesList__item_image",previewUrl:i,fileUrl:n,file:t,isBackendAms:e.props.isBackendAms}):o.createElement(c.SwcEnterpriseFile,{key:t.id,className:"swcEnterpriseFilesList__item swcEnterpriseFilesList__item_file",file:t,onDownload:e.props.onDownload,isBackendAms:e.props.isBackendAms})}))},t}(a.SwcBaseComponent);t.SwcEnterpriseFilesList=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(459),c=n(43),u=n(25),l=n(460),p=n(14),d=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="swcEnterpriseFile",n._onDownloadClick=function(e,t){t.stopPropagation(),t.preventDefault(),n.props.onDownload(e)},n._onKeyDown=function(e){e.stopPropagation();var t=c.default.getKeyCode(e);t!==u.default.ENTER&&t!==u.default.SPACE||e.target.click()},n.state={status:null},n}return r(t,e),t.prototype.componentDidMount=function(){this.props.file.id&&this.checkFileStatus(this.props.file,this.props.isBackendAms)},t.prototype.render=function(){var e=this.props.file,t=a.getFileIconTypeByExtension(e.fileType);return s.createElement("li",{className:this.getComposedBlockClassName()},s.createElement("a",{className:"swcEnterpriseFile__link",tabIndex:-1,onClick:o.linkEvent(e,this._onDownloadClick),onKeyDown:this._onKeyDown},s.createElement(p.SwcIcon,{className:"swcEnterpriseFile__icon",type:t,size:p.SwcIconSize.Medium}),s.createElement("div",{className:"swcEnterpriseFile__meta"},s.createElement("div",{className:"swcEnterpriseFile__name"},e.fileName)),!!this.state.status&&s.createElement(l.SwcFileStatus,{className:"swcEnterpriseFile__status",status:this.state.status})))},t}(n(461).SwcEnterpriseItemBase);t.SwcEnterpriseFile=d},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(58),a=n(0),c=n(460),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcEnterpriseImage",t}return r(t,e),t.prototype.componentDidMount=function(){this.checkFileStatus(this.props.file,this.props.isBackendAms)},t.prototype.render=function(){var e=this.props,t=e.fileUrl,n=e.previewUrl,i=this.state.status,r={"background-image":'url("'+n+'")'};return o.createElement("li",{className:this.getComposedBlockClassName()},o.createElement("a",{href:t,className:"swcEnterpriseImage__link",target:"_blank",rel:"noopener noreferrer",tabIndex:-1,title:a.swc.services.i18n.fetch("message_text_photo"),style:r},!!i&&i!==s.DocumentStatus.Success&&o.createElement(c.SwcFileStatus,{className:"swcEnterpriseImage__status",status:i})))},t}(n(461).SwcEnterpriseItemBase);t.SwcEnterpriseImage=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(539),o=/(<swiftcard>?[\s\S]*<\/swiftcard>)/i,s=/(?:<swiftcard[\s]+swift=\")([\s\S]*)(?:\">)/i,a=function(){return function(e,t){var n=this;this.element=t,this.isDisjoined=!0,this.unsupportedText="Swift is not supported",this.parse=function(e,t,i){var a;if(!/^<swiftcard/i.test(e.content))return null;n.content=e.content;var c=e.content.match(o);if(!c||0===c.length)return null;var u=c[0].replace("><",">$$$<").split("$$$"),l=n.find(u,function(e){return s.test(e)});if(!l)return null;var p=l.match(s)[1];try{a=JSON.parse(p)}catch(e){return null}return a?new r.default(a,t,e,i):null},this.find=function(e,t){var n;for(n=0;n<e.length;++n)if(t(e[n],n,e))return e[n]},this.message=e.message,this.conversation=e.conversation,this.swift=this.parse(e.message,e.conversation,this.element),this.swift?this.customMessageClasses="swiftCard "+(this.swift.isSupported()?i.SwiftCardType[this.swift.type].toLowerCase():"unsupported")+(this.swift.isValid()?"":" invalid"):(this.content=this.unsupportedText,this.swift=new r.default({},e.conversation,e.message,this.element))}}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(98),r=n(4),o=n(0),s=n(448),a=n(136),c=n(540),u=n(182),l=n(101),p=function(){return function(e,t,n,p){var d=this;if(this._encoder=new i.Encoder,this.CAROUSEL_WIDTH_DEFAULT=288,this.CAROUSEL_WIDTH_NARROW=204,this.selectedCard=ko.observable(0),this.unsupportedText=o.swc.services.i18n.fetch("s_unsupported"),this.types={Unknown:r.SwiftCardType.unknown,Card:r.SwiftCardType.card,Carousel:r.SwiftCardType.carousel,SignIn:r.SwiftCardType.signin,Receipt:r.SwiftCardType.receipt},this.carouselLeftPosition=function(){var e=d.CAROUSEL_WIDTH_DEFAULT;return s.default.instance.CurrentStyle===s.StyleModes.NARROW&&(e=d.CAROUSEL_WIDTH_NARROW),d.isFirst()?"0px":d.isLast()?"calc("+d.selectedCard()*-e+"px + (100% - "+e+"px))":"calc("+d.selectedCard()*-e+"px + (100% - "+e+"px) / 2)"},this.isSupported=function(){var e=d.cards.every(function(e){return e.isSupported()});return d.isValid()&&d.type!==r.SwiftCardType.unknown&&e},this.isValid=function(){var e=d.cards.every(function(e){return e.isValid()});return!!d.type&&0!==d.cards.length&&e},this.isCarousel=function(){return d.type===r.SwiftCardType.carousel},this.isMultilineCard=function(){return d.type===r.SwiftCardType.multiline},this.nextCard=function(){d.moveTo(d.selectedCard()+1)},this.prevCard=function(){d.moveTo(d.selectedCard()-1)},this.moveTo=function(e){e<0||e>=d.cards.length||(d.selectedCard(e),d.isFirst(0===e),d.isLast(e===d.cards.length-1))},this.moveToCard=function(e){d.moveTo(d.cards.indexOf(e))},this.types["message/card"]=r.SwiftCardType.card,this.types["message/card.carousel"]=r.SwiftCardType.carousel,this.types["message/card.signin"]=r.SwiftCardType.signin,this.types["message/card.receipt"]=r.SwiftCardType.receipt,this.types["message/card.multiline"]=r.SwiftCardType.multiline,e)if(this.content=e.content?l.default.normalizeRichText(e.content):null,this.summary=l.default.normalizeText(e.summary),this.type=e.type?this.types[e.type]:null,this.cards=l.default.mapArray(e.attachments,function(e){return new c.default(e,t,n.senderId,p)}),e.suggestedActions&&e.suggestedActions.actions&&e.suggestedActions.actions.forEach(function(e){e.title&&(e.title=d._encoder.decode(d._encoder.encode(e.title))),n.suggestedActions.pushObservable(new u.default(e,t,n.senderId))}),this.isValid()){if(this.isSupported()||(this.button=new a.default({type:r.SwiftCardActionType.unsupported,title:o.swc.services.i18n.fetch("s_learnMore")},t,n.senderId)),this.areButtonsMultiLine=!this.cards.every(function(e){return e.content&&e.isValid()&&!1===e.content.areButtonsMultiLine}),this.isFirst=ko.observable(!0),this.isLast=ko.observable(1===this.cards.length),this.selectedCard=ko.observable(0),this.isMultiple=ko.observable(this.cards.length>1),this.isMultiple())for(var f=0;f<this.cards.length;f++){var h=this.cards[f];if(h.isValid()&&h.content&&h.content.mainSection)for(var g=0;g<h.content.mainSection.images.length;g++)h.content.mainSection.images[g].isImageInCarousel(!0)}this.prevCardTitle=o.swc.services.i18n.fetch("s_prevCard"),this.nextCardTitle=o.swc.services.i18n.fetch("s_nextCard")}else this.button=new a.default({type:r.SwiftCardActionType.unsupported,title:o.swc.services.i18n.fetch("s_learnMore")},t,n.senderId)}}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(462),o=function(){return function(e,t,n,o){var s=this;if(this.contentType=i.SwiftCardContentType.unknown,this.content=null,this.isValid=function(){return s.contentType===i.SwiftCardContentType.adaptive||s.contentType!==i.SwiftCardContentType.unknown&&s.content&&s.content.isValid&&s.content.isValid()||s.contentType===i.SwiftCardContentType.unknown},this.isSupported=function(){return s.contentType===i.SwiftCardContentType.adaptive||s.contentType!==i.SwiftCardContentType.unknown&&(!s.content||!!s.content.isSupported&&s.content.isSupported())},this.getContentTypeName=function(){return i.SwiftCardContentType[s.contentType].toLowerCase()},this.convertToCardContentType=function(e,t){if(!e)return i.SwiftCardContentType.unknown;var n=t&&t.media&&t.media[0]&&t.media[0].profile;try{switch(e.toLowerCase()){case"application/vnd.microsoft.card.hero":return i.SwiftCardContentType.hero;case"application/vnd.microsoft.card.thumbnail":return i.SwiftCardContentType.thumb;case"application/vnd.microsoft.card.receipt":return i.SwiftCardContentType.receipt;case"application/vnd.microsoft.card.signin":return i.SwiftCardContentType.signin;case"application/vnd.microsoft.card.video":return i.SwiftCardContentType.video;case"application/vnd.microsoft.card.audio":return i.SwiftCardContentType.audio;case"application/vnd.microsoft.card.flex":return i.SwiftCardContentType.flex;case"application/vnd.microsoft.card.animation":return"video"===n?i.SwiftCardContentType.video:i.SwiftCardContentType.animation;case"application/vnd.microsoft.card.adaptive":return i.SwiftCardContentType.adaptive;default:return i.SwiftCardContentType.unknown}}catch(e){return i.SwiftCardContentType.unknown}},this.contentType=this.convertToCardContentType(e.contentType,e.content),this.content=null,this._conversation=t,e.content)switch(this.contentType){case i.SwiftCardContentType.hero:case i.SwiftCardContentType.thumb:this.content=new r.default(e.content,t,n,this.contentType);break;case i.SwiftCardContentType.signin:this.content=new r.SignInContent(e.content,t,n);break;case i.SwiftCardContentType.receipt:this.content=new r.ReceiptContent(e.content,t,n);break;case i.SwiftCardContentType.audio:case i.SwiftCardContentType.video:case i.SwiftCardContentType.animation:this.content=new r.MediaContent(e.content,t,n,this.contentType);break;case i.SwiftCardContentType.flex:this.content=new r.FlexContent(e.content,t,n,this.contentType);break;case i.SwiftCardContentType.adaptive:this.content=e.content}}}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(101),r=function(){return function(e){var t=this;this.isValid=function(){return!!t.key||!!t.value},this.key=i.default.normalizeRichText(e.key),this.value=i.default.normalizeRichText(e.value)}}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(358),o=n(101),s=function(){return function(e,t,n,s){var a=this;if(this.isValid=function(){return!!a.video||!!a.audio||!(!a.animation||!a.animation.url)},this.getSourceDomain=function(e){var t=e.replace(/^(https?:\/\/)?(w*\.)?/i,"");return t?t.split("/")[0]:null},this.url=e.url?o.default.normalizeUrl(e.url):null,this.url)switch(s){case i.SwiftCardContentType.video:this.video=this.url;break;case i.SwiftCardContentType.audio:this.audio=this.url;break;case i.SwiftCardContentType.animation:this.animation=new r.default(e||{},t,n,s)}this.sourceDomain=this.url?this.getSourceDomain(this.url):null}}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(0),o=n(136),s=n(358),a=n(463),c=n(101),u=n(101),l=function(){return function(e,t,n,l){var p=this;this.expandedText=function(){return""===p.subtitle||""===p.title},this.isValid=function(){return!!p.title||!!p.subtitle||!!p.text||!!p.buttons&&0!==p.buttons.length||p.images&&0!==p.images.length},this.getTitleByType=function(){switch(p.tap.type){case i.SwiftCardActionType.call:case i.SwiftCardActionType.imBack:return p.createSectionTitle();case i.SwiftCardActionType.openUrl:return p.createSectionTitle()+"\n\n"+p.tap.value}return""},this.createSectionTitle=function(){return r.swc.services.i18n.fetch("accessibility_swift_action_prefix",{swiftAction:p.lowerFirstLetter(p.tap.title)})},this.lowerFirstLetter=function(e){return e?e[0].toLowerCase()+e.substring(1):""};var d=new s.default(e.image||{},t,n,l);this._conversation=t,this.title=c.default.normalizeRichText(e.title),this.subtitle=c.default.normalizeRichText(e.subtitle),this.text=c.default.normalizeRichText(e.text),this.price=c.default.normalizeText(e.price),this.images=e.images?a.default.mapImages(e.images,t,n,l):[],0===this.images.length&&e.image&&e.image.url&&this.images.push(d),this.buttons=u.default.filterOutDisabledItems(e.buttons,function(e){return new o.default(e,t,n)}),this.tap=e.tap?u.default.getItemIfNotDisabled(new o.default(e.tap||{},t,n)):null}}();t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(99),s=n(4),a=n(0),c=n(9),u=n(21),l=n(462),p="/adaptivecardsv3.min.js",d=/swc:addon:open=([^&]*)/g,f={supportsInteractivity:!0,fontFamily:"Segoe UI",fontSizes:{small:12,default:14,medium:17,large:21,extraLarge:26},fontWeights:{lighter:200,default:400,bolder:600},imageSizes:{small:40,medium:80,large:160},containerStyles:{default:{fontColors:{default:{normal:"#333333",subtle:"#EE333333"},accent:{normal:"#2E89FC",subtle:"#882E89FC"},good:{normal:"#54a254",subtle:"#DD54a254"},warning:{normal:"#c3ab23",subtle:"#DDc3ab23"},attention:{normal:"#FF0000",subtle:"#DDFF0000"}},backgroundColor:"#FFFFFF"},emphasis:{fontColors:{default:{normal:"#333333",subtle:"#EE333333"},accent:{normal:"#2E89FC",subtle:"#882E89FC"},good:{normal:"#54a254",subtle:"#DD54a254"},warning:{normal:"#c3ab23",subtle:"#DDc3ab23"},attention:{normal:"#FF0000",subtle:"#DDFF0000"}},backgroundColor:"#08000000"}},spacing:{small:3,default:8,medium:20,large:30,extraLarge:40,padding:10},separator:{lineThickness:1,lineColor:"#EEEEEE"},actions:{maxActions:5,spacing:"Default",buttonSpacing:20,showCard:{actionMode:"Inline",inlineTopMargin:16,style:"Emphasis"},preExpandSingleShowCardAction:!1,actionsOrientation:"Horizontal",actionAlignment:"Left"},adaptiveCard:{allowCustomStyle:!1},imageSet:{imageSize:"Medium",maxImageHeight:"maxImageHeight"},factSet:{title:{size:"Default",color:"Default",isSubtle:!1,weight:"Bolder",warp:!0},value:{size:"Default",color:"Default",isSubtle:!1,weight:"Default",warp:!0},spacing:10}},h=function(e){function t(t,n,i){var r=e.call(this)||this;r.element=i,r._actionHandlers={},r._mapSupportedActionTypes=function(){r._actionHandlers["Action.OpenUrl"]=r.openUrl,r._actionHandlers["Action.ShowCard"]=r.showCard,r._actionHandlers["Action.Http"]=r.httpAction,r._actionHandlers["Action.Submit"]=r.submit,r._actionHandlers.Submit=r.submit},r._processNodes=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if("p"===i.nodeName)r._processNodes(i.childNodes,t),t.push(250);else if("s"===i.nodeName)r._processNodes(i.childNodes,t),t.push(100);else if("break"===i.nodeName)if(i.attributes.strength){var o=i.attributes.strength.nodeValue;"weak"===o||("medium"===o?t.push(50):"strong"===o?t.push(100):"x-strong"===o&&t.push(250))}else i.attributes.time&&t.push(JSON.parse(i.attributes.time.value));else"audio"===i.nodeName?i.attributes.src&&t.push(i.attributes.src.value):"say-as"===i.nodeName?r._processNodes(i.childNodes,t):"w"===i.nodeName?r._processNodes(i.childNodes,t):"phoneme"===i.nodeName?r._processNodes(i.childNodes,t):t.push(i.nodeValue)}},r._renderContent=function(){r._element.parentElement.insertBefore(r._content,r._element),a.swc.Eventing.triggerEvent("scrollToBottom",r._conversation.id)},r._playSpeech=function(e,t){if(t<e.length){var n=e[t];if("number"==typeof n)setTimeout(function(){r._playSpeech(e,t+1)},n);else if(0===n.indexOf("http"))r._audioContainer.autoplay=!0,r._audioContainer.src=n,r._audioContainer.onended=function(){return r._playSpeech(e,t+1)},r._audioContainer.onerror=function(){return r._playSpeech(e,t+1)},r._audioContainer.play();else{var i=new(0,window.SpeechSynthesisUtterance);if(!a.swcWindow.speechSynthesis||!i)return;i.text=n,i.lang="en-US",i.onerror=function(n){r._playSpeech(e,t+1)},i.onend=function(n){r._playSpeech(e,t+1)},a.swcWindow.speechSynthesis.speak(i)}}},r.executeAction=function(e){if(e&&!e.stop){var t=e.type||e.title,n=r._actionHandlers[t];!n&&e.url&&(n=r._actionHandlers["Action.OpenUrl"]),n&&"function"==typeof n&&n(e)}},r.openUrl=function(e){if(e.url){if(e.url.match(/^skype:\?payments/));else{if(e.url.match(d))return void("overlay"===d.exec(e.url)[1]&&a.swc.Eventing.triggerEvent("swc:addon:open",{id:r._conversation.id,url:e.url}));e.url.match(/^skype:/)}window.open(e.url,"_blank").opener=null}},r.submit=function(e){if(!e.data)return null;var t={value:JSON.stringify({userSubmitData:e.data}),title:""};return r._conversation.sendSwift(t).then(function(){return Promise.resolve()}).catch(function(){})},r.isValid=function(){return!!r._content},r.isSupported=function(){return r.isValid()},r._element=r.element,r._conversation=n,r._audioContainer=document.createElement("audio");var o=u.UrlHelper.getVendorPath(a.swc.EcsConfig)+p;return a.swcWindow.AdaptiveCards?(r._adaptiveCard=a.swcWindow.AdaptiveCards,r._render(t)):a.swc.scriptLoader.addScript(o,function(){r._adaptiveCard=a.swcWindow.AdaptiveCards,r._render(t)}),r}return r(t,e),t.prototype._render=function(e){if(e&&this._adaptiveCard){e.version=e.version||"1.0",e.body&&(e.body=e.body.filter(function(e){return e.text&&(e.text=o.default.parse(e.text),e.text=c.MessageUtils.getMessageSanitizedContent(e.text)),e}));var t=new this._adaptiveCard.AdaptiveCard;t.hostConfig=new this._adaptiveCard.HostConfig(f),t.onExecuteAction=this.executeAction,t.parse(e),this._content=t.render(),this.type=s.SwiftCardContentType.adaptive,this._mapSupportedActionTypes(),this._renderContent()}},t.prototype.showCard=function(e){},t.prototype.httpAction=function(e){},t.ready=!1,t}(l.BaseContent);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(0),o=n(43),s=n(25),a=function(){function e(e,t){this.myLanguage=ko.observable(),this.theirLanguage=ko.observable(),this.callToAction=ko.observable(),this.they_are_speaking=ko.observable(r.swc.services.i18n.fetch("they_are_speaking",{theirLanguage:this.theirLanguage()})),this.you_are_speaking=ko.observable(r.swc.services.i18n.fetch("you_are_speaking",{myLanguage:this.myLanguage()})),this.onKeyDown=function(e,t){var n=o.default.getKeyCode(t);n!==s.default.ENTER&&n!==s.default.SPACE||t.target.click()},this.myLanguage(i.default.get.translationLanguages[navigator.language.split("-")[0]].name),this.theirLanguage(i.default.get.translationLanguages[i.default.get.translationLanguage].name),this.callToAction("Start translation?")}return e.prototype.activateTranslation=function(){this.callToAction("")},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(19),o=n(100),s=n(26),a=n(0),c=function(){function e(e,t){var n=this;this.loggedIn=ko.observable(),this.nameClicked=ko.observable(!1),this.isAgent=ko.observable(!0),this.isGuest=ko.observable(!0),this.displayName=ko.observable(),this.say_hi=ko.observable(a.swc.services.i18n.fetch("say_hi")),this.or_text=ko.observable(a.swc.services.i18n.fetch("or_text")),this.sign_in_text=ko.observable(a.swc.services.i18n.fetch("sign_in_text")),this.to_save_your_chat=ko.observable(a.swc.services.i18n.fetch("to_save_your_chat")),this.welcome_back_text=ko.observable(a.swc.services.i18n.fetch("welcome_back_text")),this.click_here_text=ko.observable(a.swc.services.i18n.fetch("click_here_text")),this.to_switch_accounts=ko.observable(a.swc.services.i18n.fetch("to_switch_accounts")),this.title=ko.observable(),this.disableLogout=ko.observable(),this.dispose=function(){a.swc.services.signInManager.unsubscribe("isSignedIn",n.onAppReadyStateChange),a.swc.services.mePersonManager.mePerson&&a.swc.services.mePersonManager.mePerson.unsubscribe("displayName",n.onDisplayNameChange)},this.onDisplayNameChange=function(){n.setGreetingMessage()},this.onAppReadyStateChange=function(){n.welcomeMsgHandler()},this.isGuestOnlyMode=i.default.get.isGuestOnlyMode,this._conversation=t,this.say_hi_to_bot_aria=a.swc.services.i18n.fetch("say_hi_to_a_bot"),this.sign_in_to_save_chat_aria=a.swc.services.i18n.fetch("sign_in_to_save_your_chat"),this.click_here_to_switch_accounts_aria=a.swc.services.i18n.fetch("click_here_to_switch_accounts_aria_label"),this.msg_hi=a.swc.services.i18n.fetch("hi"),a.swc.services.signInManager.subscribe("isSignedIn",this.onAppReadyStateChange),a.swc.services.mePersonManager.mePerson.subscribe("displayName",this.onDisplayNameChange),this.isAgent(t.isAgent),this.isGuest(a.swc.services.mePersonManager.mePerson.isGuest),this.welcomeMsgHandler(),this.setGreetingMessage(),this.getConversationTitle(),this.disableLogout(this._conversation.definition.DisableLogout)}return e.prototype.getConversationTitle=function(){var e=this;if(""!==this._conversation.topic||this._conversation.isGroup)this.title(this._conversation.topic),this._conversation.subscribe("topic",function(t){e.title(t)});else{var t=a.swc.services.persons.getPerson(this._conversation.id,!0);t.displayName===t.id&&a.swc.services.signInManager.getSkypeToken().then(function(n){a.swc.services.signInManager.state===r.SigninState.SignedIn&&e._subscribeToDisplayName(t)}).catch(function(n){a.swc.services.signInManager.state===r.SigninState.SignedIn?e._subscribeToDisplayName(t):a.swc.services.signInManager.subscribe("state",function(){a.swc.services.signInManager.state===r.SigninState.SignedIn&&(e._subscribeToDisplayName(t),t.fetchDisplayNameAndAvatar())})})}},e.prototype._subscribeToDisplayName=function(e){var t=this;e.displayName&&this._handleDisplayName(e),e.subscribe("displayName",function(){return t._handleDisplayName(e)})},e.prototype._handleDisplayName=function(e){this.title(e.displayName===e.id?"":e.displayName)},e.prototype.signin=function(){a.swc.services.signInManager.login()},e.prototype.sendHi=function(){this._conversation.sendMessage(this.msg_hi,o.ActionTrigger.WELCOME_MESSAGE)},e.prototype.nameClick=function(){this._conversation.definition.DisableLogout||this.nameClicked(!0)},e.prototype.signout=function(){this.nameClicked(!1),a.swc.services.signInManager.logout("welcome")},e.prototype.welcomeMsgHandler=function(){a.swc.services.signInManager.userIdentityType!==s.IdentityType.GUEST?this.loggedIn(a.swc.services.signInManager.state!==r.SigninState.SignedOut):this.loggedIn(!1)},e.prototype.setGreetingMessage=function(){var e=a.swc.services.mePersonManager.mePerson;this.displayName(e.displayName)},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(0),s=n(41),a=function(){return function(e){var t=this;this.conversations=e,this.count=ko.observable(0),this.expanded=ko.observable(!1),this.buttonTitle=ko.pureComputed(function(){return t.expanded()?o.swc.services.i18n.fetch("hide_collapsed_chats"):o.swc.services.i18n.fetch("show_collapsed_chats")}),this.toggleExpand=function(e,n){t.expanded(!t.expanded()),setTimeout(function(){var e=n.target.parentElement.querySelector("ul");e&&e.focus()})},this.appendAvatarVM=function(e,t,n){if(e&&e.nodeType===Node.ELEMENT_NODE){var o=document.createDocumentFragment(),a={customAvatar:n.chatDataConfig.Avatar,customTitle:n.chatDataConfig.Title,conversation:n.conversation},c=r.createElement(s.SwcConversationAvatar,a);i.render(c,o),e.insertBefore(o,e.firstChild)}},this.conversationsList=this.conversations.conversationsList,this.conversationsList.subscribe(function(){t.count(t.conversationsList().length)})}}();t.ConversationsListVM=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(43),o=n(25),s=/<LwcCallRecording[^>]*?\surl=\"([^"]+?)\"/i,a=/<LwcCallRecording[^>]*?\sthumbnail=\"([^"]+?)\"/i,c=/<LwcCallRecording[^>]*?\sfilename=\"([^"]+?)\"/i,u=function(){function e(t){var n=this;this.message=t,this.thumbnailUrl=ko.observable(),this.onRecordingKeyDown=function(e,t){var n=r.default.getKeyCode(t);n!==o.default.ENTER&&n!==o.default.SPACE||t.target.click()},this.onContentChanged=function(t){var r=e.getMatchedContent(t,a);r&&i.swc.services.amsManager.getCallRecordingThumbnail(r).then(function(e){var t=(window.URL||i.swcWindow.webkitURL).createObjectURL(e);n.thumbnailUrl(t)})},t.subscribe("content",this.onContentChanged),this.onContentChanged(t.content)}return e.prototype.dispose=function(){this.message.unsubscribe("content",this.onContentChanged)},e.prototype.downloadRecording=function(){var t=this,n=null,r=!!navigator.msSaveOrOpenBlob,o=e.getMatchedContent(this.message.content,s)+"/views/video";r||(n=window.open("","_blank")),i.swc.services.amsManager.downloadCallRecording(o).then(function(i){if(r){var s=e.getMatchedContent(t.message.content,c);navigator.msSaveOrOpenBlob(i,s)}else n.location.href=o})},e.getMatchedContent=function(e,t){var n=e.match(t);return n?n[1]:null},e}();t.CallRecordingVM=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(43),o=n(25),s="/views/imgpsh_fullsize",a=function(){function e(e,t,n,a){var l=this;this.message=e,this._conversation=t,this.thumbnailUrl=ko.observable(),this.onImgKeyDown=function(e,t){var n=r.default.getKeyCode(t);n!==o.default.ENTER&&n!==o.default.SPACE||t.target.click()},this.downloadImage=function(){var e=null,t=!!navigator.msSaveOrOpenBlob,n=c(l.message.content),r=u(l.message.content);r&&-1===r.indexOf(s)?r+=s:r="https://api.asm.skype.com/v1/objects/"+n+s,l._conversation.download(r)||(t||(e=window.open("","_blank")),i.swc.services.amsManager.downloadPicture(n).then(function(n){t?navigator.msSaveOrOpenBlob(n,function(e){var t=e.match(/<LwcImage[^>]*?\sfilename=\"([^"]+?)\"/i);if(!t)return null;var n=t[1];return n.substr(n.lastIndexOf("/")+1)}(l.message.content)):e.location.href=r}))},this.messageList=n,e.subscribe("content",function(e){l.onContentUpdate(e)}),this.onContentUpdate(e.content)}return e.prototype.onContentUpdate=function(e){var t=this,n=c(e);n&&i.swc.services.amsManager.downloadPictureThumbnail(n).then(function(e){var n=(window.URL||i.swcWindow.webkitURL).createObjectURL(e);t.thumbnailUrl(n)})},e}();function c(e){var t=u(e);return t?t.substr(t.lastIndexOf("/")+1):null}function u(e){var t=e.match(/<LwcImage[^>]*?\surl=\"([^"]+?)\"/i);return t?t[1]:null}t.ImageMessageVM=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(551),o=n(464);t.getMessageViewModel=function(e,t,n,s){return e.type===i.MessageType.LwcFile?new r.BaseFileMessage(e,t,n,s):new o.BaseMessage(e,t,n,s)}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(58),s=n(4),a=n(0),c=n(72),u=n(459),l=n(464),p=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.displaySize=ko.observable(),o.originalName=ko.observable(),o.downloaded=ko.observable(!1),o.title=ko.observable(),o.icon=ko.observable(),o.directionIcon='<span class="swcIcon swcIcon_settingsGeneral"></span>',o.statusText=ko.observable(),o.statusIcon=ko.observable(),o.isMyNewMessage=!1,o._retryFileSend=function(){a.swc.services.amsManager.retryFileUpload(o.conversation,o.documentId),o.updateFileStatus(o.documentId)},o.downloadFile=function(){o.conversation.download(o.url)||a.swc.services.amsManager.downloadFileByDocumentId(o.documentId).then(function(e){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,o.fullName);else{var t=a.swcWindow.URL||a.swcWindow.webkitURL,n=t.createObjectURL(e),i=document.createElement("a");document.body.appendChild(i),i.href=n,i.setAttribute("download",o.fullName),i.click(),t.revokeObjectURL(n)}o.downloaded(!0),o.sendDlTelemetry()})},o.isMyNewMessage=t.direction===s.Direction.Outgoing&&t.status===s.DeliveryStatus.Pending,t.subscribe("content",function(e){clearTimeout(o.statusTimeout),o.statusTimeout=void 0,o.onContentUpdate(e)}),o.onContentUpdate(t.content),o}return r(t,e),t.prototype.onContentUpdate=function(e){var t=function(e){var t=function(e){var t=e.match(/<LwcFile[^>]*?\surl=\"([^"]+?)\"/i);if(!t)return null;var n=t[1];return n.substr(n.lastIndexOf("/")+1)}(e);if(!t)return{size:0,name:null,url:null,extension:"",documentId:""};var n=e.match(/<LwcFile[^>]*?\ssize=\"([\d]+?)\"/i),i=n&&parseInt(n[1],10)||0,r=e.match(/<LwcFile[^>]*?\soriginalName=\"([^"]+?)\"/i),o=r?r[1]:null,s=e.match(/<LwcFile[^>]*?\surl=\"([^"]+?)\"/i),a=s?s[1]:null,u=c.getNameAndExtension(o),l=u.name,p=u.extension;return{size:i,name:l,url:a,extension:p,documentId:t}}(e);this.displaySize(function(e){var t=0;for(;e>=1024;)e/=1024,t++;return Math.floor(e)+" "+["Bytes","KB","MB","GB"][t]}(t.size)),this.originalName(t.name),this.url=t.url,this.documentId=t.documentId,this.fullName=t.name+"."+t.extension;var n=function(e){var t=a.swc.services.i18n.fetch("message_text_file_type",{ext:e.toUpperCase()}),n='<span class="swcIcon '+u.getFileIconTypeByExtension(e)+'"></span>';switch(e){case"xls":case"xlsx":t="Excel";break;case"doc":case"docx":t="Word";break;case"ppt":case"pptx":t="PowerPoint";break;case"one":t="OneNote";break;case"pdf":t="PDF";break;case"vdx":case"vsd":case"vsdx":t="Visio"}return{icon:n,title:t}}(t.extension);this.title(n.title),this.icon(n.icon),this.isMyNewMessage&&this.updateFileStatus(this.documentId)},t.prototype.updateFileStatus=function(e){var t=this;a.swc.services.amsManager.getFileStatus(e).then(function(n){t.documentId===e&&(n.uploadStatus!==o.DocumentStatus.InProgress&&n.uploadStatus!==o.DocumentStatus.ScanInProgress||(t.statusTimeout=setTimeout(function(){t.updateFileStatus(e)},2e3)),t.setUploadStatus(n.uploadStatus))}).catch(function(){t.documentId===e&&t.setUploadStatus(o.DocumentStatus.Failed)})},t.prototype.setUploadStatus=function(e){var t="",n="";switch(e){case o.DocumentStatus.Failed:t=this.isMyNewMessage?this.textUploadFailed():this.textMessageError(),n='<span class="swcIcon swcIcon_error"></span>';break;case o.DocumentStatus.ScanInProgress:t=this.textMessageScanning(),n='<div class="swcSpinner swcSpinner_small"></div>';break;case o.DocumentStatus.InProgress:t=this.textMessageUploading(),n='<div class="swcSpinner swcSpinner_small"></div>';break;case o.DocumentStatus.Malware:t=this.textMessageMalware(),n='<span class="swcIcon swcIcon_error"></span>';break;case o.DocumentStatus.Success:t=this.isMyNewMessage?this.textMessageUploadComplete():"",n=this.isMyNewMessage?'<span class="swcIcon swcIcon_ok"></span>':""}this.uploadStatus=e,this.statusText(t),this.statusIcon(n)},t.prototype.getMessageActions=function(){var t=e.prototype.getMessageActions.call(this);return this.isMyNewMessage&&this.uploadStatus===o.DocumentStatus.Failed&&t[0].items.push({title:this.textMessageRetry(),group:1,action:this._retryFileSend}),t},t.prototype.sendDlTelemetry=function(){a.swc.Telemetry.sendEvent.fileAction("DownloadClick",this.fullName,this.message.clientMessageId,this.message.rawMessageType,this.conversation.id,this.conversation.selfParticipant.person.id,this.message.senderId,!this.conversation.isOneOnOne,this.conversation.members.length||this.conversation.participants.length||-1)},t}(l.BaseMessage);t.BaseFileMessage=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){var n=this;this.content=ko.observable(),this.content(e.content),e.subscribe("content",function(e){return n.content(e)})}}();t.default=i},function(e,t){e.exports='<div class="conversationsList" data-bind="visible: count()">\r\n    <ul data-bind="foreach: { data: conversationsList, as: \'item\', afterAdd: appendAvatarVM },\r\n        visible: expanded, click: toggleExpand">\r\n        <li data-bind="click: show">\r\n            <p class="title" data-bind="text: item.title()"></p>\r\n        </li>\r\n    </ul>\r\n    <button class="expand" aria-haspopup="true"\r\n            data-bind="click: toggleExpand, css: {expanded: expanded()}, attr: {title: buttonTitle()}">\r\n        <span>+<span class="title" data-bind="text: count()"></span></span>\r\n    </button>\r\n</div>\r\n'},function(e,t){e.exports='\x3c!-- ko if: !isDeletedMessage() --\x3e\r\n    <div class="message" role="presentation" data-bind="css: classNames,\r\n    attr: {\'data-messageType\': type}, event: { contextmenu: openMessageActions }, listItem: true">\r\n        <div class="headerAvatar" aria-label="avatar" tabindex="-1"\r\n        data-bind="click: navigateToChat.bind(null, senderId), event: { keydown: onAvatarKeyDown }, visible: showAuthor()"></div>\r\n        <div class="authorAndContent">\r\n            <div class="messageInfo" data-bind="visible: showMessageInfo">\r\n                <span class="author" data-bind="text: author, visible: showAuthor()"></span>\r\n                <span class="timestamp"\r\n                    data-bind="text: timestamp, visible: !statusClassName() && showTimestamp()"></span>\r\n            </div>\r\n            <div class="bubble" data-bind="style:{ \'max-height\': contentLimitValue }">\r\n                <div class="messageType" data-bind="component: {\r\n                    name: type.toLowerCase(),\r\n                    params: {\r\n                        message: $data.message,\r\n                        conversation: $data.conversation,\r\n                        meUserName: $parent.meUserName,\r\n                        suggestedActions: $parent.suggestedAction,\r\n                        messageListElement: messageListElement\r\n                    }\r\n                }"></div>\r\n            </div>\r\n            <div class="buttons">\r\n                <button class="button seemore" data-bind="click: seeMore">\r\n                    <span class="normal">See All </span>\r\n                    <span class="swcIcon swcIcon_chevronDown" aria-hidden="true"></span>\r\n                </button>\r\n                <button class="button seeless" data-bind="click: seeLess">\r\n                    <span class="normal">See Less </span>\r\n                    <span class="swcIcon swcIcon_chevronUp" aria-hidden="true"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="sendingStatus" data-bind="text: status(), css: statusClassName()"></div>\r\n    </div>\r\n\x3c!-- /ko --\x3e\r\n'},function(e,t){e.exports="<div class=\"swift\">\r\n    \x3c!-- ko if: !swift.isSupported() --\x3e\r\n        \x3c!-- ko template: { name: 'swiftUnsupported', data: swift } --\x3e\r\n        \x3c!-- /ko --\x3e\r\n    \x3c!-- /ko --\x3e\r\n    \x3c!-- ko if: swift.isSupported() --\x3e\r\n        \x3c!-- ko if: swift.isCarousel() --\x3e\r\n            \x3c!-- ko template: { name: 'swiftCarouselCard', data: swift } --\x3e\r\n            \x3c!-- /ko --\x3e\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!-- ko if: !swift.isCarousel() && !swift.isMultilineCard()--\x3e\r\n            \x3c!-- ko template: { name: 'swiftSingleCard', data: swift } --\x3e\r\n            \x3c!-- /ko --\x3e\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!-- ko if: swift.isMultilineCard() --\x3e\r\n        \x3c!-- ko template: { name: 'swiftMultilineCard', data: swift } --\x3e\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!-- /ko --\x3e\r\n    \x3c!-- /ko --\x3e\r\n</div>\r\n"},function(e,t){e.exports="\x3c!-- DO NOT REMOVE - Adaptive Card template holder --\x3e\r\n"},function(e,t){e.exports='<div class="lwx-message">\r\n    <div class="PictureWrapper">\r\n        <div class="PictureSharing">\r\n            <a class="thumbnailHolder" data-bind="click: downloadImage, event: { keydown: onImgKeyDown }, listActionable: true" target="_blank" tabindex="0">\r\n                \x3c!-- ko if: thumbnailUrl --\x3e\r\n                <span class="thumbnail" data-bind="style: {backgroundImage: \'url(\\\'\' + thumbnailUrl() + \'\\\')\'}"></span>\r\n                \x3c!-- /ko --\x3e\r\n\r\n                \x3c!-- ko ifnot: thumbnailUrl --\x3e\r\n                <span class="thumbnail"></span>\r\n                \x3c!-- /ko --\x3e\r\n            </a>\r\n        </div>\r\n        <reactions-bar class="reactionsBar" params="message: message, messageListElement: messageList"></reactions-bar>\r\n    </div>\r\n    \x3c!-- ko if: $parent.showEditedIcon --\x3e\r\n    <span class="edit messageBtn" data-bind="attr:{\'aria-label\': $parent.textEditedMessage, title: $parent.textEditedMessage}">\r\n        <span class="swcIcon swcIcon_topic" aria-hidden="true"></span>\r\n    </span>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    \x3c!-- ko if: $parent.showMessageActions() --\x3e\r\n    <div class="actionsContainer">\r\n        <button class="messageBtn deleteAction" data-bind="click: $parent.openDeleteMsgConfirmationDialog,\r\n        attr: {title: $parent.textDeleteMessageHeader}">\r\n            <span class="swcIcon swcIcon_delete" aria-hidden="true"></span>\r\n        </button>\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n</div>\r\n'},function(e,t){e.exports='<div class="lwx-message">\r\n    <div class="previewWithMeta">\r\n        <div class="meta">\r\n            <div class="name" data-bind="text: $parent.originalName, attr: {title: $parent.originalName}"></div>\r\n            <div class="status">\r\n                <span class="size" data-bind="text: $parent.displaySize, attr: {title: $parent.displaySize}"></span>\r\n                <span class="status-text" data-bind="text: $parent.statusText, attr: {title: $parent.statusText}"></span>\r\n                <span class="status-icon" data-bind="html: $parent.statusIcon"></span>\r\n            </div>\r\n            <div class="type">\r\n                <span class="type-icon" data-bind="html: $parent.icon"></span>\r\n                <span class="type-title" data-bind="text: $parent.title, attr: {title: $parent.title}"></span>\r\n                <span class="type-direction-icon" data-bind="html: $parent.directionIcon"></span>\r\n            </div>\r\n        </div>\r\n        <button aria-label="download file" class="download" data-bind="click: $parent.downloadFile, text: $parent.textDownload, listActionable: true"></button>\r\n    </div>\r\n\r\n    \x3c!-- ko if: $parent.showMessageActions() --\x3e\r\n    <div class="actionsContainer">\r\n        <button class="messageBtn deleteAction" data-bind="click: $parent.openDeleteMsgConfirmationDialog,\r\n        attr: {title: $parent.textDeleteMessageHeader}">\r\n            <span class="swcIcon swcIcon_delete" aria-hidden="true"></span>\r\n        </button>\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n</div>\r\n'},function(e,t){e.exports='<div class="lwx-message">\r\n    <div class="PictureWrapper">\r\n        <div class="PictureSharing">\r\n            <a class="thumbnailHolder" data-bind="click: downloadRecording, event: { keydown: onRecordingKeyDown }" target="_blank" tabindex="-1">\r\n                \x3c!-- ko if: thumbnailUrl --\x3e\r\n                <span class="thumbnail" data-bind="style: {backgroundImage: \'url(\\\'\' + thumbnailUrl() + \'\\\')\'}"></span>\r\n                \x3c!-- /ko --\x3e\r\n\r\n                \x3c!-- ko ifnot: thumbnailUrl --\x3e\r\n                <span class="thumbnail"></span>\r\n                \x3c!-- /ko --\x3e\r\n            </a>\r\n        </div>\r\n    </div>\r\n</div>\r\n'},function(e,t){e.exports='<div class="action">\r\n    \x3c!-- ko ifnot: loggedIn --\x3e\r\n        <div class="callToAction">\r\n            \x3c!-- ko if: isAgent --\x3e\r\n            <button class="sayhi" data-bind="click: sendHi,\r\n            text: say_hi,\r\n            attr: {\'aria-label\': say_hi_to_bot_aria}"></button>\r\n            \x3c!-- /ko --\x3e\r\n\r\n            \x3c!-- ko ifnot: isGuestOnlyMode --\x3e\r\n            <span data-bind="text: or_text()"></span>\r\n            <span class="signin">\r\n            <button data-bind="click: signin,\r\n                text: sign_in_text,\r\n                attr: {\'aria-label\': sign_in_to_save_chat_aria}"></button>\r\n                <span data-bind="text: to_save_your_chat"></span>\r\n            </span>\r\n            \x3c!-- /ko --\x3e\r\n        </div>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    \x3c!-- ko if: loggedIn --\x3e\r\n        <div>\r\n            <span data-bind="text: welcome_back_text"></span><button data-bind="attr:{ \'title\':displayName }, text:displayName, click: nameClick, css: {nameClicked: nameClicked, disableLogout: disableLogout}"></button>!\r\n        </div>\r\n        \x3c!-- ko if: nameClicked --\x3e\r\n        <div>\r\n        <button class="signin" data-bind="click: signout,\r\n            text: click_here_text, attr: { \'title\': click_here_to_switch_accounts_aria }"></button>\r\n        <span data-bind="text: to_switch_accounts"></span>\r\n        </div>\r\n        \x3c!-- /ko --\x3e\r\n    \x3c!-- /ko --\x3e\r\n</div>\r\n'},function(e,t){e.exports='<div class="skypeLogo">\r\n    <skype-logo></skype-logo>\r\n</div>\r\n'},function(e,t){e.exports='<div class="unread-splitter" data-bind="text: content"></div>\r\n'},function(e,t){e.exports='<div class="lwx-message">\r\n    <div class="content" data-bind="html: content,\r\n        style:{ backgroundColor:messageColor, background: messageColor },\r\n        css: { sticker: isExtraLargeEmoticon, bot: isAgent }"></div>\r\n</div>\r\n'},function(e,t){e.exports='<div class="message welcome">\r\n    <skype-logo></skype-logo>\r\n    <div data-bind="html: they_are_speaking()">\r\n    </div>\r\n    <div data-bind="html: you_are_speaking()">\r\n    </div>\r\n    <div>\r\n        <a tabindex="0" data-bind="click:activateTranslation, text: callToAction, event: { keydown: onKeyDown }"></a>\r\n    </div>\r\n</div>\r\n'},function(e,t){e.exports='<div class="audioPlayer">\r\n    \x3c!-- ko if: showCoverImage() --\x3e\r\n    <div class="coverHolder">\r\n        <img class="thumbnail" data-bind="attr: { src: coverImage.url, alt: coverImage.alt, width: coverImage.uiSize().width, height: coverImage.uiSize().height },\r\n                style: { left: coverImage.leftAlignment() + \'px\', bottom: coverImage.bottomAlignment() + \'px\' }" />\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n    \x3c!-- ko if: showLoadingInfo --\x3e\r\n    <div class="loader" data-bind="visible: isLoading()"></div>\r\n    <div class="error" data-bind="visible: failed()">\r\n        <span class="swcIcon swcIcon_error"></span>\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    <div class="controlsOverlay" data-bind="click: togglePlay"></div>\r\n\r\n    <audio class="player" data-bind="attr: { src: media, loop: autoloop}, click: togglePlay,\r\n            event: {canplay: onReady, error: onError, loadedmetadata: onMetadataLoaded, timeupdate: onTimeUpdated, ended: onAudioEnded}"></audio>\r\n\r\n    <div class="playerControls" data-bind="visible: canPlay">\r\n\r\n        <button data-bind="click: togglePlay, attr: {title: playButtonText}"\r\n                class="button" type="button">\r\n            \x3c!-- ko if: isPlaying() --\x3e\r\n            <span class="swcIcon swcIcon_pause"></span>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: !isPlaying() --\x3e\r\n            <span class="swcIcon swcIcon_play"></span>\r\n            \x3c!-- /ko --\x3e\r\n        </button>\r\n\r\n        <div class="timeline" data-bind="click: onTimelineClick">\r\n            <div class="timers">\r\n                <div class="currentTime" data-bind="text: currentTime"></div>\r\n                <div class="totalTime" data-bind="text: totalTime"></div>\r\n            </div>\r\n            <div class="totalProgress"></div>\r\n\r\n            <div class="progress" data-bind="attr: {style: currentProgress}">\r\n                <div class="handle" data-bind="event: {mousedown: onHandleStartDrag}"></div>\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n</div>\r\n'},function(e,t){e.exports='<div class="videoPlayer">\r\n\r\n    <div class="fullsreenInfo" data-bind="visible: isInFullscreen">\r\n        \x3c!-- ko if: subtitle --\x3e\r\n        <h2 data-bind="text: subtitle, attr: { title: subtitle }"></h2>\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!-- ko if: title --\x3e\r\n        <h1 data-bind="text: title, attr: { title: title }"></h1>\r\n        \x3c!-- /ko --\x3e\r\n    </div>\r\n\r\n    \x3c!-- ko if: showLoadingInfo --\x3e\r\n    <div class="loader" data-bind="visible: isLoading()"></div>\r\n    <div class="error" data-bind="visible: failed()">\r\n        <span class="swcIcon swcIcon_error"></span>\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    <div class="controlsOverlay" data-bind="click: togglePlay"></div>\r\n\r\n    <video class="player" data-bind="attr: { src: media, loop: autoloop, autoplay: autoplay}, click: togglePlay,\r\n            event: {onprogress: onProgress, canplay: onReady, error: onError, loadedmetadata: onMetadataLoaded, timeupdate: onTimeUpdated, ended: onVideoEnded}">\r\n    </video>\r\n\r\n    <div class="playerControls" data-bind="visible: canPlay">\r\n\r\n        <button data-bind="click: togglePlay, attr: {title: playButtonText}"\r\n                class="button" type="button">\r\n            \x3c!-- ko if: isPlaying() --\x3e\r\n            <span class="swcIcon swcIcon_pause"></span>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: !isPlaying() --\x3e\r\n            <span class="swcIcon swcIcon_play"></span>\r\n            \x3c!-- /ko --\x3e\r\n        </button>\r\n\r\n        \x3c!-- ko if: displayCurrentTime --\x3e\r\n        <div class="currentTime" data-bind="text: currentTime"></div>\r\n        \x3c!-- /ko  --\x3e\r\n\r\n        <div class="timeline" data-bind="click: onTimelineClick">\r\n            <div class="totalProgress"></div>\r\n            <div class="progress" data-bind="attr: {style: currentProgress}">\r\n                <div class="handle" data-bind="event: {mousedown: onHandleStartDrag}"></div>\r\n            </div>\r\n        </div>\r\n\r\n        \x3c!-- ko if: displayTotalTime --\x3e\r\n        <div class="totalTime" data-bind="text: totalTime"></div>\r\n        \x3c!-- /ko --\x3e\r\n\r\n        \x3c!-- ko if: displayMuteButton --\x3e\r\n        <button data-bind="click: toggleMute, attr: {title: toggleMuteText()}"\r\n                class="button" type="button">\r\n            \x3c!-- ko if: isMuted() --\x3e\r\n            <span class="swcIcon swcIcon_volumeOff"></span>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: !isMuted() --\x3e\r\n            <span class="swcIcon swcIcon_volumeMax"></span>\r\n            \x3c!-- /ko --\x3e\r\n        </button>\r\n        \x3c!-- /ko --\x3e\r\n\r\n        \x3c!-- ko if: isFullscreenSupported --\x3e\r\n        <button data-bind="click: toggleFullscreen, attr: {title: fullscreenButtonText}"\r\n                class="button toggleFullscreen" type="button">\r\n            \x3c!-- ko if: isInFullscreen() --\x3e\r\n            <span class="swcIcon swcIcon_contract"></span>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: !isInFullscreen() --\x3e\r\n            <span class="swcIcon swcIcon_expand"></span>\r\n            \x3c!-- /ko --\x3e\r\n        </button>\r\n        \x3c!-- /ko --\x3e\r\n\r\n    </div>\r\n</div>\r\n'},function(e,t){e.exports='<div class="gifPlayer">\r\n    \x3c!-- ko if: showCoverImage() --\x3e\r\n    <div class="coverHolder">\r\n        <img class="thumbnail" data-bind="attr: { src: coverImage.url(), alt: coverImage.alt, width: coverImage.uiSize().width, height: coverImage.uiSize().height },\r\n                style: { left: coverImage.leftAlignment() + \'px\', bottom: coverImage.bottomAlignment() + \'px\' }" />\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n    \x3c!-- ko if: showLoadingInfo --\x3e\r\n    <div class="loader" data-bind="visible: isLoading()"></div>\r\n    <div class="error" data-bind="visible: failed()">\r\n        <span class="swcIcon swcIcon_error"></span>\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    \x3c!-- ko if: media --\x3e\r\n    <img data-bind="visible: canPlay(),\r\n            attr: { src: media.url,\r\n                alt: media.alt,\r\n                width: media.uiSize().width,\r\n                height: media.uiSize().height\r\n            }, style: { left: media.leftAlignment(),\r\n                bottom: media.bottomAlignment()\r\n            },\r\n            event: { load: onReady, error: onError }" />\r\n    \x3c!-- /ko --\x3e\r\n</div>\r\n'},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(20),r=n(3),o=n(0),s=n(55),a=n(140),c=n(569),u=n(53),l="width: 300px; height: 47px; position: relative;",p="width: 300px; height: 450px; position: relative;",d=function(){function e(){this._resolveCallbacks=[],this._rejectCallbacks=[]}return e.prototype.add=function(e,t){this._resolveCallbacks.push(e),this._rejectCallbacks.push(t)},e.prototype.resolve=function(e){this._resolveCallbacks.forEach(function(t){return t(e)})},e.prototype.reject=function(){this._rejectCallbacks.forEach(function(e){return e()})},e}(),f=function(){function e(e){var t=this;this._conversations={},this._asyncConversationRequests={},this._stageCapacity=1,this._minWidth=1,this._activeCount=0,this._maxStageCapacity=4,this.viewports=[],this._onVisibilityChange=function(e){var n=t.get(e.key);if(n){var i=e.isVisible&&n.onStage;!n.alwaysOnStage&&n.stashed&&t._pop(e.key),e.isVisible?(n.container&&t._focusDefault(n.container),i||(n.alwaysOnStage&&s.isInIframe()&&t._recountStage(!0),t._moveToStage(n))):(t._cancelFocusDefault(),t._removeFromStage(e.key)),i||(t._recountStage(),t._stored&&(t._moveToStage(t._stored),t._stored=null))}},this._onResize=function(){t._recountStage()},this._removeFromStage=function(e,n){var i,r;e?r=e:t.forEach(function(e,t){!e.alwaysOnStage&&e.onStage&&(i?e.displayedAt<=i&&(i=e.displayedAt,r=t):(i=e.displayedAt,r=t))});var o=t.get(r);return s.isInIframe()&&t.removeFromViewport(o),o.onStage=!1,t._activeCount--,o.model.isActive=!1,o},this._pop=function(e){if(!t._conversationsList)return null;var n,i=e;if(i||t.forEach(function(e,t){e.stashed&&(n?e.displayedAt>=n&&(n=e.displayedAt,i=t):(n=e.displayedAt,i=t))}),i){var r=t.get(i);return r.stashed=!1,r.container.style.display="flex",t._conversationsList.remove(r.vm),r}return null},this._stash=function(e){if(!t._conversationsList){t._conversationsList=new c.ConversationsList;var n=document.createElement("div");if(n.innerHTML="\x3c!-- ko component: {name: 'conversations-list', params: {conversations: conversations}} --\x3e\x3c!-- /ko --\x3e",ko.applyBindings({conversations:t._conversationsList},n),t._conversationsListContainer=n.firstElementChild,r.default.get.theme&&(t._theme=r.default.get.theme,t._conversationsListContainer.classList.add(t._theme)),t._bindTheme(),t.listViewport)t.listViewport.document.body.appendChild(n);else{var i=t._container||document.body;i.insertBefore(t._conversationsListContainer,i.childNodes[0])}}s.isInIframe()&&e.container&&document.body.appendChild(e.container),e.stashed=!0,e.container.style.display="none",t._conversationsList.add(e.vm)},this._bindTheme=function(){return r.default.get.subscribe("theme",function(e){var n=t._conversationsListContainer.classList;t._theme&&n.remove(t._theme),e&&n.add(e),t._theme=e})},this._toggleCollapse=function(e){var n=t.get(e),i=n&&n.container;if(i){var r=i.classList,o=r.contains("collapsed");o?r.remove("collapsed"):r.add("collapsed");var s=n.viewport;s&&t._parallelView&&t._viewports.update(s,{classes:i.className.split(" "),attrs:{style:o?p:l},active:!!o})}},this._container=e.container,this._minWidth=e.minWidth,o.swc.Eventing.registerEvent("onVisibilityChange",this._onVisibilityChange),this._addListeners(),this._viewports=o.swc.services.viewports}return Object.defineProperty(e.prototype,"baseParent",{get:function(){return this._container},set:function(e){this._container=e,this._recountStage()},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e){for(var t in this._conversations)if(this._conversations.hasOwnProperty(t)){var n=this._conversations[t];e.call(n,n,t)}},e.prototype.add=function(e,t){var n=this;if(!this._conversations[e]){this._conversations[e]=t;var i=this._asyncConversationRequests[e];i&&(i.resolve(t),delete this._asyncConversationRequests[e]);var r=Object.keys(this._conversations).length;o.swc.Telemetry.sendEvent.maxConversationsOpened(r)}var s=t.vm;s&&s.isCollapsed.subscribe(function(){return n._toggleCollapse(e)})},e.prototype.get=function(e){return this._conversations[e]},e.prototype.getAsync=function(e){var t=this;return new Promise(function(n,i){var r=t.get(e);r?n(r):(t._asyncConversationRequests[e]||(t._asyncConversationRequests[e]=new d),t._asyncConversationRequests[e].add(n,i),setTimeout(function(){var n=t._asyncConversationRequests[e];n&&(delete t._asyncConversationRequests[e],n.reject())},6e4))})},e.prototype.setContainer=function(e,t){var n=this.get(e);n&&(n.container=t)},e.prototype.dispose=function(){var e=this;this.forEach(function(t,n){var i=t.model;t.stashed?e._pop(n):e._removeFromStage(n),i&&i.dispose(),delete e._conversations[n]})},e.prototype._focusDefault=function(e){var t=this;this._focusDefaultTimer&&clearTimeout(this._focusDefaultTimer),this._focusDefaultTimer=setTimeout(function(){if(t._focusDefaultTimer=void 0,e){var n=i.AbilityHelpers.focusable.findDefault(e);n&&i.AbilityHelpers.focusedElement.focus(n)}},0)},e.prototype._cancelFocusDefault=function(){this._focusDefaultTimer&&(clearTimeout(this._focusDefaultTimer),this._focusDefaultTimer=void 0)},e.prototype._addListeners=function(){this._windowResizeHandler=u(this._onResize,200),window.addEventListener("resize",this._windowResizeHandler),o.swc.services.notificationsManager.setOpenedConversations(this._conversations)},e.prototype.createViewports=function(e,t,n){var i=this;this._parallelView=n.ParallelView,this._parallelView&&e++;for(var r=[],o=function(e){var n=e||!s._parallelView?"conversation":"conversationsList",o=e?{attrs:{style:"display: none;"},classes:["swcChat__frame"]}:{attrs:s._parallelView?{style:"display: none;"}:{style:"display: block;"},classes:s._parallelView?["conversationsList"]:["swcChat__frame","lwc-chat-frame"]};r.push(s._viewports.create({type:n,group:"messaging"},o).then(function(n){var r=n.document.body;e?r.style.margin="0":i._parallelView?r.setAttribute("style","display: flex; justify-content: flex-end; height: 100%; width: 100%; flex-direction: column; align-items: flex-end;"):n.document.body.parentElement.className="swc-chat";var o=[];if(t)for(var s=0,c=t;s<c.length;s++){var u=c[s];o.push(a.StyleLoader.addStyle(u,n.document))}return Promise.all(o).then(function(){e||!i._parallelView?i.viewports.push(n):i._parallelView&&(i.listViewport=n)})}))},s=this,c=0;c<e;c++)o(c);return Promise.all(r)},e.prototype.addToViewport=function(e){for(var t=0,n=this.viewports;t<n.length;t++){var i=n[t],r=i.document.body;if(!r.firstElementChild)return e.container&&(r.appendChild(e.container),e.viewport=i,this._parallelView&&this._viewports.update(i,{attrs:{style:p},active:!0}),o.swc.services.pesManager.refresh()),!0}return!1},e.prototype.removeFromViewport=function(e){this._parallelView&&(document.body.appendChild(e.container),this._viewports.update(e.viewport,{attrs:{style:"display: none;"},active:!1}),e.viewport=null)},e.prototype._moveToStage=function(e){e&&(this._currentConversation=e,e.onStage||(e.onStage=!0,e.model.isActive=!0,this._activeCount++),e.displayedAt=Date.now(),e.container.style.display="",s.isInIframe()?this.addToViewport(e)||(document.body.appendChild(e.container),this._stored=e):this._container&&(this._container.contains(e.container)||this._container.appendChild(e.container)),e.vm&&e.vm.isCollapsed(!1),o.swc.Eventing.triggerLocalEvent("viewRestored",e.model.id))},e.prototype._getOuterWidth=function(e){var t=e.offsetWidth,n=window.getComputedStyle(e,null),i=parseInt(n.maxWidth,10)||0;return(t=t<i?i:t)+(parseInt(n.marginLeft,10)||0)+(parseInt(n.marginRight,10)||0)},e.prototype._recountStage=function(e){if(this._conversations&&this._activeCount){if(this._container){var t=this._container.clientWidth;this._stageCapacity=t/(this._minWidth||this._getOuterWidth(this._currentConversation.container))}this._maxStageCapacity?Math.min(this._stageCapacity,this._maxStageCapacity):this._stageCapacity;4;var n=Math.floor(4)-this._activeCount;if(e&&n<1&&n--,n<0)for(var i=0;i>n;i--)this._stash(this._removeFromStage());else if(n>0)for(i=0;i<n;i++)this._moveToStage(this._pop());if(this.listViewport){var r=this._conversationsList&&this._conversationsList.count?{attrs:{style:"width: 240px; height: 450px; position: relative;"},active:!0}:{attrs:{style:"display: none;"},active:!0};this._viewports.update(this.listViewport,r)}}},e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.conversationsList=ko.observableArray()}return e.prototype.add=function(e){return this.conversationsList.push(e)},e.prototype.remove=function(e){return this.conversationsList.remove(e)},e.prototype.shift=function(){return this.conversationsList.shift()},Object.defineProperty(e.prototype,"count",{get:function(){return this.conversationsList().length},enumerable:!0,configurable:!0}),e}();t.ConversationsList=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(571),r=n(591),o=n(592),s=n(595),a=n(596),c=function(){function e(){}return e.register=function(e){this.isInitialized||(ko.components.register("messages-list",{viewModel:{createViewModel:function(e,t){return new o.default(e,t.element)}},template:n(597),synchronous:!0}),ko.components.register("typing-indicator",{viewModel:{createViewModel:function(e){return new r.default(e.conversation)}},template:n(598),synchronous:!0}),ko.components.register("conversation",{viewModel:{createViewModel:function(t,n){return new i.default(t,e,n.element)}},template:n(599),synchronous:!0}),ko.components.register("lwc-signin",{viewModel:{createViewModel:function(t,n){return new s.default(t,e,n.element)}},template:n(600),synchronous:!0}),ko.components.register("reactions-bar",{viewModel:{createViewModel:function(e,t){return new a.default(e.message,e.messageListElement,t.element)}},template:n(601),synchronous:!0}),this.isInitialized=!0)},e.unregister=function(){ko.components.unregister("messages-list"),ko.components.unregister("conversation"),ko.components.unregister("reactions-bar"),this.isInitialized=!1},e.isInitialized=!1,e}();t.default=c},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(2),s=n(20),a=n(3),c=n(1),u=n(86),l=n(19),p=n(71),d=n(100),f=n(26),h=n(47),g=n(38),m=n(141),v=n(30),y=n(352),_=n(132),b=n(103),w=n(4),C=n(69),S=n(70),T=n(169),E=n(39),P=n(79),I=n(431),k=n(33),M=n(0),O=n(572),A=n(56),x=n(59),N=n(170),L=n(353),R=n(354),D=n(7),U=n(72),F=n(13),j=n(29),B=n(139),H=n(9),G=n(54),z=n(18),W=n(21),V=n(359),K=n(466),q=n(573),J=n(575),Y=n(588),$=n(355),X=n(14),Q=n(589),Z=n(185),ee=n(590),te=n(53),ne=function(e,t){return M.swc.services.i18n.fetch(e,t)},ie="swc-calling",re="./calling-popup.html",oe="width=640, height=480, menubar=no, status=no, titlebar=no, toolbar=no, rel=noopener noreferrer",se="/sdk/v1/",ae="sdk",ce="js",ue=1e3,le=",";function pe(){var e=M.swc.services.localStorage.getItem(k.SWC_SFB_DISMISSED_KEY);return e?e.split(le):[]}var de=function(){function e(e,t,n){var i=this;this._params=e,this.chatDataConfig=t,this._element=n,this.showComponent=ko.observable(!1),this.isCollapsed=ko.observable(!1),this.title=ko.observable(),this.avatarUrl=ko.observable(""),this.brandMessage=ko.observable(""),this.showBrand=ko.observable(!0),this.isAgent=ko.observable(!1),this.signedIn=ko.observable(!0),this.showLoginPage=ko.observable(!1),this.privacyStatementUrl=ko.observable(""),this.termOfUseUrl=ko.observable(""),this.isPickerVisible=ko.observable(!1),this.pesConfigInitialized=ko.observable(!1),this.userMessageSent=ko.observable(!1),this.isGuest=ko.observable(!0),this.showCalling=ko.observable(!1),this.showOtherActions=ko.observable(!0),this.showMoreActionsBtn=ko.observable(!1),this.suppressCallingControls=ko.observable(!1),this.audioEnabled=ko.observable(!0),this.videoEnabled=ko.observable(!0),this.animateLoginScreen=ko.observable(!0),this.showAddParticipants=ko.observable(!1),this.showRemoveParticipants=ko.observable(!1),this.showShowParticipants=ko.observable(!1),this.warnings=ko.observableArray([]),this.isMePersonGuest=ko.observable(!0),this.isParticipantControlEnabled=ko.observable(!1),this.unreadMessageCounter=ko.observable(0),this.languageChangeToggle=ko.observable(),this.showParticipantsControl=ko.computed(function(){return!1}),this.showActionsBar=ko.computed(function(){return!0}),this.editConversationTitleText=ko.observable(""),this.deleteConversationTitle=ko.observable(""),this.deleteConversationText=ko.observable(""),this.deleteConversationConfirmTitle=ko.observable(""),this.titleColor=ko.observable(""),this.titleBackground=ko.observable(""),this.correlationId=F.guid.generate(),this.canRemoveParticipants=ko.observable(!1),this.deviceWarnings=ko.observableArray([]),this.texts={calling_disabled_warning:"",sfb_warning:"",area_text_insertText:"",area_text_disabled:"",teams_admin_chat_disabled:"",teams_admin_chat_disabled_group:""},this.ms_service_privacy_agreement=ko.observable(""),this._callingPopup=null,this.isTypingProxied=!1,this._koSubscriptions=[],this.proxy={},this._proxiedIsChatEnabled=!0,this._canSendEmoticons=!0,this._canUploadFile=!0,this._showCallingWarning=!1,this._showSfbWarning=!1,this.onDevicePermissionCheck=function(e){var t=e.permissions,n=e.id,r=e.withVideo;n===i.conversation.id&&i._handledDeviceWarnings(t,r)},this.onLanguageUpdate=function(){i.localizeResources(),i.languageChangeToggle(!i.languageChangeToggle()),i.onConversationUpdate()},this._onIsBlockedChange=function(e){e?i.showCalling(!1):i.setCallingCapabilities(),i.conversation.isChatEnabled=!e,i.conversation.isGroup||i._updatePersonBlockedState(i.conversation.id,e)},this._onAlertsOffChange=function(e){e?i.unreadMessageCounter(-1):i.unreadMessageCounter(i.conversation.unreadMessagesCount)},this._onParticipantsUpdate=function(){if(i.conversation.isGroup&&!i.conversation.isOneOnOne){var e=i._hasMyselfParticipant(i.conversation.participants);e&&i._enableGroupConversation(),i._showMoreActionButton(e),i.updateActionsBar()}i.onConversationUpdate()},this._showMoreActionButton=function(e){a.default.get.isTeams()?(i.showMoreActionsBtn(!i.isOneOnOneConversation()&&e),i.updateActionsBar()):(i.showMoreActionsBtn(!0),i.updateActionsBar())},this._byTimestamp=function(e,t){return t.originalTimestamp.getTime()>e.originalTimestamp.getTime()?-1:1},this.onConversationUpdate=function(){var e=i.conversation.definition.Prefill,t=i._proxiedPlaceholder||i.conversation.definition.InputPlaceholder||a.default.get.inputPlaceholderOverride||i.texts.area_text_insertText,n=i.conversation.participants.map(function(e){return e.person.mri}),r=M.swc.services.signInManager.isAadSupported()?M.swc.services.userService.then(function(e){return e.getUsers(n)}):Promise.resolve([]);Promise.all([M.swc.services.capabilitiesService.getCapabilitiesForConversation(i.conversation),r]).then(function(n){var r=n[0],o=n[1],s=i._proxiedIsChatEnabled&&r.allowChat,a=!1,c=i.getInitialChatInputProps(),u=c.canSendEmoticons,l=c.canUploadFile;s?M.swc.services.signInManager.isAadSupported()&&(a=o.some(function(e){return!e.featureSettings.isPrivateChatEnabled}))&&(t=i.conversation.isOneOnOne?i.texts.teams_admin_chat_disabled:i.texts.teams_admin_chat_disabled_group,u=!1,l=!1):t=i.texts.area_text_disabled,i._canSendEmoticons=u&&r.allowSendEmoticons&&(i.pesConfigInitialized()||M.swc.services.pesManager.isInitialized),i._canUploadFile=l&&s&&r.allowUploadFiles,i.updateChatInput({isChatEnabled:s&&!a,isEditingEnabled:s&&r.allowEditMessage,canSendEmoticons:i._canSendEmoticons,canUploadFile:i._canUploadFile,placeholder:t,prefillText:e})})},this._enableGroupConversation=function(){i.conversation.isChatEnabled=!0,i.isParticipantControlEnabled(!0),i.setCallingCapabilities()},this.onClicked=function(){return M.swc.Eventing.triggerLocalEvent("hideBubbleWindow"),!0},this._getMoreActions=function(){var e=[{items:[],id:"conversationOptions"},{items:[],id:"botPrivacyOptions"}];return i.conversation.isTeamsOneOnOne||(i.conversation.isGroup?i._hasMyselfParticipant(i.conversation.participants)&&e[0].items.push(B.default.createMenuItem({title:ne("roster_menu_leave_conversation"),action:i.openLeaveConversation})):i.conversation.isBlocked?e[0].items.push(B.default.createMenuItem({title:ne("roster_menu_unblock_contact"),action:i.openUnblockContact})):e[0].items.push(B.default.createMenuItem({title:ne("roster_menu_block_contact"),action:i.openBlockContact}))),a.default.get.isTeams()||e[0].items.push(B.default.createMenuItem({title:ne("roster_menu_delete_conversation"),action:i.openDeleteConversation})),i.conversation.isAgent&&(""!==i.privacyStatementUrl()&&e[1].items.push(B.default.createMenuItem({title:ne("header_privacyPolicy"),action:i.openPrivacyAndCookiesLink})),""!==i.termOfUseUrl()&&e[1].items.push(B.default.createMenuItem({title:ne("header_termsOfUse"),action:i.openTermsOfUseLink}))),e},this.openPrivacyAndCookiesLink=function(){window.open(i.privacyStatementUrl(),"_blank"),M.swc.Telemetry.sendEvent.userAction(P.UserActionType.PrivacyAndCookies)},this.openTermsOfUseLink=function(){window.open(i.termOfUseUrl(),"_blank"),M.swc.Telemetry.sendEvent.userAction(P.UserActionType.TermsOfUse)},this._removeMeParticipantFromModel=function(){for(var e=0;e<i.conversation.participants.length;e++){i.conversation.participants[e].person.id===M.swc.services.mePersonManager.mePerson.id&&i.conversation.participants.spliceObservable(e,1)}},this.openDeleteConversation=function(e){var t=function(){var e=Date.now();i.conversation.deleteConversation().then(function(t){M.swc.Eventing.triggerLocalEvent("removeAllMessagesFromUi",i.conversation.id),M.swc.Telemetry.sendEvent.conversationRemoved(i.conversation,"delete",i.conversation.members.length||i.conversation.participants.length||-1,Date.now()-e,t.status),M.swc.Telemetry.sendEvent.userAction(P.UserActionType.DeleteConversation)},function(e){}).then(function(){if(i.conversation.isGroup){var e=function(){Z.ConfirmationDialog.remove(),M.swc.Eventing.triggerLocalEvent("onConversationDelete",i.conversation.id),i.close()};i.conversation.members.filter(function(e){return M.swc.services.mePersonManager.isMe(e.id)}).length>0&&1!==i.conversation.members.length?i._removeMeParticipant().then(function(){e()}):e()}else M.swc.Eventing.triggerEvent("onConversationDelete",i.conversation.id),i.conversation.messages.length&&i.conversation.messages.spliceObservable(0,i.conversation.messages.length),Z.ConfirmationDialog.remove(),i.close()})};Z.ConfirmationDialog.add(i._element,function(){var e=ne("confirm_dialog_delete_conversation_header"),n=ne("confirm_dialog_delete_conversation_text"),i=ne("btn_confirm_deletion"),r=ne("sign_in_cancel");return L.createConfirmationDialog(e,n,{title:i,action:t},{title:r})},$.SwcTextDialog)},this.openLeaveConversation=function(e){var t=function(){i._removeMeParticipant().then(Z.ConfirmationDialog.remove)};Z.ConfirmationDialog.add(i._element,function(){return L.createConfirmationDialog(i.deleteConversationTitle(),i.deleteConversationText(),{title:i.deleteConversationConfirmTitle(),action:t},{title:ne("sign_in_cancel")})},$.SwcTextDialog)},this.openBlockContact=function(e){var t=function(e){var t=Date.now();M.swc.services.contactsManager.blockContact(i.conversation.id,e.isReportAbuse,e.reason).then(function(n){M.swc.Telemetry.sendEvent.contactBlock("block",n.status,Date.now()-t,e.isReportAbuse,e.reason),Z.ConfirmationDialog.remove(),M.swc.Telemetry.sendEvent.userAction(P.UserActionType.BlockUser),M.swc.services.persons.getPerson(i.conversation.id).isBlocked=!0},function(e){}),M.swc.services.webApi.setBlockedConversation(i.conversation.id,!0)};Z.ConfirmationDialog.add(i._element,function(){var e=ne("confirm_dialog_block_contact_header"),n=ne("btn_confirm_blocking");return L.createConfirmationDialog(e,"",{title:n,action:t},{title:ne("sign_in_cancel")})},$.SwcBlockDialog)},this.openUnblockContact=function(e){var t=Date.now();M.swc.services.contactsManager.unblockContact(i.conversation.id).then(function(e){M.swc.Telemetry.sendEvent.contactBlock("unblock",e.status,Date.now()-t),M.swc.Telemetry.sendEvent.userAction(P.UserActionType.UnblockUser),M.swc.services.persons.getPerson(i.conversation.id).isBlocked=!1},function(e){}),M.swc.services.webApi.setBlockedConversation(i.conversation.id,!1)},this.openMoreActions=function(e){e.stopPropagation();var t=B.default.createMenuList(i._getMoreActions(),"rosterMenuList"),n=i._element.querySelector(".swcChatActionsBar__button_more");V.default.add(n,i._element,t,V.BubbleType.List)},this._renderAvatar=function(e){void 0===e&&(e=""),i.avatarUrl(e),i.renderChatHeader()},this.onUnreadMessageCount=function(e){i.conversation.alertsOff||(i.unreadMessageCounter(e),i.renderChatHeader(),M.swc.Eventing.triggerEvent("updateUnreadMessageCounter",{convId:i.convId,count:e}))},this.controlShowHandler=function(e){e.currentConversationId&&j.default.toFullIdentifier(e.currentConversationId)===i.conversation.id?(i.conversation.isControlOpen=!0,i.conversation.unreadMessagesCount=0,i.triggerFocusInputEvent()):i.conversation.isControlOpen=!1},this.openAddon=function(e){var t={"swc:addon:close":function(e){e.message&&i.conversation.sendMessage(e.message,d.ActionTrigger.ADDON),e.invokeData&&i.conversation.sendDataToBot(e.invokeData)}};new O.default(i._element,e.url,t).show()},this.onCalleeUnavailable=function(e){if(e.mri===i.conversation.id){var t=e.withVideo?".swcChatActionsBar__button_video":".swcChatActionsBar__button_audio",n=document.createElement("span");n.textContent=ne("callee_unavailable"),V.default.add(i._element.querySelector(t),i._element,n,V.BubbleType.Info)}},this.callStatusChangedHandler=function(e){var t=2===e.status||1===e.status||3===e.status||9===e.status||4===e.status;i.suppressCallingControls(t),i.updateActionsBar(),e.conversationId===i.conversation.id&&t?(i.canClose(!1),i.toggleChatSize(null,null,!0)):(i.canClose(i.chatDataConfig.CanClose),i.renderChatHeader())},this.callingLayoutChangedHandler=function(e){"minimize"===e.action&&e.mri===i.conversation.id&&i.triggerFocusInputEvent()},this.controlHideHandler=function(e){e.currentConversationId===i.conversation.id&&(i.conversation.isControlOpen=!1)},this.openAddParticipantsView=function(){if(M.swc.Telemetry.sendEvent.userAction(P.UserActionType.AddParticipant),i.showAddParticipants(!0),i.addParticipantsRootNode=i._element.querySelector(".swcAddParticipantsRoot"),i.addParticipantsRootNode){var e=o.createElement(b.I18nContextComponent,{},o.createElement(K.SwcAddParticipants,{conversation:i.conversation,onCancel:i.closeAddParticipantsView,onConfirm:i.addParticipantsToConversation,isNewChatControl:!1}));r.render(e,i.addParticipantsRootNode)}},this.closeAddParticipantsView=function(){i.showAddParticipants(!1),r.render(null,i.addParticipantsRootNode)},this._joinOrCreateConversation=function(e){var t=function(e){A.default.startChat(e,i.chatDataConfig,!1,h.OpenChatOrigin.ADD_PARTICIPANTS_TEAMS)},n=function(e){var n=e.headers.get("location").match(/threads\/(19:.*)$/)[1];t(n),i.closeAddParticipantsView()},r=function(e){},o=e.concat(i.conversation.members);y.findRecentConversationIdForMembers(o).then(function(e){t(e),i.closeAddParticipantsView()}).catch(function(e){M.swc.services.webApi.createThread(o).then(n,r)})},this._addToExistingConversation=function(e){e.forEach(function(e){e.id&&i.conversation.addParticipant(e.id)}),i.closeAddParticipantsView()},this.addParticipantsToConversation=function(e){a.default.get.isTeams()&&i.conversation.isOneOnOne?i._joinOrCreateConversation(e):i._addToExistingConversation(e)},this.closeShowParticipantsView=function(){i.showShowParticipants(!1)},this.openRemoveParticipantsView=function(){if(i.showRemoveParticipants(!0),i.removeParticipantsRootNode=i._element.querySelector(".swcRemoveParticipantsRoot"),i.removeParticipantsRootNode){var e=o.createElement(Q.SwcRemoveParticipants,{conversation:i.conversation,onCancel:i.closeRemoveParticipantsView,onConfirm:i.removeParticipantsFromConversation,canRemoveParticipants:i.canRemoveParticipants()});r.render(e,i.removeParticipantsRootNode)}},this.closeRemoveParticipantsView=function(){i.showRemoveParticipants(!1),r.render(null,i.removeParticipantsRootNode)},this.removeParticipantsFromConversation=function(e){e.forEach(function(e){i.conversation.removeParticipant(e)}),i.closeRemoveParticipantsView()},this._updateAndSubscribeSelfParticipant=function(){i._setSelfParticipantProperties(),i.conversation.selfParticipant.subscribe("role",i._setSelfParticipantProperties),i.conversation.selfParticipant.subscribe("capabilities",i._setSelfParticipantProperties)},this._setSelfParticipantProperties=function(){var e=i.conversation.selfParticipant;i.canRemoveParticipants(e.role===S.ParticipantRole.Admin||e.capabilities.some(function(e){return e===C.ParticipantCapabilities.kickMember}))},this.init=function(){var e=function(e){i.isGuest(M.swc.services.signInManager.userIdentityType===f.IdentityType.GUEST),i.updateSignedInState(),e===l.SigninState.SignedIn&&i.setCallingCapabilities(),i.renderChatHeader()};M.swc.services.signInManager.subscribe("state",e),M.swc.Eventing.registerEvent("forceExpandChat",function(e){(!a.default.get.isParallelView||a.default.get.isParallelView&&e===i.conversation.id)&&(i._unCollapseHeader(),M.swc.services.webApi.startEndpointActivation())}),e(M.swc.services.signInManager.state),i._initConversation()},this.renderChatHeader=function(){if(i._chatHeaderNode){var e={customAvatar:i.avatarUrl(),customTitle:i.chatDataConfig.Title,conversation:i.conversation,className:i.isAgent()?"bot":""},t={participantsCount:i.conversation.participants.length,showParticipantsControl:i.showParticipantsControl(),showCalling:i.showCalling(),suppressCallingControls:i.suppressCallingControls(),showOtherActions:i.showOtherActions(),showMoreActionsBtn:i.showMoreActionsBtn(),videoEnabled:i.videoEnabled(),audioEnabled:i.audioEnabled(),openAddParticipantsView:i.openAddParticipantsView,openRemoveParticipantsView:i.openRemoveParticipantsView,startVideoCall:function(e){return i.startVideoCall(e)},startAudioCall:function(e){return i.startAudioCall(e)},openMoreActions:function(e){return i.openMoreActions(e)}},n={title:i.title(),titleColor:i.titleColor(),titleBarBackground:i.titleBackground(),unreadMessageCounter:i.unreadMessageCounter(),chatActionsBarProps:t,avatarProps:e,showActionsBar:i.showActionsBar(),canMinimize:i.chatDataConfig.CanCollapse,canClose:i.canClose(),isCollapsed:i.isCollapsed(),warnings:i.warnings(),onClose:function(e){i.close(e),i._unCollapseHeader()},onToggleChatHeader:function(e){e.preventDefault(),e.stopPropagation(),M.swc.Eventing.triggerLocalEvent("hideBubbleWindow"),i.toggleChatSize(null,null)}},s=o.createElement(q.SwcChatHeader,n);r.render(s,i._chatHeaderNode)}},this.onDragEnter=function(e,t){var n=i._canProcessDropEvent(t);return i._handleDragEventEvent(t,n)},this.onDragOver=function(e,t){return i._handleDragEventEvent(t,i._canProcessDropEvent(t))},this.onDragLeave=function(){},this.onDrop=function(e,t){if(i._canProcessDropEvent(t)){var n=[];t.dataTransfer&&t.dataTransfer.files?n=t.dataTransfer.files:t.originalEvent.dataTransfer&&(n=t.originalEvent.dataTransfer.files),i.sendFiles(n)}return i._allowCustomHandling(t)},this.dispose=function(){i._conversationNode&&s.AbilityHelpers.modalityLayer.removeLayer(i._conversationNode),i._koSubscriptions.forEach(function(e){return e.dispose()}),i._koSubscriptions=[];var e=i.conversation;if(e){e.unsubscribe("unreadMessagesCount",i.onUnreadMessageCount),e.unsubscribe("alertsOff",i._onAlertsOffChange),e.unsubscribe("isChatEnabled",i.onConversationUpdate),e.unsubscribe("isUnderQuarantine",i.onConversationUpdate),e.unsubscribe("definition",i.onConversationUpdate),e.unsubscribe("isOneOnOne",i.isOneOnOneConversation),e.unsubscribe("isBlocked",i._onIsBlockedChange),i.conversation.isOneOnOne||(e.unsubscribe("selfParticipant",i._updateAndSubscribeSelfParticipant),e.selfParticipant.unsubscribe("role",i._setSelfParticipantProperties),e.selfParticipant.unsubscribe("capabilities",i._setSelfParticipantProperties));var t=e.participants;t&&(t.unsubscribe(i._onParticipantsUpdate),M.swc.Eventing.unregisterEvent("proxy:configuration:setLanguage:response",i.onLanguageUpdate),M.swc.Eventing.unregisterEvent("devicesPermissions",i.onDevicePermissionCheck))}},this._isJoinLink=function(e){return e.indexOf("https")>-1},this._initConversation=function(){i._isJoinLink(i.conversation.id)||i._changeConversation(i.conversation)},this.subscribeToAvatar=function(e,t){i.conversation.isGroup?i.conversation.subscribe("avatar",i._renderAvatar):(e.avatarData&&i._renderAvatar(e.avatarData),e&&e.subscribe("avatarData",function(e){t===i.conversation.id&&i._renderAvatar(e)}))},this.setupProxy=function(){var e=function(e){return e===i.conversation.id},t=i.conversation.refId;M.swc.Eventing.registerEvent("proxy:conversation:expand",function(t){e(t.id)&&i.toggleChatSize(null,null,!0)}),M.swc.Eventing.registerEvent("proxy:conversation:regClose",function(e){e.refId===t&&(i.proxy.close={handler:function(){return M.swc.Eventing.triggerEvent("proxy:conversation:resClose",{refId:t})},preventDefault:!!e.preventDefault})}),M.swc.Eventing.registerEvent("proxy:conversation:regCollapse",function(t){e(t.id)&&(i.conversation.refId=t.refId,i.proxy.toggle={handler:function(){return M.swc.Eventing.triggerEvent("proxy:conversation:resCollapse",{refId:i.conversation.refId,isCollapsed:!i.conversation.isControlOpen})},preventDefault:!!t.preventDefault})}),M.swc.Eventing.registerEvent("proxy:conversation:showConfirmationDialog",function(t){var n=function(e){M.swc.Eventing.triggerEvent("proxy:conversation:resShowConfirmationDialog",{CID:t.dialog.CID,res:e})},r=function(){n(m.DialogResult.CONFIRMED)},o=function(){n(m.DialogResult.CANCELED)};e(t.id)&&Z.ConfirmationDialog.add(i._element,function(){return L.createConfirmationDialog(t.dialog.title,t.dialog.description,{title:t.dialog.confirmationButtonTitle,action:r},{title:t.dialog.cancelButtonTitle,action:o})},$.SwcTextDialog)}),M.swc.Eventing.registerEvent("proxy:conversation:regUnreadCount",function(t){e(t.id)&&(i.refId=i.refId||t.refId,i.conversation.subscribe("unreadMessagesCount",function(e){M.swc.Eventing.triggerEvent("proxy:conversation:unreadCount",{refId:i.refId,count:e})}))}),M.swc.Eventing.registerEvent("proxy:conversation:regAvatar",function(t){if(e(t.id)){i.refId=i.refId||t.refId;var n="";if(i.conversation.isGroup)n=i.conversation.avatar,i.conversation.subscribe("avatar",function(e){M.swc.Eventing.triggerEvent("proxy:conversation:resAvatar",{refId:i.refId,avatarUrl:e})});else{var r=M.swc.services.persons.getPerson(i.conversation.id);n=r.avatarData,r.subscribe("avatarData",function(e){M.swc.Eventing.triggerEvent("proxy:conversation:resAvatar",{refId:i.refId,avatarUrl:e})})}M.swc.Eventing.triggerEvent("proxy:conversation:resAvatar",{refId:i.refId,avatarUrl:n})}}),M.swc.Eventing.registerEvent("proxy:conversation:regTitle",function(t){if(e(t.id)){if(i.refId=i.refId||t.refId,i.conversation.isGroup)i.conversation.subscribe("topic",function(e){M.swc.Eventing.triggerEvent("proxy:conversation:resTitle",{refId:i.refId,title:e})});else{var n=M.swc.services.persons.getPerson(i.conversation.id);n.subscribe("displayName",function(e){var t=n.isAgent&&n.displayName===n.id?"":n.displayName;M.swc.Eventing.triggerEvent("proxy:conversation:resTitle",{refId:i.refId,title:t})})}M.swc.Eventing.triggerEvent("proxy:conversation:resTitle",{refId:i.refId,title:i.conversation.topic})}}),M.swc.Eventing.registerEvent("proxy:conversation:regPresenceStatus",function(t){if(e(t.id)&&(i.refId=i.refId||t.refId,!i.conversation.isGroup)){var n=M.swc.services.persons.getPerson(i.conversation.id);M.swc.Eventing.triggerEvent("proxy:conversation:resPresenceStatus",{refId:i.refId,presenceStatus:n.presenceStatus}),n.subscribe("presenceStatus",function(e){M.swc.Eventing.triggerEvent("proxy:conversation:resPresenceStatus",{refId:i.refId,presenceStatus:e})})}}),M.swc.Eventing.registerEvent("proxy:conversation:emoticonpicker",function(e){e.open?i.toggleExpressionPickerHandler(e.id,e.open):i.hideExpressionPickerHandler(e.id)}),M.swc.Eventing.registerEvent("proxy:conversation:setMessageProperties",function(t){if(e(t.id)){var n="";t.props&&(i.conversation.currentMessageProperties=t.props,t.props.tags&&(n=N.default.explode(t.props.tags).join(" "))),i.updateChatInput({tags:n})}}),M.swc.Eventing.registerEvent("proxy:conversation:placeholder",function(t){e(t.id)&&(i._proxiedPlaceholder=t.text,i.onConversationUpdate())}),M.swc.Eventing.registerEvent("proxy:conversation:regIsTyping",function(t){e(t.id)&&(i.conversation.refId=t.refId,i.isTypingProxied=!0)}),M.swc.Eventing.registerEvent("proxy:conversation:disableInput",function(t){e(t.id)&&(i._proxiedIsChatEnabled=!t.disable,i.onConversationUpdate())}),M.swc.Eventing.registerEvent("proxy:conversation:setActionBar",function(t){if(e(t.id)){var n=t.definition.map(function(e){return{name:e.name,text:e.text,title:e.title,handler:function(){return M.swc.Eventing.triggerEvent("proxy:conversation:resActionBar",e.CID)},className:e.className}});i.initActionBar(n)}}),M.swc.Eventing.registerEvent("proxy:conversation:inputtext",function(t){e(t.id)&&(i.conversation.definition.Prefill=t.text,i.updateChatInput({prefillText:void 0}),i.updateChatInput({prefillText:t.text}))}),v.ProxyConnector.instance.connect(i.conversation.refId,{conversationId:i.conversation.id})},this.hideExpressionPickerHandler=function(e){i.conversation.id===e&&i.hideExpressionPicker()},this.toggleExpressionPickerHandler=function(e,t){i.conversation.id!==e||i.isPickerVisible()?t||i.isPickerVisible(!1):(i.isPickerVisible(!0),M.swc.Eventing.triggerEvent("pes:picker:open"),M.swc.Telemetry.sendEvent.userAction(P.UserActionType.ExpressionPicker))},this.sendFiles=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=U.checkFile(n,{size:i._fileSize,extensions:i._extensions,types:i._types});r.supportedFileSize&&r.supportedFileExtension&&r.supportedFileType?M.swc.services.amsManager.sendFile(i.conversation,n):M.swc.Eventing.triggerEvent("unsupportedFileSelected",{fileName:n.name,fileSize:n.size,supportedFileSize:r.supportedFileSize,supportedFileExtension:r.supportedFileExtension,supportedFileType:r.supportedFileType})}},this.isSupportedBrowser=z.default.testSupporedList(c.Configuration.ECS.callingSupportedBrowsers),this.isIeEngine=z.default.isIe(),this.conversation=this._params.conversation,this.convId=j.default.getNormalizeId(this.conversation.id),this.enable=this._params.enable,this.canClose=ko.observable(t.CanClose),this.localizeResources(),t.TitleColor&&this.titleColor(t.TitleColor),t.TitleBackground&&this.titleBackground(t.TitleBackground),this._params.enable()?this.init():this._params.enable.subscribe(function(e){return e&&i.init()}),!a.default.get.callingReady&&this.chatDataConfig.EnableCalling&&M.swc.Eventing.registerEvent("callingReady",function(){i.setCallingCapabilities()}),this.showBrand(!R.default.isDomainIn("hideLogoOnHosts")),this.suppressCallingControls(u.default.isInCall),this.conversation.subscribe("unreadMessagesCount",this.onUnreadMessageCount),this.conversation.subscribe("alertsOff",this._onAlertsOffChange),this.conversation.subscribe("isChatEnabled",this.onConversationUpdate),this.conversation.subscribe("isUnderQuarantine",this.onConversationUpdate),this.conversation.subscribe("definition",this.onConversationUpdate),this._setAcceptedFiles();var p=this.getInitialChatInputProps(),g=p.canSendEmoticons,_=p.canUploadFile;this._canSendEmoticons=g,this._canUploadFile=_,this._chatInputProps={canSendEmoticons:this._canSendEmoticons,canUploadFile:this._canUploadFile,conversationId:this.conversation.id,isChatEnabled:!0,isEditingEnabled:!0,acceptedFiles:this._accepted,placeholder:"",prefillText:this.conversation.definition.Prefill,tags:"",message:null,onSendFiles:this.sendFiles,onTypingChange:te(function(e){var t=e&&G.get().isOnline;i.isTypingProxied&&M.swc.Eventing.triggerEvent("proxy:conversation:resIsTyping",{refId:i.conversation.refId,isTyping:t}),i.conversation.setIsTyping(t)},ue,{maxWait:ue}),onSendNewMessage:function(e,t){i.conversation.sendMessage(e,t)},onSendEditedMessage:function(e,t){e.content!==t&&(i.conversation.editMessage(e,t),i.updateChatInput({message:void 0}))},onMessageEditRequest:function(){var e=i._getMyLastMessage();i.updateChatInput({message:e})},onCancelMessageEditRequest:function(){i.updateChatInput({message:void 0})},onSearch:function(e){M.swc.services.searchManager.searchSkypeDirectory(e).then(function(e){x.default.mapSearchProfileInfo(e).forEach(function(e){var t=new T.default(!1);t.content=e.name,t.direction=w.Direction.Incoming,t.status=-1,i.conversation.messages.pushObservable(t)})})}};var E,k=function(){return setTimeout(function(){setTimeout(function(){i.renderChatInput(),i.onConversationUpdate()})})};M.swc.services.pesManager.isInitialized?(this.pesConfigInitialized(!0),k()):M.swc.Eventing.registerEvent("pesConfigInitialized",function(){i.pesConfigInitialized(!0),k()}),M.swc.Eventing.registerEvent("devicesPermissions",this.onDevicePermissionCheck),M.swc.Eventing.registerEvent("onControlShow",this.controlShowHandler),M.swc.Eventing.registerEvent("onControlHide",this.controlHideHandler),M.swc.Eventing.registerEvent("callStatusChanged",this.callStatusChangedHandler),M.swc.Eventing.registerEvent("callingLayoutChanged",this.callingLayoutChangedHandler),M.swc.Eventing.registerEvent("calleeUnavailable",this.onCalleeUnavailable),M.swc.Eventing.registerEvent("swc:addon:open",function(e){e.id===i.conversation.id&&i.openAddon(e)}),M.swc.Eventing.registerEvent("requestEditingMessage",function(e){e.convId===i.conversation.id&&i._chatInputProps.isEditingEnabled&&i.updateChatInput({message:e.message})}),M.swc.Eventing.registerEvent("onConversationDelete",function(e){e===i.conversation.id&&i.close()}),M.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",this.onLanguageUpdate),this.animateLoginScreen(!t.DisableInOutAnimation),this.isGroupConversation=this.conversation.isGroup,this.isOneOnOneConversation=ko.observable(this.conversation.isOneOnOne),this.conversation.subscribe("isOneOnOne",this.isOneOnOneConversation),this._chatHeaderNode=this._element.querySelector(".chat-header"),this.conversation.participants.subscribe(this._onParticipantsUpdate),this._onParticipantsUpdate(),M.swc.services.mePersonManager.fetch().then(function(e){i.isMePersonGuest(e.isGuest)}),this.showParticipantsControl=ko.computed(function(){return t.EnableParticipantsControl&&i.isGroupConversation&&!i.isOneOnOneConversation()&&!i.isMePersonGuest()&&i.isParticipantControlEnabled()}).extend({notify:"always"}),this.showActionsBar=ko.computed(function(){return i.showParticipantsControl()||i.showCalling()&&!i.suppressCallingControls()||i.showOtherActions()}).extend({notify:"always"}),this._koSubscriptions.push(this.showParticipantsControl.subscribe(function(){return i.updateActionsBar()})),this._koSubscriptions.push(this.showActionsBar.subscribe(function(){return i.updateActionsBar()})),this._showMoreActionButton(),this.conversation.subscribe("isBlocked",this._onIsBlockedChange),this.conversation.isBRB&&(this.sendFirstReportMessage(),M.swc.Eventing.registerEvent("startReportProblemChat",function(){return i.sendFirstReportMessage()})),this.setTitle(this.conversation.topic),I.reportUserActivityStart(),this.setupProxy(),this._showSfbWarning=this.conversation.isSfB&&(E=this.conversation.id,!(pe().indexOf(E)>=0)),this.updateWarnings(),this.updateActionsBar(),this._conversationNode=n.querySelector(".swc-conversation"),this.conversation.isOneOnOne||(this._updateAndSubscribeSelfParticipant(),this.conversation.subscribe("selfParticipant",this._updateAndSubscribeSelfParticipant)),s.AbilityHelpers.modalityLayer.addLayer(this._conversationNode,"conversation",{accessibilityLabel:this.conversation.topic,onFocusLost:function(e,t){return!!e.classList.contains("down-btn")&&(t.focusDefault(),!0)}})}return e.prototype._handledDeviceWarnings=function(e,t){var n=this,i=this.deviceWarnings().some(function(e){return 1===e.id}),r=this.deviceWarnings().some(function(e){return 2===e.id}),o=t&&!e.video&&!e.audio,s=!t&&!e.audio;!i&&t&&o?(this.deviceWarnings.push({id:1,text:ne("camera_connected_permission_legend"),icon:X.SwcIconType.VideoOff,onClose:function(){n.deviceWarnings(n.deviceWarnings().filter(function(e){return 1!==e.id})),n.renderDeviceWarnings()}}),this.renderDeviceWarnings()):!r&&s&&(this.deviceWarnings.push({id:2,text:ne("microphone_connected_permission_legend"),icon:X.SwcIconType.MicrophoneOff,onClose:function(){n.deviceWarnings(n.deviceWarnings().filter(function(e){return 2!==e.id})),n.renderDeviceWarnings()}}),this.renderDeviceWarnings())},e.prototype.renderDeviceWarnings=function(){if(this.deviceWarningsRootNode){if(0===this.deviceWarnings().length)return void r.render(null,this.deviceWarningsRootNode)}else{var e=this._element.parentElement.querySelector(".swcChatHeader");if(!e)return;this.deviceWarningsRootNode=document.createElement("div"),e.parentNode.insertBefore(this.deviceWarningsRootNode,e.nextSibling)}var t=o.createElement(Y.SwcChatWarningsList,{warnings:this.deviceWarnings()});r.render(t,this.deviceWarningsRootNode)},e.prototype.localizeResources=function(){var e=this;this.editConversationTitleText(ne("edit_conversation_title_text")),this.deleteConversationTitle(ne("confirm_dialog_leave_conversation_header")),this.deleteConversationText(ne("confirm_dialog_leave_conversation_text")),this.deleteConversationConfirmTitle(ne("btn_confirm_leave")),this.brandMessage(ne("powered_by_skype"));var t=encodeURIComponent(this.chatDataConfig.Locale||c.Configuration.LOCALE),n=E.default.dompurify.sanitize(ne("ms_service_privacy_agreement",{0:'<a href="https://www.microsoft.com/'+t+'/servicesagreement/" target="_blank">',1:"</a>",2:'<a href="https://privacy.microsoft.com/'+t+'/privacystatement" target="_blank">',3:"</a>"}),{ALLOWED_TAGS:["a"],ALLOWED_ATTR:["target","href"]});this.ms_service_privacy_agreement(n),Object.keys(this.texts).forEach(function(t){e.texts[t]=ne(t)})},e.prototype._updatePersonBlockedState=function(e,t){M.swc.services.persons.getPerson(e).isBlocked=t},e.prototype.updateActionsBar=function(){this.renderChatHeader()},e.prototype.updateChatInput=function(e){this._chatInputProps=i({},this._chatInputProps,e),this.renderChatInput()},e.prototype.renderChatInput=function(){var e=this._element.querySelector(".chat-input");if(e){var t=o.createElement(b.I18nContextComponent,{},o.createElement(J.SwcChatInput,this._chatInputProps));r.render(t,e)}},e.prototype.updateWarnings=function(){var e=this,t=this._showCallingWarning,n=this._showSfbWarning;this.warnings([]),t&&this.warnings.push({icon:X.SwcIconType.Error,text:this.texts.calling_disabled_warning,onClose:function(){e._showCallingWarning=!1,e.updateWarnings()}}),n&&this.warnings.push({icon:X.SwcIconType.IconSkypeForBusiness,text:this.texts.sfb_warning,onClose:function(){var t,n;e._showSfbWarning=!1,t=e.conversation.id,(n=pe()).indexOf(t)>=0||(n.push(t),M.swc.services.localStorage.setItem(k.SWC_SFB_DISMISSED_KEY,n.join(le))),e.updateWarnings()}}),this.renderChatHeader()},e.prototype._getMyLastMessage=function(){var e=this.conversation.messages?this.conversation.messages.filter(function(e){return e.type===w.MessageType.UserMessage&&e.direction===w.Direction.Outgoing&&!e.isDeleted}).sort(this._byTimestamp):[];return e.length?e[e.length-1]:null},e.prototype.getInitialChatInputProps=function(){var e=this.conversation.isSfB,t=this.conversation.definition,n=t.DisableSendingEmoticons,i=t.CanUploadFile;return{canSendEmoticons:c.Configuration.ECS.expressionPickerEnabled&&!n&&!e,canUploadFile:(i||this.chatDataConfig.CanUploadFile)&&!e}},e.prototype.sendFirstReportMessage=function(){var e=a.default.get.isTeams()?"":c.Configuration.BRB_START_MESSAGE;this.conversation.sendMessage(e,d.ActionTrigger.SUGGESTED_ACTION)},e.prototype._hasMyselfParticipant=function(e){return e.some(function(e){return e.person.mri===M.swc.services.mePersonManager.mePerson.mri})},e.prototype._removeMeParticipant=function(){var e=this;return this.conversation.removeParticipant(M.swc.services.mePersonManager.mePerson.mri).then(function(){e.conversation.isChatEnabled=!1,e.showCalling(!1),e.isParticipantControlEnabled(!1),a.default.get.isTeams()&&e.showOtherActions(!1),e._removeMeParticipantFromModel();var t=ne("message_text_you_have_left_the_conversation");M.swc.services.webApi.sendLocalSystemMessage(e.conversation.id,t,w.CustomMessageType.MeLeftGroup),M.swc.Telemetry.sendEvent.userAction(P.UserActionType.LeaveConversation)}).catch(function(e){})},e.prototype.triggerFocusInputEvent=function(){var e=this;setTimeout(function(){M.swc.Eventing.triggerEvent("proxy:conversation:focusInput",{id:e.conversation.id})})},e.prototype.startVideoCall=function(e){e.stopPropagation(),this._startCall(!0),M.swc.Telemetry.sendEvent.userAction(P.UserActionType.StartVideoCall)},e.prototype.startAudioCall=function(e){e.stopPropagation(),this._startCall(!1),M.swc.Telemetry.sendEvent.userAction(P.UserActionType.StartAudioCall)},e.prototype.loginCss=function(){return{anim:!0}},e.prototype.setCallingCapabilities=function(){var e=this;M.swc.services.capabilitiesService.getCapabilitiesForConversation(this.conversation).then(function(t){var n=t.allowCalling;if(e.showCalling(n),e.videoEnabled(n),e.audioEnabled(n),e._showCallingWarning=!1,e.updateWarnings(),e.updateActionsBar(),!e.conversation.isWithMe()){if(!n){var i=e.chatDataConfig.EnableCalling&&!e.isSupportedBrowser;return e._showCallingWarning=i,e.showCalling(i),e.updateWarnings(),void e.updateActionsBar()}if(e.conversation.getConversationType()===w.ConversationType.PHONE)return e.videoEnabled(!1),void e.updateActionsBar();if(a.default.get.isTeams()&&!e.isOneOnOneConversation()&&!e._hasMyselfParticipant(e.conversation.participants))return e.showCalling(!1),void e.updateActionsBar();if(!e.conversation.isGroup&&(e.isGuest()||e.conversation.isAgent)&&e._capabilities){var r=function(t){return e._capabilities.indexOf(t)>-1},o=r("video.send"),s=r("audio.send"),c=o||s;e.showCalling(c),e.videoEnabled(o),e.audioEnabled(s),e.updateActionsBar()}}},function(e){})},e.prototype._unCollapseHeader=function(){this.isCollapsed(!1),this.renderChatHeader()},e.prototype.updateSignedInState=function(){var e=M.swc.services.signInManager;if(this.conversation.sdkMode!==g.SDKMode.BOT||a.default.get.isSkypeOnly)if(this.conversation.getConversationType()===w.ConversationType.PERSON&&e.userIdentityType===f.IdentityType.GUEST)this.showLoginPage(!0),this.showComponent(!1),this.signedIn(!1);else if(this.conversation.getConversationType()===w.ConversationType.GROUP&&a.default.get.isGuestOnlyMode)this.showLoginPage(!1),this.showComponent(!0),this.signedIn(!0);else{this.showLoginPage(e.state===l.SigninState.SignedOut||e.state===l.SigninState.SigningOut);var t=e.state===l.SigninState.SignedIn||this.conversation.isGroup||!this.isGuest()&&this.conversation.isPerson;this.signedIn(e.state!==l.SigninState.SignedOut&&t),this.showComponent(!1),this.showLoginPage()||this.signedIn()!==this.showLoginPage()?!this.showLoginPage()&&this.signedIn()&&(this.conversation.isActive=!0):D.default.throwError(10505,"Empty chat is shown","",this.conversation.id)}else this.showLoginPage(!1),this.showComponent(!0),this.signedIn(e.state!==l.SigninState.SignedOut)},e.prototype.close=function(e){if(e&&e.stopPropagation(),!this.proxy.close||(this.proxy.close.handler(),!this.proxy.close.preventDefault)){var t={id:this.conversation.id},n={origin:c.Configuration.ORIGIN,action:p.ActionNames.HideChatWindow,data:t};M.swc.Eventing.triggerEvent("onControlClose",t,!0),this.conversation.definition.EnableCustomOnCloseHandler||(M.swc.Eventing.triggerEvent("compatEvent",n),M.swc.Telemetry.sendEvent.visibilityChangeQos(!1))}},e.prototype.toggleChatSize=function(e,t,n){if(this.chatDataConfig.CanCollapse){var i=this.proxy.toggle;if(!(!i||!i.preventDefault))return this.conversation.isControlOpen=!!n||!this.conversation.isControlOpen,this.conversation.isControlOpen&&(this.conversation.unreadMessagesCount=0,this.conversation.markAsRead()),void i.handler();this.isCollapsed(!(n||this.isCollapsed()));var r=this.isCollapsed()?p.ActionNames.CollapseChatWindow:p.ActionNames.ExpandChatWindow;M.swc.Eventing.triggerEvent("compatEvent",{origin:c.Configuration.ORIGIN,action:r}),this.conversation.isControlOpen=!this.isCollapsed(),this.conversation.isControlOpen&&(this.conversation.unreadMessagesCount=0);var o=this.conversation.sdkMode===g.SDKMode.BOT,s={type:this.isCollapsed()?"collapse":"expand",isVisible:!this.isCollapsed(),conversationId:o?this.conversation.id:"n/a"};M.swc.Eventing.triggerEvent("onVisibilityChange",s,!0),this.renderChatHeader(),this.isCollapsed()||this.conversation.markAsRead(),i&&i.handler()}},e.prototype._startCall=function(e){var t=this,n=this.conversation.isGroup,i=this.conversation.id;a.default.get.isTeams()&&this.conversation.isOneOnOne&&(n=!1,i=this.conversation.members.filter(function(e){return!M.swc.services.mePersonManager.isMe(e.id)}).shift().id),"https:"===a.default.get.parentProtocol?M.swc.Eventing.triggerEvent("startCall",{calleeId:i,withVideo:e,avatarUrl:this.avatarUrl(),displayName:this.title(),isGroup:n}):null===this._callingPopup||this._callingPopup.closed?M.swc.services.signInManager.getSkypeToken().then(function(n){var r={token:n,convId:i,convType:j.default.detectConversationType(i),withVideo:e,SDKUrl:t._getSDKUrl(),env:M.swc.EcsConfig.environment};t._callingPopup=window.open(W.UrlHelper.setQueryParameters(re,r),ie,oe)}):this._callingPopup.focus()},e.prototype._getSDKUrl=function(){var e=se+ae,t=W.UrlHelper.getCompletePath(e,ce);return W.UrlHelper.getCDNPath(M.swc.EcsConfig)+t},e.prototype._allowCustomHandling=function(e){return e.preventDefault(),e.stopPropagation(),this.isIeEngine&&(e.returnValue=!1),!1},e.prototype._handleDragEventEvent=function(e,t){var n=e.dataTransfer||e.originalEvent.dataTransfer;return n&&(n.dropEffect=t?"copy":"none"),this._allowCustomHandling(e)},e.prototype._containsType=function(e,t){var n=e.dataTransfer||e.originalEvent.dataTransfer;return Array.prototype.some.call(n.types,function(e){return e===t})},e.prototype._canProcessDropEvent=function(e){return this._canUploadFile&&this._containsType(e,"Files")},e.prototype.show=function(){A.default.startChat(this.conversation.id,this.chatDataConfig,!1,h.OpenChatOrigin.CONVERSATION_ROSTER),this.isCollapsed(!1),this.renderChatHeader()},e.prototype._subscribeToDisplayName=function(e){var t=this;e.displayName&&this._handleDisplayName(e),e.subscribe("displayName",function(){return t._handleDisplayName(e)})},e.prototype._handleDisplayName=function(e){var t=e.isAgent&&e.displayName===e.id?"":e.displayName;this.setTitle(t),this.conversation.topic=e.displayName},e.prototype._changeConversation=function(e){var t,n=this,i=M.swc.services.signInManager;this.isGuest(i.userIdentityType===f.IdentityType.GUEST||i.state!==l.SigninState.SignedIn),this.conversation=e,this.conversation.sdkMode===g.SDKMode.BOT?this.showLoginPage(!1):this.updateSignedInState(),this.isAgent(this.conversation.isAgent),this._renderAvatar(),this.conversation.isOneOnOne&&(t=this.conversation.isTeamsOneOnOne?this.conversation.theOtherParticipant.person:M.swc.services.persons.getPerson(this.conversation.id,!0,this.isAgent()),a.default.get.isTeams()?M.swc.services.presenceService.subscribe(t.mri,function(e){t.presenceStatus=_.getStatusFromAvailability(e.presence.availability)}):M.swc.services.webApi.subscribeContactPresence(t.id)),this.conversation.isOneOnOne&&!this.conversation.topic?this._subscribeToDisplayName(t):this.conversation.topic&&this.setTitle(this.conversation.topic),this.chatDataConfig.Title||this.conversation.subscribe("topic",function(e){return n.setTitle(e)});var r=this.chatDataConfig.Avatar;r?this._renderAvatar(r):this.conversation.avatar?this._renderAvatar(this.conversation.avatar):this._renderAvatar(),t&&this.subscribeToAvatar(t,this.conversation.id),this.conversation.sdkMode===g.SDKMode.BOT&&t&&M.swc.services.agentsManager.getAgent(t.id).then(function(e){if(e&&e.agentDescriptions&&1===e.agentDescriptions.length){var t=e.agentDescriptions[0],i=n.conversation.definition.PrivacyUri||t.privacyStatement,r=n.conversation.definition.TermsOfUseUri||t.tos;n.privacyStatementUrl(i),n.termOfUseUrl(r),t.capabilities&&(n._capabilities=t.capabilities,n.setCallingCapabilities())}})},e.prototype.setTitle=function(e){if(e){var t=H.MessageUtils.sanitizeTopic(e);this.title(t),this.renderChatHeader()}},e.prototype.initActionBar=function(e){var t=o.createElement(ee.ActionBar,{actions:e}),n=this._element.querySelector(".action-bar");r.render(t,n)},e.prototype.hideExpressionPicker=function(){this.isPickerVisible()&&this.isPickerVisible(!1),M.swc.Eventing.triggerEvent("pes:picker:cancelRequest")},e.prototype._setAcceptedFiles=function(){var e=this.conversation.definition?this.conversation.definition:this.chatDataConfig;this._fileSize=parseFloat(e.FileSize),this._extensions=N.default.explode(e.FileExtensions),this._types=N.default.explode(e.FileTypes),this._accepted=N.default.implode(this._extensions.concat(this._types))},e}();t.default=de},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(52),r=function(){function e(e,t,n){var r=this;this.onClose=function(){i.swcPostMessage(r.frame.contentWindow,"swc:addon:userClosed"),window.setTimeout(function(){r.hide(),r.destroy()},5)},this.handlers={},this.onmessage=function(e){var t=e.data;if(t&&t.action)switch(t.action){case"swc:addon:close":(0,r.handlers["swc:addon:close"])(t),r.hide(),r.destroy()}},this.handlers=n,this.wrapper=document.createElement("div"),this.close=document.createElement("div"),this.frame=document.createElement("iframe");this.wrapper.setAttribute("style","position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; background: #fff");this.frame.setAttribute("style","width: 100%; height: 100%; border: none;"),this.frame.setAttribute("allow","camera; microphone;"),this.frame.src=encodeURI(t);this.close.textContent="close",this.close.setAttribute("style","position: absolute; z-index: 10; right: 5px; top: 5px; font-size: 9px;"),this.close.addEventListener("click",this.onClose),this.hide(),this.listen(),this.wrapper.appendChild(this.frame),this.wrapper.appendChild(this.close),e.appendChild(this.wrapper)}return e.prototype.listen=function(){window.addEventListener("message",this.onmessage)},e.prototype.show=function(){this.wrapper.style.display="block"},e.prototype.hide=function(){this.wrapper.style.display="none"},e.prototype.destroy=function(){window.removeEventListener("message",this.onmessage),this.close.removeEventListener("click",this.onClose);var e=this.wrapper.parentElement;this.wrapper.removeChild(this.frame),e.removeChild(this.wrapper)},e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),a=n(103),c=n(0),u=n(8),l=n(41),p=n(574),d=n(468),f=n(14),h=function(e){return c.swc.services.i18n.fetch(e)},g=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="swcChatHeader",n}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.unreadMessageCounter,n=e.avatarProps,i=e.titleBarBackground,r=e.titleColor,c=e.title,u=e.canMinimize,d=e.canClose,g=e.onToggleChatHeader,m=e.showActionsBar,v=e.chatActionsBarProps,y=e.isCollapsed,_=e.warnings;return s.createElement("div",{className:this.getComposedBlockClassName()},s.createElement("div",{className:"swcChatHeader__titleBar "+(y?"swcChatHeader__collapsed":""),onClick:g,title:h(y?"maximize_window":"minimize_window"),style:{backgroundColor:i}},s.createElement(l.SwcConversationAvatar,o({},n,{className:"swcChatHeader__avatar"})),s.createElement("div",{class:"swcChatHeader__titleContainer"},s.createElement("h3",{className:"swcChatHeader__title",style:{color:r}},c)),y&&t>0&&s.createElement("p",{className:"swcChatHeader__unreadCounter"},this.props.unreadMessageCounter),u&&s.createElement("button",{className:"swcChatHeader__button swcChatHeader__button_minimize",onClick:this.props.onToggleChatHeader},s.createElement(f.SwcIcon,{type:f.SwcIconType.Minus,size:f.SwcIconSize.Medium})),d&&s.createElement("button",{className:"swcChatHeader__button swcChatHeader__button_close",onClick:this.props.onClose,title:h("close_window")},s.createElement(f.SwcIcon,{type:f.SwcIconType.Cancel,size:f.SwcIconSize.Medium}))),m&&!y&&s.createElement(a.I18nContextComponent,null,s.createElement(p.SwcChatActionsBar,o({className:"swcChatHeader__chatActionsBar"},v))),_.length>0&&this.renderWarnings())},t.prototype.renderWarnings=function(){return s.createElement("ul",{className:"swcChatHeader__warningsList"},this.props.warnings.map(function(e,t){return s.createElement(d.SwcChatWarning,o({},e,{className:"swcChatHeader__chatWarning",key:t}))}))},t}(u.SwcBaseComponent);t.SwcChatHeader=g},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(0),c=n(8),u=n(14),l=function(e,t){return a.swc.services.i18n.fetch(e,t)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcChatActionsBar",t}return r(t,e),t.prototype.render=function(){var e=this.props.participantsCount,t=l("open_remove_participants"),n=e?l("chat_participants_count",{count:e}):"",i=l("start_video_calling"),r=l("start_audio_calling"),a=l("open_add_participants"),c=l("open_more_actions");return s.createElement("div",{className:this.getComposedBlockClassName()},this.props.showParticipantsControl&&s.createElement(o.Fragment,null,s.createElement("button",{title:t,className:"swcChatActionsBar__button",onClick:this.props.openRemoveParticipantsView},s.createElement(u.SwcIcon,{size:u.SwcIconSize.Medium,type:u.SwcIconType.Contact})),s.createElement("span",{className:"swcChatActionsBar__buttonText",title:n},s.createElement("span",{"aria-hidden":"true"},this.props.participantsCount)),s.createElement("div",{className:"swcChatActionsBar__separator"})),this.props.showCalling&&!this.props.suppressCallingControls&&s.createElement(o.Fragment,null,s.createElement("button",{className:"swcChatActionsBar__button swcChatActionsBar__button_calling swcChatActionsBar__button_video",title:i,disabled:!this.props.videoEnabled,onClick:this.props.startVideoCall},s.createElement(u.SwcIcon,{size:u.SwcIconSize.Medium,type:u.SwcIconType.Video})),s.createElement("button",{className:"swcChatActionsBar__button swcChatActionsBar__button_calling swcChatActionsBar__button_audio",title:r,disabled:!this.props.audioEnabled,onClick:this.props.startAudioCall},s.createElement(u.SwcIcon,{size:u.SwcIconSize.Medium,type:u.SwcIconType.CallStart}))),this.props.showParticipantsControl&&s.createElement("button",{title:a,className:"swcChatActionsBar__button",onClick:this.props.openAddParticipantsView},s.createElement(u.SwcIcon,{size:u.SwcIconSize.Medium,type:u.SwcIconType.ContactAdd})),this.props.showOtherActions&&this.props.showMoreActionsBtn&&s.createElement("button",{"aria-haspopup":"true",title:c,className:"swcChatActionsBar__button swcChatActionsBar__button_more",onClick:this.props.openMoreActions},s.createElement(u.SwcIcon,{size:u.SwcIconSize.Medium,type:u.SwcIconType.More})))},t}(c.SwcBaseComponent);t.SwcChatActionsBar=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(20),c=n(1),u=n(100),l=n(79),p=n(0),d=n(469),f=n(43),h=n(25),g=n(9),m=n(36),v=n(576),y=n(8),_=n(582),b=n(14),w=n(587),C=function(e){return p.swc.services.i18n.fetch(e)},S=" ",T=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="swcChatInput",n.onTextareaRef=function(e){n._textarea=e,e&&a.AbilityHelpers.focusable.setup(e,{isDefaultFocusable:!0})},n.onKeyDown=function(e){e.stopPropagation(),n.props.onTypingChange(!!n._textarea.value);var t=f.default.getKeyCode(e);if(n.suggestionList.handleKeyDown(e,t))return e.preventDefault(),!1;t!==h.default.ESCAPE&&t!==h.default.UP&&t!==h.default.DOWN&&t!==h.default.TAB&&t!==h.default.ENTER||n.keyDownHandler(e);var i=d.Commands.instance;return t===h.default.UP&&""!==n._textarea.value&&i.isValidCommand(n._textarea.value)&&e.preventDefault(),t===h.default.UP&&""===n._textarea.value?(n.props.onMessageEditRequest(),!0):t===h.default.ESCAPE?(n.props.onCancelMessageEditRequest(),!0):t!==h.default.ENTER||(!!e.shiftKey||(n.props.isChatEnabled?(e.preventDefault(),n.sendMessage(u.ActionTrigger.KEYPRESS_ENTER),n._onEmoticonPickerClose(),n.suggestionList.handleInput({value:n._textarea.value,selectionStart:n._textarea.selectionStart},n.props.conversationId),!1):void 0))},n.handleInput=function(e){e.stopPropagation();var t=n._textarea.value;t.length>c.Configuration.MSG_MAX_LENGTH&&(t=t.substring(0,c.Configuration.MSG_MAX_LENGTH)),n.setState({messageText:t}),n.evaluateChangeCommand(t.trim()),n.props.message&&!t&&n.props.onCancelMessageEditRequest(),n.suggestionList.handleInput({value:t,selectionStart:n._textarea.selectionStart},n.props.conversationId)},n.pasteInput=function(e){e.stopPropagation(),e.preventDefault();var t,i,r=(window.clipboardData||e.clipboardData).getData("Text");r&&n.insertTextToSelection(r),!r&&(t="Files",i=e.clipboardData,Array.prototype.some.call(i.types,function(e){return e===t}))?n.props.canUploadFile&&n.props.onSendFiles(e.clipboardData.files):n.handleInput(e)},n.sendButtonHandler=function(e){e.stopPropagation(),n.props.isChatEnabled&&(n.suggestionList.clear(),n.sendMessage(u.ActionTrigger.BUTTON_SEND_CLICK))},n.cancelEditingMode=function(e){e.stopPropagation(),n.props.onCancelMessageEditRequest()},n._onEmoticonBtnClick=function(e){e.stopPropagation(),n._toggleEmoticonPicker()},n._toggleEmoticonPicker=function(e){n.state.isEmoticonPickerVisible?e||n.setState({isEmoticonPickerVisible:!1}):(n.setState({isEmoticonPickerVisible:!0}),p.swc.Telemetry.sendEvent.userAction(l.UserActionType.ExpressionPicker))},n._onEmoticonSelect=function(e){var t=e&&e.shortcuts&&e.shortcuts.length?e.shortcuts[0]+S:"";t&&n.insertTextToSelection(t)},n._onSuggestionApply=function(e){n.setCursorAt(e.selectionEnd),n.setState({messageText:e.value})},n._onEmoticonPickerClose=function(){n.setState({isEmoticonPickerVisible:!1})},n._onFileInputChange=function(e){e.stopPropagation(),n._fileSelector&&0!==n._fileSelector.files.length&&(n.props.onSendFiles(n._fileSelector.files),n._textarea&&a.AbilityHelpers.focusedElement.focus(n._textarea))},n._onAttachBtnClick=function(e){e.stopPropagation(),n.openFileSelector(n.props.acceptedFiles)},n.state={isEmoticonPickerVisible:!1,messageText:""},n.suggestionList=new v.SuggestionList(n._onSuggestionApply,t.canSendEmoticons,t.conversationId),n}return r(t,e),t.prototype.componentDidMount=function(){var e=this,t=function(t){return t===e.props.conversationId};p.swc.Eventing.registerEvent("proxy:conversation:filepicker",function(n){t(n)&&e.openFileSelector(e.props.acceptedFiles)}),p.swc.Eventing.registerEvent("proxy:conversation:emoticonpicker",function(n){t(n.id)&&(n.open?e._toggleEmoticonPicker(n.open):e._onEmoticonPickerClose())});var n=function(n){t(n.id)&&e._textarea&&a.AbilityHelpers.focusedElement.focus(e._textarea)};p.swc.Eventing.registerEvent("proxy:conversation:focusInput",n),p.swc.Eventing.registerEvent("paste",n)},t.prototype.componentWillReceiveProps=function(e){if(!e.prefillText&&""!==e.prefillText||this.props.prefillText===e.prefillText||this.setState({messageText:e.prefillText}),e.message&&this.props.message!==e.message){var t=g.MessageUtils.sanitizeMessageInputContent(e.message.content);this.setCursorAt(t.length),this.setState({messageText:t})}this.props.message&&!e.message&&this.emptyTextArea(),this.props.canSendEmoticons!==e.canSendEmoticons&&(this.suggestionList.clear(),this.suggestionList.dispose(),this.suggestionList=new v.SuggestionList(this._onSuggestionApply,e.canSendEmoticons,this.props.conversationId))},t.prototype.componentDidUpdate=function(e,t){var n=this;if(this._textarea){if(t.messageText!==this.state.messageText&&this._mirror&&(this._mirror.style.width=this._textarea.offsetWidth+"px",this._textarea.style.height=this._mirror.offsetHeight+"px"),this._cursorPosition>=0){this._setSelectionRangeTimer&&clearTimeout(this._setSelectionRangeTimer);var i=this._cursorPosition;this._textarea&&a.AbilityHelpers.focusedElement.focus(this._textarea),this._setSelectionRangeTimer=setTimeout(function(){n._setSelectionRangeTimer=void 0,n._textarea&&n._textarea.setSelectionRange(i,i)})}this._cursorPosition=void 0}},t.prototype.componentWillUnmount=function(){this._setSelectionRangeTimer&&(clearTimeout(this._setSelectionRangeTimer),this._setSelectionRangeTimer=void 0)},t.prototype.render=function(){var e=this,t=!!this.state.messageText,n=this.props.message,i=n&&this.state.messageText===g.MessageUtils.sanitizeMessageInputContent(n.content),r=C("send_message"),a=C("text_cancel_editing_message"),u=C("send_file"),l=this.state.isEmoticonPickerVisible?C("emoticon_picker_close"):C("emoticon_picker_open"),p=C("area_text_insertText");return s.createElement("div",{className:this.getComposedBlockClassName()},this.state.isEmoticonPickerVisible&&s.createElement(_.SwcEmoticonPicker,{className:"swcChatInput__emoticonPicker",onSelect:this._onEmoticonSelect,onClose:this._onEmoticonPickerClose}),s.createElement("div",{className:"swcChatInput__container "+this.props.tags},this.props.canSendEmoticons&&s.createElement("button",{className:"swcChatInput__button swcChatInput__button_emoticon",onClick:this._onEmoticonBtnClick,title:l,disabled:!this.props.isChatEnabled},s.createElement(b.SwcIcon,{className:"swcChatInput__icon",type:b.SwcIconType.EmoticonStroke,size:b.SwcIconSize.Medium})),s.createElement("textarea",{ref:this.onTextareaRef,className:"swcChatInput__textArea",onKeyDown:this.onKeyDown,onInput:this.handleInput,onPaste:this.pasteInput,value:this.state.messageText,placeholder:this.props.placeholder,maxLength:c.Configuration.MSG_MAX_LENGTH,disabled:!this.props.isChatEnabled,"aria-label":p}),this.props.isChatEnabled&&(t||!this.props.canUploadFile)&&!i&&s.createElement("button",{className:"swcChatInput__button swcChatInput__button_send",onClick:this.sendButtonHandler,disabled:!this.props.isChatEnabled,title:r,"aria-label":r},s.createElement(b.SwcIcon,{className:"swcChatInput__icon",type:b.SwcIconType.Send,size:b.SwcIconSize.Medium})),(t||!this.props.canUploadFile)&&i&&s.createElement("button",{className:"swcChatInput__button swcChatInput__button_cancel",onClick:this.cancelEditingMode,title:a},s.createElement(b.SwcIcon,{className:"swcChatInput__icon",type:b.SwcIconType.Cancel,size:b.SwcIconSize.Medium})),this.props.canUploadFile&&s.createElement(o.Fragment,null,s.createElement("input",{ref:function(t){return e._fileSelector=t},type:"file",className:"swcChatInput__fileInput",multiple:!0,onChange:this._onFileInputChange}),!t&&s.createElement("button",{className:"swcChatInput__button swcChatInput__button_file",onClick:this._onAttachBtnClick,title:u},s.createElement(b.SwcIcon,{className:"swcChatInput__icon",type:b.SwcIconType.Clippy,size:b.SwcIconSize.Medium})))),s.createElement(w.SwcSuggestionPicker,{className:"swcChatInput__suggestions",suggestionList:this.suggestionList}),s.createElement("div",{style:"max-width: 0; max-height: 0; position: absolute; overflow: hidden;"},s.createElement("div",{ref:function(t){return e._mirror=t},className:"swcChatInput__textArea",style:"position: relative; word-wrap: break-word; white-space: pre-wrap;"},this.state.messageText)))},t.prototype.sendMessage=function(e){var t=this.state.messageText.trim();if(t&&!(t.length>c.Configuration.MSG_MAX_LENGTH)){var n=d.Commands.instance;n.commands.length&&n.isValidCommand(t)?n.mode===d.CommandMode.submit&&this.emptyTextArea():(0===this.state.messageText.toLowerCase().indexOf("skypesearch:")?this.props.onSearch(t.substr("skypesearch:".length).trim()):this.props.message?this.props.onSendEditedMessage(this.props.message,t):this.props.onSendNewMessage(t,e),this.emptyTextArea())}},t.prototype.emptyTextArea=function(){this.setState({messageText:""})},t.prototype.keyDownHandler=function(e){this.evaluateChangeCommand("",e)},t.prototype.evaluateChangeCommand=function(e,t){var n=d.Commands.instance;n.mode===d.CommandMode.change&&n.evaluate(e,this.props.conversationId,t)},t.prototype.insertTextToSelection=function(e){var t=this._textarea.selectionStart,n=this._textarea.selectionEnd;this.setCursorAt(t+e.length),this.setState(function(i){var r=i.messageText;return{messageText:m.inject(r,e,t,n)}})},t.prototype.setCursorAt=function(e){this._cursorPosition=e},t.prototype.openFileSelector=function(e){void 0===e&&(e=""),this._fileSelector&&(this._fileSelector.value="",this._fileSelector.accept=e,this._fileSelector.click(),p.swc.Telemetry.sendEvent.userAction(l.UserActionType.FilePicker))},t}(y.SwcBaseComponent);t.SwcChatInput=T},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),s=n(0),a=n(25),c=n(36),u=n(577),l=n(579),p=function(e){function t(t,n,i){var r=e.call(this)||this;r.onSuggestionApply=t,r._suggestionEngines=[],r._selectedIndex=-1,r._suggestions=[],r._getWord=function(e){var t=e.selectionStart;return c.wordAt(e.value,t).toLocaleLowerCase()},r._processSuggestions=function(e){var t=e.length?e.reduce(function(e,t){return e.concat(t)}):[];r.setSuggestions(t),0===r.suggestions.length?r.setSelectedIndex(-1):(-1===r.selectedIndex||r.selectedIndex>r.suggestions.length)&&r.setSelectedIndex(0)};var o=s.swc.services.conversations.get(i);return s.swc.EcsConfig.enableMentions&&o.isGroup&&r._suggestionEngines.push(l.default),n&&r._suggestionEngines.push(u.default),r}return r(t,e),Object.defineProperty(t.prototype,"selectedIndex",{get:function(){return this._selectedIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suggestions",{get:function(){return this._suggestions},enumerable:!0,configurable:!0}),t.prototype.setSelectedIndex=function(e){e!==this._selectedIndex&&(this._selectedIndex=e,this.publish("selectedIndex",e))},t.prototype.setSuggestions=function(e){e!==this._suggestions&&(this._suggestions=e,this.publish("suggestions",e))},t.prototype.handleInput=function(e,t){var n=this,i=[],r=s.swc.services.conversations.get(t);this._suggestionEngines.forEach(function(t){var o=n._getWord(e);t.shouldCreateSuggestion(o)&&i.push(new Promise(function(n,i){t.getSuggestions(e,o,r).then(function(e){n(e.slice(0,5))})}))}),Promise.all(i).then(this._processSuggestions)},t.prototype.clear=function(){this.setSuggestions([]),this.setSelectedIndex(-1)},t.prototype.applyItem=function(e){if(e<0||e>=this.suggestions.length)this.clear();else{var t=this.suggestions[e].applySuggestion();this.clear(),this.onSuggestionApply(t)}},t.prototype.handleKeyDown=function(e,t){if(0===this.suggestions.length||-1===[a.default.UP,a.default.DOWN,a.default.ENTER,a.default.TAB,a.default.ESCAPE].indexOf(t))return!1;switch(t){case a.default.ESCAPE:return this.clear(),!1;case a.default.UP:case a.default.DOWN:if(this.suggestions.length<2)return!1;var n=38===t?-1:1;this.setSelectedIndex((this.selectedIndex+this.suggestions.length+n)%this.suggestions.length);break;case a.default.ENTER:case a.default.TAB:if(e.shiftKey)return!1;this.applyItem(this.selectedIndex)}return!0},t}(o.default);t.SuggestionList=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(578),o=function(){function e(){this.isEnabled=!0,this.suggestHidden=!0}return e.prototype.shouldCreateSuggestion=function(e){return!!this.isEnabled&&(0===e.indexOf("(")&&e.length>=2)},e.prototype.getSuggestions=function(e,t,n){var i=this;return new Promise(function(n,r){i.filterEmoticons(t,e).then(function(e){1===e.length&&i.hasExactMatch("("+t,e[0].emoticon)&&(e=[]),n(e)})})},e.prototype.filterEmoticons=function(e,t){var n=this.suggestHidden;return i.swc.services.pesManager.getConfiguration().then(function(i){var o=i.items.reduce(function(i,o){if("emoticon"!==o.type||!o.visible&&!n)return i;var s=o.shortcuts.filter(function(t){return 0===t.indexOf(e.toLocaleLowerCase())});if(s.length){var a=new r.EmoticonSuggestion(o,s[0],t);return i.push(a),i}return i},[]);return o.sort(function(e,t){var n=e.shortcut,i=t.shortcut;return n.length>i.length?1:n.length<i.length?-1:0}),o})},e.prototype.hasExactMatch=function(e,t){return!!t.shortcuts.filter(function(t){return t===e}).length},e}();t.EmoticonSuggestionEngine=o,t.default=new o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n,i){var r=e.call(this,i)||this;return r.emoticon=t,r.shortcut=n,r}return r(t,e),t.prototype.getReplacer=function(){return this.shortcut},t}(n(449).Suggestion);t.EmoticonSuggestion=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(580),r=n(581),o=function(){function e(){}return e.prototype.shouldCreateSuggestion=function(e){return 0===e.indexOf("@")||e.length>2},e.prototype.getSuggestions=function(e,t,n){return new Promise(function(o,s){var a=n.participants.filter(function(e){var n=t.toLowerCase().substring(t.indexOf("@")+1);return e.person.displayName.split(" ").some(function(e){return 0===e.toLowerCase().indexOf(n)})}).map(function(t){return new r.MentionSuggestion(t,e)});i.MentionAllSuggestion.shouldCreateAllSuggestion(e.value)&&o([new i.MentionAllSuggestion(e)].concat(a)),o(a)})},e}();t.default=new o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=function(e){function t(n){var i=e.call(this,n)||this;return i.isAll=!1,i.isAll=t.shouldCreateAllSuggestion(n.value),i}return r(t,e),t.shouldCreateAllSuggestion=function(e){return 0===("@"+t.allText).indexOf(e)},t.prototype.getReplacer=function(){return"@("+t.allText+")"},t.allText=o.swc.services.i18n.fetch("text_all").toLowerCase(),t}(n(449).Suggestion);t.MentionAllSuggestion=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){var i=e.call(this,n)||this;return i.participant=t,i.templateName="suggestion-item-mention",i.displayName=ko.observable(t.person.displayName),t.person.subscribe("displayName",i.displayName),i}return r(t,e),t.prototype.dispose=function(){this.participant.person.unsubscribe("displayName",this.displayName)},t.prototype.getReplacer=function(){var e=this.participant.person;return"@"+(e.isAgent?"("+e.displayName.replace(/(\(|\))/g,"")+")":"("+e.displayName+")")},t}(n(449).Suggestion);t.MentionSuggestion=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(583);t.SwcEmoticonPicker=i.SwcEmoticonPicker},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),a=n(40),c=n(0),u=n(43),l=n(25),p=n(8),d=n(584),f=n(585),h=n(586),g=[],m=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="swcEmoticonPicker",n.onKeyDown=function(e){e.stopPropagation(),u.default.getKeyCode(e)===l.default.ESCAPE&&n.onClose()},n.onSearchQueryChange=function(e){n.setState({searchQuery:e})},n.onClose=function(){n.onSearchQueryChange(""),n.props.onClose()},n.onEmoticonPreview=function(e){n.setState({currentEmoticonId:e})},n.onEmoticonSelect=function(e){n.onEmoticonPreview(e);var t=_(g,e);n.props.onSelect(t)},n.state={searchQuery:"",currentEmoticonId:""},g.length?n:(c.swc.services.pesManager.getConfiguration().then(function(e){g=function(e){var t={},n=[];if(!e)return n;e.tabs&&e.tabs.forEach(function(e){e.sections&&e.sections.forEach(function(e){e.pack&&(t[e.pack]=e)})});e.packs&&(n=e.packs.filter(function(e){var n=!1;if(!t[e.id])return!1;if(!e.title||e.id===v||e.id===y)return!1;for(var i=0;i<e.items.length;i++)if(e.items[i].type===a.default.itemTypes.emoticon.id){n=!0;break}return n}));return n}(e),n.forceUpdate()}),n)}return r(t,e),t.prototype.render=function(){var e=this.state.currentEmoticonId?function(e,t){var n=_(e,t);if(!n)return null;return{id:n.id,description:n.description,shortcut:n.shortcuts&&n.shortcuts[0]||""}}(g,this.state.currentEmoticonId):{id:"smile",description:"Smile",shortcut:":)"};return s.createElement("div",{className:this.getComposedBlockClassName(),onKeyDown:this.onKeyDown},s.createElement(d.SwcEmoticonPickerHeader,{className:"swcEmoticonPicker__header",searchQuery:this.state.searchQuery,onSearchQueryChange:this.onSearchQueryChange,onClose:this.onClose}),s.createElement("div",{className:"swcEmoticonPicker__content"},s.createElement(h.SwcEmoticonPickerPreview,o({className:"swcEmoticonPicker__preview"},e)),s.createElement(f.SwcEmoticonPickerList,{className:"swcEmoticonPicker__list",searchQuery:this.state.searchQuery,emoticonPacks:g,onEmoticonPreview:this.onEmoticonPreview,onEmoticonSelect:this.onEmoticonSelect})))},t}(p.SwcBaseComponent);t.SwcEmoticonPicker=m;var v="e6a2194043654a10b081028546390dd8",y="c31911f4054c48e39c3139bd0f2a456e";function _(e,t){for(var n=0,i=g;n<i.length;n++)for(var r=0,o=i[n].items;r<o.length;r++){var s=o[r];if(s.id===t)return s}return null}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(0),a=n(8),c=n(14),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcEmoticonPickerHeader",t.onSearchIconClick=function(e){e.stopPropagation(),t.focusInput()},t.focusInput=function(){t._input&&t._input.focus()},t.onInputValueChange=function(e){e.stopPropagation();var n=e.target;t.props.onSearchQueryChange(n.value)},t.onCloseClick=function(e){e.stopPropagation(),t.props.onClose()},t}return r(t,e),t.prototype.componentDidMount=function(){setTimeout(this.focusInput,100)},t.prototype.render=function(){var e=this,t=s.swc.services.i18n.fetch("search"),n=s.swc.services.i18n.fetch("emoticon_picker_close");return o.createElement("div",{className:this.getComposedBlockClassName()},o.createElement("span",{className:"swcEmoticonPickerHeader__iconWrapper",title:t,onClick:this.onSearchIconClick},o.createElement(c.SwcIcon,{className:"swcEmoticonPickerHeader__icon",type:c.SwcIconType.Search,size:c.SwcIconSize.Medium})),o.createElement("input",{className:"swcEmoticonPickerHeader__input",ref:function(t){return e._input=t},type:"text",value:this.props.searchQuery,onInput:this.onInputValueChange,placeholder:t}),o.createElement("button",{className:"swcEmoticonPickerHeader__button",onClick:this.onCloseClick,title:n},o.createElement(c.SwcIcon,{className:"swcEmoticonPickerHeader__icon",type:c.SwcIconType.Cancel,size:c.SwcIconSize.Medium})))},t}(a.SwcBaseComponent);t.SwcEmoticonPickerHeader=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(0),c=n(60),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcEmoticonPickerList",t.handleMouseEvent=function(e,n){n.stopPropagation(),t.props.onEmoticonPreview(e)},t.handleClickEvent=function(e,n){n.stopPropagation(),t.props.onEmoticonSelect(e)},t}return r(t,e),t.prototype.render=function(){var e=this,t=a.swc.services.i18n.fetch("search_no_results_found").toUpperCase();return s.createElement(c.AccessibleList,null,s.createElement("div",{className:this.getComposedBlockClassName()},!this.props.emoticonPacks.length&&s.createElement("h4",{className:"swcEmoticonPickerList__title"},t),s.createElement("div",{className:"swcEmoticonPickerList__emoticonPacks"},this.props.emoticonPacks.map(function(t){return s.createElement(o.Fragment,{key:t.id},t.title&&s.createElement("h4",{className:"swcEmoticonPickerList__title"},t.title),s.createElement("div",{className:"swcEmoticonPickerList__packItems","data-name":t.id,"aria-label":t.ariaLabel},t.items.map(function(t){return s.createElement(c.AccessibleListItem,{key:t.id},s.createElement("div",{key:t.id,onMouseOver:o.linkEvent(t.id,e.handleMouseEvent),onFocus:o.linkEvent(t.id,e.handleMouseEvent),onClick:o.linkEvent(t.id,e.handleClickEvent),tabIndex:0,title:t.description,"data-item-id":t.id,className:t.type+" swcEmoticonPickerList__packItem",role:"listitem",hidden:!l(t,e.props.searchQuery),style:{"background-image":"url("+t.background+")"}}))})))}))))},t}(n(8).SwcBaseComponent);function l(e,t){var n=[e.keywords||[],e.shortcuts||[],e.description.split(/\s/),(e.copyright||"").split(/\s/),(e.pickerTitle||"").split(/\s/),(e.transcript||"").split(/\s/)].reduce(function(e,t){return e.concat(t)},[]).filter(function(e){return void 0!==e&&""!==e&&null!==e}).map(function(e){return e.toLowerCase()});return t=t.toLowerCase(),n.find(function(e){return e.indexOf(t)>-1})}t.SwcEmoticonPickerList=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(135),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcEmoticonPickerPreview",t}return r(t,e),t.prototype.render=function(){return o.createElement("div",{className:this.getComposedBlockClassName()},o.createElement(s.SwcEmoticon,{className:"swcEmoticonPickerPreview__emoticon",large:!0,largeEmoticonClass:"extraLarge",title:this.props.description,emoticonId:this.props.id,isAnimated:!0}),o.createElement("h4",{className:"swcEmoticonPickerPreview__description"},this.props.description),!!this.props.shortcut&&o.createElement("h4",{className:"swcEmoticonPickerPreview__shortcut"},this.props.shortcut))},t}(n(8).SwcBaseComponent);t.SwcEmoticonPickerPreview=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(0),c=n(135),u=n(37),l=n(74),p=n(8),d=n(14),f=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="swcSuggestionPicker",n.propNames=["suggestions","selectedIndex"],n._setNewState=function(){n.setState({suggestions:n.props.suggestionList.suggestions,selectedIndex:n.props.suggestionList.selectedIndex})},n._clickHandler=function(e){n.props.suggestionList.applyItem(e)},n.state={suggestions:[],selectedIndex:-1},n}return r(t,e),t.prototype.componentDidMount=function(){var e=this;this.propNames.forEach(function(t){e.props.suggestionList.subscribe(t,e._setNewState)})},t.prototype.componentDidUpdate=function(){a.swc.services.pesManager.refresh()},t.prototype.componentWillUnmount=function(){var e=this;this.propNames.forEach(function(t){e.props.suggestionList.unsubscribe(t,e._setNewState)})},t.prototype.render=function(){var e=this;return s.createElement("ul",{className:this.getComposedBlockClassName()},this.state.suggestions.map(function(t,n){var i="swcSuggestionPicker__item"+(e.state.selectedIndex===n?" swcSuggestionPicker__item_selected":"");if(t.emoticon)return s.createElement("li",{key:t.emoticon.id,className:i,onClick:o.linkEvent(n,e._clickHandler)},s.createElement(c.SwcEmoticon,{className:"swcSuggestionPicker__emoticon",emoticonId:t.emoticon.id,isAnimated:!0}),s.createElement("span",{className:"swcSuggestionPicker__shortcut"},t.shortcut));var r=t;if(r.isAll)return s.createElement("li",{key:"@all",className:"swcSuggestionPicker__mentionItem "+i,onClick:o.linkEvent(n,e._clickHandler)},s.createElement(d.SwcIcon,{type:d.SwcIconType.Contacts,size:d.SwcIconSize.Small}),s.createElement("span",{className:"swcSuggestionPicker__mentionText"},a.swc.services.i18n.fetch("text_all").toLowerCase()));if(!r.participant)return null;var p=r.participant;return p.person.id===a.swc.services.mePersonManager.mePerson.id?null:s.createElement("li",{key:p.person.id,className:"swcSuggestionPicker__mentionItem "+i,onClick:o.linkEvent(n,e._clickHandler)},s.createElement(l.SwcPersonAvatar,{size:u.SwcAvatarSize.Small,person:p.person}),s.createElement("span",{class:"swcSuggestionPicker__mentionText"},p.person.displayName))}))},t}(p.SwcBaseComponent);t.SwcSuggestionPicker=f},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),a=n(8),c=n(468),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockClassName="swcChatWarningsList",t}return r(t,e),t.prototype.render=function(){return s.createElement("ul",{className:this.getComposedBlockClassName()},this.props.warnings.map(function(e,t){return s.createElement(c.SwcChatWarning,o({},e,{className:"swcChatWarningsList__warning",key:t}))}))},t}(a.SwcBaseComponent);t.SwcChatWarningsList=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),a=n(2),c=n(105),u=n(103),l=n(79),p=n(0),d=n(60),f=n(59),h=n(467),g=n(8),m=n(14),v=function(e,t){return p.swc.services.i18n.fetch(e,t)},y=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="swcRemoveParticipants",n._toggleMarkedParticipant=function(e){if(!p.swc.services.mePersonManager.isMe(e.person.id)&&n.props.canRemoveParticipants){var t=f.default.getWrappedIdWithMri(e.person);n.setState(function(e){var n,i=e.marked;return{marked:o({},i,(n={},n[t]=!i[t],n))}})}},n._onConfirm=function(){var e=n.state.marked,t=Object.keys(e).filter(function(t){return!0===e[t]});0!==t.length&&n.props.onConfirm(t)},n._setScrollViewport=function(e){n._scrollViewport=e},n._setScrollWrapper=function(e){n._scrollWrapper=e},n.state={marked:{}},n}return r(t,e),t.prototype.componentDidMount=function(){this._scrollViewport&&this._scrollWrapper&&(this._customScrollbar=new c.default(this._scrollWrapper,this._scrollViewport),this._customScrollbar.recount()),p.swc.Telemetry.sendEvent.userAction(l.UserActionType.Participants)},t.prototype.render=function(){var e=this,t=this.props,n=t.conversation.participants,i=t.canRemoveParticipants,r=t.onCancel,o=this.state.marked,c=Object.keys(o).filter(function(e){return!0===o[e]}).length>0;return a.createElement(u.I18nContextComponent,null,a.createElement("div",{className:this.getComposedBlockClassName()},a.createElement("header",{className:"swcRemoveParticipants__header"},a.createElement("h3",{className:"swcRemoveParticipants__title"},v("conversation_remove_people_to_chat")),a.createElement("button",{title:v("sign_in_cancel"),"aria-label":v("sign_in_cancel"),type:"button",className:"swcRemoveParticipants__closeButton",tabIndex:0,onClick:r},a.createElement(m.SwcIcon,{type:m.SwcIconType.Cancel,size:m.SwcIconSize.Medium}))),n.length>0&&a.createElement("div",{className:"swcRemoveParticipants__scrollWrapper swc-scroll-wrapper",ref:this._setScrollWrapper,role:"none"},a.createElement(d.AccessibleList,null,a.createElement("ul",{className:"swcRemoveParticipants__list swc-scroll-viewport",ref:this._setScrollViewport},n.map(function(t){return a.createElement(h.Participant,{key:t.person.id,person:t.person,action:s.linkEvent(t,e._toggleMarkedParticipant),canBeRemoved:i&&!p.swc.services.mePersonManager.isMe(t.person.id),removeParticipantText:v("remove_participant_by_name",{participantName:t.person.displayName}),selectedForRemoval:e.state.marked[f.default.getWrappedIdWithMri(t.person)]})})))),c&&a.createElement("footer",{className:"swcRemoveParticipants__footer"},a.createElement("button",{type:"button",className:"swcRemoveParticipants__confirmButton",title:v("new_chat_button_remove_selection"),onClick:this._onConfirm},v("new_chat_button_remove_selection")))))},t}(g.SwcBaseComponent);t.SwcRemoveParticipants=y},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props.actions;return s.createElement("div",{className:"swc-action-bar"},e.map(function(e){return s.createElement("button",{key:e.name,className:"swc-action "+e.className,onClick:e.handler,title:e.title},e.text)}))},t}(o.Component);t.ActionBar=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(29),o=function(e,t){return i.swc.services.i18n.fetch(e,t)},s=function(){function e(e){var t=this;this.conversation=e,this.typingIndicator=ko.observable(o("typingIndicatorOnLoad")),this.isTyping=ko.observable(!1),this._typingParticipants={},this._onDisplayNameUpdate=function(e){t.typingIndicator(o("typingIndicatorHuman",{typingMessage:t.shouldUseCustomDisplayName(t._person)?t._person.imDisplayName:t.adjustBotName(e)}))},this.conversation.participants.subscribe(this._onParticipantsChange.bind(this)),this.conversation.subscribe("isTyping",this._onTypingIndicator.bind(this)),this.boundConversationLoadedHandler=this._onConversationLoadedHandler.bind(this),e.isLoaded?this.setup():(this.isTyping(!0),this.conversation.subscribe("isLoaded",this.boundConversationLoadedHandler))}return e.prototype.setup=function(){if(this.conversation.isGroup){var e=o("typingIndicatorHuman",{typingMessage:o("typingIndicatorSomebody")});this.typingIndicator(e)}else this._person=i.swc.services.persons.getPerson(this.conversation.id,!0),this._onDisplayNameUpdate(this._person.displayName),this._person.subscribe("displayName",this._onDisplayNameUpdate)},e.prototype._onParticipantsChange=function(e,t){var n=this;e.length&&t.newItems&&t.newItems.length&&t.newItems.forEach(function(e){var t=n._typingDetector.bind(n,e);e.subscribe("isTyping",t)})},e.prototype._onConversationLoadedHandler=function(){this.isTyping(!1),this.setup()},e.prototype._onTypingIndicator=function(e){if(this.isTyping(!!e),this.timeoutId&&clearTimeout(this.timeoutId),e){var t=this;this.timeoutId=setTimeout(function(){t.isTyping(!1),t.timeoutId=void 0},5e3)}},e.prototype._typingDetector=function(e,t){var n=this,i=e.person.id;t?this._typingParticipants[i]=e:delete this._typingParticipants[i];var r=Object.keys(this._typingParticipants),s="";r.length?(this.conversation.isGroup&&(r.forEach(function(e){var t=n.getCurrentDisplayName(e);s+=""===s?t:", "+t}),this.typingIndicator(o("typingIndicatorHuman",{typingMessage:s}))),this.isTyping(!0)):this.isTyping(!1)},e.prototype.adjustBotName=function(e){return e&&e!==r.default.getNormalizeId(this.conversation.id)?e:this.conversation.isAgent?"Bot":"Person"},e.prototype.dispose=function(){this.conversation.unsubscribe("isLoaded",this.boundConversationLoadedHandler),this._person&&(this._person.unsubscribe("displayName",this._onDisplayNameUpdate),this._person=null)},e.prototype.getCurrentDisplayName=function(e){var t="";return this._typingParticipants[e]&&(t=this.shouldUseCustomDisplayName(this._typingParticipants[e].person)?this._typingParticipants[e].person.imDisplayName:this._typingParticipants[e].person.displayName),t},e.prototype.shouldUseCustomDisplayName=function(e){return""!==e.imDisplayName&&i.swc.EcsConfig.showCustomTypingName},e}();t.default=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(1),a=n(105),c=n(4),u=n(169),l=n(0),p=n(7),d=n(448),f=n(21),h=n(359),g=n(593),m="isUnderQuarantine",v="isBlocked",y="swift-narrow",_=function(e){function t(n,i){var r=e.call(this,n.conversation,i)||this;return r._params=n,r._canMarkNewMessage=!1,r._fetchingInProgress=!1,r._isFirstLoad=!0,r._crMessage=null,r._unreadSplitter=null,r._unreadSplitterSubscription=null,r._blockedChatMsg=null,r.lastScrollStartTime=0,r.init=function(){r.conversation.subscribe(m,r._onQuarantineHandlerSubscripion),r.conversation.subscribe(v,r._onBlockedHandlerSubscripion),r.conversation.consumptionHorizon.subscribe("value",function(){r._updateUnreadSplitter()}),l.swc.services.mePersonManager.fetch().then(function(e){r.meUserName=e.id,r._initConversationMessagesList(),r._addBotGreetingMessage(),r._addWelcomeMessage(),r._updateUnreadSplitter(),r._scrollToBottom(),r._setMinHeight(),r.viewport.addEventListener("scroll",r._onScroll),r._messagesEl=r._element.querySelector(".messages"),r.isShowMessages(!r.conversation.isBlocked),r.isBlocked(r.conversation.isBlocked);var t=d.default.instance;t.forceWidth(r._messagesEl.offsetWidth),t.addResizeHandler(r._onResize),t.CurrentStyle===d.StyleModes.NARROW&&r._messagesEl.classList.add(y),l.swc.Eventing.registerEvent("viewRestored",function(e){e===r.conversation.id&&(r._updateUnreadSplitter(!0),setTimeout(r._scrollToBottom,250))})},function(e){p.default.throwError(101010,"Unable to fetch me person in messages list VM")}),l.swc.Eventing.registerEvent("removeAllMessagesFromUi",r.removeAllMessagesFromUI),l.swc.Eventing.registerEvent("scrollToBottom",function(e){return e===r.conversation.id&&r._scrollToBottom()}),l.swc.Eventing.registerEvent("onControlClose",r._removeUnreadSplitterSubscription),r.scroll=new a.default(r._element,r.viewport)},r.removeAllMessagesFromUI=function(e){e===r.conversation.id&&r._removeAllMessagesFromUI()},r._removeUnreadSplitterSubscription=function(e){e&&e.id===r.conversation.id&&r._unreadSplitterSubscription&&(l.swc.Eventing.unregisterEvent("proxy:configuration:setLanguage:response",r._unreadSplitterSubscription),r._unreadSplitterSubscription=null)},r._onResize=function(){r.scroll.recount()},r._onScroll=function(){r.lastScrollStartTime=Date.now(),r.isScrolling=!0,r.messagesList().length&&r.viewport.scrollTop<4*(r.viewport.clientHeight||500)&&!r._fetchingInProgress&&(r._fetchingInProgress=!0,-1===r._lastScrollPositionFromBottomBeforeFetching&&(r._lastScrollPositionFromBottomBeforeFetching=r.viewport.scrollHeight-r.viewport.scrollTop),r.conversation.loadMoreMessages().then(function(){return r._fetchingInProgress=!1})),r.viewport.scrollTop<r.viewport.scrollHeight-r.viewport.offsetHeight-500&&r.showJumpArrow(!0),r.viewport.scrollTop+250>=r.viewport.scrollHeight-r.viewport.offsetHeight&&r.showJumpArrow(!1),r.scrollingTimer||(r.scrollingTimer=setTimeout(function(){Date.now()-500>r.lastScrollStartTime&&(r.isScrolling=!1,l.swc.services.pesManager.refresh(),r.lastScrollStartTime=0,r.scrollingTimer=null)},500)),h.default.remove()},r.dispose=function(){r.conversation&&r.conversation.messages&&(r.conversation.messages.unsubscribe(r._onNewMessages),r.conversation.messages.spliceObservable(0,r.conversation.messages.length)),r.messagesList().forEach(function(e){e.dispose()}),r.viewport.removeEventListener("scroll",r._onScroll),d.default.instance.removeResizeHandler(r._onResize),r.messagesList.removeAll(),r.conversation.unsubscribe(m,r._onQuarantineHandlerSubscripion),r.conversation.unsubscribe(v,r._onBlockedHandlerSubscripion)},r._initConversationMessagesList=function(){if(r.conversation.messages.length>0){r._canMarkNewMessage=!0,t.initTelemetrySent||(t.initTelemetrySent=!0);for(var e=0,n=r.conversation.messages;e<n.length;e++){var i=n[e];if(r._checkUserMessageSent(i))break}r._addMessagesToUI(r.conversation.messages),setTimeout(r._scrollToBottom,0)}r.conversation.messages.subscribe(r._onNewMessages.bind(r))},r.addMessage=function(e){var t=new u.default(!1);t.type=c.MessageType.UserMessage,t.direction=c.Direction.Incoming,t.content=e,t.status=-1,r.conversation.messages.pushObservable(t)},r._checkUserMessageSent=function(e){return!!r._params.userMessageSent()||("UserMessage"===e.type&&e.direction===c.Direction.Outgoing&&(r._params.userMessageSent(!0),r._setMinHeight()),!1)},r._onNewMessages=function(e,n){var i;r._canMarkNewMessage||(r._canMarkNewMessage=!0),t.initTelemetrySent||(t.initTelemetrySent=!0),r._isFirstLoad&&o.default.get.isTeams()&&r.messagesList().length>1&&r.messagesList(r.messagesList().filter(function(e){return e.type!==c.MessageType.Welcome}));var s=r.messagesList().length-1,a=r.messagesList()[s]?r.messagesList()[s].timestamp.getTime():0,u=n.newItems?n.newItems.slice():[],p=n.oldItems?n.oldItems.slice():[];if(r._isFirstLoad&&1===r.messagesList().length){var d=r.messagesList()[0],f=e.filter(function(e){return e.id===d.id})[0];f&&(u.unshift(f),p.unshift(d))}var h=[],g=[];if(p.length&&r._removeMessagesFromUI(p),u.length&&u.forEach(function(e){e&&e.content;r._checkUserMessageSent(e),e.isDeleted||r.conversation.definition.HideSystemMessages&&e.type===c.MessageType.SystemMessage||(e.content||0!==e.files.length)&&(a<=e.timestamp.getTime()?h.push(e):g.push(e))}),r._isFirstLoad&&setTimeout(r._scrollToBottom,0),g.length){for(var m=r.messagesList()[0],v=[],y=r.viewport.scrollTop-r.viewport.scrollHeight,_=function(e){for(var t=r.messagesList().length-1;t>=0;t--)if(r.messagesList()[t].timestamp.getTime()<e.timestamp.getTime())return t;return-1},b=0;b<g.length;b++){var w=g[b];if(m&&w.timestamp<=m.timestamp)v.push(w);else{var C=_(w)+1;r.messagesList.splice(C,0,w),r.adjustAuthorInfo(C,C+1)}}v.length&&((i=r.messagesList).unshift.apply(i,v),r.adjustAuthorInfo(0,g.length)),r.viewport.scrollTop=r.viewport.scrollHeight+y}if(h.length){r._addMessagesToUI(h);var S=r.messagesList().length-h.length,T=S>0?S-1:0;r.adjustAuthorInfo(T,r.messagesList().length);var E=h[h.length-1].direction===c.Direction.Outgoing;(r._needUpdateScroll()||E)&&setTimeout(r._scrollToBottom,0)}(r._isFirstLoad&&e.length||h.length)&&(r._processSuggestedActions(e[e.length-1]),r._isFirstLoad=!1),r.scroll.recount(),l.swc.services.pesManager.refresh()},r._onMessageDeleted=function(e){e&&r._updateUnreadSplitter()},r._localizeSplitter=function(e){r._unreadSplitter&&(r._unreadSplitter.content=l.swc.services.i18n.fetch("unread_messages"),r.messagesList.splice(e,1,r._unreadSplitter))},r.convContainerNode=i.parentElement,r._onQuarantineHandlerSubscripion=r.onQuarantineHandler.bind(r),r._onBlockedHandlerSubscripion=r.onBlockedHandler.bind(r),r._params.enable()?r.init():r._params.enable.subscribe(function(e){return e&&r.init()}),r}return r(t,e),t.prototype._addMessagesToUI=function(e){var t,n=this;e.forEach(function(e){e.subscribe("isDeleted",n._onMessageDeleted)}),(t=this.messagesList).push.apply(t,e)},t.prototype._removeMessagesFromUI=function(e){var t=this;e.forEach(function(e){e.unsubscribe("isDeleted",t._onMessageDeleted)}),this.messagesList.removeAll(e)},t.prototype._removeAllMessagesFromUI=function(){var e=this;this.messagesList().forEach(function(t){t.unsubscribe("isDeleted",e._onMessageDeleted)}),this.messagesList.removeAll()},t.prototype._setMinHeight=function(){this.clientHeight(this.viewport.clientHeight?this.viewport.clientHeight+"px":"100%")},t.prototype._addWelcomeMessage=function(){var e=s.Configuration.ECS.hideWelcomeOnHosts;if(e&&e.some(function(e){return f.UrlHelper.getHost()===e||o.default.get.host===e}))return;var t=new u.default(!1);t.type=c.MessageType.Welcome,t.status=c.DeliveryStatus.Sent,this.messagesList.push(t)},t.prototype.onQuarantineHandler=function(){if(this.conversation.isUnderQuarantine&&!this._crMessage){this._crMessage=new u.default(!0),this._crMessage.type=c.MessageType.SystemMessage;var e="";!this.person&&this.conversation.isPerson&&(this.person=l.swc.services.persons.getPerson(this.conversation.id),e=this.person.displayName||this.person.id),this._crMessage.content=l.swc.services.i18n.fetch("waiting_for_replay",{user_name:e}),this.messagesList.push(this._crMessage)}else!this.conversation.isUnderQuarantine&&this._crMessage&&(this.messagesList.remove(this._crMessage),this._crMessage=null)},t.prototype.onBlockedHandler=function(){this.isShowMessages(!this.conversation.isBlocked),this.isBlocked(this.conversation.isBlocked)},t.prototype._addBotGreetingMessage=function(){var e=this;this.conversation.isAgent&&(void 0!==this.conversation.isNew?this.conversation.isNew&&this.person&&(this.person.description&&this.addMessage(this.person.description),this.person.subscribe("description",function(t){e.addMessage(t)})):this.conversation.subscribe("isNew",function(t){e._addBotGreetingMessage()}))},t.prototype._needUpdateScroll=function(){return!(this.viewport.scrollTop>=this.viewport.scrollHeight-this.viewport.offsetHeight)},t.prototype.adjustAuthorInfo=function(e,t){var n;e>0?n=this.messagesList()[e-1]:(n=this.messagesList()[e],e++);for(var i=e;i<t;i++){var r=this.messagesList()[i];if(!n)return;var o=r.timestamp.getTime()-n.timestamp.getTime();r.isFirst=r.senderId!==n.senderId||o>12e4,n=r}},t.prototype._updateUnreadSplitter=function(e){if(void 0===e&&(e=!1),!this._unreadSplitter){var t=new u.default(!1);t.type=c.MessageType.UnreadSplitter,this._unreadSplitter=t}this._unreadSplitter.content=l.swc.services.i18n.fetch("unread_messages"),e&&this.messagesList.remove(this._unreadSplitter);var n=this.messagesList(),i=this.messagesList.indexOf(this._unreadSplitter);if(!e)if(this._shouldRemoveSplitter(n,i))this.messagesList.remove(this._unreadSplitter),this._removeUnreadSplitterSubscription(this.conversation.id);else if(i>-1)return;var r=this._getAddSplitterIndex(n);r>-1&&!(r===i)&&(this.messagesList.splice(r,0,this._unreadSplitter),this._unreadSplitterSubscription=this._localizeSplitter.bind(null,r),l.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",this._unreadSplitterSubscription))},t.prototype._shouldRemoveSplitter=function(e,t){if(t<0)return!1;if(t===e.length-1)return!0;for(var n=!0,i=0;i<e.length;i++){var r=e[i];if(l.swc.services.mePersonManager.isMe(r.senderId))return!0;var o=r.type===c.MessageType.UserMessage,s=r.type===c.MessageType.SystemMessage;(o||s)&&(n=n&&r.isDeleted)}return n},t.prototype._getAddSplitterIndex=function(e){for(var t=this.conversation.consumptionHorizon,n=e.length-1,i=!1,r=e.length-1;r>=0;r--){var o=e[r];t.lastReadMessageId===o.getKey()&&(n=r)}for(r=e.length-1;r>n;r--){o=e[r];if(!l.swc.services.mePersonManager.isMe(o.senderId)){var s=o.type===c.MessageType.UserMessage,a=o.type===c.MessageType.SystemMessage;!s&&!a||o.isDeleted||(i=!0)}}return i?n+1:-1},t.initTelemetrySent=!1,t}(g.default);t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(20),r=n(0),o=n(9),s=n(54),a=n(594),c="swc:action:click",u=".message",l=function(){return function(e,t){var n=this;this._element=t,this.messagesList=ko.observableArray(),this.isShowMessages=ko.observable(!0),this.isBlocked=ko.observable(!1),this.clientHeight=ko.observable("100%"),this.languages=ko.observableArray(),this.showSuggestedActions=ko.observable(!1),this.hasSuggestedActionOnLeft=ko.observable(!0),this.hasSuggestedActionOnRight=ko.observable(!0),this.isConnected=ko.observable(!0),this.translatorActive=ko.observable(!1),this.textTranslatorActive=ko.observable(r.swc.services.i18n.fetch("translator_active",{0:"<strong>",1:"</strong>"})),this.textNoConnection=ko.observable(""),this.textBlockChatMsg=ko.observable(""),this.textLabelScrollToBottom=ko.observable(""),this.showJumpArrow=ko.observable(!1),this._isScrollAnimating=!1,this._lastScrollPositionFromBottomBeforeFetching=-1,this.localizeResources=function(){n.textNoConnection(r.swc.services.i18n.fetch("no_connection")),n.textBlockChatMsg(r.swc.services.i18n.fetch("area_text_disabled")),n.textLabelScrollToBottom(r.swc.services.i18n.fetch("scroll_to_bottom"))},this.invokeSuggestedAction=function(e){e&&"function"==typeof e.action&&e.action()},this.suggestionChanged=function(){var e;e=0!==n._suggestionArea.scrollLeft,n.hasSuggestedActionOnLeft(e),e=n._suggestionArea.scrollLeft!==n._suggestionArea.scrollWidth-n._suggestionArea.clientWidth,n.hasSuggestedActionOnRight(e)},this.scrollSuggestionsToBeginning=function(){n._scrollSuggestedArea(0)},this.scrollSuggestionsToLeft=function(){n._scrollSuggestedArea(n._suggestionArea.scrollLeft-n._suggestionArea.clientWidth)},this.scrollSuggestionsToRight=function(){n._scrollSuggestedArea(n._suggestionArea.scrollLeft+n._suggestionArea.clientWidth)},this.newMessageAddeded=function(e){Object.keys(r.swc.Eventing.registry).length&&o.MessageUtils.attachActionToLinks(e,u,c,n._swcClickEventHandler)},this.newMessageRendered=function(e){if(n.conversation.definition.MessageContentLimit&&e&&0!==e.length){var t=e[0].nextElementSibling;if(t&&t.classList.contains("message")&&t.classList.contains("other")&&!t.querySelector(".swift")){var i=t.getBoundingClientRect();n._shouldLimit(i.height)&&(t.classList.add("limited"),t.classList.add("less"),t.querySelector(".bubble").style.maxHeight=n.conversation.definition.MessageContentLimit)}}},this._shouldLimit=function(e){var t=!!n.conversation.definition.MessageContentLimit;if(!t)return!1;var i=parseInt(n.conversation.definition.MessageContentLimit.replace("px",""),10);return t&&i<e},this.jumpToBottom=function(){return n._scrollToBottom()},this._scrollToBottom=function(){n.viewport.scrollTop=n.viewport.scrollHeight,r.swc.services.pesManager.refresh(),i.AbilityHelpers.list.setCurrent(n.viewport,void 0)},this._scrollToLast=function(){-1!==n._lastScrollPositionFromBottomBeforeFetching&&(n.viewport.scrollTop=n.viewport.scrollHeight-n._lastScrollPositionFromBottomBeforeFetching,n._lastScrollPositionFromBottomBeforeFetching=-1)},this._swcClickEventHandler=function(e){var t=e.target.getAttribute("data-swc-payload"),n=e.target.getAttribute("href");t&&r.swc.Eventing.triggerEvent("click",t),n.toLowerCase().indexOf("swc:preventdefault=false")<0&&e.preventDefault()},this._processSuggestedActions=function(e){e&&e.suggestedActions.length?(n.suggestedActions(e.suggestedActions),n.showSuggestedActions(!0),n.suggestionChanged(),n.scrollSuggestionsToBeginning(),setTimeout(function(){return n._scrollToBottom()},250)):(n.suggestedActions([]),n.showSuggestedActions(!1))},this._scrollSuggestedArea=function(e){a.scrollTo(e,250,"scrollLeft",n._suggestionArea,function(){return n.suggestionChanged()})},this.dispose=function(){r.swc.Eventing.unregisterEvent("proxy:configuration:setLanguage:response",n.localizeResources)},this._toggleJumpArrow=function(e){n._toggleJumpArrowTimer&&window.clearTimeout(n._toggleJumpArrowTimer),e?n._jumpArrow.style.display="block":n._jumpArrow.classList.remove("show-down-arrow"),n._toggleJumpArrowTimer=window.setTimeout(function(){n._toggleJumpArrowTimer=void 0,e?n._jumpArrow.classList.add("show-down-arrow"):n._jumpArrow.style.display="none"},e?0:500)},this.viewport=this._element.querySelector(".swc-scroll-viewport"),this.conversation=e,this._suggestionArea=t.querySelector(".suggestionArea"),this.suggestedActions=ko.observableArray([]),window.addEventListener("resize",function(){n.suggestionChanged()}),s.get().subscribe("isOnline",this.isConnected),this.localizeResources(),r.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",this.localizeResources),this._jumpArrow=this._element.querySelector(".down-arrow"),this._jumpArrow.style.display="none",this.showJumpArrow.subscribe(this._toggleJumpArrow)}}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scrollTo=function e(t,n,i,r,o){var s="scrollLeft"===i?r.scrollLeft:r.scrollTop,a=(t-s)/n*10;setTimeout(function(){var c=s+a;"scrollLeft"===i?r.scrollLeft=c:r.scrollTop=c,n-=10,c===t||n<=0?o&&o():e(t,n,i,r,o)},10)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(445),s=function(){return function(e,t,n){n.innerHTML="";var s={componentConfig:t,params:e},a=r.createElement(o.SignIn,s);i.render(a,n)}}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(3),s=n(15),a=n(40),c=n(0),u=n(43),l=n(25),p=n(359),d=n(41),f=n(135),h="https://"+a.default.pesCDNAuthentication.cdnServiceHost+"/pes/v1/emoticons/",g=a.default.profiles.emoticons.getSmall(),m=function(){function e(e,t,n){var h=this;this.element=n,this.reactions=ko.observableArray([]),this.showReactionsBar=ko.observable(!1),this.ecsTeamsReactionsPack=["yes"],this._removeItems=function(e){e.forEach(function(e){o.default.get.backend===s.MessagingBackend.TEAMS&&"like"===e.key&&(e.key="yes");for(var t=0;t<h.reactions().length;t++){var n=h.reactions()[t];e.key===n.id&&h.reactions().splice(t,1)}})},this._addItems=function(e){e.forEach(function(e){var t;if(0!==e.users.length){o.default.get.backend===s.MessagingBackend.TEAMS&&"like"===e.key&&(e.key="yes");var n=null,i=h._pesEmoticonMap[e.key];if(i){for(var r=0;r<h.reactions().length;r++){var a=h.reactions()[r];e.key===a.id&&(n=a)}n?n.users=e.users:(!o.default.get.isTeams()||o.default.get.isTeams()&&h.ecsTeamsReactionsPack.indexOf(e.key)>-1)&&(t=h.reactions).push.apply(t,[h._mapEmoticonToReactionItem(i,e)])}}})},this._mapEmoticonToReactionItem=function(e,t){var n=e.description||e.id;return{id:e.id,url:h.getEmoticonUrl(e.id),users:t.users,title:c.swc.services.i18n.fetch("reactions_see_who_reacted_text",{key:n})}},this.getEmoticonUrl=function(e){return e?'url("'+h._getUrl(e)+'")':""},this.getUserListNames=function(e){var t="",n=null,i=[];return h.reactions().forEach(function(t){t.id===e&&(n=t)}),n&&n.users.forEach(function(e){var t=e.person.displayName||e.person.id;i.push(t)}),i.length>0&&(t=i.join("\n")),t},this._getDisplayName=function(e){var t=e.displayName||e.id,n=c.swc.services.i18n.fetch("reactions_you_text");return e.id===h._mePersonId&&(t+=" "+n),t},this.onKeyDown=function(e,t){var n=u.default.getKeyCode(t);n!==l.default.ENTER&&n!==l.default.SPACE||t.target.click()},this.showReactionPreview=function(e,t){var n=document.createElement("div");n.className="reactionPreviewWrapper";var o=document.createElement("div");o.classList.add("reactionPreviewArea");var s={large:!0,largeEmoticonClass:"extraLarge",emoticonId:e.id,title:e.title,isAnimated:!0},a=r.createElement(f.SwcEmoticon,s),u=document.createDocumentFragment();if(i.render(a,u),o.appendChild(u),n.appendChild(o),e.users&&e.users.length){var l=document.createElement("div");l.className="reactionPreviewUsers",e.users.forEach(function(e){var t=document.createElement("div");t.className="userItem";var n=document.createDocumentFragment(),o={person:e.person,size:d.SwcAvatarSize.SuperSmall},s=r.createElement(d.SwcPersonAvatar,o);i.render(s,n),t.appendChild(n);var a=document.createElement("span");a.className="name",a.innerText=h._getDisplayName(e.person),t.appendChild(a),l.appendChild(t)}),n.appendChild(l)}t.preventDefault(),t.stopPropagation();var g=t.target,m={target:t.target,clientX:t.clientX||g.getBoundingClientRect().right,clientY:t.clientY||g.getBoundingClientRect().top};p.default.add(m,h._messageList,n,p.BubbleType.ReactionPreview,p.BubblePosition.onContextMenu),c.swc.services.pesManager.refresh()},this._messageList=t,this._pesEmoticonMap=c.swc.services.pesManager.emoticonMap,this.showHighDpiClass=a.default.highDpi,this._addItems(e.emotions),this.showReactionsBar(!!this.reactions().length),this._mePersonId=c.swc.services.mePersonManager.mePerson.id,e.emotions.subscribe(function(e,t){t.newItems&&t.newItems.length>0?h._addItems(t.newItems):t.oldItems&&t.oldItems.length>0&&h._removeItems(t.oldItems),h.showReactionsBar(!!h.reactions().length)})}return e.prototype._getUrl=function(e){return h+e+"/views/"+g},e}();t.default=m},function(e,t){e.exports='<div class="down-arrow">\r\n    <button class="down-btn" data-bind="text: textLabelScrollToBottom, click: jumpToBottom"></button>\r\n</div>\r\n<div class="swc-scroll-viewport" data-bind="list: { bottomUp: true }">\r\n    <div class="messages">\r\n        \x3c!-- ko if: isShowMessages() --\x3e\r\n            \x3c!-- ko foreach: {data: messagesList, afterAdd:newMessageAddeded, afterRender: newMessageRendered} --\x3e\r\n                \x3c!-- ko component: {\r\n                    name: \'messageitem\',\r\n                    params: {\r\n                        message: $data,\r\n                        conversation: $parent.conversation,\r\n                        conversationContainer: $parent.convContainerNode,\r\n                        meUserName: $parent.meUserName,\r\n                        suggestedActions: $parent.suggestedActions\r\n                    }\r\n                } --\x3e\r\n                \x3c!-- /ko --\x3e\r\n            \x3c!-- /ko --\x3e\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!-- ko if: isBlocked() --\x3e\r\n            <div class="message content system" data-messagetype="SystemMessage" data-bind="listItem: true">\r\n                <span class="text" data-bind="html: textBlockChatMsg()"></span>\r\n            </div>\r\n        \x3c!-- /ko --\x3e\r\n        <div class="branding" aria-hidden="true" tabindex="-2" data-bind="css: {emptyBottomMargin: showSuggestedActions()}">\r\n            <typing-indicator params="conversation: conversation"></typing-indicator>\r\n            <div class="translate" data-bind="css: { isTranslating: translatorActive}">\r\n                <div class="translation-globe">\r\n                    <span class="swcIcon swcIcon_globe" aria-hidden="true"></span>\r\n                </div>\r\n                    <div data-bind="html: textTranslatorActive()">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="suggested-actions" data-bind="css: {\'show-suggested-actions\': showSuggestedActions()}">\r\n            \x3c!-- ko if: showSuggestedActions() --\x3e\r\n            <div class="navBtnWrapper" data-bind="click: scrollSuggestionsToLeft, css: { disabled: !hasSuggestedActionOnLeft()}">\r\n                <div class="left" role="button" role="button" data-bind="attr: {tabindex: hasSuggestedActionOnLeft() ? 0 : undefined}">\r\n                    <span class="swcIcon swcIcon_navigationBackCentered swcIcon_size_medium" aria-hidden="true"></span>\r\n                </div>\r\n            </div>\r\n            \x3c!-- /ko --\x3e\r\n            <div class="suggestionArea actionItems" data-bind="foreach: {data: suggestedActions}, scroll: suggestionsChanged">\r\n                <button class="actionItem" data-bind="click: $parent.invokeSuggestedAction,\r\n                    attr: {title: actionType === \'openUrl\' ? value : \'\'}, css: {icon: (actionType === \'openUrl\' || actionType === \'call\') }">\r\n                    \x3c!-- ko if: actionType === \'openUrl\' --\x3e\r\n                    <span class="swcIcon swcIcon_link" aria-hidden="true"></span>\r\n                    \x3c!-- /ko --\x3e\r\n                    \x3c!-- ko if: actionType === \'call\' --\x3e\r\n                    <span class="swcIcon swcIcon_callStart" aria-hidden="true"></span>\r\n                    \x3c!-- /ko --\x3e\r\n                    <p data-bind="html: title"></p>\r\n                </button>\r\n            </div>\r\n            \x3c!-- ko if: showSuggestedActions() --\x3e\r\n            <div class="navBtnWrapper" data-bind="click: scrollSuggestionsToRight, css: { disabled: !hasSuggestedActionOnRight()}">\r\n                <div role="button" data-bind="attr: {tabindex: hasSuggestedActionOnRight() ? 0 : undefined}">\r\n                    <span class="swcIcon swcIcon_navigationForwardCentered swcIcon_size_medium" aria-hidden="true"></span>\r\n                </div>\r\n            </div>\r\n            \x3c!-- /ko --\x3e\r\n        </div>\r\n        <div class="status-msg" data-bind="css: {\'show-status\': !isConnected()}">\r\n            <div class="down-btn" data-bind="attr: {tabindex: isConnected() ? undefined : 0}, text: textNoConnection()"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="swiftUnsupported">\r\n    <div class="lwx-message">\r\n        <div class="card unsupported">\r\n            <div class="text">\r\n                <div data-bind="text: unsupportedText"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftSingleCard">\r\n<div class="lwx-message" role="listitem">\r\n    \x3c!-- ko template: { name: \'contentSection\' } --\x3e\x3c!-- /ko --\x3e\r\n    <div class="card" data-bind="template: { name: cards[0].getContentTypeName() === \'hero\' || cards[0].getContentTypeName() === \'thumb\' ? \'swiftCard\' : \'swiftCard-\' + cards[0].getContentTypeName(), data: cards[0]}, css: cards[0].getContentTypeName()"></div>\r\n</div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftMultilineCard">\r\n    <div class="lwx-message multiline">\r\n        \x3c!-- ko template: { name: \'contentSection\' } --\x3e\x3c!-- /ko --\x3e\r\n        <div class="carouselContainer" data-bind="css: { multiLine: areButtonsMultiLine },\r\n                                          foreach: {\r\n                                              data: cards,\r\n                                              as: \'card\'\r\n                                          }">\r\n            <div class="card" data-bind="template: { name: card.getContentTypeName() === \'hero\' || card.getContentTypeName() === \'thumb\' ? \'swiftCard\' : \'swiftCard-\' + card.getContentTypeName(), data: card },\r\n                                        css: card.getContentTypeName()"></div>\r\n\r\n        </div>\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftCarouselCard">\r\n    <div class="lwx-message carousel" data-bind="css: { first: isFirst, last: isLast, multiple: isMultiple, double: cards.length == 2, triple: cards.length == 3 }">\r\n        \x3c!-- ko template: { name: \'contentSection\' } --\x3e\x3c!-- /ko --\x3e\r\n        <div class="carouselContainer" data-bind="css: { multiLine: areButtonsMultiLine },\r\n                                          foreach: {\r\n                                              data: cards,\r\n                                              as: \'card\',\r\n                                              afterRender: function(e, card) { e[1].addEventListener(\'focus\', function() { moveToCard(card); }, true); }\r\n                                          },\r\n                                          style: { left: carouselLeftPosition() }">\r\n            <div class="card" data-bind="template: { name: card.getContentTypeName() === \'hero\' || card.getContentTypeName() === \'thumb\' ? \'swiftCard\' : \'swiftCard-\' + card.getContentTypeName(), data: card },\r\n                                        css: card.getContentTypeName()"></div>\r\n\r\n        </div>\r\n        <div class="prev" data-bind="click: prevCard, enterKey: prevCard, attr: { title: prevCardTitle }">\r\n            <div class="button" role="button" tabindex="0">\r\n                <span class="swcIcon swcIcon_navigationBackCentered swcIcon_size_small" aria-hidden="true"></span>\r\n            </div>\r\n        </div>\r\n        <div class="next" data-bind="click: nextCard, enterKey: nextCard, attr: {title: nextCardTitle}">\r\n            <div class="button" role="button" tabindex="0">\r\n                <span class="swcIcon swcIcon_navigationForwardCentered swcIcon_size_small" aria-hidden="true"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftCard">\r\n    <div class="cardContent" data-bind="attr: { tabindex: (content.tap && content.tap.isValid()) ? -1 : null, role: (content.tap && content.tap.isValid()) ? \'presentation\' : null, title: (content.tap && content.tap.isValid()) ? content.tap.tooltip : null },\r\n                                              css: { tap: content.tap && content.tap.isValid() },\r\n                                              enterKey: (content.tap && content.tap.isValid()) ? content.tap.action : null,\r\n                                              click: (content.tap && content.tap.isValid()) ? content.tap.action : null, clickBubble: false">\r\n        \x3c!-- ko if: content.mainSection.isValid() --\x3e\r\n        \x3c!-- ko template: { name: \'swiftSection\', data: content.mainSection } --\x3e\x3c!-- /ko --\x3e\r\n        \x3c!-- /ko --\x3e\r\n        <div class="buttons" data-bind="foreach: { data: content.buttons, as: \'button\' }, css: { multiLine: content.areButtonsMultiLine}">\r\n            \x3c!-- ko template: { name: \'swiftButton\', data: button } --\x3e\x3c!-- /ko --\x3e\r\n        </div>\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftCard-flex">\r\n    <div class="cardContent" data-bind="attr: { tabindex: (content.tap && content.tap.isValid()) ? -1 : null, role: (content.tap && content.tap.isValid()) ? \'presentation\' : null, title: (content.tap && content.tap.isValid()) ? content.tap.tooltip : null },\r\n                                              css: { tap: content.tap && content.tap.isValid() },\r\n                                              enterKey: (content.tap && content.tap.isValid()) ? content.tap.action : null,\r\n                                              click: (content.tap && content.tap.isValid()) ? content.tap.action : null, clickBubble: false">\r\n        <div class="section">\r\n            \x3c!-- ko if: content.title || content.subtitle || content.text --\x3e\r\n            <div class="textContent">\r\n                \x3c!-- ko if: content.subtitle --\x3e\r\n                <h2 data-bind="html: content.subtitle, attr: { title: $element.textContent }"></h2>\r\n                \x3c!-- /ko --\x3e\r\n                \x3c!-- ko if: content.title --\x3e\r\n                <h1 data-bind="html: content.title, attr: { title: $element.textContent }"></h1>\r\n                \x3c!-- /ko --\x3e\r\n                \x3c!-- ko if: content.text --\x3e\r\n                <p class="normal" data-bind="html: content.text, attr: { title: $element.textContent }, css: content.expandedText() "></p>\r\n                \x3c!-- /ko --\x3e\r\n            </div>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: content.images.length > 0 --\x3e\r\n            \x3c!-- ko with: content.images[0] --\x3e\r\n            <div class="image" data-bind="attr: { tabindex: (tap && tap.isValid()) ? 0 : null, role: (tap && tap.isValid()) ? \'button\' : null, title: (tap && tap.isValid()) ? getTitleByType() : null },\r\n                                              css: { tap: tap && tap.isValid() },\r\n                                              enterKey: (tap && tap.isValid()) ? tap.action : null,\r\n                                              click: (tap && tap.isValid()) ? tap.action : null, clickBubble: false">\r\n\r\n                <img data-bind="attr: { src: url(), alt: alt, width: uiSize().width, height: uiSize().height }" />\r\n            </div>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- /ko --\x3e\r\n        </div>\r\n        \x3c!-- ko if: content.buttons.length > 0 --\x3e\r\n        <div class="buttons" data-bind="foreach: { data: content.buttons, as: \'button\' }, css: { multiLine: content.areButtonsMultiLine}">\r\n            \x3c!-- ko template: { name: \'swiftButton\', data: button } --\x3e\x3c!-- /ko --\x3e\r\n        </div>\r\n        \x3c!-- /ko --\x3e\r\n    </div>\r\n<\/script>\r\n\r\n\r\n<script type="text/html" id="swiftCard-receipt">\r\n    <div data-bind="attr: { tabindex: (content.tap && content.tap.isValid()) ? 0 : null, role: (content.tap && content.tap.isValid()) ? \'button\' : null, title: (content.tap && content.tap.isValid()) ? content.tap.tooltip : null },\r\n                                              css: { tap: content.tap && content.tap.isValid() },\r\n                                              enterKey: (content.tap && content.tap.isValid()) ? content.tap.action : null,\r\n                                              click: (content.tap && content.tap.isValid()) ? content.tap.action : null, clickBubble: false">\r\n        \x3c!-- ko if: content.title --\x3e\r\n        <h1 data-bind="html: content.title"></h1>\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!-- ko if: content.facts.length !== 0 --\x3e\r\n        <div class="facts" role="list" data-bind="foreach: { data: content.facts, as: \'fact\' }">\r\n            \x3c!-- ko template: { name: \'swiftFact\', data: fact } --\x3e\x3c!-- /ko --\x3e\r\n        </div>\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!-- ko if: content.displayedItems().length !== 0 --\x3e\r\n        <div class="items" role="list" data-bind="foreach: { data: content.displayedItems, as: \'item\' }">\r\n            <div class="item" role="listitem">\r\n                \x3c!-- ko template: { name: item.images.length !== 0 ? \'swiftSection\' : \'swiftItem\', data: item } --\x3e\x3c!-- /ko --\x3e\r\n            </div>\r\n        </div>\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!-- ko if: content.showFoldButton --\x3e\r\n        <div class="button fold" data-bind="attr: { tabindex: -1, role: \'button\', title: content.foldButtonText() },\r\n                                   enterKey: content.triggerFoldAction,\r\n                                   click: content.triggerFoldAction, clickBubble: false">\r\n            <span class="normal" data-bind="text: content.foldButtonText()"></span>\r\n        </div>\r\n        \x3c!-- /ko --\x3e\r\n        <div class="summary">\r\n            \x3c!-- ko if: content.vat --\x3e\r\n            <div class="line">\r\n                <span class="key normal" data-bind="text: content.vatText"></span>\r\n                <span class="value normal" data-bind="text: content.vat"></span>\r\n            </div>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: content.tax --\x3e\r\n            <div class="line">\r\n                <span class="key normal" data-bind="text: content.taxText"></span>\r\n                <span class="value normal" data-bind="text: content.tax"></span>\r\n            </div>\r\n            \x3c!-- /ko --\x3e\r\n            <div class="line">\r\n                <span class="key normal" data-bind="text: content.totalPriceText"></span>\r\n                <span class="value normal" data-bind="text: content.total"></span>\r\n            </div>\r\n        </div>\r\n        <div class="buttons" data-bind="foreach: { data: content.buttons, as: \'button\' }, css: { multiLine: content.areButtonsMultiLine}">\r\n            \x3c!-- ko template: { name: \'swiftButton\', data: button } --\x3e\x3c!-- /ko --\x3e\r\n        </div>\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftCard-signin">\r\n    <div class="text" data-bind="html: content.text"></div>\r\n    <div class="buttons" data-bind="foreach: { data: content.buttons, as: \'button\' }">\r\n        \x3c!-- ko template: { name: \'swiftButton\', data: button } --\x3e\x3c!-- /ko --\x3e\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftSection">\r\n    <div class="section" data-bind="attr: { tabindex: (tap && tap.isValid()) ? 0 : null, role: (tap && tap.isValid()) ? \'presentation\' : null, title: (tap && tap.isValid()) ? getTitleByType() : null },\r\n                css: { tap: tap && tap.isValid() },\r\n                enterKey: (tap && tap.isValid()) ? tap.action : null,\r\n                click: (tap && tap.isValid()) ? tap.action : null, clickBubble: false">\r\n        \x3c!-- ko if: subtitle || title || price || text --\x3e\r\n        <div class="textContent">\r\n            \x3c!-- ko if: subtitle --\x3e\r\n                <h2 data-bind="html: subtitle, attr: { title: $element.textContent }"></h2>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: title --\x3e\r\n                <h1 data-bind="html: title, attr: { title: $element.textContent }"></h1>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: price --\x3e\r\n                <span class="price normal" data-bind="html: price, attr: { title: $element.textContent }"></span>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: text --\x3e\r\n                <p class="normal" data-bind="html: text, attr: { title: $element.textContent }, css: { expandedText: expandedText() }"></p>\r\n            \x3c!-- /ko --\x3e\r\n        </div>\r\n        \x3c!-- /ko --\x3e\r\n        \x3c!-- ko if: images.length > 0 --\x3e\r\n            \x3c!-- ko with: images[0] --\x3e\r\n                \x3c!-- ko if: isValid() && url() --\x3e\r\n                <div class="image" data-bind="attr: { tabindex: (tap && tap.isValid()) ? 0 : null, role: (tap && tap.isValid()) ? \'button\' : null, title: (tap && tap.isValid()) ? getTitleByType() : null },\r\n                                              css: { tap: tap && tap.isValid() },\r\n                                              enterKey: (tap && tap.isValid()) ? tap.action : null,\r\n                                              click: (tap && tap.isValid()) ? tap.action : null, clickBubble: false">\r\n\r\n                    <img data-bind="attr: { src: url(), alt: alt, width: uiSize().width, height: uiSize().height },\r\n                                    style: { bottom: bottomAlignment() + \'px\'}" />\r\n                </div>\r\n                \x3c!-- /ko --\x3e\r\n            \x3c!-- /ko --\x3e\r\n        \x3c!-- /ko --\x3e\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftButton">\r\n    <div class="lwx-message button" data-bind="attr: { tabindex: isValid() ? -1 : null, role: isValid() ? \'button\' : null, title: tooltip },\r\n                                   enterKey: isValid() ? action : null,\r\n                                   click: isValid() && !isCallActionType ? action : null, clickBubble: false">\r\n\r\n            \x3c!--  ko if: !isCallActionType --\x3e\r\n            <span class="normal" data-bind="text: title"></span>\r\n            \x3c!-- /ko --\x3e\r\n\r\n            \x3c!--  ko if: isCallActionType && value --\x3e\r\n            <a data-bind="text: title, attr: { href: value }"></a>\r\n            \x3c!-- /ko --\x3e\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftFact">\r\n    <div class="fact" role="listitem">\r\n        <span class="key normal" data-bind="html: key"></span>\r\n        <span class="value normal" data-bind="html: value"></span>\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftItem">\r\n    <span class="swc-title" data-bind="html: title"></span>\r\n    <span class="price normal" data-bind="text: price"></span>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftCard-video">\r\n    <div class="cardContent" data-bind="css: content.aspect">\r\n        <div class="videoCard">\r\n            <videoplayer params="media: content.media.video, thumbnail: content.image.url, autoplay: content.autostart, muted: true, autoloop: false, displayMuteButton: true, messageId: $component.message.id, title: content.title, subtitle: content.subtitle"></videoplayer>\r\n        </div>\r\n        <div data-bind="template: \'mediaCardSection\', data: $data"></div>\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftCard-audio">\r\n    <div class="cardContent">\r\n        <div class="audioCard">\r\n            <div class="audio-message" data-bind="css: {thumbnail: content.hasThumbnail()}">\r\n                <div class="media-holder">\r\n                    <div class="media-content">\r\n                        <audioplayer params="media: content.media.audio, autoplay: content.autostart, messageId: $component.message.id, coverImage: content.image"></audioplayer>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-bind="template: \'mediaCardSection\', data: $data"></div>\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftCard-animation">\r\n    <div class="cardContent">\r\n        <div class="animationCard">\r\n            <gifplayer params="media: content.media.animation, coverImage: content.image"></gifplayer>\r\n        </div>\r\n        <div data-bind="template: \'mediaCardSection\', data: $data"></div>\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="contentSection">\r\n    \x3c!-- ko if: content --\x3e\r\n    <div class="card" data-bind="css: cards[0].getContentTypeName()">\r\n        <div class="cardContent">\r\n            <div class="section">\r\n                <div class="textContent">\r\n                    <p class="normal" data-bind="html: content"></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n<\/script>\r\n\r\n<script type="text/html" id="mediaCardSection">\r\n    \x3c!-- ko if: content.hasTextInfo() --\x3e\r\n    <div class="section">\r\n        <div class="textContent">\r\n            \x3c!-- ko if: content.title --\x3e\r\n            <h1 data-bind="text: content.title, attr: { title: content.title }"></h1>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: content.subtitle --\x3e\r\n            <h2 data-bind="text: content.subtitle, attr: { title: content.subtitle }"></h2>\r\n            \x3c!-- /ko --\x3e\r\n            \x3c!-- ko if: content.media --\x3e\r\n                \x3c!-- ko if: content.media.sourceDomain --\x3e\r\n                <h3 class="domain" data-bind="text: content.media.sourceDomain, attr: { title: content.media.sourceDomain }"></h3>\r\n                \x3c!-- /ko --\x3e\r\n            \x3c!-- /ko --\x3e\r\n        </div>\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n    <div class="buttons" data-bind="foreach: { data: content.buttons, as: \'button\' }, css: { multiLine: content.areButtonsMultiLine}">\r\n        \x3c!-- ko template: { name: \'swiftButton\', data: button } --\x3e\x3c!-- /ko --\x3e\r\n    </div>\r\n<\/script>\r\n\r\n<script type="text/html" id="swiftCard-adaptive">\r\n    <adaptivecard params="content: content, conversation: _conversation"></adaptivecard>\r\n<\/script>\r\n\r\n'},function(e,t){e.exports='<div class="typingIndicator" data-bind="css: {isTyping: isTyping()}">\r\n    <div class="bubble"></div>\r\n    <div class="bubble"></div>\r\n    <div class="bubble"></div>\r\n    <div>\r\n        <span data-bind="text: typingIndicator"></span>\r\n    </div>\r\n</div>\r\n'},function(e,t){e.exports='<div class="swc-conversation dragAndDropContainer" data-bind="event: {\r\n        click: onClicked,\r\n        dragenter: onDragEnter,\r\n        dragover: onDragOver,\r\n        dragleave: onDragLeave,\r\n        drop: onDrop\r\n     }, visible: !showAddParticipants() && !showRemoveParticipants() && !showShowParticipants()">\r\n    \x3c!-- ko if: showLoginPage --\x3e\r\n    <lwc-signin params="isSignedIn: signedIn, isConversationWithPerson: conversation.isPerson" data-bind="css:{anim:animateLoginScreen}"></lwc-signin>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    \x3c!-- ko if: signedIn --\x3e\r\n    \x3c!-- ko if: chatDataConfig.ShowHeader --\x3e\r\n    <div class="chat-header"></div>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    <messages-list role="list" aria-live="polite" class="swc-scroll-wrapper" data-bind="css: {\'no-header\': !chatDataConfig.ShowHeader, \'collapsed\': isCollapsed()}"  params="conversation: conversation, userMessageSent: userMessageSent, enable: enable"></messages-list>\r\n\r\n    \x3c!-- ko if: isGuest() && !userMessageSent() --\x3e\r\n    <div class="msa-privacy">\r\n        <div data-bind="html: ms_service_privacy_agreement" class="text"></div>\r\n    </div>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    <div class="action-bar" data-bind="css: {collapsed: isCollapsed()}"></div>\r\n    <div class="chat-input" data-bind="css: {collapsed: isCollapsed()}"></div>\r\n    \x3c!-- /ko --\x3e\r\n\r\n    \x3c!-- ko if: showBrand --\x3e\r\n    <div class="skypeBrandMessage" data-bind="text:brandMessage"></div>\r\n    \x3c!-- /ko --\x3e\r\n</div>\r\n\r\n\x3c!-- ko if: showParticipantsControl() --\x3e\r\n    \x3c!-- ko if: showAddParticipants() --\x3e\r\n        <div class="swcAddParticipantsRoot"></div>\r\n    \x3c!-- /ko --\x3e\r\n    \x3c!-- ko if: showRemoveParticipants() --\x3e\r\n        <div class="swcRemoveParticipantsRoot"></div>\r\n    \x3c!-- /ko --\x3e\r\n\x3c!-- /ko --\x3e\r\n'},function(e,t){e.exports="\r\n"},function(e,t){e.exports='\r\n\x3c!-- ko if: showReactionsBar --\x3e\r\n<ul class="reactionsItems" data-bind="foreach: { data: reactions(), as: \'reaction\' }">\r\n    <li tabindex="0" class="reactionItem" data-bind="click: $parent.showReactionPreview, event: { keydown: $parent.onKeyDown }">\r\n        <span class="emoticon" data-bind="attr:\r\n            { title: reaction.title, \'aria-label\': reaction.title },\r\n            style: { \'background-image\' : $parent.getEmoticonUrl(reaction.id) },\r\n            css: { highDpi: $parent.showHighDpiClass }">\r\n        </span>\r\n        <span class="counter" data-bind="text: reaction.users.length"></span>\r\n    </li>\r\n</ul>\r\n\x3c!-- /ko --\x3e\r\n'},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getView=function(t){var n=e.views[t];if(!n){var i=document.createElement("div");i.innerHTML=e.templates[t],n=e.views[t]=i}return n.firstElementChild.cloneNode(!0)},e.views={},e.templates={skype:'\n            <div class="conversation skype-conversation swc-focus-outline-area" data-bind="component: {\n                name: \'conversation\',\n                params: {\n                    conversation: conversation,\n                    enable: enable\n                }\n            }"></div>\n        '},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),a=n(2),c=n(1),u=n(97),l=n(164),p=n(0),d=n(126),f=n(336),h=n(604),g=[d.SupportedSounds.Notification,d.SupportedSounds.Ringing],m=function(e){function t(){var t=e.call(this)||this;return t._notifications=[],t._audioPlayer=new f.SoundPlayer(g),t._notifyBasedOnUserSettings=c.Configuration.ECS.notifyBasedOnUserSettings,t._add=function(e){var n=l.default.getActionsForNotification(e,t.props.chatDefinition),i=o({},e,{actions:n}),r=t._getSupportedSettingType(e.type),s=function(e){t._notifications.push(i),p.swc.Telemetry.sendEvent.notificationShown(i.type),t._refreshState(),e&&t._playSound(i)};r&&t._notifyBasedOnUserSettings?p.swc.services.notificationSettingsStore.get(r).then(t._notifyIfEnabled.bind(null,s)):s(!1)},t._remove=function(e){for(var n=0;n<t._notifications.length;n++){var i=t._notifications[n];if(i.id===e){t._notifications.splice(n,1),t._stopSound(i);break}}t._refreshState()},p.swc.Eventing.registerEvent("sendNotification",t._add),p.swc.Eventing.registerEvent("hideNotification",function(e){return t._remove(e)}),t}return r(t,e),t.prototype.render=function(){var e=this,t=this._notifications.length?{}:{display:"none"};return a.createElement("div",{className:"swc-notifications",style:t},this._notifications.map(function(t){return a.createElement(h.NotificationComponent,{key:t.id,notification:t,onClose:e._remove})}))},t.prototype._notifyIfEnabled=function(e,t){var n=!1,i=!1;switch(t.value){case u.NotificationAllowedValue.All:n=!0,i=!0;break;case u.NotificationAllowedValue.Notification:n=!0;break;case u.NotificationAllowedValue.Off:n=!1}n&&e(i)},t.prototype._getSupportedSettingType=function(e){var t=null;switch(e){case"UnreadMessage":t=u.NotificationSettingType.NewMessage;break;case"Calling":t=u.NotificationSettingType.IncomingCall}return t},t.prototype._playSound=function(e){e.sound&&(e.loopSound?this._audioPlayer.play(e.sound):this._audioPlayer.playOnce(e.sound))},t.prototype._stopSound=function(e){e.sound&&this._audioPlayer.stop(e.sound)},t.prototype._refreshState=function(){this.setState({notificationIds:this._notifications.map(function(e){return e.id})})},t}(s.Component);t.NotificationList=m},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(0),c=n(41),u=n(14),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._textAccept=a.swc.services.i18n.fetch("accept"),t._textIgnore=a.swc.services.i18n.fetch("ignore"),t._textClose=a.swc.services.i18n.fetch("calling_participants_close"),t.handleAction=function(e,n){for(var i,r=0,o=t.props.notification.actions;r<o.length;r++){var s=o[r];if(s.type===e){i=s;break}}i.action&&i.action(),n&&n.stopPropagation(),t.close()},t}return r(t,e),t.prototype.componentDidMount=function(){var e=this;this.timer=setTimeout(function(){e.handleAction("Ignore")},3e4)},t.prototype.componentWillUnmount=function(){this.timer&&clearTimeout(this.timer)},t.prototype.render=function(){var e=this.props.notification,n=t._getClassName(e.type),i="Calling"===e.type;return s.createElement("div",{className:"notification "+n,onClick:o.linkEvent("Accept",this.handleAction)},s.createElement(c.SwcAvatar,{size:c.SwcAvatarSize.Medium,title:e.title,avatarUrl:e.avatarUrl}),s.createElement("div",{className:"content"},s.createElement("h2",null,e.title),s.createElement("p",null,e.description)),i&&s.createElement("div",{className:"actions"},s.createElement("button",{className:"action accept",title:this._textAccept,onClick:o.linkEvent("Accept",this.handleAction)},s.createElement(u.SwcIcon,{size:u.SwcIconSize.Medium,type:u.SwcIconType.CallStart})),s.createElement("button",{className:"action decline",title:this._textIgnore,onClick:o.linkEvent("Ignore",this.handleAction)},s.createElement(u.SwcIcon,{size:u.SwcIconSize.Medium,type:u.SwcIconType.CallEnd}))),s.createElement("button",{className:"close",title:this._textClose,onClick:o.linkEvent("Ignore",this.handleAction)},s.createElement(u.SwcIcon,{size:u.SwcIconSize.Medium,type:u.SwcIconType.Cancel})))},t._getClassName=function(e){var t="";switch(e){case"Calling":t="calling";break;case"Reminder":t="reminder";break;case"Summary":t="summary";break;case"UnreadMessage":t="message"}return t},t.prototype.close=function(){this.props.onClose(this.props.notification.id)},t}(o.Component);t.NotificationComponent=l}]);